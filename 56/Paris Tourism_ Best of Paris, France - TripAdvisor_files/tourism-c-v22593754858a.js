if(typeof ta==="undefined"){var ta={}}var api=(function(){if(window.IS_DEBUG==null){window.IS_DEBUG=false}if(window.VERSION_MAP==null){window.VERSION_MAP={}}if(window.CDNHOST==null){window.CDNHOST=""}var a={overlays:{},maps:{},bmaps:{},common:{},phac:{},servlet:{},support:{},util:{},widgets:{},commerce:{},mobfull:{},photos:{},media:{},hac:{filters:{}},t4b:{},api:{maps:{}},p13n:{},registration:{},meta:{},reviews:{}};a.id=function(d){try{return document.id(d)}catch(f){if(a.util.error){a.util.error.record(f,"ta.id - trouble wrapping",null,{elmtArg:a.util.error.describe(d)})}}};a.select=function(){var e=Array.from(arguments),f=e.length>1&&(("string"===typeof e[0])?e.pop():e.shift())||document,d=e.shift();return Slick.search(f,d,new Elements)};a.invoke=function(d,e){d.each(function(f){f[e]()})};a.selectInvoke=function(d,e){a.invoke($$(d),e)};a.css=function(e,d){return Asset.css(e,Object.merge({media:"screen, print"},d))};a.throttle=function(j,e,g,h){var f=(new Date()).getTime();var i;if(e in c){i=c[e];if(f-i.lastReset<i.minResolution){i.cb=j;return}}else{i=c[e]={start:f,minResolution:Math.max(Math.floor(g/10),50)}}i.cb=j;function d(){delete c[e];i.cb()}if(i.timeout){clearTimeout(i.timeout)}if(h&&(f-i.start>h)){d()}else{i.lastReset=f;i.timeout=setTimeout(d,g)}};var c={};var b=a;b.extend=_.extend;b.bind=function(d,e){return Function.prototype.bind.apply(d,Array.from(arguments).slice(1))};b.addEvent=function(d,f,e){return d&&$(d).addEvent(f,e)};b.fireEvent=function(e,f,d){return e&&$(e).fireEvent(f,d)};b.removeEvent=function(d,f,e){return d&&$(d).removeEvent(f,e)};b.createElement=function(d,e){return new Element(d,e)};b.getSize=function(d){return d&&$(d).getSize()};b.getPosition=function(d){return d&&$(d).getPosition()};b.getCoords=function(d){return d&&$(d).getCoordinates()};b.addClass=function(d,e){return d&&$(d).addClass(e)};b.removeClass=function(d,e){return d&&$(d).removeClass(e)};b.toggleClass=function(d,e,f){return d&&$(d).toggleClass(e,f)};b.hasClass=function(d,e){return d&&$(d).hasClass(e)};b.find=function(d,e){return $(e||document).getElement(d)};b.findAll=b.select;b.adopt=function(d){return Element.prototype.adopt.apply($(d),Array.prototype.slice.call(arguments,1))};b.parent=function(e,d){return e&&$(e).getParent(d)};b.getOffsetParent=function(d){return d&&$(d).getOffsetParent()};b.getOffsets=function(d){return d&&$(d).getOffsets()};b.setStyle=function(d,f,e){return d&&$(d).setStyle(f,e)};b.bindAll=function(d){if(arguments.length>1){Array.from(arguments).slice(1).each(function(e){d[e]=b.bind(d[e],d)})}else{Object.each(d,function(f,e){d[e]=b.bind(f,d)})}return d};b.checkBrowser=function(){return Array.from(arguments).some(function(d){return !!Browser[d]})};b.isNode=function(d){return(typeof Node==="object"?d instanceof Node:d&&typeof d==="object"&&typeof d.nodeType==="number"&&typeof d.nodeName==="string")};b.isElement=function(d){return(typeof HTMLElement==="object"?d instanceof HTMLElement:d&&typeof d==="object"&&d.nodeType===1&&typeof d.nodeName==="string")};b.inDocument=function(d){return !!d.parentNode&&d.parentNode.nodeType!==11};b.removePropertyEvent=function(f,h,g){if(h.substr(0,2)!=="on"){h="on"+h}f=$(f);var l="ta.call(",k=f.getProperty(h),d=k&&k.indexOf(g),j=k&&k.indexOf(")",d),i;if(!k||d<0){return}if(k.charAt(j+1)==";"){j++}if(k.charAt(d+g.length)=="("){i=k.slice(0,d)+k.slice(j+1)}else{if(d>=l.length+1&&k.substr(d-l.length-1,l.length)==l){d-=l.length+1;i=k.slice(0,d)+k.slice(j+1)}}f.setProperty(h,i&&i.trim())};b.containsEvent=function(e,h){if(!h){return false}var d=h.pageX,g=h.pageY;var f=b.getCoords(e);if("fixed"==(b.getOffsetParent(e)||e).style.position||typeof d==="undefined"||typeof g==="undefined"){d=h.clientX;g=h.clientY}return(g>=f.top&&g<=f.bottom&&d>=f.left&&d<=f.right)};b.containsElement=function(d,e){if(!d||!e){return false}while(e!=null){if(e===d){return true}e=e.parentElement}return false};b.elementOrParentMatches=function(d,e){if(!d||!e){return false}while(d!=null){if(e(d)){return true}d=d.parentElement}return false};b.createNamespace=function(d){var e=d.split(".");return e.reduce(function(g,f){return g[f]||(g[f]={})},window)};b.mixin=function(d){Array.prototype.slice.call(arguments,1).forEach(function(e){for(var f in e){this[f]=e[f]}},d)};b.merge=function(g){var f=Array.prototype.slice.call(arguments,1);for(var e=0,d=f.length;e<d;e++){for(var h in f[e]){if(f[e].hasOwnProperty(h)){g[h]=f[e][h]}}}};b.isArray=function(d){return Object.prototype.toString.call(d)==="[object Array]"};b.forceReflow=function(d){d&&d.offsetWidth};b.scrollTop=function(){var d=window.pageYOffset!==undefined,e=((document.compatMode||"")==="CSS1Compat");return d?window.pageYOffset:e?document.documentElement.scrollTop:document.body.scrollTop};b.scrollLeft=function(){var d=window.pageXOffset!==undefined,e=((document.compatMode||"")==="CSS1Compat");return d?window.pageXOffset:e?document.documentElement.scrollLeft:document.body.scrollLeft};if(window.define){define("ta",[],function(){return a})}return b})();api.merge(ta,api);var ifdefNN=function(a){return typeof(a)!=="undefined"&&a!==null};(function(a){var b={};a.store=function(c,d){b[c]=d;return d};a.retrieve=function(c){return b[c]};a.has=function(c){return typeof(b[c])!="undefined"};a.retrieveOrStore=function(c,d){var e=b[c];if(typeof(e)=="undefined"){b[c]=d;e=d}return e};a.remove=function(c){var d=b[c];delete b[c];return d};a.keep=function(e,f){var d=[];var c=a.retrieve(e);if(c){if(c instanceof Array){d=c}else{d.push(c)}}if(f instanceof Array){d=d.combine(f)}else{d.push(f)}a.store(e,d)};a.merge=function(c,e){var d=a.retrieve(c)||{};if(Object&&Object.merge){a.store(c,Object.merge(d,e))}else{if($&&$.extend){a.store(c,$.extend({},d,e))}}};a.asInt=function(d,c){var e=parseInt(a.retrieve(d));return isNaN(e)?(c||0):e};a.asFloat=function(d,c){var e=parseFloat(a.retrieve(d));return isNaN(e)?(c||0):e};a.executeCallbacks=function(d){if(a.has(d)){var e=a.retrieve(d);if(!e instanceof Array){return}for(var c=0;c<e.length;c++){e[c]()}}}})(ta);ta.load=function(c,g){var f=false;var d=ta.findFileKey(c);if(d){f=VERSION_MAP[d]}if(f){var a=d+"_callback";if(ta.has(a)){var e=ta.retrieve(a);e.push(g);ta.store(a,e)}else{ta.store(a,[function(){delete VERSION_MAP[d];if(g){g()}}]);var b=function(){var h=ta.remove(a);h.each(function(i){if(i){i()}})};if(typeof f==="object"){ta.loadInOrder(f,b)}else{Asset.javascript(f,{onLoad:b})}}}return f};ta.loadInOrder=function(a,d){var c=a.slice();var b=function(){if(c.length===0){d()}else{Asset.javascript(c.shift(),{onLoad:b})}};b()};ta.findFileKey=function(f){if(typeof f!="string"||!VERSION_MAP){return}var d=false;var c=false;if(VERSION_MAP[f]){c=f}else{if(VERSION_MAP[f+".js"]){c=f+".js"}else{var a=f.split(".");var b=0;while(a&&a.length>1&&b<10){a=a.slice(0,-1);var e=a.join("-")+".js";if(e&&VERSION_MAP[e]){c=e;break}b++}}}return c};(function(ta){var _eventListeners={};ta.call=function(funcName,evnt,elmt){if(evnt==null){if(IS_DEBUG){alert("You must pass the event.\n\nUsage:\nta.call('ta.namespace.Class.function', event);")}return false}if(funcName==null){if(IS_DEBUG){alert("ta.call of undefined function")}return false}var func=funcName;if(typeof(funcName)==="function"){funcName="<func>"}else{if(!/^ta\.[\w\d\.]+$/.test(funcName)){if(IS_DEBUG){alert("Invalid function name. Must be of the form: ta.namespace.Class.function")}return false}}var e=new Event(evnt||window.event);if(!elmt){elmt=e.target}elmt=ta.id(elmt);if(!elmt){ta.util.error.record(null,"ta.call re-wrap fail (non-DOM element) - "+funcName,evnt,{elmtArg:ta.util.error.describe({none:"none"}),funcName:funcName})}else{if(!elmt.$family){ta.util.error.record(null,"ta.call re-wrap fail - "+funcName,evnt,{elmtArg:ta.util.error.describe(elmt),funcName:funcName})}}var argSet=arguments;var args=Array.from(argSet).slice(3);args.splice(0,0,e,elmt);try{args.unshift({callback:_ta_call_defer,evt:e});args.unshift(func);return ta.run.apply(null,args)}catch(_ex){ta.util.error.record(_ex,"ta.call - "+funcName,evnt)}return false};var _ta_call_defer=function(func,options){if(options){delete (options.evt)}ta.run.apply(null,arguments)};ta.run=function(func,options){var argSet=arguments,args=Array.from(argSet).slice(2);try{var fn=ta.fn(func);if(fn&&typeOf(fn)==="function"){var retVal=fn.apply(window,Array.from(args));if(options&&options.onComplete){var completeFun=ta.fn(options.onComplete);if(completeFun){completeFun(retVal)}}return retVal}else{if(options&&options.evt){new Event(options.evt).preventDefault()}}var callback=options&&options.callback;ta.load(func,(callback||ta.run).pass(arguments))}catch(_ex){ta.util.error.record(_ex,"ta.run - "+func)}return false};ta.on=function(name,f){var v=_eventListeners[name];if(!v){v=_eventListeners[name]=[]}v.push(f)};ta.fireEvent=function(name){var args=Array.from(arguments),listeners=_eventListeners[name];args.shift();if(listeners){listeners.each(function(callback){callback.attempt(args)})}};ta.off=function(name,f){var v=_eventListeners[name],index;if(v instanceof Array){index=v.indexOf(f);if(index>=0){v.splice(index,1)}}};var OneTimeFunctionQueue=function(evtName){var _queue=[];var _runNow=false;var _execFn=function(fn,name){try{fn()}catch(_ex){try{ta.util.error.record(_ex,"OneTimeFunctionQueue "+evtName+(name?"-"+name:""))}catch(ignore){}}};var _runQueuedFunctions=function(){var startTiming=new Date();var funcTimings={};var anonFuncCounter=1;var recordTiming=ta.has("ta.js_load_tracking")&&evtName=="load";_queue.sort(function(a,b){return(a.priority-b.priority)||(a.subpriority-b.subpriority)});for(var i=0;i<_queue.length;++i){var funcStartTime=new Date();_execFn(_queue[i].func,_queue[i].name);if(recordTiming){var funcEndTime=new Date();var funcName=_queue[i].name;if(!funcName){funcName="Anon "+(anonFuncCounter++)}funcTimings[funcName]=funcEndTime.getTime()-funcStartTime.getTime()}}_queue=[];if(recordTiming){var endTiming=new Date();var totalTime=endTiming.getTime()-startTiming.getTime();ta.util.perf.loadPingback(totalTime,funcTimings)}};if(evtName!=null){window.addEvent(evtName,function(){_runNow=true;_runQueuedFunctions()})}this.addToQueue=function(fn,priority,name){if(!fn){ta.util.error.record(null,"addToQueue for "+evtName+" queue - no function");return}if(typeof priority==="string"){name=priority;priority=false}if(_runNow){_execFn(fn,name)}else{priority=priority||(100+_queue.length);_queue.push({func:fn,priority:priority,name:name,subpriority:_queue.length})}};this.executeQueue=function(){_runQueuedFunctions()}};var _readyQ=new OneTimeFunctionQueue("domready");var _loadQ=new OneTimeFunctionQueue("load");var _lazyImgQ=new OneTimeFunctionQueue(null);ta.queueForReady=function(fn,priority,name){_readyQ.addToQueue(fn,priority,name)};ta.queueForLoad=function(fn,priority,name){if(typeof IS_DEBUG!="undefined"&&IS_DEBUG){var tempName=name;if(typeof priority==="string"){tempName=priority}}_loadQ.addToQueue(fn,priority,name)};ta.queueLazyImg=function(element){var priority;try{priority=element.priority||1000}catch(ignore){return}var _fn=function(){try{if(element.oSRC!==""){if(element.tagName.toUpperCase()==="IMG"){element.src=element.oSRC}else{element.style.backgroundImage="url('"+element.oSRC+"')"}element.oSRC="";element.priority=""}}catch(e){ta.util.error.record(e,"lazy img",null,{src:element.src,oSRC:element.oSRC})}};_lazyImgQ.addToQueue(_fn,priority)};ta.manualProcessLoadQueue=function(){_loadQ.executeQueue()};ta.processLazyImages=function(){_lazyImgQ.executeQueue()};ta.fn=function(fn){switch(typeof(fn)){case"function":return fn;case"string":var f=false;try{f=eval(fn)}catch(e){}if(!f){var ns=fn.split("."),n=ns.pop();try{ns=eval(ns.join("."));f=ns&&ns._magic&&ns._magic.partial(n)}catch(e){}}if(f&&typeof(f)==="function"){return f}break}return null}}(ta));(function(E,d,j){d=E.ta=E.ta||{};d.analytics||(d.analytics={});var K=8;var b="impressionTrackingTree";var f=0,g=1,o=2;var i=[];var D=60;var H=function(U){return typeof U==="function"};var z=function(){var V=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],X;if(E.XMLHttpRequest){X=new XMLHttpRequest()}else{for(var U=0;U<V.length;U++){try{X=new ActiveXObject(V[U]);break}catch(W){}}}return X};var m=function(U,V){try{if(!U||typeof V!=="object"){return}if(E.JSON&&JSON.stringify){var W=JSON.stringify(V);if(W&&W.length<100000){i.push([U,W]);if(i.length>D){i.shift()}}}}catch(X){}};var t=function(Z,V,aa){if(!Z||typeof V!=="object"){C(new Error("postUrl/dataObj is null/empty/undefined"),"TA.Record _simpleAjaxPost",null,arguments);if(aa){aa()}return}var W;if(typeof Request!=="undefined"&&E.MooTools){W={url:Z,method:"post",data:V};if(aa){W.onComplete=aa;W.timeout=3000}var X=new Request(W).send();m(Z,V);return X}else{if(typeof Zepto!=="undefined"&&Zepto&&H(Zepto.ajax)){W={type:"POST",url:Z,data:V,error:function(ad,ab){var ac=/InvalidTrackingTreeException/;if(E.IS_DEBUG&&new RegExp(ac).exec(ad.response)){var ae=/Caused by:\s(.*)\n/;alert("TRACKING ERROR DETECTED\n"+new RegExp(ae).exec(ad.response)[1])}C(new Error("XHR error, errorType = "+ab),"TA.Record _simpleAjaxPost",null,arguments)}};if(aa){W.complete=aa;W.timeout=3000}Zepto.ajax(W)}else{if(typeof jQuery=="function"){W={url:Z,type:"POST",data:V};if(aa){W.complete=aa;W.timeout=3000}jQuery.ajax(W)}else{var U=z(),Y=h(V);U.open("POST",Z,false);U.setRequestHeader("Content-type","application/x-www-form-urlencoded");U.setRequestHeader("Content-length",Y.length);U.send(Y)}}}m(Z,V)};var C=function(){if(d&&d.util&&d.util.error&&d.util.error.record){d.util.error.record.apply(this,arguments)}else{if(d&&d.m&&H(d.m.recordJSError)){d.m.recordJSError(arguments)}}};var A=function(U){if(U===j||U==null){return""}if(typeof U!=="string"){U=U.toString()}return U.replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*")};var T=function(X){var U=[];for(var V in X){var W=X[V];U.push(A(V)+"."+A(W))}return U.join("*")};var x=function(U){if(U===j||U===null){return""}if(typeof U!=="string"){U=U.toString()}return U.replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*").replace(/\~/g,"!~")};var s=function(X){var U=[];for(var V in X){var W=X[V];U.push(x(V)+"."+x(W))}return U.join("*")};var q=function(U){var V=/(https?:\/\/[^\/]+)?\/([^#.?-]*)/;var W=V.exec(U);if(W){if(typeof W[2]!="undefined"){return(W[2])?W[2]:"Home"}}return null};var P=function(){var U=d.analytics.pageData&&d.analytics.pageData.length&&d.analytics.pageData[d.analytics.pageData.length-1];if(U&&U.url){return U.url.substring(1)}else{var V=/\/([^-]*)/.exec(E.location.pathname);return V?V[1]:null}};var Q=function(W,U,X){var V=new RegExp("(-"+U+"([0-9]+))|([?&]"+X+"=([0-9]+))");var Y=V.exec(W);if(Y){if(typeof Y[2]!="undefined"){return Y[2]}if(typeof Y[4]!="undefined"){return Y[4]}}return null};var I=function(U){return Q(U,"d","detail")||Q(U,"g","geo")};var J=function(U){var V=document.cookie.match("(?:^|;)\\s*"+U+"=([^;]*)");if(V){V=V[1];if(V.indexOf("%1%")===0){V=V.substring(3)}return decodeURIComponent(V)}return false};var r=function(X,Y,V){try{var U;if(V.encode){Y=encodeURIComponent(Y)}if(V.domain){Y+="; domain="+V.domain}if(V.path){Y+="; path="+V.path}if(V.duration){U=new Date();U.setTime(U.getTime()+V.duration*1000);Y+="; expires="+U.toGMTString()}if(V.secure){Y+="; secure"}document.cookie=X+"="+Y}catch(W){C(W,"_setCookieInSeconds",null,arguments)}};var S=function(){if(d.m&&d.m.store&&d.m.store.has("bookingSessionId")){return d.m.store.get("bookingSessionId")}return null};var B=function(){var U=false;if(typeof d.userLoggedIn==="boolean"){if(typeof d.userSecurelyLoggedIn==="boolean"){U=d.userLoggedIn?(d.userSecurelyLoggedIn?o:g):f}else{U=d.userLoggedIn}}return U};var N=function(X,V){var U={gac:X[1],gaa:X[2],gal:X[3],gav:X[4],gani:X[5],gass:P(),gasl:I(document.location.href),gads:q(V),gadl:I(V),gapu:d.uid,gams:B()},W=S();if(!U.gass){throw new Error("Src servlet undefined, gac:"+U.gac+", gaa:"+U.gaa+", gal:"+U.gal)}if(!U.gads){throw new Error("Dst servlet undefined. gac:"+U.gac+", gaa:"+U.gaa+", gal:"+U.gal)}if(d.has&&d.has("gatt")){U.gatt=d.retrieve("gatt")}if(W){U.bsid=W}r("EVT",T(U),{domain:cookieDomain,duration:5,encode:true,path:"/"})};var O=function(X){if(!X||!X.className||!X.firstChild){return false}var W=new RegExp("\\b"+b+"\\b"),U=X.firstChild.nodeType,V=X.firstChild.nodeValue;return W.test(X.className)&&U===K&&V!==""};d.analytics._GARecordRequest=function(Y,W){var V={gac:Y[1],gaa:Y[2],gal:Y[3],gav:Y[4],gani:Y[5],gass:P(),gasl:I(document.location.href),gapu:d.uid,gams:B()},X=S(),U;if(W){V.gacl=W}if(d.has&&d.has("gatt")){V.gatt=d.retrieve("gatt")}if(X){V.bsid=X}if(typeof Request!="undefined"&&E.MooTools){U=new Request({url:"/GARecord",data:V})}else{U={get:function(){setTimeout(function(){var Z=new XMLHttpRequest();Z.open("GET","/GARecord?"+h(V),true);Z.send(null)},1)}}}m("/GARecord",V);return U};var h=function(V){var W=[];for(var U in V){W.push(encodeURIComponent(U)+"="+encodeURIComponent(V[U]))}return W.join("&")};d.urlArgLookup=function(X,U){var W=new RegExp("[\\?&]"+X+"=(\\w+)");var V=W.exec(U);if(V&&typeof V[1]!==j){return V[1]}return null};d.analytics._JSON_parse=function(U){if(JSON.parse){return JSON.parse(U)}if(JSON.decode){return JSON.decode(U)}throw new Error("No JSON.parse or JSON.decode")};d.analytics._validatedTrackEventArray=function(W,Y,U,X,V){if(W&&typeof W!="string"){W=W.toString()}if(Y&&typeof Y!="string"){Y=Y.toString()}if(U&&typeof U!="string"){U=U.toString()}if(!X){X=0}else{if(typeof X!="number"){X=parseFloat(X);if(isNaN(X)){X=0}}}if(typeof V!="boolean"){V=(V===true)}return["_trackEvent",W,Y,U,X,V]};d.analytics._toEvtParams=function(W){try{var U={gac:W.module,gaa:W.action,gal:W.context,gav:W.value,gani:W.noninteraction};U.gass=P();U.gasl=I(document.location.href);U.gapu=d.uid;U.gams=B();return U}catch(V){C(V,"ta.analytics._toEvtParams",null,W)}};d.analytics._trackEventAfterAjax=function(V){try{d.trackDMPBehavior(V.module,V.action,V.context,V.value,V.noninteraction)}catch(U){C(U,"ta.analytics._trackEventAfterAjax",null,V)}};d.getEventPathOptions=function(Z,W,V){try{var Y=u(V,Z);if(!Y){C(null,"ta.getEventPathOptions - invalid element",null,arguments);return}var U=G(Y);if(W){U.noninteraction=W}return U}catch(X){C(X,"ta.getEventPathOptions",null,arguments)}};d.analytics._trackEventPathAfterAjax=function(U){try{d.trackEventOnPage(U.category,U.action,U.label,U.value,U.noninteraction)}catch(V){C(V,"ta.analytics._trackEventPathAfterAjax",null,arguments)}};d.trackPhysicalCommerce=function(W,V,Z,U){try{var X=d.analytics._validatedTrackEventArray(W,"Commerce-Physical",V,Z,false);d.analytics._GARecordRequest(X,U).get()}catch(Y){C(Y,"ta.trackPhysicalCommerce",null,arguments)}};d.trackAttemptedCommerce=function(V,U,X){try{d.trackDMPBehavior(V,U,X,null,null)}catch(W){C(W,"ta.trackAttemptedCommerce",null,arguments)}};d.trackPhysicalAndAttemptedCommerce=function(W,V,X,Y,U){d.trackPhysicalCommerce(W,V,Y,U);d.trackAttemptedCommerce(W,V,X,Y)};d.trackImpressionEventOnPage=function(V,X,U,W){V=V||"";X=X||"";U=U||"";W=W||0;d.trackEventOnPage(V,X,U,W,true)};d.trackEventOnPage=function(V,Z,U,Y,X){try{var W=d.analytics._validatedTrackEventArray(V,Z,U,Y,X);d.analytics._GARecordRequest(W).get();d.trackDMPBehavior(V,Z,U,Y,X)}catch(aa){C(aa,"ta.trackEventOnPage",null,arguments)}};d.trackCommerceClickForInsight=function(Z){if(!d.retrieve("insight_profile_commerce_clicks_from_data_attributes.enabled")){return}try{var aa=d.id(Z),ad,V,ab,U,X,ae,W,Y;ad=aa.get("data-offerauthor");V=aa.get("data-locationId");ab=aa.get("data-pernight");X=d.meta.link.getUrlFromClickElem(aa);ae=d.popups.PopUtil.extractSlotFromCommerceUrl(X);U=I(document.location.href);W={};W.providerName=""+ad;W.clickLocId=""+V;W.price=""+ab;W.slot=""+ae;W.pageLocId=""+U;Y=JSON.encode(W);d.trackEventOnPage("InsightEvent","InsightCommerceClick",Y)}catch(ac){C(ac,"ta.trackCommerceClickForInsight",null,arguments)}};d.trackEventOnPageOnce=function(Y,aa,W,X){var U="eventsAlreadyTracked",Z;if(ifdefNN(d)&&ifdefNN(d.m)&&ifdefNN(d.m.store)){Z=d.m.store.get(U)}else{Z=d.retrieve(U)}if(!Z){Z={};if(ifdefNN(d)&&ifdefNN(d.m)&&ifdefNN(d.m.store)){d.m.store.add(U,Z)}else{d.store(U,Z)}}var V=Y+"|"+aa+"|"+W;if(!Z[V]){d.trackEventOnPage(Y,aa,W,0,X);Z[V]=true}};d.trackDMPBehavior=function(V,Y,U,X,W){try{if(d.common&&d.common.dmp&&d.common.dmp.isEnabled()){d.common.dmp.sendGABehavior(V,Y,U,X,W)}}catch(Z){C(Z,"Error adding and sending GARecord behavior to DMP")}};d.setEvtCookie=function(W,Z,V,Y,U){try{var X=d.analytics._validatedTrackEventArray(W,Z,V,Y,false);N(X,U);if(d.common&&d.common.dmp&&d.common.dmp.isEnabled()){d.common.dmp.sendEventBehavior(W,Z,V,Y,M())}}catch(aa){C(aa,"ta.setEvtCookie",null,arguments)}};var v=function(W){var V;try{V=J("MEVT")||"";if(V.length>0){V+="~"}V+=s(W);if(V.length>1024){throw"MEVT Cookie is full"}r("MEVT",V,{domain:cookieDomain,duration:5,encode:true})}catch(U){C(U,"_appendMevtCookie",null,arguments);return false}return true};var l="trk";var a=l.length;var L="etk";var p=/^([A-Z]{1,2}:)?[A-Za-z_0-9\-\.]+$/;var M=function(){var U=(typeof event!="undefined")?event:E.event;if(U){return U.target||U.srcElement}return document.activeElement};d.analytics.getCommentTrackingPath=function(U,V){return u(U,V)};var u=function(aa,ac){if(!aa){aa=M();if(!aa){C(null,"_getCommentTrackingPath - no element provided or event target element",null,arguments);return null}}if(aa.nodeType!=1){return null}var af=[];if(ac&&typeof ac=="string"&&ac!==""){if(p.test(ac)){if(ac.substring(0,2)=="P:"){af.push(ac.substring(2));return af}else{af.push(ac)}}}if(typeof aa.previousSibling==="undefined"){C(null,"_getCommentTrackingPath - browser does not support previousSibling",null,arguments);return af}LOOP_PARENT_NODES:for(var X=aa;X!=document.body;X=X.parentNode){if(X==null){C(null,"_getCommentTrackingPath - LOOP_PARENT_NODES got unexpected null node",null,arguments);break}var ad=0;for(var U=X.previousSibling;U!=null;U=U.previousSibling){if(U.nodeType==K){var W=U.nodeValue;if(W==L){ad++;continue}if(W.substring(0,a)!=l){continue}if(ad>0){ad--;continue}var Z=W.substring(a).split("/");if(!Z){C(null,'ta._getCommentTrackingPath - cannot split context class: "'+W+'"',null,arguments)}for(var ae=Z.length-1;ae>=0;ae--){var V=Z[ae];var ab=p.exec(V);if(!ab){C(null,'ta._getCommentTrackingPath - tracking prefix used with invalid context: "'+Z[ae]+'"',null,arguments);continue}if(ab[1]=="P:"){var Y=ab[0].substring(2);af.push(Y);break LOOP_PARENT_NODES}else{af.push(ab[0])}}}}}return af};var G=function(W){if(W.length===0){return null}var U={action:W[0],label:"",value:"1",category:W[W.length-1]};W.shift();for(var V=W.length-2;V>=0;V--){U.label+=W[V];if(V>0){U.label+="/"}if(W[V].substring(0,2)=="N:"){U.value=W[V].substring(2)}}if(U.label===""){U.label="Unknown"}return U};d.trk=function(ab,X,W,Y){try{var aa=u(W,ab);if(!aa){C(null,"ta.trk - invalid element for "+ab,null,arguments);return}if(Y&&Y.length>0&&aa.length&&aa.splice){for(var V=Y.length-1;V>=0;V--){if(typeof(Y[V])==="string"){aa.splice(1,0,Y[V])}}}var U=G(aa);d.trackEventOnPage(U.category,U.action,U.label,U.value,X)}catch(Z){C(Z,"ta.trk",null,arguments)}};d.trkImpTree=function(V,X){try{if(!O(V)){C(null,"ta.trkImpTree called with invalid trackTreeElem!",null,arguments);if(X){X()}return}var U=V.firstChild.nodeValue;n(U,X)}catch(W){C(W,"ta.trkImpTree",null,arguments);if(X){X()}}};d.recordImpression=function(U,W){if(!U){if(W){W()}return}try{n(F(U),W)}catch(V){C(V,"ta.recordImpression",null,arguments);if(W){W()}}};var y="<!--";var w="-->";var F=function(U){var V=U.indexOf(y),W=0,X=U.indexOf(w);if(V!==-1){W=V+y.length}if(X===-1){X=U.length}return U.substring(W,X)};d.analytics.stripCommentsFromTree=F;var k="\\";var c="/";d.analytics.appendAscendTokens=function(V){var X=0,W=0,U=0;for(X=0;X<V.length;X++){if(V[X]===c){U++}else{if(V[X]===k){W=X+1;while(W<V.length&&V[W]===k){U--;X=W;W++}}}}if(U>0){for(X=0;X<U;X++){V+=k}}return V};var n=function(U,W){var V={tTreeStr:U&&U.trim(),tTreeUid:d.uid&&d.uid.trim(),tTreeLastReferrer:E.location.href,tTreeIsMemberSignedIn:B()};if(d.m&&d.m.store&&d.m.store.has("bookingSessionId")){V.bsid=d.m.store.get("bookingSessionId")}if(!V.tTreeStr){C(new Error("tTreeStr is null/undefined/empty."),"ta._sendTreeImpression",null)}else{if(!V.tTreeUid){C(new Error("tTreeUid is null/undefined/empty."),"ta._sendTreeImpression",null)}}t("/ImpressionRecord",V,W)};d.setEvtCookieAndPath=function(Z,U,W){try{if(!W){W=M()}var Y=u(W,Z);if(!Y){C(null,"ta.setEvtCookieAndPath - invalid element for "+Z,null,arguments);return}var V=G(Y);if(!U){while(W.nodeName!="A"){if(W==document.body){break}W=W.parentNode}U=W.href;if(!U){C(null,"ta.setEvtCookieAndPath - no url parameter and cannot find a.href",null,arguments);return}}d.setEvtCookie(V.category,V.action,V.label,V.value,U)}catch(X){C(X,"ta.setEvtCookieAndPath",null,arguments)}};d.recordPageview=function(V,Y){if(!V){return}var U=q(V),X="/PageviewRecord",W=Y?Y:{};if(U){W.servletName=U;t(X,W)}};d.resetPageDataUrl=function(){var U;if(d&&d.analytics&&d.analytics.pageData){U=d.analytics.pageData&&d.analytics.pageData.length&&d.analytics.pageData[d.analytics.pageData.length-1];if(U){U.url=""}}};d.trackEngagementClick=function(U,V){if(!U||!V){C(new Error("object/selectionFunction is null/undefined"),"ta.trackEngagementClick",null,arguments);return}if(!H(V)){C(new Error("passed variable selectionFunction is not a function"),"ta.trackEngagementClick",null,V);return}V(U)};d.placementNodeSelectorTracker=function(Z){if(!Z||!Z.element||!Z.type){C(new Error("object/element/type is null/undefined"),"ta.placementNodeSelectorTracker",null,Z);return}var ae=Z.element;var Y=Z.type;var aa;var V;var ag;var af;var U;var ad;var W=d.analytics.getCommentTrackingPath(ae);Y=Y+"_Click";if(!W){C(new Error("trackTreePath is null/undefined"),"ta.placementNodeSelectorTracker",null,arguments);return}if(W.length<1){C(new Error("trackTreePath is missing information"),"ta.placementNodeSelectorTracker",null,arguments);return}aa=W.getLast();if(!aa){C(new Error("placement is null/undefined"),"ta.placementNodeSelectorTracker",null,W);return}for(ad=W.length-1;ad>=0;ad--){U=W[ad];if(!U){continue}if(U.indexOf("N:")===0){V=U;break}}if(aa==="HH_MainList"){V="N:1"}else{if(!V){C(new Error("positionNode is null/undefined"),"ta.placementNodeSelectorTracker",null,W);return}}ag=V.split(":");if(ag&&ag.length===2){af=ag[1]}else{C(new Error("positionSplit appears to be incorrect"),"ta.placementNodeSelectorTracker",null,arguments);return}if(!af){C(new Error("position is null/undefined"),"ta.placementNodeSelectorTracker",null,arguments);return}var ac=parseInt(af,10);if(isNaN(ac)){C(new Error("position is not a number"),"ta.placementNodeSelectorTracker",null,af);return}var ah=R(aa);if(ah===-1){return}af=ac+ah;aa=e(aa);var X;var ab=d.select("#jfy_filter_bar_sort .jfy_sort.selected");if(ab&&ab.length===1){ab=ab[0];X=ab.getAttribute("data-currentSort")}d.trackEventOnPage(aa,Y,X,af)};var e=function(U){if(!U){return U}if(P()!=="Hotels"){return"Clicks_"+U}var V;if(U==="Hotels_MainList"||U==="Hotels_MainList_Sponsored"){V="Clicks_"+U}else{if(U==="hotels_list_short_cells2"){V="Clicks_Hotels_MainList"}else{if(U==="sponsored_coupon_listing"){V="Clicks_Hotels_MainList_Sponsored"}}}if(d.id("sponsoredCouponListingWrap")&&V==="Clicks_Hotels_MainList"){V+="_Sponsored"}V+=(d.widgets.calendar.getCheckRatesData())?"_PostDates":"_PreDates";return V};var R=function(X){if(!X){C(new Error("placement is null/undefined"),"ta._shiftOrdinalsWithSponsoredPlacement",null,X);return -1}if(P()!=="Hotels"){return 0}var V=0;var Z=d.retrieve("hac.offset");if(Z&&Z>0){V=Z}if(!d.id("sponsoredCouponListingWrap")){return V}var W=document.getElement("#HAC_RESULTS .pageNumbers .current");var U;if(W){var Y=W.getAttribute("data-page-number");U=parseInt(Y,10);if(isNaN(U)||!U){C(new Error("pageNumber is not a number"),"ta._shiftOrdinalsWithSponsoredPlacement",null,Y);return -1}}if(X==="hotels_list_short_cells2"||X==="Hotels_MainList"){V+=U;return V}if(Z&&Z>0&&(X==="sponsored_coupon_listing"||X==="Hotels_MainList_Sponsored")){V+=(U-1)}return V};d.getRecentTARecords=function(){return i};d.addTypeAheadMevt=function(U){U.t="ta";return v(U)};d.addTypeAheadDebugMevt=function(U){U.t="ta_d";return v(U)};d.addGARecordMevt=function(X,Y,W,ac,V){try{var U=d.analytics._validatedTrackEventArray(X,Y,W,ac,false),ab={t:"ga",gac:U[1],gaa:U[2],gal:U[3],gav:U[4],gani:U[5],gass:P(),gasl:I(document.location.href),gads:q(V),gadl:I(V),gapu:d.uid,gams:B()},Z=S();if(!ab.gass){throw new Error("Src servlet undefined, gac:"+ab.gac+", gaa:"+ab.gaa+", gal:"+ab.gal)}if(!ab.gads){throw new Error("Dst servlet undefined. gac:"+ab.gac+", gaa:"+ab.gaa+", gal:"+ab.gal)}if(d.has&&d.has("gatt")){ab.gatt=d.retrieve("gatt")}if(Z){ab.bsid=Z}v(ab);if(d.common&&d.common.dmp&&d.common.dmp.isEnabled()){d.common.dmp.sendEventBehavior(X,Y,W,ac,M())}}catch(aa){C(aa,"ta.addGARecordMevt",null,arguments)}}})(window,ta);(function(){var f=[];var a=3000;function b(l,n){var g=f.length;f.push({name:l,properties:[]});for(var m in n){var h=true;if(g>0){for(var j=0;h&&j<g;j++){if(f[j].properties.indexOf(m)!=-1){h=false}}}if(h){f[g].properties.push(m)}}}b("node",document.createTextNode(""));b("Element",Element.prototype);f[1].properties.push("uid");b("element",document.createElement("div"));b("input",document.createElement("input"));f[3].properties.push("autocomplete");var e={element:"E",number:"N","function":"F",string:"S","boolean":"B",object:"O",collection:"C",whitespace:"W"};function d(h){var g=typeOf(h);return null==h?"_":(e[g]?e[g]:(g=="null"?"!":g))}ta.util.error={types:f,override:false,errorCount:0,record:function(y,h,s,u,n){if(!y){y=new Error("Stub error to build stack.")}if(ta.has("ta.error.record.inFlight")||ta.util.error.errorCount>9){return}ta.util.error.errorCount++;ta.store("ta.error.record.inFlight",true);var p=false;try{p=document.getElement("body").hasClass("js_logging")}catch(B){}if(!p){return}if(IS_DEBUG&&console.error){console.error("JS_ERROR_RECORD: "+h,y)}var E=true;if(u&&u.hasOwnProperty("error_script")&&!ta.util.error.isInternalScript(u.error_script)&&!ta.util.error.isScriptInline(u.error_script)){E=false}var m={};var D=false;try{if(s||window.event){s=new Event(s||window.event);D=ta.id(s.target);m.eTarg=this.getSelectorString(D)}}catch(r){}if(typeof(debugCacheKey)!="undefined"){m.key=debugCacheKey}var g=window.pageServlet;if(!g){g="unknown"}m.servlet=g;if(!n||typeof n!="string"){n="ERROR"}if(!E){n="WARN";m.warnReason="externalError"}else{if(!IS_DEBUG&&ta.util.error.errorCount>1){n="WARN";m.warnReason="notFirstJSError"}}var H={extraInfoError:"Problem storing extra info"};var G="";var l={};try{var j="";try{j=window.navigator.userAgent}catch(t){}var k="";var i="";if(D){if(typeof D.id!=="function"){k=D.id}i=D.className}var w=false;try{w=doCookieCheck()}catch(B){}var z="";if(typeof serverPool!="undefined"&&serverPool){z=serverPool}var v="";if(window.MooTools){v+="MooTools "}if(window.jQuery){v+="jQuery ";n="WARN";m.warnReason="jquery"}l={TARGET_ID:k,TARGET_CLASS:i,PAGE_UID:ta.uid,INTERNAL_JS:ta.util.error.getScriptSrcs(),CLIENT_POOL:z,COOKIES_ENABLED:w,JS_LIBS:v};if(!E){l.INTERNAL_ERROR="false"}if(ta.util.error.errorCount>1){l.PRIOR_JS_PAGE_ERRORS=ta.util.error.errorCount-1}}catch(A){u=H}m.xInfo=ta.util.error._getExtraInfoString(l,u);try{m.eUrl=window.location.href}catch(r){}var o="No Error";try{if(y){if(Object.prototype.toString.call(y)===Object.prototype.toString.call(new Error)){o=y.name+"-"+y.message}else{if(typeof y==="object"){o="non-Error object "+Object.prototype.toString.call(y)+" passed, sample properties - ";var F=0;for(prop in y){if(y.hasOwnProperty(prop)){o+=prop.substring(0,30)+": "+(y[prop]&&y[prop].toString?y[prop].toString().substring(0,20):y[prop])+", ";if(++F>4){break}}}}else{o="non-Object error passed: "+(""+y).substring(0,30)}}o=o.replace(/[\r\n]/g,"")}}catch(r){}m.eMsg=o;var x="";try{x=ta.util.error.getErrorBlock(h).substring(0,150);m.eBlk=x}catch(r){}try{if(x.indexOf("window.onerror")!=0){var C=ta.util.error.getErrorStack(y);if(C){m.eStak=C}}}catch(r){}try{if(ta.widgets&&ta.widgets.calendar){m.eDates=ta.widgets.calendar.getErrorDates()}}catch(r){}m.eLogLevel=n;try{new Request({url:"/JSErrorRecord",data:m}).send()}catch(B){m={eBlk:"JSErrorRecord Error",servlet:g,eLogLevel:"ERROR",eMsg:"no error retrieved"};new Request({url:"/JSErrorRecord",data:m}).send()}if(IS_DEBUG){(window.ERRORS||(window.ERRORS=[])).push(m)}if(ta.util.error.override){if(ta.util.error.override.match(/alert/)){ta.util.error.alert(m)}if(ta.util.error.override.match(/console/)&&console){ta.util.error.console(m)}}ta.remove("ta.error.record.inFlight");if(IS_DEBUG&&y&&n==="ERROR"&&false){throw y}if(IS_DEBUG){var q=ta.util.error._buildToolbarElement(o,h,n);if(ta.has("debug.toolbar.loaded")){ta.util.error.addErrorInJSToolbar(q)}else{ta.util.error._jsToolbarErrorsToAdd.push(q)}}},_jsToolbarErrorsToAdd:[],_buildToolbarElement:function(i,h,g){var j="<td class='"+g+"'>"+g+"</td><td><b>Error Block</b>:: "+h+", <b>Error Message</b>:: "+i+"</td>";return new Element("tr",{html:j})},addErrorInJSToolbar:function(i){var g=document.getElement("#DEBUG_JS_ERROR_DETAILS tbody"),h=document.getElement(".perfButtonWrap .jsErrors");if(!i){return}if(g){i.inject(g)}if(i.innerHTML&&i.innerHTML.indexOf("ERROR")>-1){h.addClass("ERROR")}else{h.addClass("WARN")}},_getExtraInfoString:function(q,g){var m="_extraInfoError_:Problem storing extra info.";var o={};var r="";try{var p=typeOf(g);var j={};if(p==="array"||p==="arguments"){for(var l=0;l<g.length;l++){var h=g[l];var n=typeof h;if(n==="string"||n==="number"||n==="boolean"){j[l]=h}else{j[l]=typeof h}}g=j}o=Object.merge(q,g);r=JSON.encode(o);if(r){if(r.length>a){r=r.substring(0,a)}return r.replace(/[\r\n]/g,"")}}catch(k){}try{o=q;r=JSON.encode(o);if(r){if(r.length>a){r=r.substring(0,a)}return r.replace(/[\r\n]/g,"")}}catch(k){}return m},getErrorBlock:function(g){if(typeof g!="undefined"&&g!==null){return g.toString().replace(/[\r\n]/g,"")}return"null or undefined"},getErrorStack:function(m){var n="";try{if(arguments&&arguments.callee&&!Browser.chrome&&!Browser.firefox&&!Browser.safari){var p=[];var h=arguments.callee.caller;h=h.caller;var k=0;while(h&&k++<20){var i=h.toString();if(i.match(/onErrorFunc/)){h=h.caller;continue}var g=i.length;var j=g>100?100:g;var q=i.substring(0,j);q=q.replace(/(\n|\r|\'|\")/g,"");q+="::";p.push(q);h=h.caller}return p.join(" ")}}catch(l){n="-arguments.callee issue"}if(m&&m.stack){var o=m.stack.split("\n");o=o.map(function(s){var r=s.lastIndexOf("/");if(r>0){s=s.substr(r+1)}return s});return o.join()}return"none"+n},getSelectorString:function(h){if(!h){return""}var g=[h];while(typeof h!="undefined"&&h&&typeof h.parentNode!="undefined"){g.push(h=h.parentNode)}g=g.map(function(j){if(j&&j.tagName){var i=j.tagName;if(j.id){i+="#"+j.id}if(j.className){i+="."+j.className}return i}return""});g=g.reverse().join(">");g=g.replace(/\s+/g,".");return g},ajaxFailure:function(i,h,g){ta.util.error.record(null,i,null,Object.merge({status:h.status},g))},alert:function(g){var h="";Object.each(g,function(j,i){h=h+i+": "+j+"\n"});window.alert(h)},console:function(g){if(console){console.error(g)}},getScriptSrcs:function(){var g="";Array.each(document.getElementsByTagName("script"),function(k,h){if(!k){return}var j=k.src;if(ta.util.error.isInternalScript(j)){var i="";if(g!=""){i=", "}j=j.substring(j.indexOf("/js")+1);g=g+i+j}});if(g.length>a){g=g.substring(0,a)}return g},isInternalScript:function(g){if(!g||!g.indexOf){return false}var h=window.CDNHOST||"";if(window.IS_DEBUG&&h==""){return g.match(/(js3\/|js\/)/)!=null}else{return g.indexOf(h)==0}},isScriptInline:function(h){if(!h||!h.indexOf){return false}var g="noPage";try{g=window.location.href}catch(i){}if(h===g){return true}return false},describe:function(h){if(null==h){return"_N"}var j=d(h),i=[],l,m;for(var k in h){l=false;for(var g=0;!l&&g<f.length;g++){if(f[g].properties.indexOf(k)!=-1){l=true;if(i.indexOf(f[g].name)==-1){i.push(f[g].name)}}}if(!l){j+=","+k+":"+d(h[k])}}if(i.length>0){j+=","+i.join(",")}return j}};var c=Cookie.read("JS_ERROR_HANDLING");if(c){ta.util.error.override=c}})();window.ta||(window.ta={});(function(a){a.util||(a.util={});var c="interruption_record";var e=["popup","popunder","gate","other"];var d=function(h,f){try{if(a&&a.util&&a.util.error&&a.util.error.record&&typeof a.util.error.record==="function"){a.util.error.record(f,h,null,null)}}catch(g){}};var b=function(g){for(var f=0;f<e.length;f++){if(g===e[f]){return true}}return false};a.util.recordInterruption=function(g,f){try{if(!b(g)){d("ta.util.recordInterruption: Invalid type")}else{if(!f){d("ta.util.recordInterruption: Name cannot be null or blank")}else{if(a.trackEventOnPage&&typeof a.trackEventOnPage==="function"){a.trackEventOnPage(c,g,f.replace(",",""),0,true)}else{d("ta.util.recordInterruption: cannot track event on page")}}}}catch(h){d("ta.util.recordInterruption: exception tracking event",h)}}}(ta));(function(n,h){var y=false,j="taLsTest",i="1",q="TALocalStorageCurrentSessionId",l=false,m="session-",k=false,A=[];var t=function(){return !!(l||k)};var u=function(e){if(!t()){typeof n!=="undefined"&&n.util&&n.util.error&&n.util.error.record(null,"Accessing localStorage session cookie before session logic intialized: "+e);return false}return true};var p=function(e){return b(e,"value")};var v=function(e){return b(e,"now")};var b=function(D,F){if(!F){return null}try{var E=JSON.parse(y.getItem(D)||"0"),H;if(!E){return null}if(E.ttl&&E.ttl+E.now<new Date().getTime()){y.removeItem(D);return null}if(!E.hasOwnProperty(F)){return null}y.setItem("512",E[F]);H=y.getItem("512");y.removeItem("512");return H}catch(G){}return null};var B=function(D){try{y.removeItem(D)}catch(E){}};var C=function(D){try{var F=y.getItem(D);if(F!==null&&F!==h){return true}}catch(E){}return false};var a=function(E,F,D){try{y.setItem(E,JSON.stringify({ttl:D||0,now:new Date().getTime(),value:F}))}catch(G){}};var r=function(D){k=true;if(!D){typeof n!=="undefined"&&n.util&&n.util.error&&n.util.error.record(null,"Attempting to initialize localStorage with invalid sesion key: "+D);return false}if(!x()){return false}l=p(q);if(!l||l!=D){l=D;a(q,l);var e=p("latestPageServlet");if(e){a("sessionEntryServlet",e)}d();if(C(q)){typeof n!=="undefined"&&n.store&&n.store("isFirstSessionPageView",true)}}};var d=function(){try{var F=m+l;var D=new RegExp("^"+m);if(y.length){for(var E=0;E<y.length;E++){var H=y.key(E);try{if(D.test(H)&&H!=F){B(H)}}catch(G){}}}}catch(I){}};var x=function(){var E=false;try{if(y&&y.setItem){y.setItem(j,i);E=y.getItem(j)!=i;y.removeItem(j);if(E){y=false}return !!y}}catch(D){}return false};var g=function(D){try{y.setItem("session-"+l,JSON.stringify(D))}catch(E){}};var s=function(){try{var D=y.getItem("session-"+l);if(D){return JSON.parse(D)}}catch(E){}return{}};var c=function(e){A.push(e)};var f={enabled:x(),get:p,set:a,remove:B,has:C,getTimeStamp:v,updateSessionId:r,onSessionStorageChange:c,canUseSession:t,getSessionKey:function(D){if(!u(D)){return null}var e=s();if(e){return e[D]}return null},setSessionKey:function(D,E){if(!u(D)){return}var e=s();if(!e){e={}}e[D]=E;g(e)},removeSessionKey:function(D){if(!u(D)){return}var e=s();if(!e){return}delete e[D];g(e)},hasSessionKey:function(D){if(!u(D)){return false}var e=s();if(e){var E=e[D];if(E!==null&&E!==h){return true}}return false},setStorage:function(e){y=e;this.enabled=x()}};n.localStorage=f;if(typeof window!=="undefined"){var z=false;try{var o=window.localStorage;z=o}catch(w){}n.localStorage.setStorage(z);(function(){function D(G){G=G||window.event;if(l&&(!G.key||G.key==="session-"+l)){for(var F=0,E=A.length;F<E;F++){A[F](G)}}}var e=!!window.addEventListener;if(e){window.addEventListener("storage",D,false)}else{document.attachEvent("onstorage",D)}})()}}(ta));(function(i,k,e){var l=[],m=[],h=false,o=false;var d,n;if(typeof document.hidden!=="undefined"){d="hidden";n="visibilitychange"}else{if(typeof document.mozHidden!=="undefined"){d="mozHidden";n="mozvisibilitychange"}else{if(typeof document.msHidden!=="undefined"){d="msHidden";n="msvisibilitychange"}else{if(typeof document.webkitHidden!=="undefined"){d="webkitHidden";n="webkitvisibilitychange"}}}}function j(){o=false;for(var p in m){if(m.hasOwnProperty(p)){m[p]()}}}function f(){o=true;for(var p in l){if(l.hasOwnProperty(p)){l[p]()}}}function g(){var q=document[d]?l:m;for(var p in q){if(q.hasOwnProperty(p)){q[p]()}}}function a(){if(typeof document[d]==="undefined"){k.addEvent("focus",j);k.addEvent("blur",f)}else{document.addEventListener(n,g)}h=true}function b(){if(typeof document[d]==="undefined"){k.removeEvent("focus",j);k.removeEvent("blur",f)}else{document.removeEventListener(n,g)}o=false;h=false}function c(r,q){var p=r.indexOf(q);if(p>=0){return r.splice(p,1)}return null}i.pageVisibility={addFocusListener:function(p){m.push(p);if(!h){a()}},addBlurListener:function(p){l.push(p);if(!h){a()}},removeFocusListener:function(p){if(p){c(m,p)}else{m.length=0}if(m.length===0&&l.length===0){b()}},removeBlurListener:function(p){if(p){c(l,p)}else{l.length=0}if(m.length===0&&l.length===0){b()}},hidden:function(){if(typeof document.hidden!=="undefined"){return document.hidden}return o}}})(ta,window);(function(){ta=window.ta=window.ta||{};var b=ta.prerender||(ta.prerender={});b.states={PREFETCH_SENT:"prefetchSent",CLEAR:"clear"};var a=function(f){if(ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(f)}};var e=function(i,k,g,j,h){if(ta.analytics&&ta.analytics._validatedTrackEventArray&&ta.analytics._GARecordRequest){var f=ta.analytics._validatedTrackEventArray(i,k,g,j,h);ta.analytics._GARecordRequest(f).get();return true}return false};var d=function(){if("visibilityState" in document){b._visibilityState="visibilityState";b._visibilitystatechanged="visibilitychange";return}var g=["webkit","moz","ms","o"];for(var f=0;f<g.length;f++){if((g[f]+"VisibilityState") in document){b._visibilityState=g[f]+"VisibilityState";b._visibilitystatechanged=g[f]+"visibilitychange"}}};var c=function(){try{if(b._state===b.states.PREFETCH_SENT&&document[b._visibilityState]!=="prerender"){e("Prerender","shown","",0,true);b._state=b.states.CLEAR}}catch(f){a(f)}};b._init=function(f){try{b._enabled=f;b._state=b.states.CLEAR;d();if(!b.isSupported()||!b.isEnabled()){return}if(document[b._visibilityState]==="prerender"){if(e("Prerender","prefetch","",0,true)){b._state=b.states.PREFETCH_SENT;document.addEventListener(b._visibilitystatechanged,c,false)}}}catch(g){a(g)}};b.isEnabled=function(){return b._enabled};b.isSupported=function(){return b._visibilityState!==undefined}})();(function(){if(typeof performancePingbackInit=="undefined"||performancePingbackInit.initialized){return}performancePingbackInit.initialized=true;ta.queueForReady(function(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.domready=new Date().getTime()}},0,"perf.recordReady");ta.queueForLoad(function(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.load=new Date().getTime();setTimeout(function(){a()},0)}},10000000,"perf.recordLoad");function b(){var c=performancePingbackInit.domready-performancePingbackInit.start;var d=performancePingbackInit.load-performancePingbackInit.start;var g="/PerformancePingback?ppuid="+performancePingbackInit.uid+"&load="+d+"&domready="+c+"&servlet="+performancePingbackInit.servlet;if(performancePingbackInit.behaviorEnd&&performancePingbackInit.behaviorStart){var f=performancePingbackInit.behaviorEnd-performancePingbackInit.behaviorStart;g+="&behavior="+f}if(window.performance&&window.performance.timing){for(var e in window.performance.timing){var h=window.performance.timing[e];if(typeof h==="number"){g+="&"+e+"="+h}}}g+="&coldcache="+(!performancePingbackInit.isTaReferrer);new Request({url:g}).send()}function a(){if(typeof performancePingbackInit!="undefined"&&performancePingbackInit.enabled&&performancePingbackInit.domready&&performancePingbackInit.load){if(!("readyState" in document)||!("onreadystatechange" in document)||!("addListener" in document)){b();return}if(document.readyState==="complete"){setTimeout(function(){b()},0)}else{document.addListener("readystatechange",function(){if(document.readyState==="complete"){setTimeout(function(){b()},0)}})}}}})();(function(){ta.util.perf={loadPingback:function(c,d){try{var a={};var f="";var b=false;f+="[[";Object.each(d,function(h,e){if(b){f+=","}f+=e+":"+h;b=true});f+="]]";a.functionTimes=f;a.totalTime=c;if(ta.uid){a.uid=ta.uid+""}a.errorsOnLoad=ta.has("ta.onload.errors");a.servlet=window.pageServlet;new Request({url:"/LoadRecord",data:a}).send()}catch(g){ta.util.error.record(g,"ta.util.perf.loadPingback",false,{totalLoadTime:c,funcTimes:d})}}}})();(function(a){Object.append(a,{isHotelsRedesign2011:function(){if(ta.has("hac.isHotelsRedesign2011")){return ta.retrieve("hac.isHotelsRedesign2011")}if(window.pageServlet=="LastMinute"){ta.store("hac.isHotelsRedesign2011",true);return true}var c=ta.id("HAC_SMRY");var b=c&&c.hasClass("hotels_re_2011");ta.store("hac.isHotelsRedesign2011",b);return b},isSmartDealsFilters:function(){if(ta.has("smartdeals.isSmartDealsFilters")){return ta.retrieve("smartdeals.isSmartDealsFilters")}var b=ta.id("DEALS");var c=b&&b.hasClass("sdfilters");ta.store("smartdeals.isSmartDealsFilters",c);return c},isDHTMLCRRedesign2012:function(){if(ta.has("overlays.isDHTMLCRRedesignBasic")){return ta.retrieve("overlays.isDHTMLCRRedesignBasic")}var b=$$(".overlay");var c=b&&b.hasClass("rgba_flyout");ta.store("overlays.isDHTMLCRRedesignBasic",c);return c},isRestaurantsRedesign2012:function(){if(ta.has("eateries.isRestaurants")){return ta.retrieve("eateries.isRestaurants")}var c=ta.id("EATERIES_2012");var b=c&&c.hasClass("gridA");ta.store("eateries.isRestaurants",b);return b},isAttractionsRedesign2012:function(){if(ta.has("attractions.isAttractions")){return ta.retrieve("attractions.isAttractions")}var b=ta.id("ATTRACTIONS_2012");var c=b&&b.hasClass("gridA");ta.store("attractions.isAttractions",c);return c},isMetaHomepageIntegration2013:function(){if(ta.has("home.isMetaHomepageIntegration2013")){return ta.retrieve("home.isMetaHomepageIntegration2013")}var c=ta.id("PPT");var b=c&&c.hasClass("ppt_container");ta.store("home.isMetaHomepageIntegration2013",b);return b},isMetaHotels2013:function(){if(ta.has("hotelsMeta.isMetaHotels2013")){return ta.retrieve("hotelsMeta.isMetaHotels2013")}var c=ta.id("PAGE");var b=c&&c.hasClass("meta_hotels");ta.store("hotelsMeta.isMetaHotels2013",b);return b},isMetaHotel2013:function(){if(ta.has("hotel.meta2013")){return ta.retrieve("hotel.meta2013")}var d=ta.id("MAIN"),c=d&&(d.hasClass("Hotel_Review")||d.hasClass("ShowUserReviews")||d.hasClass("Hotels")||d.hasClass("HACSearch"));ta.store("hotel.meta2013",c);return c},isFlights2013:function(){return $$(".new_lander").length>0},isMetaHotelsRequest:function(){return ta.has("isMetaHotelsRequest")},isHacMap:function(){return ta.has("hac.maps.isHacMap")},isFall2013MastheadRefresh:function(){return ta.has("fall_2013_masthead_refresh")},isHRTabs2014:function(){return ta.has("hr_tabs_2014")},isTabletAlbumViewer:function(){return ta.retrieve("tabletAlbumPhotoLightbox.enabled")},isTabletRotationCTATest:function(){return ta.retrieve("tabletRotationCTATest.enabled")},isWarUsabilityTest:function(){return ta.id(document.body).hasClass("war_usability")},isAirport:function(){return window.pageServlet=="Airport"}})})(ta);(function(a,c,b,d){b.browser=(function(g){var f=function(){return navigator.userAgent.contains("MSIE 10.0")},h=function(){return g.retrieve("ta.isIE11orHigher")},e=function(){var n=g.retrieve("metaCheckRatesDebugFeatureEnabled"),j=null,k=h(),l=k?127:0,i=(c.innerWidth==screen.width&&((screen.height-c.innerHeight)===l));if(n){return true}try{j=!!new ActiveXObject("htmlfile")}catch(m){j=false}return !j&&i&&(k||f())};return{isIE9orHigher:function(){if(h()||(Browser.ie&&Browser.version>=9)){return true}return false},isIE10Metro:function(){return f()&&e()},isIEMetro:function(){return e()}}}(b))}(document,window,ta));(function(a,f,b,h){var g="screenSizeRecord";function c(){var l=a.documentElement,j=a.body,k=f.innerWidth||l.clientWidth||j.clientWidth,i=f.innerHeight||l.clientHeight||j.clientHeight,n=screen.width,m=screen.height;return"s"+n+"x"+m+"b"+k+"x"+i}function e(k){var i=c(),j=b.localStorage.getSessionKey(g);if(i!==j){b.localStorage.setSessionKey(g,i);b.trackEventOnPage("screenSizeRecord",k,i)}}function d(){if(!b.retrieve("screenSizeRecord")||!b.localStorage.enabled){return}e("load");var i;f.addEvent("resize",function(){if(i){clearTimeout(i)}i=setTimeout(function(){e("resize")},250)})}b.queueForLoad(d,"ScreenSizeRecord.onLoad")})(document,window,ta);var ta=window.ta||{};var define;ta.rollupAmdShim=ta.rollupAmdShim||(function(){var l={};var d={};var c={};var g=function(){};var k=function(){};function b(o,m){var n;for(n=0;n<o.length;++n){l[o[n]]=true}for(n=0;n<m.length;++n){d[m[n]]=true}if((typeof define!=="function")||!define.isTaRollupShim){if(typeof define==="function"){g=define}else{g=function(){}}define=h}if((typeof require!=="function")||!require.isTaRollupShim){if(typeof require==="function"){k=require}else{k=function(){}}require=e}}function h(o,q,r,m){var n,p;if(typeof o==="string"&&typeof q==="object"&&typeof r==="function"){if(c.hasOwnProperty(o)){return}p=a(q);if(p){n=r.apply(null,p);c[o]=n;r=f(i,null,n);if(l[o]){j(o,n)}}else{if(l[o]){k([o],f(j,null,o))}}}return g(o,q,r,m)}h.amd=true;h.isTaRollupShim=true;function e(n,p,m,q){var o;if(typeof n==="string"&&typeof p!=="function"){o=a([n]);if(o){return o[0]}}else{if(typeof n==="object"&&typeof p==="function"){o=a(n);if(o){p.apply(null,o);return}}}return k(n,p,m,q)}e.isTaRollupShim=true;function a(r){var o,m,p,n;var q=[];for(o=0;o<r.length;++o){m=r[o];n=null;if(m){if(c.hasOwnProperty(m)){n=c[m];q.push(n)}else{if(d[m]){p=m.split("/");if(p[0]==="underscore"){p[0]="_"}for(n=window;p.length>1&&n;n=n[p.shift()]){}if(p.length>0&&n){n=n[p[0]]||n[p[0].toLowerCase()]}if(n){c[m]=n;g(m,[],f(i,null,n))}q.push(n)}}}else{q.push(null)}}if(q.length!==r.length){return}return q}function j(o,p){var m=o.split("/");var q=ta;var n;if(m[0]==="ta"){m.shift()}while(m.length>1){n=m.shift();if(!q[n]){q[n]={}}q=q[n]}if(m.length>0){n=m.shift();q[n]=p;q[n.toLowerCase()]=p}}function i(m){return m}function f(n,m){var o=[].slice.call(arguments,2);return function(){var p=o.concat.apply(o,arguments);return n.apply(m,p)}}return{install:b}})();/* Dust - Asynchronous Templating - v2.3.5
* http://linkedin.github.io/dustjs/
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */
(function(root){var dust={},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",loggingLevels=[DEBUG,INFO,WARN,ERROR,NONE],EMPTY_FUNC=function(){},logger={},originalLog,loggerContext;dust.debugLevel=NONE;dust.silenceErrors=false;if(root&&root.console&&root.console.log){loggerContext=root.console;originalLog=root.console.log}logger.log=loggerContext?function(){if(typeof originalLog==="function"){logger.log=function(){originalLog.apply(loggerContext,arguments)}}else{logger.log=function(){var message=Array.prototype.slice.apply(arguments).join(" ");originalLog(message)}}logger.log.apply(this,arguments)}:function(){};dust.log=function(message,type){type=type||INFO;if(dust.debugLevel!==NONE&&dust.indexInArray(loggingLevels,type)>=dust.indexInArray(loggingLevels,dust.debugLevel)){if(!dust.logQueue){dust.logQueue=[]}dust.logQueue.push({message:message,type:type});logger.log("[DUST "+type+"]: "+message)}if(!dust.silenceErrors&&type===ERROR){if(typeof message==="string"){throw new Error(message)}else{throw message}}};dust.onError=function(error,chunk){logger.log("[!!!DEPRECATION WARNING!!!]: dust.onError will no longer return a chunk object.");dust.log(error.message||error,ERROR);if(!dust.silenceErrors){throw error}else{return chunk}};dust.helpers={};dust.cache={};dust.register=function(name,tmpl){if(!name){return}dust.cache[name]=tmpl};dust.render=function(name,context,callback){var chunk=new Stub(callback).head;try{dust.load(name,chunk,Context.wrap(context,name)).end()}catch(err){dust.log(err,ERROR)}};dust.stream=function(name,context){var stream=new Stream();dust.nextTick(function(){try{dust.load(name,stream.head,Context.wrap(context,name)).end()}catch(err){dust.log(err,ERROR)}});return stream};dust.renderSource=function(source,context,callback){return dust.compileFn(source)(context,callback)};dust.compileFn=function(source,name){name=name||null;var tmpl=dust.loadSource(dust.compile(source,name));return function(context,callback){var master=callback?new Stub(callback):new Stream();dust.nextTick(function(){if(typeof tmpl==="function"){tmpl(master.head,Context.wrap(context,name)).end()}else{dust.log(new Error("Template ["+name+"] cannot be resolved to a Dust function"),ERROR)}});return master}};dust.load=function(name,chunk,context){var tmpl=dust.cache[name];if(tmpl){return tmpl(chunk,context)}else{if(dust.onLoad){return chunk.map(function(chunk){dust.onLoad(name,function(err,src){if(err){return chunk.setError(err)}if(!dust.cache[name]){dust.loadSource(dust.compile(src,name))}dust.cache[name](chunk,context).end()})})}return chunk.setError(new Error("Template Not Found: "+name))}};dust.loadSource=function(source,path){return eval(source)};if(Array.isArray){dust.isArray=Array.isArray}else{dust.isArray=function(arr){return Object.prototype.toString.call(arr)==="[object Array]"}}dust.indexInArray=function(arr,item,fromIndex){fromIndex=+fromIndex||0;if(Array.prototype.indexOf){return arr.indexOf(item,fromIndex)}else{if(arr===undefined||arr===null){throw new TypeError('cannot call method "indexOf" of null')}var length=arr.length;if(Math.abs(fromIndex)===Infinity){fromIndex=0}if(fromIndex<0){fromIndex+=length;if(fromIndex<0){fromIndex=0}}for(;fromIndex<length;fromIndex++){if(arr[fromIndex]===item){return fromIndex}}return -1}};dust.nextTick=(function(){return function(callback){setTimeout(callback,0)}})();dust.isEmpty=function(value){if(dust.isArray(value)&&!value.length){return true}if(value===0){return false}return(!value)};dust.filter=function(string,auto,filters){if(filters){for(var i=0,len=filters.length;i<len;i++){var name=filters[i];if(name==="s"){auto=null}else{if(typeof dust.filters[name]==="function"){string=dust.filters[name](string)}else{dust.log("Invalid filter ["+name+"]",WARN)}}}}if(auto){string=dust.filters[auto](string)}return string};dust.filters={h:function(value){return dust.escapeHtml(value)},j:function(value){return dust.escapeJs(value)},u:encodeURI,uc:encodeURIComponent,js:function(value){if(!JSON){dust.log("JSON is undefined.  JSON stringify has not been used on ["+value+"]",WARN);return value}else{return JSON.stringify(value)}},jp:function(value){if(!JSON){dust.log("JSON is undefined.  JSON parse has not been used on ["+value+"]",WARN);return value}else{return JSON.parse(value)}}};function Context(stack,global,blocks,templateName){this.stack=stack;this.global=global;this.blocks=blocks;this.templateName=templateName}dust.makeBase=function(global){return new Context(new Stack(),global)};Context.wrap=function(context,name){if(context instanceof Context){return context}return new Context(new Stack(context),{},null,name)};Context.prototype.get=function(path,cur){if(typeof path==="string"){if(path[0]==="."){cur=true;path=path.substr(1)}path=path.split(".")}return this._get(cur,path)};Context.prototype._get=function(cur,down){var ctx=this.stack,i=1,value,first,len,ctxThis;first=down[0];len=down.length;if(cur&&len===0){ctxThis=ctx;ctx=ctx.head}else{if(!cur){while(ctx){if(ctx.isObject){ctxThis=ctx.head;value=ctx.head[first];if(value!==undefined){break}}ctx=ctx.tail}if(value!==undefined){ctx=value}else{ctx=this.global?this.global[first]:undefined}}else{if(ctx){if(ctx.head){ctx=ctx.head[first]}else{ctx=undefined}}}while(ctx&&i<len){ctxThis=ctx;ctx=ctx[down[i]];i++}}if(typeof ctx==="function"){var fn=function(){try{return ctx.apply(ctxThis,arguments)}catch(err){return dust.log(err,ERROR)}};fn.isFunction=true;return fn}else{if(ctx===undefined){dust.log("Cannot find the value for reference [{"+down.join(".")+"}] in template ["+this.getTemplateName()+"]")}return ctx}};Context.prototype.getPath=function(cur,down){return this._get(cur,down)};Context.prototype.push=function(head,idx,len){return new Context(new Stack(head,this.stack,idx,len),this.global,this.blocks,this.getTemplateName())};Context.prototype.rebase=function(head){return new Context(new Stack(head),this.global,this.blocks,this.getTemplateName())};Context.prototype.current=function(){return this.stack.head};Context.prototype.getBlock=function(key,chk,ctx){if(typeof key==="function"){var tempChk=new Chunk();key=key(tempChk,this).data.join("")}var blocks=this.blocks;if(!blocks){dust.log("No blocks for context[{"+key+"}] in template ["+this.getTemplateName()+"]",DEBUG);return}var len=blocks.length,fn;while(len--){fn=blocks[len][key];if(fn){return fn}}};Context.prototype.shiftBlocks=function(locals){var blocks=this.blocks,newBlocks;if(locals){if(!blocks){newBlocks=[locals]}else{newBlocks=blocks.concat([locals])}return new Context(this.stack,this.global,newBlocks,this.getTemplateName())}return this};Context.prototype.getTemplateName=function(){return this.templateName};function Stack(head,tail,idx,len){this.tail=tail;this.isObject=head&&typeof head==="object";this.head=head;this.index=idx;this.of=len}function Stub(callback){this.head=new Chunk(this);this.callback=callback;this.out=""}Stub.prototype.flush=function(){var chunk=this.head;while(chunk){if(chunk.flushable){this.out+=chunk.data.join("")}else{if(chunk.error){this.callback(chunk.error);dust.log("Chunk error ["+chunk.error+"] thrown. Ceasing to render this template.",WARN);this.flush=EMPTY_FUNC;return}else{return}}chunk=chunk.next;this.head=chunk}this.callback(null,this.out)};function Stream(){this.head=new Chunk(this)}Stream.prototype.flush=function(){var chunk=this.head;while(chunk){if(chunk.flushable){this.emit("data",chunk.data.join(""))}else{if(chunk.error){this.emit("error",chunk.error);dust.log("Chunk error ["+chunk.error+"] thrown. Ceasing to render this template.",WARN);this.flush=EMPTY_FUNC;return}else{return}}chunk=chunk.next;this.head=chunk}this.emit("end")};Stream.prototype.emit=function(type,data){if(!this.events){dust.log("No events to emit",INFO);return false}var handler=this.events[type];if(!handler){dust.log("Event type ["+type+"] does not exist",WARN);return false}if(typeof handler==="function"){handler(data)}else{if(dust.isArray(handler)){var listeners=handler.slice(0);for(var i=0,l=listeners.length;i<l;i++){listeners[i](data)}}else{dust.log("Event Handler ["+handler+"] is not of a type that is handled by emit",WARN)}}};Stream.prototype.on=function(type,callback){if(!this.events){this.events={}}if(!this.events[type]){dust.log("Event type ["+type+"] does not exist. Using just the specified callback.",WARN);if(callback){this.events[type]=callback}else{dust.log("Callback for type ["+type+"] does not exist. Listener not registered.",WARN)}}else{if(typeof this.events[type]==="function"){this.events[type]=[this.events[type],callback]}else{this.events[type].push(callback)}}return this};Stream.prototype.pipe=function(stream){this.on("data",function(data){try{stream.write(data,"utf8")}catch(err){dust.log(err,ERROR)}}).on("end",function(){try{return stream.end()}catch(err){dust.log(err,ERROR)}}).on("error",function(err){stream.error(err)});return this};function Chunk(root,next,taps){this.root=root;this.next=next;this.data=[];this.flushable=false;this.taps=taps}Chunk.prototype.write=function(data){var taps=this.taps;if(taps){data=taps.go(data)}this.data.push(data);return this};Chunk.prototype.end=function(data){if(data){this.write(data)}this.flushable=true;this.root.flush();return this};Chunk.prototype.map=function(callback){var cursor=new Chunk(this.root,this.next,this.taps),branch=new Chunk(this.root,cursor,this.taps);this.next=branch;this.flushable=true;callback(branch);return cursor};Chunk.prototype.tap=function(tap){var taps=this.taps;if(taps){this.taps=taps.push(tap)}else{this.taps=new Tap(tap)}return this};Chunk.prototype.untap=function(){this.taps=this.taps.tail;return this};Chunk.prototype.render=function(body,context){return body(this,context)};Chunk.prototype.reference=function(elem,context,auto,filters){if(typeof elem==="function"){elem.isFunction=true;elem=elem.apply(context.current(),[this,context,null,{auto:auto,filters:filters}]);if(elem instanceof Chunk){return elem}}if(!dust.isEmpty(elem)){return this.write(dust.filter(elem,auto,filters))}else{return this}};Chunk.prototype.section=function(elem,context,bodies,params){if(typeof elem==="function"){elem=elem.apply(context.current(),[this,context,bodies,params]);if(elem instanceof Chunk){return elem}}var body=bodies.block,skip=bodies["else"];if(params){context=context.push(params)}if(dust.isArray(elem)){if(body){var len=elem.length,chunk=this;if(len>0){if(context.stack.head){context.stack.head["$len"]=len}for(var i=0;i<len;i++){if(context.stack.head){context.stack.head["$idx"]=i}chunk=body(chunk,context.push(elem[i],i,len))}if(context.stack.head){context.stack.head["$idx"]=undefined;context.stack.head["$len"]=undefined}return chunk}else{if(skip){return skip(this,context)}}}}else{if(elem===true){if(body){return body(this,context)}}else{if(elem||elem===0){if(body){return body(this,context.push(elem))}}else{if(skip){return skip(this,context)}}}}dust.log("Not rendering section (#) block in template ["+context.getTemplateName()+"], because above key was not found",DEBUG);return this};Chunk.prototype.exists=function(elem,context,bodies){var body=bodies.block,skip=bodies["else"];if(!dust.isEmpty(elem)){if(body){return body(this,context)}}else{if(skip){return skip(this,context)}}dust.log("Not rendering exists (?) block in template ["+context.getTemplateName()+"], because above key was not found",DEBUG);return this};Chunk.prototype.notexists=function(elem,context,bodies){var body=bodies.block,skip=bodies["else"];if(dust.isEmpty(elem)){if(body){return body(this,context)}}else{if(skip){return skip(this,context)}}dust.log("Not rendering not exists (^) block check in template ["+context.getTemplateName()+"], because above key was found",DEBUG);return this};Chunk.prototype.block=function(elem,context,bodies){var body=bodies.block;if(elem){body=elem}if(body){return body(this,context)}return this};Chunk.prototype.partial=function(elem,context,params){var partialContext;partialContext=dust.makeBase(context.global);partialContext.blocks=context.blocks;if(context.stack&&context.stack.tail){partialContext.stack=context.stack.tail}if(params){partialContext=partialContext.push(params)}if(typeof elem==="string"){partialContext.templateName=elem}partialContext=partialContext.push(context.stack.head);var partialChunk;if(typeof elem==="function"){partialChunk=this.capture(elem,partialContext,function(name,chunk){partialContext.templateName=partialContext.templateName||name;dust.load(name,chunk,partialContext).end()})}else{partialChunk=dust.load(elem,this,partialContext)}return partialChunk};Chunk.prototype.helper=function(name,context,bodies,params){var chunk=this;try{if(dust.helpers[name]){return dust.helpers[name](chunk,context,bodies,params)}else{dust.log("Invalid helper ["+name+"]",WARN);return chunk}}catch(err){dust.log(err,ERROR);return chunk}};Chunk.prototype.capture=function(body,context,callback){return this.map(function(chunk){var stub=new Stub(function(err,out){if(err){chunk.setError(err)}else{callback(out,chunk)}});body(stub.head,context).end()})};Chunk.prototype.setError=function(err){this.error=err;this.root.flush();return this};function Tap(head,tail){this.head=head;this.tail=tail}Tap.prototype.push=function(tap){return new Tap(tap,this)};Tap.prototype.go=function(value){var tap=this;while(tap){value=tap.head(value);tap=tap.tail}return value};var HCHARS=new RegExp(/[&<>\"\']/),AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(s){if(typeof s==="string"){if(!HCHARS.test(s)){return s}return s.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;")}return s};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(s){if(typeof s==="string"){return s.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t")}return s};if(typeof exports==="object"){module.exports=dust}else{root.dust=dust}})((function(){return this})());/* dustjs-helpers - v1.2.0
* https://github.com/linkedin/dustjs-helpers
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */
(function(dust){var _console=(typeof console!=="undefined")&&(typeof IS_DEBUG!=="undefined")&&IS_DEBUG?console:{log:function(){}};function isSelect(context){var value=context.current();return typeof value==="object"&&value.isSelect===true}function jsonFilter(key,value){if(typeof value==="function"){return value.toString().replace(/(^\s+|\s+$)/mg,"").replace(/\n/mg,"").replace(/,\s*/mg,", ").replace(/\)\{/mg,") {")}return value}function filter(chunk,context,bodies,params,filterOp){params=params||{};var body=bodies.block,actualKey,expectedValue,filterOpType=params.filterOpType||"";if(typeof params.key!=="undefined"){actualKey=dust.helpers.tap(params.key,chunk,context)}else{if(isSelect(context)){actualKey=context.current().selectKey;if(context.current().isResolved){filterOp=function(){return false}}}else{_console.log("No key specified for filter in:"+filterOpType+" helper ");return chunk}}expectedValue=dust.helpers.tap(params.value,chunk,context);if(filterOp(coerce(expectedValue,params.type,context),coerce(actualKey,params.type,context))){if(isSelect(context)){context.current().isResolved=true}if(body){return chunk.render(body,context)}else{_console.log("Missing body block in the "+filterOpType+" helper ");return chunk}}else{if(bodies["else"]){return chunk.render(bodies["else"],context)}}return chunk}function coerce(value,type,context){if(value){switch(type||typeof(value)){case"number":return +value;case"string":return String(value);case"boolean":value=(value==="false"?false:value);return Boolean(value);case"date":return new Date(value);case"context":return context.get(value)}}return value}var helpers={tap:function(input,chunk,context){if(typeof input!=="function"){return input}var dustBodyOutput="",returnValue;returnValue=chunk.tap(function(data){dustBodyOutput+=data;return""}).render(input,context);chunk.untap();if(returnValue.constructor!==chunk.constructor){return returnValue}else{if(dustBodyOutput===""){return false}else{return dustBodyOutput}}},sep:function(chunk,context,bodies){var body=bodies.block;if(context.stack.index===context.stack.of-1){return chunk}if(body){return bodies.block(chunk,context)}else{return chunk}},idx:function(chunk,context,bodies){var body=bodies.block;if(body){return bodies.block(chunk,context.push(context.stack.index))}else{return chunk}},contextDump:function(chunk,context,bodies,params){var p=params||{},to=p.to||"output",key=p.key||"current",dump;to=dust.helpers.tap(to,chunk,context);key=dust.helpers.tap(key,chunk,context);if(key==="full"){dump=JSON.stringify(context.stack,jsonFilter,2)}else{dump=JSON.stringify(context.stack.head,jsonFilter,2)}if(to==="console"){_console.log(dump);return chunk}else{return chunk.write(dump)}},"if":function(chunk,context,bodies,params){var body=bodies.block,skip=bodies["else"];if(params&&params.cond){var cond=params.cond;cond=dust.helpers.tap(cond,chunk,context);if(eval(cond)){if(body){return chunk.render(bodies.block,context)}else{_console.log("Missing body block in the if helper!");return chunk}}if(skip){return chunk.render(bodies["else"],context)}}else{_console.log("No condition given in the if helper!")}return chunk},math:function(chunk,context,bodies,params){if(params&&typeof params.key!=="undefined"&&params.method){var key=params.key,method=params.method,operand=params.operand,round=params.round,mathOut=null,operError=function(){_console.log("operand is required for this math method");return null};key=dust.helpers.tap(key,chunk,context);operand=dust.helpers.tap(operand,chunk,context);switch(method){case"mod":if(operand===0||operand===-0){_console.log("operand for divide operation is 0/-0: expect Nan!")}mathOut=parseFloat(key)%parseFloat(operand);break;case"add":mathOut=parseFloat(key)+parseFloat(operand);break;case"subtract":mathOut=parseFloat(key)-parseFloat(operand);break;case"multiply":mathOut=parseFloat(key)*parseFloat(operand);break;case"divide":if(operand===0||operand===-0){_console.log("operand for divide operation is 0/-0: expect Nan/Infinity!")}mathOut=parseFloat(key)/parseFloat(operand);break;case"ceil":mathOut=Math.ceil(parseFloat(key));break;case"floor":mathOut=Math.floor(parseFloat(key));break;case"round":mathOut=Math.round(parseFloat(key));break;case"abs":mathOut=Math.abs(parseFloat(key));break;default:_console.log("method passed is not supported")}if(mathOut!==null){if(round){mathOut=Math.round(mathOut)}if(bodies&&bodies.block){return chunk.render(bodies.block,context.push({isSelect:true,isResolved:false,selectKey:mathOut}))}else{return chunk.write(mathOut)}}else{return chunk}}else{_console.log("Key is a required parameter for math helper along with method/operand!")}return chunk},select:function(chunk,context,bodies,params){var body=bodies.block;if(params&&typeof params.key!=="undefined"){var key=dust.helpers.tap(params.key,chunk,context);if(body){return chunk.render(bodies.block,context.push({isSelect:true,isResolved:false,selectKey:key}))}else{_console.log("Missing body block in the select helper ");return chunk}}else{_console.log("No key given in the select helper!")}return chunk},eq:function(chunk,context,bodies,params){if(params){params.filterOpType="eq"}return filter(chunk,context,bodies,params,function(expected,actual){return actual===expected})},ne:function(chunk,context,bodies,params){if(params){params.filterOpType="ne";return filter(chunk,context,bodies,params,function(expected,actual){return actual!==expected})}return chunk},lt:function(chunk,context,bodies,params){if(params){params.filterOpType="lt";return filter(chunk,context,bodies,params,function(expected,actual){return actual<expected})}},lte:function(chunk,context,bodies,params){if(params){params.filterOpType="lte";return filter(chunk,context,bodies,params,function(expected,actual){return actual<=expected})}return chunk},gt:function(chunk,context,bodies,params){if(params){params.filterOpType="gt";return filter(chunk,context,bodies,params,function(expected,actual){return actual>expected})}return chunk},gte:function(chunk,context,bodies,params){if(params){params.filterOpType="gte";return filter(chunk,context,bodies,params,function(expected,actual){return actual>=expected})}return chunk},"default":function(chunk,context,bodies,params){if(params){params.filterOpType="default"}return filter(chunk,context,bodies,params,function(expected,actual){return true})},size:function(chunk,context,bodies,params){var key,value=0,nr,k;params=params||{};key=params.key;if(!key||key===true){value=0}else{if(dust.isArray(key)){value=key.length}else{if(!isNaN(parseFloat(key))&&isFinite(key)){value=key}else{if(typeof key==="object"){nr=0;for(k in key){if(Object.hasOwnProperty.call(key,k)){nr++}}value=nr}else{value=(key+"").length}}}}return chunk.write(value)},dchoice:function(chunk,context,bodies,params){var choiceVar,value,cMod10,cMod100,locale=context.global.LOCALE;params=params||{};if(isNaN(parseInt(params.key),10)){_console.log("Choice variable not a number.");return chunk.write("")}choiceVar=Math.abs(params.key);cMod10=choiceVar%10;cMod100=choiceVar%100;if(locale==="ru"){if(cMod100!==11&&cMod10===1){value=params.arg0}else{if(cMod10>=2&&cMod10<=4&&(cMod100<=10||cMod100>=20)){value=params.arg1}else{value=params.arg2}}}else{if(locale==="cs"||locale==="sk"){if(choiceVar===1){value=params.arg0}else{if(choiceVar>=2&&choiceVar<=4){value=params.arg1}else{value=params.arg2}}}else{if(locale==="sr"||locale==="uk"){if(choiceVar>=11&&choiceVar<=14){value=params.arg2}else{if(cMod10===1){value=params.arg0}else{if(cMod10>=2&&cMod10<=4){value=params.arg1}else{value=params.arg2}}}}else{_console.log("Invalid dchoice locale: "+locale+". This should have been caught earlier.");value=""}}}return chunk.write(value)},dchoice2:function(chunk,context,bodies,params){var choiceVar,value;params=params||{};if(isNaN(parseInt(params.key),10)){_console.log("Choice variable not a number.");return chunk.write("")}choiceVar=Math.abs(params.key);if(choiceVar%100!==11&&(choiceVar%100)%10===1){value=params.arg0}else{value=params.arg1}return chunk.write(value)}};dust.helpers=helpers})(dust);(function(f){var g=/^ *(\w+) +in +([$_a-zA-Z][.$_\w]*)/;var i=/^\//;var c=/^[a-zA-Z:]*\/\//;var e=/ctx\.(?:get\("(.*?)"\)|getPath\(false,\["(.*?)"\]\)),ctx,"h"(?:,\["(.*?)"\])?/;var l=/","/g;var b=/^\s|\s(?=\s|$)/g;var m=f.helpers["if"].bind(f.helpers);var j=f.helpers.eq.bind(f.helpers);var k=f.helpers.select.bind(f.helpers);var h=f.helpers.tap.bind(f.helpers);function n(o){return o===~~o}function a(p){if(typeof p!="function"){return p}p=p.toString();var o="";var r=/(?:reference\((.*?)\)|write\("(.*?)"\))[.;]/g;var q;var s;while(!!(q=r.exec(p))){if(q[1]){s=q[1].match(e);if(s){if(s[1]){o+=" {"+s[1]}else{if(s[2]){o+=" {"+s[2].replace(l,".")}}if(s[3]){o+="|"+s[3].replace(l,"|")}o+="} "}}else{if(q[2]){o+=q[2]}}}return o.replace(b,"")}function d(q,o){var p=o.split(".");while(q&&p.length>0){q=q[p.shift()]}return q}if(typeof console=="undefined"){console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}}}f.helpers["if"]=function(p,q,o,s){try{return m(p,q,o,s)}catch(r){console.error("Error in @if statement: "+r.name+": "+r.message+".",'Condition "'+a(s.cond)+'"','evaluated to "'+h(s.cond,p,q)+'".');return p}};f.helpers.select=function(p,r,o,s){var q=h(s.key,p,r);if(q==0){if(q==="0"){s.key=0}}else{if(q==+q){s.key=+q}}return k(p,r,o,s)};f.helpers.eq=function(p,r,o,t){var q=h(t.key,p,r);var s=h(t.value,p,r);if(q==+q){t.key=+q}if(s==+s){t.value=+s}return j(p,r,o,t)};f.helpers.contains=function(p,q,o,s){if(!(s.collection&&s.collection.indexOf)){console.error("@contains helper requires a valid 'collection' parameter");return p}var r=h(s.value,p,q);if(typeof r=="undefined"){console.error("@contains requires a 'value' parameter");return p}if(~s.collection.indexOf(r)){return o.block(p,q)}return o["else"]?o["else"](p,q):p};f.helpers.range=function(x,p,o,s){var r=+h(s.begin,x,p);if(!n(r)){r=0}var t=+h(s.end,x,p);if(!n(t)){console.error("@range requires an integral 'end' parameter")}var q=+h(s.step,x,p);if(!n(q)){q=(t-r)/Math.abs(t-r)}var u=q>0;try{for(var v=r;u?v<t:v>t;v=v+q){p.stack.head.$val=v;x=o.block(x,p)}}catch(w){console.error("Error in @range block",w.message)}delete p.stack.head.$val;return x};f.helpers.truncate=function(p,q,o,u){var t=f.escapeHtml(h(u.value,p,q))||"";var r=h(u.length,p,q)||100;var s=t.length<=r?t:(t.slice(0,r-3).replace(/(?:\s*\&\S*|\s+)$/,"")+"...");return p.write(s)};f.helpers.localizeInt=function(p,r,o,v){var t=h(v.val,p,r)||0;var s=t.toString().split("");if(s.length>3){s.reverse();if(r.global.LOCALE=="en_IN"){t="";var u=",";for(var q=0;q<s.length;q++){t=s[q]+t;if(q<s.length-1){if(q>=3&&((q-3)%2==1)){t=u+t}else{if(q<3&&q%3==2){t=u+t}}}}}else{t="";var u=",";if(r.global.LOCALE=="de"||r.global.LOCALE=="it"||r.global.LOCALE=="nl"||r.global.LOCALE=="br"||r.global.LOCALE=="es_AR"||r.global.LOCALE=="es_CL"||r.global.LOCALE=="es_CO"||r.global.LOCALE=="es_VE"||r.global.LOCALE=="fr_BE"||r.global.LOCALE=="pt_BR"||r.global.LOCALE=="nl_BE"||r.global.LOCALE=="tr"||r.global.LOCALE=="da"||r.global.LOCALE=="el"||r.global.LOCALE=="id"||r.global.LOCALE=="vi"||r.global.LOCALE=="sr"){u="."}else{if(r.global.LOCALE=="fr"||r.global.LOCALE=="pl"||r.global.LOCALE=="es"||r.global.LOCALE=="en_ZA"||r.global.LOCALE=="de_AT"||r.global.LOCALE=="fr_CA"||r.global.LOCALE=="fr_CH"||r.global.LOCALE=="pt_PT"||r.global.LOCALE=="no"||r.global.LOCALE=="nb"||r.global.LOCALE=="ru"||r.global.LOCALE=="hu"||r.global.LOCALE=="sk"||r.global.LOCALE=="uk"||r.global.LOCALE=="cs"||r.global.LOCALE=="fi"||r.global.LOCALE=="in"){u=" "}else{if(r.global.LOCALE=="it_CH"||r.global.LOCALE=="de_CH"){u="'"}}}for(var q=0;q<s.length;q++){t=s[q]+t;if(q%3==2&&q<s.length-1){t=u+t}}}}return p.write(t)};f.helpers.quotes=function(s,t,q,u){u=u||{};var r=h(u.italics,s,t)||"";var o=t.global.IS_RTL?"&#x201d;":"&#x201c;";var p=t.global.IS_RTL?"&#x201c;":"&#x201d;";if(r=="true"){o="<i>"+o+"</i>";p="<i>"+p+"</i>"}s.write(o);s=q.block(s,t);return s.write(p)};f.helpers.fbPic=function(p,r,o,s){var t=h(s.id,p,r);var q=h(s.size,p,r);p.write("<img ");if(t){p.write('src="//graph.facebook.com/'+t+"/picture?type=square");if(q){p.write("&width="+q+"&height="+q)}p.write('" ')}p=o.block(p,r);return p.write("/>")};f.helpers.img=function(p,q,o,s){var r=h(s.src,p,q);p.write("<img ");if(r){if(!i.test(r)){r="/"+r}if(!r.match(c)){r=q.global.CDN_HOST+r}p.write('src="'+r+'" ')}if(o.block){p=o.block(p,q)}return p.write("/>")};f.helpers.fittedImg=function(z,t,q,w){var p=h(w.src,z,t);var v=h(w.height,z,t);var s=h(w.width,z,t);var r=p.url;var y=p.height;var x=p.width;var o="";var A="";var u;if(x==0||y==0){o='style= "width:'+s+"px; height: "+v+'px;" '}else{if(v/y<s/x){u=s/x;y=Math.floor(y*u);x=s;A=Math.floor((y-v)/2)*-1;o='style= "width:'+x+"px; height: "+y+"px; margin-top: "+A+'px;" '}else{u=v/y;x=Math.floor(x*u);y=v;A=Math.floor((x-s)/2)*-1;o='style= "width: '+x+"px; height: "+y+"px; margin-left: "+A+'px; "'}}z.write('<div style="height:'+v+"px; width:"+s+'px; overflow: hidden;" >');if(r){z.write('<img src="'+r+'" '+o+"/>")}z=q.block(z,t);return z.write("</div>")};f.helpers.lazyimg=function(q,r,p,t){var o=h(t["class"],q,r);var s=h(t.src,q,r);q.write('<img class="lazy '+(o?o:"")+'" ');if(s){if(typeof window=="undefined"){q.write('data-src="'+s+'" ')}else{q.write('src="'+s+'" ')}}q=p.block(q,r);return q.write("/>")};f.helpers.avatarWithFBOverlay=function(r,s,p,t){var q=h(t.avatar,r,s);var u=h(t.id,r,s);var o=h(t["class"],r,s);r.write('<div class="avatar-with-overlay '+o+'" ');if(q){r.write('style="background-image: url('+q+')">')}else{r.write('style="background-image: url(//graph.facebook.com/'+u+'/picture?type=square)">')}r.write('<img src="'+s.global.CDN_HOST+'/img2/social/social_on_mobile/fb_icon_20x20.png" ');r.write('class="overlay" />');return r.write("</div>")};f.helpers.avatar=function(r,s,p,t){var q=h(t.avatar,r,s);var u=h(t.id,r,s);var o=h(t["class"],r,s);r.write('<div class="avatar '+o+'" ');if(q){r.write('style="background-image: url('+q+')">')}else{r.write('style="background-image: url(//graph.facebook.com/'+u+'/picture?type=square)">')}return r.write("</div>")};f.helpers.pos=function(q,r,o,s){var p=s&&s.start!=null?s.start:1;if(r.stack){r.stack.head.$pos=r.stack.index+p}if(o&&o.block){q=o.block(q,r)}return q};f.helpers.bubbleRating=function(r,s,q,u){var t=f.helpers.tap(u.value,r,s);var v=f.helpers.tap(u.ratingType,r,s)||"ss";var o=t?(t.toString().length==1?t.toString()+"0":t*10):null;var p=f.helpers.tap(u["class"],r,s);t=+t;r.write('<div class="rate rate_'+v+" "+v+o+" "+(p?p:"")+'">');r.write("<img ");r.write('src="'+s.global.CDN_HOST+'/img2/sprites/ratings-v6.png" ');r.write('class="sprite-ratings" property="v:rating" alt="');r.write(t+' of 5 stars" content="'+t+'" />');return r.write("</div>")};f.helpers.bubbleRatingSvg=function(p,q,o,t){var s=f.helpers.tap(t.value,p,q);var u=+f.helpers.tap(t.multiplier,p,q)||20;var r=s*u;r=r<0?0:r>100?100:r;p.write('<div class="svgico bubblesempty">');p.write('<div class="bubbles" style="width:'+r+'%;"><div class="svgico bubblesfull"></div></div>');return p.write("</div>")};f.helpers.removeNonDigits=function(p,q,o,s){var r=h(s.value,p,q);return p.write(r.replace(/[^0-9]/g,""))};f.helpers.digitize=function(u,p,o,r){var w=+h(r.value,u,p);var t=+h(r.padding,u,p);var q=n(w)?w.toString().split(""):[];if(!n(t)){t=0}var v=t-q.length;if(v>0){while(v--){q.unshift("0")}}for(var s=0;s<q.length;s++){u=o.block(u,f.makeBase({digit:q[s]}))}return u};f.helpers.oxEach=function(u,o,t,B){if(o.stack.tail&&!(o.stack.head&&o.stack.head.__ox__)){console.error("Cannot call @oxEach within a section block");return u}var E=h(B.context,u,o);var s=E.match(g);var z=s[1];var w=s[2].split(".");var v=o.get(w[0]);var y;for(y=1;v&&y<w.length;y++){v=v[w[y]]}if(!v){return u}var F=h(B.name,u,o)||("each"+z.charAt(0).toUpperCase()+z.slice(1));var r="begin" in B||"end" in B;var C=+h(B.begin,u,o);if(!n(C)||C<0){C=0}var p=+h(B.end);p=isNaN(p)?null:p;if(p!=null&&(!n(p)||p<C)){console.error("Invalid @oxEach end index in collection"+w);p=null}var q=v.__offset__||0;u.write('<!-- @oxEach name="'+F+'" context="'+E+'"');if(r){u.write(' begin="'+C+'"');if(p!=null){u.write(' end="'+p+'"')}}u.write(" -->\n");C=C-q;if(p!=null){p=Math.min(p-q,v.length)}else{p=v.length}for(y=C;y<p;y++){var A=v[y];if(!A){console.error("@oxEach requires non-null items in collection "+w);break}var D={};for(var x in o.stack.head){D[x]=o.stack.head[x]}D[z]=A;D.$idx=y+q;D.$idx1=D.$idx+1;D.__ox__=true;D=o.rebase(D);u=t.block(u,D)}u.write("<!-- /oxEach -->\n");return u};f.helpers.oxContains=function(p,r,o,u){if(!(u.collection&&u.collection.indexOf)){console.error("@oxContains helper requires a valid 'collection' parameter");return p}var q=h(u.key,p,r);if(typeof q=="undefined"){console.error("@oxContains requires a 'key' parameter");return p}var t=h(u.value,p,r);if(typeof t=="undefined"){console.error("@oxContains requires a 'value' parameter");return p}var s=function(v){return v!=null&&d(v,q)==t};if(u.collection.filter(s).length>0){return o.block(p,r)}return o["else"]?o["else"](p,r):p};f.helpers.ifChanged=function(q,s,p,u){var t=u.collection;if(!(t&&t.indexOf)){console.error("@ifChanged helper requires a valid 'collection' parameter");return q}var r=h(u.key,q,s);if(typeof r=="undefined"){console.error("@ifChanged requires a valid 'key' parameter");return q}var o=+h(u.idx,q,s);if(!n(o)){console.error("@ifChanged requires a valid 'idx' parameter");return q}if(o<1||d(t[o],r)!=d(t[o-1],r)){return p.block(q,s)}return p["else"]?p["else"](q,s):q};f.helpers.oxSection=function(t,p,o,r){var q=h(r.namespace,t,p);var s=h(r.nsid,t,p);var w=h(r.tag,t,p)||"div";if(typeof q==="undefined"){console.error("@oxSection requires a valid 'namespace' parameter");return t}t.write("<"+w+' data-ox-section-name="'+q+'"');if(typeof s!=="undefined"){t.write(' data-ox-section-id="'+s+'"')}for(var v in r){if(v==="namespace"||v==="nsid"||v==="tag"){continue}var u=h(r[v],t,p);if(typeof v==="undefined"||typeof u==="undefined"){console.error("@oxSection key or value is undefined: "+v);continue}t.write(" "+v+'="'+u+'"')}t.write(" />\n");t=o.block(t,p);t.write("</"+w+">\n");return t};f.helpers.substr=function(x,y,o,s){var w=f.escapeHtml(f.helpers.tap(s.str,x,y))||"",p=f.helpers.tap(s.begin,x,y)||0,t=f.helpers.tap(s.end,x,y)||w.length,u=f.helpers.tap(s.len,x,y)||w.length,q=f.helpers.tap(s.underflow,x,y)||"",r=f.helpers.tap(s.overflow,x,y)||"";var v=(p==0?"":q)+(u<t-p?w.substr(p,u)+r:w.slice(p,t));return x.write(v)};f.helpers.increment=function(p,r,o,t){var s=+h(t.base,p,r);var q=+h(t.addon,p,r);if(!n(s)){s=0}if(!n(q)){q=0}r.stack.head.$increment_val=s+q;p=o.block(p,r);delete r.stack.head.$increment_val;return p}}(dust));(function(a){a.helpers.iterate=function(o,d,b,f){var m=b.block,h,l,j,e,g,c;f=f||{};function n(k,i){if(k<i){return 1}else{if(k>i){return -1}}return 0}function p(i,k){return m(o,d.push({$key:i,$value:k,$type:typeof k}))}if(f.key){g=a.helpers.tap(f.key,o,d);if(m){if(!!f.sort){h=a.helpers.tap(f.sort,o,d);l=[];for(e in g){if(g.hasOwnProperty(e)){l.push(e)}}c=d.global[h];if(!c&&h==="desc"){c=n}if(c){l.sort(c)}else{l.sort()}for(j=0;j<l.length;j++){o=p(l[j],g[l[j]])}}else{for(e in g){if(g.hasOwnProperty(e)){o=p(e,g[e])}}}}else{_console.log("Missing body block in the iter helper.")}}else{_console.log("Missing parameter 'key' in the iter helper.")}return o}})(typeof exports!=="undefined"?module.exports=require("dustjs-linkedin"):dust);(function(h){var r=h.helpers.tap.bind(h.helpers),q="__ttParentContext",t="dustTree",g="\\",n="/",a=/^([A-Z]{1,2}:)?[\\$-.\a-zA-Z_0-9|]+$/,l=/\\+$/,b=function(u){return u.global.__treeString},e=function(u){return u.global.__incrementingCounters},s=function(v,u,w){if(!v.global.__incrementingCounters){v.global.__incrementingCounters={}}v.global.__incrementingCounters[u]=w},k=function(v){var u=v.global.__treeString;v.global.__treeString=null;v.global.__incrementingCounters={};return u},j=function(v){var u=b(v),w=v.global[q];if(u!=null){return}u=v.global.__treeString=[];v.global.__incrementingCounters={};if((typeof w==="string"||w instanceof String)&&w.length>0){if(w[w.length-1]===g){u.push(w.substring(0,w.length-1));u.push(g)}else{u.push(w)}}},m=function(v,w,u){if(u&&u.block){v=u.block(v,w)}return v},p=function(v,u,w){if(u&&u.block&&v){v.write(w)}},f=function(y,w,x,v){var u=b(x),z=u.length;if(z===0||u[z-1]===g){u.push(y)}else{u.push(n);u.push(y)}p(w,v,"<!--trk"+y+"-->")},c=function(v,w,u){b(w).push(g);p(v,u,"<!--etk-->")},o=function(y,v,w,u){var x=d(y);j(w);if(x){f(y,v,w,u)}v=m(v,w,u);if(x){c(v,w,u)}return v},i=function(v){var u=b(v);return u?u.join(""):""},d=function(u){return(typeof u==="string"||u instanceof String)&&a.test(u)};h.helpers.track=function(v,w,u,z){try{var A=r(z&&z.noTrack,v,w);if(A){v=m(v,w,u);return v}var y=r(z&&z.name,v,w);return o(y,v,w,u)}catch(x){console.error(x)}};h.helpers.trackTree=function(w,y,v,B){var A,x=r(B&&B.name,w,y),u=k(y),z=t;j(y);w=m(w,y,v);A=i(y);if(w&&w.write){if(x){z=z+" "+x}w.write("<div class='"+z+"' data-tree='"+A+"'></div>")}y.global.__treeString=u;return w};h.helpers.trackWithIncrementingValue=function(w,x,u,B){var y,z,A=r(B&&B.name,w,x),v=window.ta&&ta.retrieve&&ta.store?ta.retrieve("dust.continue_inc_track"):null;if(A&&A.indexOf(":")<0){y=e(x);if(!y){return}if(!y[A]){if(v&&v[A]){z=v[A]+1}else{z=1}}else{z=y[A]+1}s(x,A,z);A=A+":"+z;if(v){ta.store("dust.continue_inc_track",y)}}return o(A,w,x,u)};h.tracking={TREE_CLASS:t,setParentTree:function(v,u){if(u&&u.global){u.global[q]=v}},cleanTree:function(u){return u?u.replace(l,""):u}}}(dust));(function(g,f,h){var a=null,e=function(){if(a!=null){return a}try{a=JSON.parse(ta.retrieve("dustGlobalContext"));return a}catch(i){}return{}},c=function(k,m,i,o){var l=e(),n=g.find(i),j=f.makeBase(l).rebase(m);if(!n||!k||!l.LOCALE||!f){return false}f.render(b(k),j,function(q,p){if(p){n.innerHTML=p}else{if(q){ta.util.error.record(q,"Error rendering dust template "+k)}}if(o){o(m)}});return true},d=function(k,m){var l=e(),i=f.makeBase(l).rebase(m),j=ta.util.Deferred(true);if(!k||!l.LOCALE||!f){j.reject("Missing dependencies");return j.promise()}f.render(b(k),i,function(o,n){if(n){j.resolve(n)}else{if(o){ta.util.error.record(o,"Error rendering dust template "+k);j.reject(o)}}});return j.promise()},b=function(i){var j=i.replace(/\//g,"_").replace(".dust",""),k=e().LOCALE;return k+j};g.dust={render:c,renderToString:d}})(ta,dust);if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install([],["ta"])};define("popunder/utils",[],function(){function a(){return{height:window.outerHeight||document.documentElement.clientHeight,width:window.outerWidth||document.documentElement.clientWidth,left:window.screenLeft||window.screenX||0,top:window.screenTop||window.screenY||0}}return{getWindowInfo:a}});define("popunder/context-manager",["ta"],function(e){var a="pu_context";var c={HOTEL_DETAIL:{priority:30,isActive:function(){return window.pageServlet==="Hotel_Review"},generateUrl:function(m){return"/Hotel_Review-s1-g"+m.geoId+"-d"+m.locId},servletName:"HotelHighlight"},GEO_HOTELS:{priority:20,isActive:function(){return window.pageServlet==="Hotels"},generateUrl:function(m){return"/SmartDeals-g"+m.geoId},servletName:"SmartDeals"},ATTRACTION_REVIEW:{priority:10,isActive:function(){return window.pageServlet==="Attraction_Review"},generateUrl:function(m){return"/SmartDeals-g"+m.geoId+"-d"+m.locId},servletName:"HotelsNearSD"},OTHER:{priority:0,isActive:function(){return true},generateUrl:function(){return"/CpmForward"},servletName:"CpmForward"}};function j(){var m,n,p,o;for(m in c){if(!c.hasOwnProperty(m)){continue}n=c[m];if(n.isActive()&&(!p||n.priority>p.priority)){p=n;o=m}}return o||"OTHER"}function b(){var m=(e.page&&e.page.hasDates&&e.page.hasDates("STAYDATES"))||(e.widgets&&e.widgets.calendar&&e.widgets.calendar.hasPageDates());return{type:j(),geoId:window.modelGeoId,locId:window.modelLocId,hasDates:m}}function f(){var m;if(e.localStorage&&e.localStorage.enabled&&e.localStorage.getSessionKey&&e.localStorage.canUseSession()){m=e.localStorage.getSessionKey(a)}return m||{type:"OTHER",geoId:null,locId:null}}function i(m){if(e.localStorage&&e.localStorage.enabled&&e.localStorage.setSessionKey&&e.localStorage.canUseSession()){e.localStorage.setSessionKey(a,m)}}function d(){var n=f(),m=b();if(!m){return}if(!n||c[m.type].priority>=c[n.type].priority){i(m)}}function l(){var n=f(),m=c[n.type];return m.generateUrl(n)}function k(){var n=f(),m=c[n.type];return m.servletName}function h(){return f().hasDates}function g(){return f().geoId}return{updateContext:d,getContextualUrl:l,getContextualServletName:k,isDated:h,getGeoId:g}});if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["popunder/popunder-manager","popunder/console-strategy","popunder/ff-new-window-strategy","popunder/ie-new-window-strategy","popunder/safari-new-window-strategy","popunder/contextual-provider"],["ta","ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"popunder",files:{"js-amd":{src:{popunder:{"ff-new-window-strategy":1,"safari-new-window-strategy":1,"contextual-provider":1,"ie-new-window-strategy":1,"popunder-manager":1,"console-strategy":1}}}},_:{baseUrl:"/"}})};define("popunder/popunder-manager",["ta"],function(g){var b=1000*60*60*24;var f,k,e=false;function l(o,n){f=o;k=n;if(!f||!k||window.name==="POPUNDER_CONTENT_FRAME"){return}k.init&&k.init();a()}function h(o){if(g.browser.isIE10Metro()){return"ie10metro"}if(!o.target){return false}if(window.noPopClass&&g.elementOrParentMatches(o.target,function(p){return g.hasClass(p,window.noPopClass)})){return"no_cpu_class"}var n=o.target.onclick;if(n&&n.toString&&n.toString().match(/window\.open/g)){return"onclick_script"}if(o.target.target&&"A"===o.target.tagName){return"has_target"}return false}function i(p,q){var o,r,n;if(p==="unload"&&typeof Browser!=="undefined"&&Browser.chrome){return"Chrome_unload"}if(e&&p==="unload"&&!window.isTakeOver){return"paused"}if(!g.util||!g.util.cookie||!g.util.cookie.canSet()){return"failed_cookie_check"}o=g.util.cookie.readRaw("CommercePopunder");if(o&&window.isTakeOver&&p==="click"){return"already_popped"}else{if(o&&!window.isTakeOver){if(o!=="SuppressUnload"||p!=="click"){return"already_popped"}}}if(window.location.protocol==="http:"&&g.has("httpsDestination")){return"http_to_https"}if(p==="click"){r=h(q);if(r){return r}}if(typeof blockPU!=="undefined"&&blockPU){return"block_pu"}return false}function m(n){n=n||window.event;if(!e&&n.target&&g.elementOrParentMatches(n.target,function(o){return o.tagName==="A"})){e=true;setTimeout(c,1000)}}function c(){e=false}function a(){g.addEvent(document,"click",m);g.addEvent(document,"click",g.bind(j,null,"click"));g.addEvent(window,"beforeunload",g.bind(j,null,"unload"))}function d(o){var n=new Date(new Date().getTime()+b);g.util.cookie.write("CommercePopunder",o,n)}function j(o,q){var s=g.popups.PopUtil.numPopundersCheck(),u,r,n;if(!f){return}n=k.getContentInfo();if(!n){return}u=i(o,q);if(u){return u}try{if(window.localStorage){localStorage.setItem("CommercePopunder.timeStamp",new Date().getTime())}}catch(p){g.util.error.record(p,"commercePopunder - localStorage after before pop",null,{},"WARN")}r={url:n.url,width:n.size.width,height:n.size.height,event:q};window.fireEvent&&window.fireEvent("onPopunderBlur");try{localStorage.setItem("CommercePopunder.fallbackRelativeUrl","/PricefinderPopunder?content")}catch(t){}if(f.spawn(r)){g.popups.PopUtil.trackPopunder(n.url,s+1);d("SuppressAll*"+new Date().getTime())}else{g.util.error.record(null,"commercePopunder - past rules, no pop",null,{},"WARN");if(o==="unload"){d("SuppressUnload")}}}return{init:l}});define("popunder/console-strategy",[],function(){return{spawn:function(a){console.log("Spawning popunder with options: ",a);return true}}});define("popunder/ff-new-window-strategy",["popunder/utils"],function(a){return{spawn:function(c){var b,f,d=a.getWindowInfo();window.open("javascript:window.blur();","_self","");b=window.open(c.url,"CommercePopunder","toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1,width=1,height=1,left="+(d.left+d.width)+",top="+(d.top+d.height));if(!b){return false}b.blur();window.focus();try{f=b.open("about:blank","ff_helper_win","");if(f){f.close()}}catch(g){}b.moveTo(d.left+(d.width-c.width)/2,d.top+(d.height-c.height)/2);b.resizeTo(c.width,c.height);return !!b}}});define("popunder/ie-new-window-strategy",["popunder/utils"],function(a){return{spawn:function(c){var b,d=a.getWindowInfo();c.height+=90;c.width-=10;b=window.open(c.url,"CommercePopunder","toolbar=1,location=1,directories=1,status=1,menubar=0,resizable=1,copyhistory=1,scrollbars=1,width=1,height=1,left="+(d.left+d.width)+",top="+(d.top+d.height));if(!b){return false}b.blur();window.focus();window.document.focus();if(window.event&&window.event.srcElement){window.event.srcElement.focus()}b.moveTo(d.left+(d.width-c.width)/2,d.top+(d.height-c.height)/2);b.resizeTo(c.width,c.height);return !!b}}});define("popunder/safari-new-window-strategy",["popunder/utils"],function(a){return{spawn:function(d){var b,e=a.getWindowInfo(),c=window.name;document.domain=window.location.hostname;b=window.open(d.url,"CommercePopunder","toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1,width=1,height=1,left="+(e.left+e.width)+",top="+(e.top+e.height));if(!b){return false}b.blur();window.focus();if(!c){c=window.location.host.replace(/[-.]/g,"");window.name=c}window.open("",c);window.focus();b.moveTo(e.left+(e.width-d.width)/2,e.top+(e.height-d.height)/2);b.resizeTo(d.width,d.height);return !!b}}});define("popunder/contextual-provider",["ta","popunder/context-manager"],function(a,d){function b(){if(window.pageServlet==="Home"){return false}return{size:{width:1040,height:615},url:"/PriceFinderPopunder"}}function c(){d.updateContext();if(a.page&&a.page.usingUnifiedDates){a.page.on("dateSelected",function(f,e){if(e==="STAYDATES"){d.updateContext()}})}else{a.addEvent(window,"newInlinePageDates",function(){setTimeout(d.updateContext,5000)});a.on("onHACUpdateComplete",function(){setTimeout(d.updateContext,5000)})}}return{init:c,getContentInfo:b}});ta.util.cookie={expireTimeForPID:5,expireTimeForPID_remove:0,cookiePIDName:"NPID",setPIDCookie:function(a){try{Cookie.write(ta.util.cookie.cookiePIDName,a,{domain:cookieDomain,time:ta.util.cookie.expireTimeForPID})}catch(b){var c="";if(typeof cookieDomain!="undefined"){c=cookieDomain}ta.util.error.record(b,"set pid cookie",null,{pid:a,cookieDomain:c})}},removePIDCookie:function(){try{Cookie.write(ta.util.cookie.cookiePIDName,"",{domain:cookieDomain,time:ta.util.cookie.expireTimeForPID_remove})}catch(a){}},openWindowWithPID:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}window.open(b,"_blank");ta.util.cookie.removePIDCookie()},setAjaxAction:function(c,a){if(c[0]!="/"){c="/"+c}c="target:"+c;try{var f=Array.from(arguments).join("|");Cookie.write("ajaxAction",f,{domain:cookieDomain,path:"/"})}catch(b){var d="";if(typeof cookieDomain!="undefined"){d=cookieDomain}ta.util.error.record(b,"set pid cookie",null,{pid:pid,cookieDomain:d})}},setPID:function(b,a){if(ta.id(a).get("tag")!="a"){a=a.getParent("a")}if(pid=a.className.match(/pid(\d+)/)){ta.util.cookie.setPIDCookie(pid[1])}},setPIDNoA:function(a){pid=a.className.match(/pid(\d+)/);if(pid){ta.util.cookie.setPIDCookie(pid[1])}},showCookieBanner:function(){try{var b=ta.id("COOKIE_BANNER"),c=$(document.body);if(b&&c){b.inject(c,"top");b.setStyles({position:"fixed",top:-3000,left:-3000});b.show();var a=b.getHeight();b.setStyle("margin-top",0-a);b.hide();b.setStyles({top:0,left:0,position:"relative"});b.show();b.set("tween",{duration:"long",onComplete:function(){window.fireEvent("showingCookieConsentBanner")}});b.tween("margin-top",0);window.fireEvent("cookieBannerShown");Cookie.write("cookieconsent","1",{duration:3600})}}catch(d){ta.util.error.record(d,"ta.util.cookie.showCookieBanner")}},canSet:function(){document.cookie="SessionTest=true";if(document.cookie.match("(^|;)\\s*SessionTest=true\\s*(;|$)")){document.cookie="SessionTest=; expires=Thu, 01 Jan 1970 00:00:01 GMT";return true}return false},readRaw:function(a){var b=document.cookie.match("(?:^|;)\\s*"+a.escapeRegExp()+"=([^;]*)");return b?b[1]:false},write:function(b,c,a){document.cookie=b+"="+c+(a?"; expires="+a.toUTCString():"")}};setPID=ta.util.cookie.setPIDCookie;ta.util.ASDF={asdf:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}window.location=asdf(b)},asdfPxlAndPid:function(d,b,a){var e="http://ad.doubleclick.net/ad/";var c=";sz=1x1";if(a){ta.util.cookie.setPIDCookie(a)}if(b){new Element("img",{src:e+b+c})}window.location=asdf(d)},asdfPopup:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}ta.servlet.Popup.open(asdf(b))},asdfPopupEmail:function(a){ta.servlet.Popup.open(asdf(a),"email",580,460,30,25)},asdfPopupGuide:function(a){ta.servlet.Popup.open(asdf(a),"dest_guide",565,700,(screen.width-700)/2,(screen.height-600)/2)},asdfPopupTerms:function(a){ta.servlet.Popup.open(asdf(a),"terms",300,300,30,25)},asdfPopupDir:function(a){new Request({url:"/ActionRecord?action=getDirectionsListings"}).send();ta.servlet.Popup.open(asdf(a),null,800,600)},asdfDcd:function(a){return asdf(a)}};function getOffset(a){if(a>=97&&a<=122){return a-61}if(a>=65&&a<=90){return a-55}if(a>=48&&a<=71){return a-48}return -1}function asdf(d){var g={"":["&","=","p","6","?","H","%","B",".com","k","9",".html","n","M","r","www.","h","b","t","a","0","/","d","O","j","http://","_","L","i","f","1","e","-","2",".","N","m","A","l","4","R","C","y","S","o","+","7","I","3","c","5","u",0,"T","v","s","w","8","P",0,"g",0],q:[0,"__3F__",0,"Photos",0,"https://",".edu","*","Y",">",0,0,0,0,0,0,"`","__2D__","X","<","slot",0,"ShowUrl","Owners",0,"[","q",0,"MemberProfile",0,"ShowUserReviews",'"',"Hotel",0,0,"Expedia","Vacation","Discount",0,"UserReview","Thumbnail",0,"__2F__","Inspiration","V","Map",":","@",0,"F","help",0,0,"Rental",0,"Picture",0,0,0,"hotels",0,"ftp://"],x:[0,0,"J",0,0,"Z",0,0,0,";",0,"Text",0,"(","x","GenericAds","U",0,"careers",0,0,0,"D",0,"members","Search",0,0,0,"Post",0,0,0,"Q",0,"$",0,"K",0,"W",0,"Reviews",0,",","__2E__",0,0,0,0,0,0,0,"{","}",0,"Cheap",")",0,0,0,"#",".org"],z:[0,"Hotels",0,0,"Icon",0,0,0,0,".net",0,0,"z",0,0,"pages",0,"geo",0,0,0,"cnt","~",0,0,"]","|",0,"tripadvisor","Images","BookingBuddy",0,"Commerce",0,0,"partnerKey",0,"area",0,"Deals","from","\\",0,"urlKey",0,"'",0,"WeatherUnderground",0,"MemberSign","Maps",0,"matchID","Packages","E","Amenities","Travel",".htm",0,"!","^","G"]};var b="";for(var a=0;a<d.length;a++){var h=d.charAt(a);var e=h;if(g[h]&&a+1<d.length){a++;e+=d.charAt(a)}else{h=""}var f=getOffset(d.charCodeAt(a));if(f<0||typeof g[h][f]=="String"){b+=e}else{b+=g[h][f]}}return b};ta.util.Doer={doit:function(e,d){var c="/"+e;var b=0;for(var a in d){if(b===0){c+="?"}else{c+="&"}c+=a+"="+d[a];b++}return c},aimdoit:function(j,c,a,k){var b=ta.util.Doer.doit(j,c);new Event(a).preventDefault();var i=475;var d=390;var g=210;var f=5;if(k){i=980;d=800;g=240}else{if(screen.width>=1024&&screen.height>=768&&c&&(c.area.indexOf("Text")!=-1||c.area.indexOf("Thumbnail")!=-1)){i=900;d=768;g=240}else{if(screen.width>1024){i=800;d=600;g=240}else{if(screen.width>800){i=620;d=500;g=240}}}}ta.store("commerce.AIMWindow",ta.servlet.Popup.open(b,null,i,d,g,f,false,true));if(ta.retrieve("isDaoDao")){if(ta.retrieve("checkrates.check_more_re")){dd.commerce.checkrates.checkMorePopupAIM(a,c)}}else{var e=ta.retrieve("meta.popProPhotosCRLeavebehind")&&!ta.widgets.calendar.hasPageDates()&&c&&c.area!="Icon_Amenities";if(ta.retrieve("checkrates.isCRLB")&&!ta.id("CHECK_RATES_LB")&&(!ta.retrieve("checkrates.meta_ui_post_click_prices")||e)){ta.run("ta.overlays.Factory.loadCheckRatesLBOverlay",{},a,null,c)}}},tadoit:function(d,b,c,a){window.location=ta.util.Doer.tadoless(d,b,c,a)},tadoless:function(g,c,f,j,b){var a="/"+g;for(var h in c){a+="-"+h+c[h]}var e=f.length;for(var d=0;d<e;d++){a+="-"+f[d]}if(!b){a+=".html"}if(j.length>0){a+=j}return a}};ta.util.pending={};ta.util.pending.waitForMore=function(e,c,a,b,d){if(ta.has("pending."+e)){ta.util.pending.cancel(e)}ta.store("pending."+e,{timer:c.delay(a,d,b),fn:c,t:"m",n:a})};ta.util.pending.waitForFn=function(id,fn){try{var tmp=eval(fn),data;if(tmp){if(typeOf(tmp)==="function"){if(ta.has("pending.callback."+id)){ta.retrieve("pending.callback."+id)()}else{if(ta.has("pending."+id)){data=ta.retrieve("pending."+id);if(data.evnt){tmp.attempt([data.evnt,data.elmt])}else{tmp.attempt()}}else{tmp.attempt()}}}else{if(IS_DEBUG){alert("fn is not a function: "+typeOf(tmp))}}}else{ta.util.pending.waitForFnAgain(id,fn)}}catch(e){ta.util.pending.waitForFnAgain(id,fn)}};ta.util.pending.WAIT_DELAY=100;ta.util.pending.WAIT_TIMEOUT=50;ta.util.pending.waitForFnAgain=function(c,a){var b=ta.has("pending."+c)?ta.retrieve("pending."+c):{t:"f",fn:a,count:1};if(b.count<ta.util.pending.WAIT_TIMEOUT){b.count++;b.timer=ta.util.pending.waitForFn.invokeLater(ta.util.pending.WAIT_DELAY,null,[c,a]);ta.store("pending."+c,b)}else{if(IS_DEBUG&&!ta.has("pending.ignore."+c)){alert("timed out ("+(ta.util.pending.WAIT_TIMEOUT*ta.util.pending.WAIT_DELAY)+"ms) waiting for function: "+a)}}};ta.util.pending.waitForFile=function(c,a,b){if(ta.load(a)){ta.util.pending.waitForFn(c,b)}};ta.util.pending.waitForHandler=function(d,b,c,a){ta.store("pending."+d,{count:0,t:"f",fn:b,evnt:c,elmt:a});ta.util.pending.waitForFn(d,b)};ta.util.pending.cancel=function(b){var a=ta.remove("pending."+b);if(a&&a.timer){clearTimeout(a.timer)}};ta.util.pending.lock=function(d,b,c,a){if(ta.has("pending."+d)){return[a,false].pick()}ta.store("pending."+d,true);if(c){ta.util.pending.unlock.delay(c,null,d)}return b()};ta.util.pending.unlock=function(b){var a=ta.remove("pending."+b);if(a&&typeof a==="object"){a.count--;if(a.count===0){a.fn()}else{ta.store("pending."+b,a)}}};ta.util.pending.multilock=function(c,a,b){ta.store("pending."+c,{count:b,fn:a})};ta.util.pending.multilockUpdate=function(d,c){var b="pending."+d,a=ta.retrieve(b);if(a){a.count+=c}};ta.util.pending.wait=function(e,c,b,d,a){ta.store("pending."+e,{timer:c.delay(b,d,a)})};ta.util.pending.waitForElement=function(d,a,c){if(ta.has("pending."+d)){return}var b=$(a);if(b){ta.util.pending.cancel("pending."+d);c(b)}else{ta.store("pending."+d,{timer:ta.util.pending.waitForElement.delay(2,null,[d,a,c])})}};ta.util.pending.waitFor=function(a,c,b){if(a()){return c()}setTimeout(function(){ta.util.pending.waitFor(a,c,b)},b);return false};ta.util.pending.waitWithPing=function(b,e,a,c){function d(i,f,g){var h=b();if(h){e(h)}else{if(a&&i>0&&i%Math.ceil(g*1000/f)==0){a(i*f/1000)}setTimeout(function(){d(i+1,f,g)},f)}}d(0,100,c||3)};ta.util.pending.waitForSelector=function(b,d,a,c){ta.util.pending.waitWithPing(function(){return ta.find(b)},d,a,c)};ta.util.load={loadedMap:false,loadingMap:false,callbacks:[]};ta.util.load.GMaps=function loadGMaps(a){return ta.util.load.maps(a)};ta.util.load.maps=function(a){if(ta.util.load.loadedMap){a&&a()}else{if(ta.util.load.loadingMap){ta.util.load.callbacks.push(a)}else{ta.util.load.loadingMap=true;return ta.maps.load.library(function(){ta.util.load.loadedMap=true;ta.util.load.loadingMap=false;a&&a();ta.util.load.callbacks.each(function(b){b&&b()})})}}};ta.util.load.mapsLazy=function(a){return ta.run("ta.maps.load.library",{},a)};function _loadMapsV2(d,c,e){d=d||[];var b=ta.remove("infobox_js");if(b){var a=1+d.length;var f=function(){a--;if(!a){c()}};if(!ta.load(e,function(){ta.util.load.maps(function(){Asset.javascript((b),{onLoad:f})})})){ta.util.error("Rollup file was not found: ",e)}d.each(function(g){Asset.css(g,{onLoad:f})})}else{ta.util.error("'infobox_js' path was not specified for this page")}}ta.util.load.loadMapV2Lite=function(a,b){_loadMapsV2(b,a,"ta-mapsv2-lite")};ta.util.load.loadMapV2=function(a,b){_loadMapsV2(b,a,"ta-mapsv2")};ta.util.load.GoogleLoader=function(a){if(ta.has("googleloader.state")){if(ta.retrieve("googleloader.state")=="loaded"){return a()}else{return ta.util.load.GoogleLoader.delay(500,this,a)}}else{ta.store("googleloader.state","loading");ta.store("googleloader.callback",a);new Asset.javascript("//www.google.com/jsapi?callback=ta.util.load.GoogleLoaderCallback")}};ta.util.load.GoogleLoaderCallback=function(){ta.store("googleloader.state","loaded");var a=ta.remove("googleloader.callback");a()};ta.util.load.LocalSearch=function(a){ta.util.load.GoogleLoader(function(){google.load("search","1",{callback:function(){}})})};ta.util.date={};ta.util.date.MS_IN_DAY=1000*60*60*24;ta.util.date.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];ta.util.date.HOUR_CONST=12;ta.util.date.THAI_BUDDHIST_YEAR_OFFSET=543;ta.util.date.MAX_STAY_DURATION_DAYS=30;ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT=330;ta.util.date.inDateSet=function(c,b){if((c==null)||(b==null)){return false}var e=b.length;for(var d=0;d<e;d++){var f=b[d];if(f.length){var g=f[0].getTime();var a=f[1].getTime();if((g<=c.getTime())&&(a>=c.getTime())){return true}}else{if(c.getTime()==f.getTime()){return true}}}return false};ta.util.date.rangesIntersect=function(a,b){return Math.max(a[0].getTime(),b[0].getTime())<=Math.min(a[1].getTime(),b[1].getTime())};ta.util.date.getDaysInRange=function(b,a){return Math.round((a.getTime()-b.getTime())/ta.util.date.MS_IN_DAY)+1};ta.util.date.getLastDayOfMonth=function(a){var b=new Date();if(a){b=new Date(a.getTime())}b=new Date(ta.util.date.normalize(b));b.setDate(1);b.setMonth(b.getMonth()+1);b.setDate(0);return b.getDate()};ta.util.date.getDaysApart=function(c,b){var a=24*60*60*1000;if(c&&b){return Math.round(Math.abs((c.getTime()-b.getTime())/(a)))}return 0};ta.util.date.inSameMonth=function(b,a){return(b!=null)&&(a!=null)&&(b.getMonth()==a.getMonth())&&(b.getYear()==a.getYear())};ta.util.date.normalize=function(a){return a.setHours(ta.util.date.HOUR_CONST,0,0,0)};ta.util.date.create=function(c,a,b){return new Date(c,a,b,ta.util.date.HOUR_CONST)};ta.util.currency={};ta.util.currency.formatCurrency=function(d,a,h,b){var g=a?a:"USD";var c=currencySymbol[g];var f=d;if(!b){f=ta.util.currency.formatThousands(Math.round(d))}var e=c[0];if(h&&ta.util.currency.addSpace(e)){if(!c[1]){return e+" "+f}else{return f+" "+e}}if(!c[1]){return e+f}else{return f+e}};ta.util.currency.formatCurrencyRange=function(g,b,a,f){var e=a?a:"USD";var c=currencySymbol[e];var d=c[0];if(f&&ta.util.currency.addSpace(d)){g=ta.util.currency.formatThousands(Math.round(g));b=ta.util.currency.formatThousands(Math.round(b));return ta.util.currency.formatCurrency(g+" - "+b,a,true,true)}else{g=ta.util.currency.formatCurrency(g,a);b=ta.util.currency.formatCurrency(b,a);return g+" - "+b}};ta.util.currency.addSpace=function(a){return/^[a-zA-Z]+$/i.test(a)};ta.util.currency.formatThousands=function(b){if(typeof groupingSize=="undefined"||typeof groupingSeparator=="undefined"||groupingSize<1){return b}var a="";var d=""+b;for(var c=1;c<=d.length;c++){a=d.charAt(d.length-c)+a;if(c%groupingSize==0&&c<d.length){a=groupingSeparator+a}}return a};ta.util.currency.setCurrencyAndReload=function(a,b){var c="SetCurrency";Cookie.write(c,a,{time:15});b=b?b+"|":"";ta.trackEventOnPage("CurrencyPicker","Select",b+a);location.reload(true)};ta.util.Toggle={};ta.util.Toggle.siblings=function(c,b){c.preventDefault();var a=true;if(b.hasClass("closed")){a=false}b.toggleClass("closed sprite-arrow_toggle_blu_lft");b.getParent().getChildren().each(function(d){if(d!=b&&typeof d.hasClass!=="undefined"&&d.hasClass!=null&&!d.hasClass("ignore_toggle")){d.setStyle("display",a?"none":"block")}})};ta.util.Toggle.parentClass=function(c,a){c.preventDefault();var b=a.getParent(".toggle");b.toggleClass("off")};ta.util.Toggle.toggleTarget=function(d,b,c){d.preventDefault();var a=true;if($(b).hasClass("closed")){a=false}$(b).toggleClass("closed");$(b).toggleClass("open");$(c).setStyle("display",a?"none":"block")};ta.util.Toggle.toggleForm=function(b,d,c){var a=$(b).getParent(".formToggle");if(/sel_(\w+)/.test(a.className)){var e=RegExp.$1;a.removeClass("sel_"+e);a.getElement(".form_"+e).hide();var f=a.getElement(".header_"+e);if(f){f.hide()}}a.addClass("sel_"+d);var f=a.getElement(".header_"+d);if(f){f.show()}a.getElement(".form_"+d).show();return false};ta.util.Toggle.toggleLI=function(e,d,a){var c=e.getNext();for(var b=0;b<1000&&c&&c.id!=d.id;b++){if(a){c.show()}else{c.hide()}c=c.getNext()}if(a){e.hide()}else{e.show()}if(a){d.show()}else{d.hide()}};ta.util.Toggle.splitHotel=function(){var c=$$("#HOTEL_DESCRIPTION .descriptive_text").get("text").toString();var b=1000;if(c&&c.length>b){var a=c.substring(0,b);var d=c.substring(b,c.length);$$("#HOTEL_DESCRIPTION .descriptive_text").set("text",a);$$("#HOTEL_DESCRIPTION .description_ellipsis").show("inline");$$("#HOTEL_DESCRIPTION .more_description").show("inline");$$("#HOTEL_DESCRIPTION .descriptive_text_last").set("text",d)}};ta.util.Toggle.expandHotel=function(c,b){var a=b.getPrevious(".descriptive_text_last");var d=b.getNext(".less_description");b.hide();if(a){a.show("inline");a.getPrevious()&&a.getPrevious().hide()}d&&d.show("inline")};ta.util.Toggle.truncateHotel=function(c,b){var d=b.getPrevious(".more_description");var a=b.getPrevious(".descriptive_text_last");d&&d.show("inline");if(a){a.hide();a.getPrevious()&&a.getPrevious().show("inline")}b.hide()};ta.util.Toggle.toggleRecentReview=function(c,e,d){var b=c.getPrevious().getChildren();for(i=0;i<b.length;i++){var a=b[i];if(a.style.display=="none"){a.style.display=""}else{a.style.display="none"}}c.set("text",c.get("text").contains("<")?e+" > ":d+" < ")};ta.util.Toggle.expandList=function(c,a,f){try{var b=c.getChildren();if(b.length>a){for(i=a;i<b.length;i++){b[i].hide()}var g=new Element("span",{html:f,"class":"taLnk hvrIE6 moreLink",events:{click:function(){for(i=a;i<b.length;i++){b[i].show()}g.hide()}}});g.inject(c,"after")}}catch(d){ta.util.error.record(d,"Failed to Toggle.expandList")}};ta.util.URL={parse:function(c){if(/^(\w+):(.*)/.test(c)){c=RegExp.$2;switch(RegExp.$1){case"DOM":elmt=document.getElement(c);c=(elmt&&elmt.href)?elmt.href:"#";break;case"GMapsLC":if(c.length==0){break}tmp=c.split(",");ops={from:pageServlet,Action:tmp.shift()};tmp.each(function(d){if(/^g(\d+)$/.test(d)){ops.g=RegExp.$1}else{if("ext"==d){ops.ext="y"}else{if(/^(.*)=(.*)$/.test(d)){ops[RegExp.$1]=RegExp.$2}else{ops[d]=""}}}});c="/GMapsLocationController?"+Object.toQueryString(ops);break;case"ABS":var a=(window.location.port=="80"||window.location.port=="")?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+c;break;case"ABSPAGE":var a=(window.location.port=="80"||window.location.port=="")?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+c;if(c.indexOf(".html")==-1){c+=".html"}break;case"REL":var b=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"));if(/\/$/.test(window.location.pathname)){b=window.location.pathname}var a=window.location.port=="80"?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+b+c;break;default:c=RegExp.$1+":"+c;break}}return c},getParameter:function(c,a){var b=new RegExp("[?&]"+a+"=([^&]+)");if(b.test(c)){return RegExp.$1}return false},getAbsoluteUrl:function(a){return location.protocol+"//"+location.hostname+a},https:function(a){a=a||"";if(a.indexOf("http")===-1){a=ta.util.URL.getAbsoluteUrl(a)}if(a.indexOf("https://")===0){return a}if(ta.retrieve("access_control_headers")){return a.replace("http://","https://")}return a},getServletNameFromUrl:function(a){return/^(?:\w+:\/\/.*)?\/([^-?]*).*/.exec(a)&&RegExp.$1}};ta.util.i18n={};ta.util.i18n.isRtl=function(){return ta.id(document.body).hasClass("rtl")};ta.util.element={};ta.util.element.replaceContent=function(f,e,c){var d=f;var b=e;if(!b.getElement(".progresstab")){var a=c+(c.indexOf("?")==-1?"?":"&")+"xhr=true";var g=new Element("div",{"class":"progresstab"});g.inject(b);new Request({url:a,onSuccess:function(h,i){b.empty();b.innerHTML=h;if(window.behavior){window.behavior.apply(b)}b.fireEvent("onContentReplaced",[d,b])},evalScripts:true}).get()}};ta.util.element.trackIfMapView=function(){if(ta.retrieve("maps_v2_open")){ta.trackEventOnPage("QC_Meta_Map_Detail","map_open")}};ta.util.element.spinner=function(b,a){$(a).getParent(".spinnerReplaceable").getChildren().each(function(c){if(c.hasClass("spinner")){c.show()}else{c.hide()}})};ta.util.element.clearDefault=function(b,a){if(a.value==a.defaultValue){a.value=""}};ta.util.element.limitLength=function(b,a,c){if(a.value.length>=c){a.value=a.value.substr(0,c);return false}};ta.util.element.updateValue=function(a,b){if(a&&a.get("value")!=b){a.set("value",b);a.fireEvent("change",a)}};ta.util.element.moveContent=function(a,b){if(!a||!b){return}b.innerHTML=a.innerHTML;a.innerHTML=""};ta.util.element.keepInWindow=function(d,c){if(!d||!d.setStyle){return}if(!c){c={top:true,right:true,bottom:true,left:true}}function e(h,i){var j=parseInt(h.getStyle(i));return j||j===0}var g=2;var f=d.getCoordinates();var b=Window.getSize();var a=Window.getScroll();if(c.right&&e(d,"right")){if(f.left<a.x+g){d.setStyle("right",b.x+a.x-f.width-g)}else{if(f.right>b.x-a.x-g){d.setStyle("right",g)}}}else{if(c.left&&e(d,"left")){if(f.left<a.x+g){d.setStyle("left",g)}else{if(f.right>b.x-a.x-g){d.setStyle("left",b.x+a.x-f.width-g)}}}}if(c.bottom&&e(d,"bottom")){if(f.top<a.y+g){d.setStyle("bottom",b.y+a.y-f.height-g)}else{if(f.bottom>b.y-a.y-g){d.setStyle("bottom",g)}}}else{if(c.top&&e(d,"top")){if(f.top<a.y+g){d.setStyle("top",g)}else{if(f.bottom>b.y-a.y-g){d.setStyle("top",b.y+a.y-f.height-g)}}}}};ta.util.element.makeTextFit=function(o,k,g,j,c){c=c||1;j=j||8;var r=false;var q=ta.select(o);for(var h=0;h<q.length;h++){var i;var n;var f;if(parseInt(g)==g){i=g;n=i}else{f=q[h].getElement(g);if(!f){return}i=f.getSize();n=i.y}var a=q[h].getElement(k);if(!a){return}var p=a.getSize();if(n<p.y){var d=a.getStyle("font-size");if(d){var e=function(t,s){return(s=="px"&&t>=j)||(s=="em"&&t>=0.5)||(s=="pt"&&t>6)||(s=="%"&&t>=50)};var l=d.replace(/[\d\.]/g,"");var b=parseFloat(d)*Math.sqrt(n/p.y);if(l=="px"){b=Math.max(parseInt(b),j)}if(e(b,l)){a.setStyle("font-size",b+l);r=true}}}}if(r>0&&c<4){var m=this;setTimeout(function(){m.makeTextFit(o,k,g,j,c+1)},1)}};ta.util.element.makeTextFitOneLine=(function(){var a=4;var b=0.9;var c=function(d,e){fontSize=d.getStyle("font-size");newSize=parseFloat(fontSize)*e;unit=fontSize.replace(/[\d\.]/g,"");if(unit=="px"&&newSize<8){newSize=8}if(unit=="em"&&newSize<0.5){newSize=0.5}if(unit=="pt"&&newSize<6){newSize=6}if(unit=="%"&&newSize<50){newSize=50}d.setStyle("font-size",newSize+unit)};return function(g,d){var e=ta.select(g);e.forEach(function(k){var h=(parseFloat(k.getStyle("padding-left"))||0)+(parseFloat(k.getStyle("padding-right"))||0);for(var j=0;j<a&&k.scrollWidth>k.clientWidth;j++){var l=(k.clientWidth-h)/(k.scrollWidth-h);c(k,l)}if(k.scrollWidth>k.clientWidth){c(k,b)}});if(d){var f;e.forEach(function(i){var h=i.getStyle("font-size");if(!f||parseFloat(h)<parseFloat(f)){f=h}});e.forEach(function(h){h.setStyle("font-size",f)})}}})();ta.util.element.autoResizeTextInNode=(function(){var a=4;var b=0.9;var c=function(d,e){fontSize=d.getStyle("font-size");newSize=parseFloat(fontSize)*e;unit=fontSize.replace(/[\d\.]/g,"");if(unit=="px"&&newSize<8){newSize=8}if(unit=="em"&&newSize<0.5){newSize=0.5}if(unit=="pt"&&newSize<6){newSize=6}if(unit=="%"&&newSize<50){newSize=50}d.setStyle("font-size",newSize+unit)};ta.on("refreshedDOMContent",function(d){ta.util.element.autoResizeTextInNode(d)});ta.queueForLoad(function(){if(ta.id(document.body)){ta.util.element.autoResizeTextInNode(ta.id(document.body))}},"autoResize all targets on load");return function(e,d){if(!ta.id(e)){return}var f=ta.id(e).getElements(".autoResize");f.forEach(function(k){if(!k.isVisible()){return}var h=(parseFloat(k.getStyle("padding-left"))||0)+(parseFloat(k.getStyle("padding-right"))||0);for(var j=0;j<a&&k.scrollWidth>k.clientWidth;j++){var l=(k.clientWidth-h)/(k.scrollWidth-h);c(k,l)}if(k.scrollWidth>k.clientWidth){c(k,b)}k.removeClass("autoResize")});if(d){var g;f.forEach(function(i){var h=i.getStyle("font-size");if(!g||parseFloat(h)<parseFloat(g)){g=h}});f.forEach(function(h){h.setStyle("font-size",g)})}}})();ta.util.element.makeSameWidth=function(a){var b=0;var c=document.getElements(a);if(c&&c.length>1){c.forEach(function(e){var d=Math.round(parseFloat(e.getStyle("width")));if(d&&d>b){b=d}});c.setStyle("width",b)}};ta.util.element.fitToContentsHorizontally=function(b,c,d,a){a=a||1;if(a<=0||c>d){return}var e=function(f){return f.scrollWidth>f.clientWidth||f.scrollHeight>f.clientHeight};ta.select(b).forEach(function(f){f.setStyle("width",c);for(var g=c;g<d&&e(f);g+=a){f.setStyle("width",g)}if(e(f)){f.setStyle("width",d)}})};ta.util.element.scrollIntoView=function(b,f,a,h){if(!b){return}var g=b.getPosition().y+(f||0);if(a&&Fx.Scroll){try{var c=b.getParent();while(c&&c!=document.body&&c.getStyle("overflow")!="auto"){c=c.getParent()}}catch(d){c=null}if(!c||c==document.body||c.getStyle("overflow")!="auto"){c=window}else{g=(b.getPosition(c).y+c.getScrollTop())+(f||0)}(new Fx.Scroll(c,{wait:false,duration:300,onComplete:function(){h&&h()}})).start(0,g)}else{window.scrollTo(0,g);h&&h()}};ta.util.element.isScrolledIntoView=function(d,g){if(!d||!d.isVisible()){return false}var f;try{f=d.getBoundingClientRect()}catch(c){return false}var e=f.bottom;var b=f.top;if(g){var a=g.offsetHeight;var h=g.getPosition();if(a){if(h&&h.y==0){e-=a}else{b+=a}}}return(!!f&&e>=0&&f.right>=0&&b<=document.documentElement.clientHeight&&f.left<=document.documentElement.clientWidth)};ta.util.element.doIfElementIsVisible=function(d,e,b){function a(){if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}function c(){if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b)}else{window.addEvent("scroll",a);window.addEvent("resize",c)}};ta.util.element.isScrolledIntoAdjustedView=function(c,k,d){if(!c){return false}var h;try{h=c.getBoundingClientRect()}catch(f){return false}var j=h.bottom,i=h.top,b=h.left,a=h.right;if(k){if(k.bottom){j=j+k.bottom>0?j+k.bottom:0}if(k.top){i=i+k.top>0?i+k.top:0}if(k.left){b=b+k.left>0?b+k.left:0}if(k.right){a=a+k.right>0?a+k.right:0}}if(d){var e=d.offsetHeight;var g=d.getPosition();if(e){if(g&&g.y==0){j-=e}else{i+=e}}}return(!!h&&j>=0&&a>=0&&i<=document.documentElement.clientHeight&&b<=document.documentElement.clientWidth)};ta.util.element.doIfElementAdjustedPositionIsVisible=function(d,f,e,b){function a(){if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}function c(){if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b)}else{window.addEvent("scroll",a);window.addEvent("resize",c)}};(function(){ta.util.element.trackWhenScrolledIntoView=function(e,f,g,d,c){if(e&&f){a.push({e:e,k:f,cb:g,once:!d,persistent:c})}};var a=[];function b(){for(var c=a.length-1;c>=0;c--){var e=a[c];var f;if(e.e.substr){f=ta.select(e.e)}else{if(e.e.join){f=e.e}else{f=new Elements([e.e])}}if(f.length>0){var d=e.inView;f.each(function(g){var h=g.offsetWidth==0&&g.offsetHeight==0||g.getStyle("display")=="none";if(!h){e.inView=e.inView||ta.util.element.isScrolledIntoView(g,e.persistent)}});if(!d&&e.inView){if(!e.cb||e.cb()){ta.trackEventOnPage(e.k[0],e.k[1],e.k[2],e.k[3]);if(e.once){a.splice(c,1)}}}}}}window.addEvent("scroll",function(){ta.throttle(b,"ta.util.element.trackWhenScrolledIntoView",250,1000)});window.addEvent("resize",b);window.addEvent("load",b)})();ta.util.element.getTotalWidth=function(b){if(!b){return 0}var a=b.getComputedStyle("width");if(a&&isNaN(parseInt(a))){return b.getWidth()}return(parseInt(b.getComputedStyle("width"))||0)+(parseInt(b.getComputedStyle("margin-left"))||0)+(parseInt(b.getComputedStyle("margin-right"))||0)+(parseInt(b.getComputedStyle("padding-left"))||0)+(parseInt(b.getComputedStyle("padding-right"))||0)+(parseInt(b.getComputedStyle("border-left-width"))||0)+(parseInt(b.getComputedStyle("border-right-width"))||0)};ta.util.element.getTotalHeight=function(a){if(!a){return 0}var b=a.getComputedStyle("height");if(b&&isNaN(parseInt(b))){return a.getHeight()}return(parseInt(a.getComputedStyle("height"))||0)+(parseInt(a.getComputedStyle("margin-top"))||0)+(parseInt(a.getComputedStyle("margin-bottom"))||0)+(parseInt(a.getComputedStyle("padding-top"))||0)+(parseInt(a.getComputedStyle("padding-bottom"))||0)+(parseInt(a.getComputedStyle("border-top-height"))||0)+(parseInt(a.getComputedStyle("border-bottom-height"))||0)};ta.util.element.copyAjaxPreserves=function(f,g){var d,e,h,c,a,j,b;if(!g||!f){return}d=g.getElements(".ajax_preserve");if(d&&d.length>0){h={};e=f.getElements(".ajax_preserve, .ajax_preserve_noreplace");for(c=0;c<e.length;++c){a=e[c].getAttribute("data-ajax-preserve");if(a){h[a]=e[c]}}for(c=0;c<d.length;++c){j=d[c];a=j.getAttribute("data-ajax-preserve");if(!a||!j.parentElement){continue}b=h[a];if(b){j.parentElement.replaceChild(b,j)}}}};ta.util.element.replaceContentWithAjaxPreserve=function(c,b){ta.util.element.copyAjaxPreserves(b,c);b.innerHTML="";var a=document.createDocumentFragment();while(c.firstChild){a.appendChild(c.firstChild)}b.appendChild(a)};ta.util.element.setContentElementWithAjaxPreserve=function(b,a){ta.util.element.copyAjaxPreserves(b,a);b.innerHTML="";b.appendChild(a)};ta.util.link={ajaxSubmit:function(a,c,b){if(a){new Event(a).preventDefault()}if(b){ta.util.cookie.setPIDCookie(b)}if(!c.className.match(/\bform_(\w+)\b/)){return}var f=$(RegExp.$1);var e={url:c.href,data:f,onFailure:function(h){if(f){f.removeClass("ajaxInFlight")}ta.util.error.ajaxFailure("link - ajaxSubmit",h)}};var g=window["callback"+f.id];if(c.className.match(/method_(\w+)\b/)){e.method=RegExp["$1"]}if(c.className.match(/\btgt_(\w+)\b/)){e.update=RegExp["$1"]}else{e.onSuccess=function(h){if(f){f.removeClass("ajaxInFlight")}ta.overlays.showInLightbox(h);if(g&&typeOf(g)=="function"){g()}}}var d=window["validate"+f.id];if(d&&typeOf(d)=="function"&&d.apply(f)==false){return}f.addClass("ajaxInFlight");if(c.className.match(/\bevalScripts\b/)){e.evalScripts=true}(e.update?new Request.HTML(e):new Request(e)).send()},ajaxCall:function(a,b){if(a){new Event(a).preventDefault()}if(!(tgt=b.className.match(/\btgt_(\w+)\b/))){return}tgt=$(tgt[1]);new Request.HTML({url:b.href,update:tgt,onFailure:ta.util.error.ajaxFailure.partial("link - ajaxCall")}).send()},popResWidth:function(b,e,d){try{var a=475,f=390,i=210;if(screen.width>1024){a=800;f=600;i=240}else{if(screen.width>800){a=620;f=500;i=240}}var g=Object.merge({width:a,height:f,xOffset:i,yOffset:5},d);ta.util.link.popup(b,e,g)}catch(c){ta.util.error.record(c,"ta.util.link - popCustom",b,g)}},popPhoto:function(a,d,c){try{Cookie.write("PhotoPop","1",{domain:cookieDomain});var e=Object.merge({name:"media",width:782,height:820},c);ta.util.link.popup(a,d,e)}catch(b){ta.util.error.record(b,"ta.util.link - popPhoto",a,e)}},popup:function(m,a,j){try{var g=Object.merge({name:false,width:950,height:610,xOffset:false,yOffset:false,noScroll:0,aHref:false,fullOptions:true,ensureReferrer:false,isAsdf:false},j);new Event(m).preventDefault();var f=false,b="",l=false;var c=1;if(ta.has("ta.popups.popupIndex")&&typeof ta.retrieve("ta.popups.popupIndex")!="undefined"){c=ta.retrieve("ta.popups.popupIndex")}if(!g.aHref){g.aHref=a.href}g.aHref=g.aHref.replace("%7Cnavarea%7C",ta.meta.link.getPhotoNavArea(a));if(g.isAsdf&&g.aHref){if(ta.util.ASDF.asdfDcd){g.aHref=ta.util.ASDF.asdfDcd(g.aHref).replace(/&amp;/g,"&")}}if(g.aHref&&g.aHref.indexOf("p=HotelsCom")>-1){g.width=Math.max(g.width,960);try{g.height=Math.max(g.height,window.getHeight(),600)}catch(h){g.height=Math.max(g.height,600)}}if(g.width){b+=",width="+g.width}if(g.height){b+=",height="+g.height}if(g.xOffset){b+=",screenX="+g.xOffset+",left="+g.xOffset}if(g.yOffset){b+=",screenY="+g.yOffset+",top="+g.yOffset}if(!Browser.chrome){g.noScroll=1}if(g.fullOptions){var i=1;if(ta.browser.isIE9orHigher()){i=0}b="toolbar=1,resizable=1,menubar="+i+",location=1,status=1,scrollbars="+g.noScroll+b}else{b="toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars="+g.noScroll+b}if(!g.name){g.name="p"+(c++)}ta.store("ta.popups.popupIndex",c);if(g.ensureReferrer&&Browser&&Browser.ie){try{l=new Element("a",{target:g.name,href:g.aHref});l.inject(ta.id(document.body),"bottom");f=window.open("",g.name,b);l.click();l.destroy()}catch(d){ta.util.error.record(d,"ta.util.link - pop ensure referrer",m,g)}}else{try{f=window.open(g.aHref,g.name,b)}catch(h){ta.util.error.record(h,"ta.util.link - popping window",m,{href:g.aHref,name:g.name,args:b})}}if(typeof f!="undefined"&&f!==null){try{f.opener=self;f.focus()}catch(d){}}}catch(k){ta.util.error.record(k,"ta.util.link - popup",m,g)}},directionsPop:function(a,c,b,d){if(d){new Request({url:"/ActionRecord?action="+d}).send()}if(ta.trackEventOnPage){ta.trackEventOnPage("map_pin_overlay","directions_click")}ta.util.link.popup(a,c,b)},directionsPopInfoCard:function(a,c,b,d){if(d){new Request({url:"/ActionRecord?action="+d}).send()}if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","map_info_window","directions_cta")}ta.util.link.popup(a,c,b)},targetBlank:function(a,d,c){try{var e=Object.merge({aHref:false,isAsdf:false},c);if(e.isAsdf&&e.aHref){if(ta.util.ASDF.asdfDcd){e.aHref=ta.util.ASDF.asdfDcd(e.aHref).replace(/&amp;/g,"&")}}var f=c&&c.action&&(c.action=="website"||c.action=="deals"||c.action=="packages");if(ta.retrieve("ta.bl_calendar_lb")&&!ta.widgets.calendar.hasPageDates()&&f){ta.run("ta.overlays.Factory.loadCheckRatesLBOverlay",{},a,d,{detail:c.detailId,gaContext:"BLLightbox-"+c.action})}if(e.newTab||navigator.appVersion.indexOf("MSIE 7.")!=-1){window.open(e.aHref,"_blank")}else{if(ta.retrieve("ta.bl_calendar_lb")&&f){ta.servlet.Popup.openExternalWithDefaultOptions(e.aHref)}else{window.open(e.aHref,"_blank")}}}catch(b){ta.util.error.record(b,"ta.util.link - targetBlank",a,e)}}};ta||(ta={});ta.util||(ta.util={});ta.util.localstorage=(function(a,d,b,e){var f="taLsTest",c="1";return{canUseLocalStore:function(){try{if(d.localStorage){localStorage.setItem(f,c);return(c===localStorage.getItem(f))}}catch(g){}return false},canUseSessionStore:function(){try{if(d.sessionStorage){sessionStorage.setItem(f,c);return(c===sessionStorage.getItem(f))}}catch(g){}return false}}}(document,window,ta));(function(a){a.util.sessionStorage={};a.util.sessionStorage.canUseSessionStore=function(){try{if(window.sessionStorage){var c="taLsTest";sessionStorage.setItem(c,"1");var b=sessionStorage.getItem(c);return(b=="1")}}catch(d){return false}}}(ta));(function(){window.ta||(window.ta={});window.ta.util||(window.ta.util={});if(window.ta.util.Deferred){return}var a=["success","failure","always","progress"];var e={resolved:["success","always"],rejected:["failure","always"]};var g=function(){};function h(i){g.prototype[i]=function(k,j){return b(this,i,j?k.bind(j):k)}}for(var d=0;d<a.length;d++){h(a[d])}g.prototype.then=function(j,k){var i=this.success(j);return k?i.failure(k):i};window.ta.util.Deferred=function(l){var i="pending";var k=new g();k.queue=[];k.args=null;k.aplus=(typeof l==="boolean")&&l;k.status=function(){return i};var j={notify:function(){if(c(i)){throw new Error("Promise has already been fulfilled.")}var n=Array.prototype.slice.call(arguments);var p,o,m;for(o=0,m=k.queue.length;o<m;o++){p=k.queue[o];if(p.hook==="progress"){p.callback.apply(null,n)}}return k},resolve:function(){if(c(i)){throw new Error("Promise has already been fulfilled.")}i="resolved";k.args=Array.prototype.slice.call(arguments);return f(k)},reject:function(){if(c(i)){throw new Error("Promise has already been fulfilled.")}i="rejected";k.args=Array.prototype.slice.call(arguments);return f(k)},isFulfilled:function(){return c(i)},promise:function(){return k}};return j};var c=function(i){return i==="resolved"||i==="rejected"};var b=function(j,i,k){if(j.fwd){return b(j.fwd,i,k)}j.queue.push({hook:i,callback:k});return f(j)};var f=function(k){if(k.fwd){return f(k.fwd)}var j,i;while(c(k.status())&&(j=k.queue.shift())){if(~e[k.status()].indexOf(j.hook)){i=j.callback.apply(null,k.args);if(i instanceof g){i.queue=i.queue.concat(k.queue.splice(0));k=k.fwd=i}else{if(i&&k.aplus){k.args=[i]}}}}return k}}());ta.util.decoder={base64Decoder:function(g){g=g.replace(/\-/g,"+").replace(/\_/g,"/");if(g.length%4!==0){var h=4-g.length%4;for(var f=0;f<h;f++){g=g+"="}}var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="",p,n,k="",o,l,j,i="";for(var e=0;e<g.length;e+=4){o=d.indexOf(g.charAt(e));l=d.indexOf(g.charAt(e+1));j=d.indexOf(g.charAt(e+2));i=d.indexOf(g.charAt(e+3));if(o==-1||l==-1||j==-1&&i==-1){ta.util.error.record(null,"Facebook signed request contains invalid base64 letter",null,{code:g});return}p=(o<<2)|(l>>4);n=((l&15)<<4)|(j>>2);k=((j&3)<<6)|i;a=a+String.fromCharCode(p);if(j!=64){a=a+String.fromCharCode(n)}if(i!=64){a=a+String.fromCharCode(k)}p=n=k="";o=l=j=i=""}return unescape(a)}};ta.util.files={reset:function(a){if(Browser.ie){a.clone(false,true).replaces(a)}else{a.value=""}},upload:function(c,e,g){function b(j,h){var k;try{k=document.createElement("<"+j+' name="'+h+'">')}catch(i){k=document.createElement(j);k.setAttribute("name",h)}return k}var f="upload_iframe_"+(Math.random()+"").split(".")[1];var d=b("iframe",f);d.setAttribute("id",f);d.setAttribute("src","about:blank");d.setAttribute("width","0");d.setAttribute("height","0");d.setAttribute("border","0");d.setAttribute("style","width:0; height:0; border:none; display:none; ");document.body.appendChild(d);c.target=f;function a(){ta.id(d).removeEvent("load",a);var h=d.contentWindow.document;g(h);setTimeout(function(){d.parentNode.removeChild(d)},250)}ta.id(d).addEvent("load",a);c.submit()}};ta.util.replace=(function(){return{img:function(b,a){try{b.src=ta.retrieve(a).src}catch(c){}}}})();(function(a){a.util||(a.util={});a.util.ajax=function(l){l||(l={});try{if(l.trackEvent&&a.analytics){var c=a.analytics._toEvtParams(l.trackEvent);l.data=a.util.merge(l.data||{},c)}}catch(f){if(a.util&&a.util.error&&a.util.error.record){a.util.error.record(f,"ta.util.ajax.initialize.trackEvent")}}var k=a.util.Deferred(l.aplus);var j=function(e){};var i,d;var g=function(e){if(!e){return""}return e.replace(/^\s*while\(1\);\s*/,"")};var h={onComplete:typeof l.onComplete==="function"?l.onComplete:j,onSuccess:typeof l.onSuccess==="function"?l.onSuccess:j,onFailure:typeof l.onFailure==="function"?l.onFailure:j,onReadOnly:l.onReadOnly||j,onRedirect:l.onRedirect||j};l.onComplete=function(){var m;var q=i.getResponseHeader("content-type");var n=l&&l.useContentType;try{if(!n||(q.indexOf("application/json")>=0)){var p=g(i.responseText);m=JSON.decode?JSON.decode(p):JSON.parse(p)}}catch(o){}if(!m){m={text:i.responseText}}if(!m.code){m.code=i.status||0}m.contentType=q;try{if(l&&l.trackEvent&&a.analytics){a.analytics._trackEventAfterAjax(this.options.trackEvent)}}catch(o){if(a&&a.util&&a.util.error&&a.util.error.record){a.util.error.record(o,"ta.util.ajax.onComplete.trackEventAfterAjax")}}if(m.code>=200&&m.code<300){m.status="ok";k.resolve(m)}else{if(m.code===301||m.code===302){m.status="redirect";k.reject(m)}else{m.status||(m.status="error");k.reject(m)}}};l.onCancel=function(){k.reject({code:0,status:"abort"})};l.onTimeout=function(){k.reject({code:0,status:"timeout"})};delete l.onLoadStart;delete l.onProgress;delete l.onException;delete l.onSuccess;delete l.onFailure;i=b(l);return k.promise().always(function(e){h.onComplete.call(i,e);if(e.status==="redirect"){h.onRedirect.call(i,e)}else{if(e.status==="readonly"){h.onReadOnly.call(i,e)}else{if(~["abort","timeout","error"].indexOf(e.status)){h.onFailure.call(i,e)}else{h.onSuccess.call(i,e)}}}})};function b(d){if(typeof MooTools!=="undefined"&&typeof Request!=="undefined"){return(new Request(d).send()).xhr}var h=new XMLHttpRequest();var j=h.abort.bind(h);var i=d.method.toUpperCase()||"GET";var g=d.url||"/";var c=[];var f,e;if(d.withCredentials){h.withCredentials(true)}h.onreadystatechange=function(){if(this.readyState===4){clearTimeout(f);d.onComplete()}};h.abort=function(){j();d.onCancel()};if(d.timeout){f=setTimeout(function(){j();d.onTimeout()},d.timeout)}d.data||(d.data={});for(e in d.data){if(d.data.hasOwnProperty(e)&&d.data[e]!==null){c.push(e+"="+encodeURIComponent(d.data[e]))}}if(/GET/.test(d.method)){g+=(/\?/.test(g)?"&":"?")+c.join("&")}if(/POST/.test(d.method)){d.headers||(d.headers={});d.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"}h.open(d.method,g);for(e in d.headers){h.setRequestHeader(e,d.headers[e])}d.onRequest&&d.onRequest.call(h);h.send(/POST/.test(d.method)?c.join("&"):null);return h}}(ta));try{(function(a){a.util||(a.util={});a.util.imageServer=function(c){var b=(typeof(CDNHOST)==="string"&&CDNHOST)||(typeof(cdnhost)==="string"&&cdnhost);if(b&&c){if(!/^\//.test(c)){c="/"+c}c=b+c}return c}})(ta)}catch(e){ta.util.error.record(e,"cannot do ta.util.imageServer",null,{path:path})};ta.common.search={langSelect:function(b,a){if(a.form.elements.q.value.length>0){a.form.submit()}},useCurrentLocation:function(a){ta.select(".locNotFound.hidden").removeClass("hidden")},clearOnFocus:function(b,a){if(a.value==a.defaultValue){a.value="";a.removeClass("focusClear")}},defaultOnBlur:function(b,a){if(a.value==""){a.addClass("focusClear");a.value=a.defaultValue}},validate:function(b,a){if(a.q.value.trim()==""||$(a.q).hasClass("focusClear")){return false}setOneTimeCookie("SRCHACT","NEW");return true},recordAndValidate:function(c,i,g,k){if(g||ta.common.search.validate(c,i)){k=k||ta.retrieve("ta_typeahead_widget");var h=k&&k.options?k.options.startTime:undefined;var l=k?k.lastSuccessfulQuery:undefined;var d=k&&k.options&&k.options.geoId;var e=k&&k.options?k.options.name:undefined;var b=k&&k.historyShown;var j=ta.id("TYPEAHEAD_REDIRECT");j.value="true";var m=ta.id("MASTAHEAD_TYPEAHEAD_START_TIME");m.value=h;var a=ta.id("MASTAHEAD_TYPEAHEAD_UI_ORIGIN");a.value=e;if(k){k.hide()}var f=k&&k.options?k.options.searchSessionId:undefined;if(!f){f="no_search_session_id"}new Request({method:"GET",data:{hadHistory:b,action:"RECORD",eventType:"search_bttn",startTime:h,source:e,query:l,uiOrigin:e,global:(!d||pageServlet=="Search"),scope:(!d||pageServlet=="Search")?"G":d,searchSessionId:f},onSuccess:function(n){if(k&&k.options&&k.options.onSubmit){k.options.onSubmit(k)}i.submit()},onFailure:function(n){if(k&&k.options&&k.options.onSubmit){k.options.onSubmit(k)}i.submit()},url:"/TypeAheadJson"}).send()}return false},selectLang:function(b,d){try{var n=function(o){var e=o.match(/([\d.]+)px/);if(e){return parseFloat(e)}return 0};var g=ta.id("SEARCH_LANG_SELECT_POPUP");if(!g){return false}if(!g.hasClass("hidden")){var f=ta.id("SEARCH_LANG_SELECT_INPUT");var i=ta.id("SEARCH_LANG_SELECTED");if(f){var h=d.id.match(/lang_(.+)/);if(h){var c=h[1];if("all"==c){f.value=""}else{f.value=c}}if(i){if(ta.isFall2013MastheadRefresh()){if(h){g.getElements(".langSelectOption").removeClass("selected");d.addClass("selected")}}else{i.set("html",ta.id(d).get("html"))}}}g.addClass("hidden");if(!ta.isFall2013MastheadRefresh()&&i&&!ta.common.search.widthfixed){var j=ta.common.search.width;var l=n(i.getStyle("width"));var a=Math.max(j,l);console.log("check width old "+j+" new "+l);if(j!=l){i.setStyle("width",a+"px");ta.common.search.widthfixed=true}}}else{g.removeClass("hidden");if(!ta.isFall2013MastheadRefresh()){var i=ta.id("SEARCH_LANG_SELECTED");if(i&&!ta.common.search.widthfixed){ta.common.search.width=n(i.getStyle("width"))}}}}catch(k){ta.util.error.record(k,"select search lang")}},reviews:function(c,b){new Request({url:"/ActionRecord?action=SearchReviews"}).send();if(b&&b.getElement){var a=b.getElement(".searchTestText");if(a){alert(a.innerHTML)}}else{alert("Coming Soon!")}return false},replaceOrAddParam:function(b,a){var e=a.split("=");var g=e[0];var f=e[1];var d=new RegExp("([\\?#&])("+g+"=\\w+)");var c=d.exec(b);if(c){return b.replace(d,"$1"+a)}else{return b+"&"+a}},extractParam:function(b,e,d){var c=new RegExp("[\\?#&]"+e+"=(\\w+)");var a=c.exec(b);if(a){return a[1]}else{if(d){return d}}return null},selectOption:function(b,d){var p=function(e){do{e=e.getParent()}while(e&&e.nodeName!=="FORM");return e};var c=ta.id(d);var i=ta.id(p(c));try{var o=function(q){var e=q.match(/([\d.]+)px/);if(e){return parseFloat(e)}return 0};var h=i.getElement(".SEARCH_SELECT_POPUP");if(!h){return false}if(!h.hasClass("hidden")){h.addClass("hidden");var f=i.getElement(".SEARCH_SELECT_INPUT");var j=i.getElement(".SEARCH_SELECTED");if(f){var g=c.hasClass("lang_all");if(g){f.value=1}else{f.value=2}if(j){j.set("html",c.get("html"))}}if(j){var k=ta.common.search.width;var n=o(j.getStyle("width"));var a=Math.max(k,n);j.setStyle("width",a+"px")}}else{h.removeClass("hidden");var j=i.getElement(".SEARCH_SELECTED");if(j){ta.common.search.width=o(j.getStyle("width"))}}}catch(l){ta.util.error.record(l,"select search lang")}}};ta.common.flyout={intlPopup:function(d,b){d.stop();b.onclick=null;flagsUrl=document.location.pathname;var c="/StaticVelocityPage?t=intSitesFly.vm&lt=evt&footerFlagFormat="+footerFlagFormat+"&flagsURL="+encodeURIComponent(flagsUrl);if(document.location.search!=""){c+=encodeURIComponent(document.location.search)}if(document.location.hash!=""){c+=encodeURIComponent(document.location.hash)}if(window.modelGeoId){c+="&geo="+modelGeoId}if(window.flagsSettings){for(var a=0;a<flagsSettings.length;a++){c+="&"+flagsSettings[a]+"=true"}}if(window.pageFeature){c+="&pageFeature="+pageFeature}new Asset.css(flagsFlyoutCSS);new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:c},b);return false},showRecentLocationSaveOverlay:function(){setPID(3832);new Request({url:"/RecentlyViewedAjax",onSuccess:function(a){if(!a.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(a,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"save_overlay"},evalScripts:true,method:"get"}).send()},submitRecentLocationEmail:function(){var a=ta.retrieve("overlays.current");if($("rvEmailSend")){$("rvEmailSend").hide()}if($("rvEmailProgress")){$("rvEmailProgress").show()}setPID(4470);new Request({url:"/RecentlyViewedAjax",onSuccess:function(b){a.hide();if(!b.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(b,{style:"dg s4 RecentlyViewedOverlay"})}},data:$("rvEmailForm"),evalScripts:true}).send()},submitRecentLocationSave:function(){var a=ta.retrieve("overlays.current");if($("rvEmailSend")){$("rvEmailSend").hide()}if($("rvEmailProgress")){$("rvEmailProgress").show()}setPID(4469);new Request({url:"/RecentlyViewedAjax",onSuccess:function(b){a.hide();if(!b.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(b,{style:"dg s4 RecentlyViewedOverlay"})}},data:$("rvEmailForm"),evalScripts:true}).send()},showEmailHotelOverlay:function(c,d,a,b){new Asset.css(emailHotelCSS);new Request({url:"/EmailHotel",onSuccess:function(f){ta.run("ta.overlays.showInLightbox",{},f,{style:"dg s4"});if(ta.has("emailOwnerShowCaptcha")){ta.t4b.emailhotel.showRecaptcha()}},data:{detail:c,isOfferEmail:d,overrideOfferEmail:a,contactColumn:b},evalScripts:true,method:"get"}).send()},rvInquiryPrivacy:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,content:$("rvPrivacyBox").innerHTML},a)},rvClearDefault:function(c,a){var b=$(c);if(b&&b.value==a){b.value="";b.removeClass("rvDefault")}},BLSpecialOffersUrl:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,content:$("blLinkMsg").innerHTML},a)},destinationsPopup:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:"/vpages/destinationsFly.html?lt=evt"},a)},funStuffPopup:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:"/vpages/funStuffFly.html?lt=evt"},a)},bestValue:function(b,a){b.stop();a.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,remoteContent:"/vpages/bestValueFly.html?log=false"},a);return false},starAttribution:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},a);return false},amenities:function(d,b,a,c){if(d){d.stop()}b.onclick=null;if(typeof(amenityOverlayCss)!="undefined"&&!ta.retrieve("ta.amenityOverlayCss")){ta.store("ta.amenityOverlayCss",Asset.css(amenityOverlayCss))}if(a&&a>0){setPID(a);new Request({url:"/ActionRecord?excludeFromVS=false&action=HRAmenitiesFlyout"}).send()}if(c){ta.store("amenities.suppressLinks",true)}ta.run("ta.overlays.Factory.createAmenitiesLightbox",{},b);return false}};ta.common.sendmessage={getMessageCode:function(){var e=new Date().getTime();var b="ABCDEFGHIJKLMNOPQRSTUVWXYZ123456";var f=[];for(var a=0;a<32;a++){f[a]=((e&(1<<a))!=0)?1:0}var c=[[],[],[],[],[],[]];for(var a=0;a<30;a++){c[a%(c.length)].push(f[f.length-1-a])}var d="";for(var a=0;a<c.length;a++){d+=b.substr(parseInt(c[a].reverse().join(""),2),1)}return d},communityLightbox:function(e,d){if(!communityEnabled){window.callback_communityLightboxEnable=function(){communityEnabled=true;var g=ta.retrieve("overlays.sendmessage");if(g){g.hide()}ta.common.sendmessage.communityLightbox(e,d)};var a=new StringBuffer();a.append('<p id="inviteStatusField" style="display: none; color: red;"></p>');a.append("<p>"+JS_mem_travelnet_friends_disabledM2M+".</p>");a.append('<p><a href="javascript:void(0)" onclick="ta.common.sendmessage.enableCommunity(window[\'callback_communityLightboxEnable\'], true); return false;">'+JS_common_Clickhere+"</a> "+JS_mem_travelnet_friends_turnOn+".</p>");var f=ta.overlays.showInLightbox(a.toString(),{backdrop:ta.overlays.BACKDROP_NEVER,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});f.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){f.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",f);return}if(d){var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h);var i=window[d];if(i&&typeOf(i)=="function"){i()}}}else{var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9998");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h)}}var c={url:e,onSuccess:b,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:communityLightbox")};new Request(c).send()},enableCommunity:function(c,a){var b=c;if(!a){b=function(d){ta.common.sendmessage.enableCommunityResponse(d,c)}}if(typeof(JS_SECURITY_TOKEN)=="undefined"){JS_SECURITY_TOKEN=""}new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeM2M",set:"on",token:JS_SECURITY_TOKEN},onSuccess:b,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:enableCommunity")}).send()},enableCommunityResponse:function(res,callback){if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){document.getElementById("inviteStatusField").innerHTML=data.ERROR;document.getElementById("inviteStatusField").style.display="block"}}else{document.getElementById("inviteStatusField").innerHTML=JS_community_on;document.getElementById("inviteStatusField").style.display="block"}},submitSendMessage:function(h,b){h.stop();b.onclick=null;var a=b.className.match(/LSO_(\w+)/)[1];$("LsoId").value=footprintGetWithSet(a);$("screenWidth").value=screen.width;$("screenHeight").value=screen.height;if(!b.className.match(/\bform_(\w+)\b/)){return}var e=$(RegExp.$1);var d={url:b.href,data:e,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:submitSendMessage")};var g=window["callback_"+e.name];if(b.className.match(/method_(\w+)\b/)){d.method=RegExp["$1"]}if(b.className.match(/\btgt_(\w+)\b/)){d.update=RegExp["$1"]}else{d.onComplete=function(k,i){if(ta.retrieve("messaging.isiframe")&&ta.id("PAGE")){ta.id("PAGE").set("html",k);if(ta.id("SUCCESS")){window.top.location.href="/Messages?f=512&o=0&cnt=25&j=-3&oo=0&oj=-3"}}else{var j=ta.overlays.showInLightbox(k,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});ta.store("overlays.sendmessage",j)}if(g&&typeOf(g)=="function"){g()}}}var c=window["validate"+e.id];if(c&&typeOf(c)=="function"&&c.apply(e)==false){return}if(b.className.match(/\bevalScripts\b/)){d.evalScripts=true}var f=ta.retrieve("overlays.sendmessage");if(f&&f.options&&f.options.permanent){f.options.permanent=false}new Request(d).send()},cancel:function(a){if(a){return}var b=ta.retrieve("overlays.sendmessage");if(b){ta.remove("overlays.sendmessage")}if(ta.has("community.needsReload")){window.location.reload()}},closeSendMessage:function(c,a){if(c&&c.stop){c.stop()}if(a){a.onclick=null}var b=ta.retrieve("overlays.sendmessage");if(b){b.hide(c)}if($("vrWideOverview")&&ta.has("vrShowCaptcha")){ta.vr.showRecaptcha()}}};ta.servlet.Inspiration={sortPopularity:function(b,a){sort("popularity")},sortAlphabetical:function(b,a){sort("alphabetical")}};ta.keep("facebook.onAvail",function(){FB.Event.subscribe("edge.create",function(d,g){try{var h=false;if(g){h=ta.id(g)}var a="";var c=d||"";if(h){if(h.className){var b=false;if(b=h.className.match(/track_(\w+)/)){a=b[1]}if(h.hasClass("expanded")){a+="_expanded"}}}new Request({url:"/ActionRecordPlus?action=LIKE&from="+a+"&url="+c}).send()}catch(f){ta.util.error.record(f,"FB like review tracking error")}})});ta.servlet.Reviews={expandCount:0,PAGING_HEIGHT:1000,expandReview:function(o,d,c){var a=0;if(ta.retrieve("expand_"+c)){return}ta.store("expand_"+c,true);a++;var b=ta.id(c);var n=new Event(o);try{a++;if(!b){ta.util.error.record(null,"expandReview - no container",n,{revId:c});return}var j,l,h=false;if(b.getElement){j=b.getElement(".dyn_full_review");l=b.getElement(".basic_review");h=b.getElement(".revBotContent")}if(!l||!l.hasClass){ta.util.error.record(null,"expandReview - no basic_rev",n,{revId:c});return}a++;var i=l.hasClass("first");if(h&&h.getElement){var g=h.getElement(".fb_like_button")}var k=l.getElement(".helpful");a++;if(j){j.setStyle("display","block");if(g){ta.servlet.Reviews.injectFBLikeIntoFull(g,j)}if(ta.servlet.Reviews.translationRatings.contains(expandedReviewId)){ta.servlet.Reviews.injectTranslationRating(l,j)}l.setStyle("display","none");ta.remove("expand_"+c)}else{a++;ta.servlet.Reviews.expandCount++;var m=l.getElement(".partnerRvw span.linkItem");a++;if(m){m.getElement("img.textArrow_more").setStyle("display","none");new Asset.image(CDNHOST+"/img2/spinner.gif",{"class":"anim_loop"}).inject(m)}a++;new Request({url:"/SingleUserReview-g"+modelGeoId+"-d"+modelLocId+"?review="+c+"&servlet="+pageServlet+"&expand="+ta.servlet.Reviews.expandCount,onSuccess:function(s,t){try{var r=0;j=new Element("div");j.addClass("dyn_full_review");j.set("html",s);j.inject(l,"after");r++;var u=j.getElement(".collapse");if(u){u.addEvent("click",function(){ta.servlet.Reviews.collapseReview(b)})}r++;if(i){j.getElement(".basic_review").addClass("first")}r++;setupTranslationRatingSlider(j);r++;if(typeof processLinks!=="undefined"){processLinks(j)}r++;ta.servlet.Reviews.fixMTHelpfulUrl(j,c);if(l){var x=l.getElement("img.anim_loop");x.dispose()}r++;if(m){var q=m.getElement("img.textArrow_more");if(typeof(q)!="undefined"&&q!=null){q.setStyle("display","inline")}}r++;var v=ta.retrieve("facebook.data.handlers.FRIEND_NAMES");var p=ta.retrieve("facebook.data.handlers.HIGHLIGHT_FRIENDS");if(v&&typeof(v)=="function"){v()}if(p&&typeof(v)=="function"){p({expanded:true})}if(g){ta.servlet.Reviews.injectFBLikeIntoFull(g,j)}if(k){helpfulVotingKey=k.id.match(/(helpful\w+)_\w+/);if(helpfulVotingKey){helpfulVotingKey=helpfulVotingKey[1];if(ta.retrieve(helpfulVotingKey)){var z=j.getElement(".helpful");if(z){z.innerHTML=k.innerHTML}}}}r++}catch(w){ta.util.error.record(w,"expandReview - post AJAX",null,{postProg:r})}if(l&&l.setStyle){l.setStyle("display","none")}if(h&&h.setStyle){h.setStyle("display","none")}ta.remove("expand_"+c);var y=ta.retrieve("ta.servlet.Reviews.callback");if(y!=null){y()}},evalScripts:true}).send()}}catch(f){ta.util.error.record(f,"expandReview",n,{revId:c,prog:a});ta.remove("expand_"+c)}},expandReviews:function(h,l,j,s,q){if(ta.retrieve("expand_"+j)){return}ta.store("expand_"+j,true);var n=ta.id(j);var p=new Event(h);try{if(!n){ta.util.error.record(null,"expandReviews - no container",p,{revId:j});return}var k,t,z=false;if(n.getElement){k=n.getElement(".dyn_full_review");t=n.getElement(".basic_review");z=n.getElement(".revBotContent")}if(!t||!t.hasClass){ta.util.error.record(null,"expandReviews - no basic_rev",p,{revId:j});return}if(k){ta.servlet.Reviews.showExpandedReview(j,true);ta.remove("expand_"+j)}else{ta.servlet.Reviews.expandCount++;var u=t.getElement(".partnerRvw span.moreLink");if(u){var c=u.getParent().getElement("img.textArrow_more");if(c){c.setStyle("display","none");new Asset.image(CDNHOST+"/img2/spinner.gif",{"class":"anim_loop"}).inject(u,"after")}}var y=$$("#REVIEWS .reviewSelector");var a;for(var v=0;v<y.length;v++){if(y[v].id==j){a=y.slice(v)}}var x=0;var m=[];if(a&&a.length>0){for(var v=0;v<a.length;v++){var r=a[v].id;if(r&&r.indexOf("review_")===0){var w=a[v].getElement(".dyn_full_review");if(!w){var g=a[v].getElement(".basic_review");if(g){m[m.length]=r.split("_")[1];if(g.getElement(".ownerFav")){x=m[m.length-1]}}else{ta.util.error.record(null,"expandReviews - basic_review content missing",null,{revId:r},"WARN")}}}}}if(m.length>0){var o=m[0];var b=0;if(s){b=s}var f=m.join(",");new Request({url:"/ExpandedUserReviews-g"+modelGeoId+"-d"+modelLocId+"?target="+o+"&context="+b+"&reviews="+f+"&servlet="+pageServlet+"&expand="+ta.servlet.Reviews.expandCount+(x>0?"&favorite="+x:""),trackEvent:{module:"Reviews",action:"expand"},onSuccess:function(H,D){try{var I=[];var A=new Element("div");A.set("html",H);var P=A.getChildren();var G=[];for(var O=0;O<P.length;O++){var E=P[O];var K=E.id.split("_")[2];var R=ta.id("review_"+K);if(R&&R.getElement){G.push(R.getProperty("id"));var N=R.getElement(".basic_review");if(N){I.push(K);E.erase("id").addClass(N.className.replace("basic_review","dyn_full_review")).inject(N,"after").hide();var S=E.getChildren()[0];if(S){S.removeClass("review")}var J=E.getElement(".collapse");if(J){J.addEvent("click",ta.servlet.Reviews.getCollapseCallback(R))}setupTranslationRatingSlider(E);if(typeof processLinks!=="undefined"){processLinks(E)}if(ta.servlet.Reviews.translationRatings.contains(K)){ta.servlet.Reviews.injectTranslationRating(N,E)}ta.servlet.Reviews.fixMTHelpfulUrl(E,"review_"+K);if(K===o){var B=N.getElement("img.anim_loop");if(B){B.dispose()}ta.servlet.Reviews.refreshSidebarAds();ta.servlet.Reviews.injectInlineBanner(R);var M=N.getElement(".partnerRvw span.moreLink");if(M){var C=M.getParent().getElement("img.textArrow_more");if(typeof(C)!="undefined"&&C!=null){C.setStyle("display","inline")}}}}}}var F=true;for(var O=0;O<I.length;O++){if(O==1){F=false}var L="review_"+I[O];ta.servlet.Reviews.showExpandedReview(L,F)}if(lazyImgs!=null){window.setupLazyLoad()}}catch(T){ta.util.error.record(T,"expandReviews - post AJAX",null,{});var B=t.getElement("img.anim_loop");if(B){B.dispose()}var M=t.getElement(".partnerRvw span.moreLink");if(M){var C=M.getParent().getElement("img.textArrow_more");if(typeof(C)!="undefined"&&C!=null){C.setStyle("display","inline")}}}if(Browser.ie&&Browser.version<8){var Q=function(){for(var U=0;U<G.length;++U){var V=ta.id(G[U]);if(V!==null){V.addClass("dummy")}}};setTimeout(Q,0)}ta.remove("expand_"+j)},onFailure:function(i,A){ta.util.error.record(null,"ExpandedUserReviews ajax call failed",null,{reviewIds:f},"WARN");var C=t.getElement("img.anim_loop");if(C){C.dispose()}var D=t.getElement(".partnerRvw span.moreLink");if(D){var B=D.getParent().getElement("img.textArrow_more");if(typeof(B)!="undefined"&&B!=null){B.setStyle("display","inline")}}},evalScripts:true}).send()}}}catch(d){ta.util.error.record(d,"expandReviews",p,{revId:j});ta.remove("expand_"+j)}},filterReviews:function(c,n){var d=arguments.callee;n=n||{};var j=ta.id("REVIEWS");var b=j.getElement(".loadingContainer");if(b){var g=j.getStyle("position");if(g!=="relative"&&g!=="absolute"&&g!=="fixed"){j.setStyle("position","relative")}var l=0;var f=n.whiteBoxTopElmt?ta.id(n.whiteBoxTopElmt):undefined;if(f){l=f.getPosition(j).y}b.setStyles({display:"block",top:l+"px",height:(j.getSize().y-l)+"px"});var i=b.getElement(".loadingBox");if(i){i.setStyle("top",n.loadingBoxTopElmt?(ta.id(n.loadingBoxTopElmt).getPosition(j).y-l)+"px":undefined)}}var a=location.pathname;var m=false;if(!n.ignoreOffset){if(window.pageServlet==="ShowUserReviews"){var k=window.onhashchange;window.onhashchange=undefined;location.hash="#or0";(function(){window.onhashchange=k}).delay(0)}else{a=location.pathname.replace(/-or\d+/,"");m=location.pathname!==a}}if(!history.replaceState&&m){c.submit()}else{if(d.request){d.request.cancel()}if(m){history.replaceState(history.state,document.title,a)}var h=n.scrollToElmt?ta.id(n.scrollToElmt):undefined;if(h){window.scrollTo(0,h.getPosition().y)}d.request=new Request({url:a,data:"mode=filterReviews&"+c.toQueryString(),evalScripts:true,onSuccess:function(r){var p=new Element("div",{html:r});var q=p.getChildren();if(q.length>0){q[0].getElements("[data-targetEvent]").each(function(s){ta.fireEvent(s.getAttribute("data-targetEvent"),s)});var o=j.getElement(":focus");ta.util.element.copyAjaxPreserves(j,q[0]);q[0].replaces(j);if(o&&o.getParent(".ajax_preserve")){o.focus()}ta.prwidgets.initWidgets(q[0])}else{ta.util.error.record(e,"filterReviews got invalid response");b.setStyle("display","none")}},onFailure:function(){if(!n.reqNum){return d(c,Object.merge({reqNum:1},n))}ta.util.error.record(undefined,"filterReviews");b.setStyle("display","none")}}).send()}},injectInlineBanner:function(a){try{if(a){if(ta.has("ads.gptEnabled")){if(!ta.has("ads.inlineReviewAd.injected")){ta.store("ads.inlineReviewAd.injected",true);ta.common.ads.queueForInjection(["gpt-ad-468x60"])}else{var b=a.getElement(".iab_inlineBanner");if(b){b.destroy()}}}else{injectAdsTargeted(a)}}else{throw new Error("Review parent element is null")}}catch(c){ta.util.error.record(c,"unable to inject inline banner on review expansion")}},refreshSidebarAds:function(){try{if(ta.has("ads.gptEnabled")){ta.common.ads.refreshSidebarAds()}else{ta.common.ads.refreshSideBarAdsWithRefreshOrdKey()}}catch(a){ta.util.error.record(a,"unable to refresh sidebar ads on review expansion")}},getCollapseCallback:function(a){return function(){ta.servlet.Reviews.collapseReview(a)}},showExpandedReview:function(a,b){try{if(typeof(a)==="undefined"){ta.util.error.record(null,"showExpandedReview - reviewId is undefined");return}var f=ta.id(a);if(f){var i,k,g=false;if(f.getElement){i=f.getElement(".dyn_full_review");k=f.getElement(".basic_review");g=f.getElement(".revBotContent")}else{ta.util.error.record(null,"showExpandedReview - recContainer missing getElement attribute",null,{revId:a});return}if(!k){ta.util.error.record(null,"showExpandedReview - basic_rev is null",null,{revId:a});return}if(!k.hasClass){ta.util.error.record(null,"showExpandedReview - basic_rev missing hasClass attribute",null,{revId:a});return}if(g&&g.getElement){var d=g.getElement(".fb_like_button")}var j=k.getElement(".helpful");if(!i){ta.util.error.record(null,"showExpandedReview - no full");return}if(j){var h=j.id.match(/(helpful\w+)_\w+/);if(h){h=h[1];if(ta.retrieve(h)){var l=i.getElement(".helpful");if(l){l.innerHTML=j.innerHTML}}}}if(d){ta.servlet.Reviews.injectFBLikeIntoFull(d,i)}i.show();k.hide()}else{ta.util.error.record(null,"showExpandedReview - revContainer is null",null,{revId:a});return}}catch(c){ta.util.error.record(c,"showExpandedReview")}},fixMTHelpfulUrl:function(c,a){var d=c.getElement("input[name=returnTo]");if(d){var b=document.location.href;if(b.indexOf("#")>=0){b=b.substring(0,b.indexOf("#"))}d.value=b+"#mtreview_"+a}},injectFBLikeIntoFull:function(c,a){try{if(c){var f=c.getFirst();if(f){f.addClass("expanded")}var b=a.getElement(".helpful");if(b){c.inject(b,"after")}}}catch(d){ta.util.error.record(d,"expandReview - like button")}},injectTranslationRating:function(c,b){if(c&&b){var a=c.getElement(".translation"),d=b.getElement(".translation");if(a&&d){d.set("html",a.get("html"))}}},translationRatings:[],collapseReview:function(a){try{a=ta.id(a);var f=a.getElement(".dyn_full_review");var c=a.getElement(".basic_review");var d=a.getElement(".revBotContent");var b=f.getElement(".fb_like_button");if(c&&c.setStyle){c.setStyle("display","block")}if(d&&d.setStyle){d.setStyle("display","block")}if(b){var i=b.getFirst();if(i){i.addClass("expanded")}if(d){b.inject(d,"inside")}}var h=a.id.replace("review_","");if(ta.servlet.Reviews.translationRatings.contains(h)){ta.servlet.Reviews.injectTranslationRating(f,c)}f.setStyle("display","none")}catch(g){ta.util.error.record(g,"collapseReview")}},findLink:function(b,a){if(/\bt(r[\d]+)\b/.test(a.className)){window.location=$(RegExp.$1).href}},mtSubmitOnClick:function(b,a){if(a.value==="true"){ta.util.cookie.setPIDCookie(25173)}else{if(a.value==="false"){ta.util.cookie.setPIDCookie(25172)}}a.form.submit()},validateMTEdit:function(d,c){var b=ta.id("mtedit_mt");var a=b.getElements(".mtedit_orig_title")[0].value;var h=b.getElements(".mtedit_title")[0].value;var g=b.getElements(".mtedit_orig_text")[0].value;var f=b.getElements(".mtedit_text")[0].value;return h&&f&&(h!=a||f!=g)},enableMTEditSubmit:function(c,b){var a=ta.id("mtedit_submit");if(a.disabled&&ta.servlet.Reviews.validateMTEdit(c,b)){a.disabled=false}},submitMTEdit:function(g,d,a,f){var b=ta.id("mtedit_submit");b.disabled=true;ta.select(".mtedit_error").each(function(j){j.hide()});if(ta.servlet.Reviews.validateMTEdit(g,d)){var c=ta.id("mtedit_mt");var i=c.getElements(".mtedit_title")[0].value;var h=c.getElements(".mtedit_text")[0].value;new Request({url:"/MachineTranslationEditSubmit?r="+a,data:{title:i,body:h,token:f},onSuccess:function(){try{ta.id("mtedit").hide();ta.id("mtedit_received").show();ta.retrieve("translationEditOverlay").position();var j=ta.id("mtForm"+a);j.getElement(".mtRateLabel").hide();j.getElement(".mtImproveButton").hide();j.getElement(".mtEditThanksLabel").show()}catch(k){ta.util.error.record(k,"submitMTEdit:onSuccess")}},onFailure:function(j){try{if(j.status>=400&&j.status<=499){ta.id("mtedit_404").show()}else{b.disabled=false;ta.id("mtedit_500").show()}}catch(k){ta.util.error.record(k,"submitMTEdit:onFailure")}}}).send()}else{ta.id("mtedit_nochange").show()}},rateMTReview:function(a,d){var c=ta.id(d.form);var i=c.getElement("input[name=translateRating]:checked");if(i){var f=i.value;var g=c.elements.userId.value;var b=c.elements.reviewId.value;ta.servlet.Reviews.translationRatings.push(b);var h=c.action+"?at=true&rateValue="+b+","+g+","+f;new Request({url:h}).send();var j=c.getElement(".thanks").innerHTML;c.getElement(".translationRatingForm").innerHTML=j}},rateMTReviewNew:function(a,d,b,f){var c=ta.id("mtForm"+b);if(c){var i=c.elements.userId;if(i){ta.servlet.Reviews.translationRatings.push(b);var j=c.action+"?at=true&rateValue="+b+","+i.value+","+f;new Request({url:j}).send();var g=document.getElement(".mtRatingOverlay");if(g){g.hide()}var h=c.getElement(".mtRatingButton");if(h){h.hide()}var k=c.getElement(".thanks");if(k){k.show()}}}},popSocialShare:function(b,a){if(b&&b.href){var c="toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1,width=800,height=400,left=40,top=40,screenx=40,screeny=40";window.open(b.href,"SocialShare",c)}new Request({url:"/ActionRecord?action=shareOn"+a}).send();return false},resizeHelpfulVote:function(g){var b=document.querySelectorAll(g),h=document.querySelector(".helpful.redesigned"),f=document.querySelector(".isHelpful"),c=document.querySelector(".tooltips"),j=(ifdefNN(h)?h.parentNode.clientWidth:336)-20,d,k,a;if(ifdefNN(f)){j-=f.clientWidth}if(ifdefNN(c)){j-=c.clientWidth}for(d=0;d<b.length;d++){k=12;a=b[d];a.style.fontSize=k+"px";while(a.clientWidth>j&&k>8){a.style.fontSize=k+"px";k--}}},helpfulVoteHandlerOb:(function(){var a={};return function(d,c,f){if(a[c]){return}a[c]=true;new Event(d).preventDefault();var g=c.className.match(/\btgt_(\w+)\b/);if(!g){return}g=g[1];var b=g.match(/\d+/);if(ifdefNN(b)){b=b[0]}f=ta.util.ASDF.asdfDcd(f);new Request({url:f,onSuccess:function(h,j){var l=ta.id(g+"_expanded");var i=ta.id(g+"_collapsed");if(l){l.innerHTML=h}if(i){i.innerHTML=h;ta.store(g,true)}var k=ta.id("postVoteMessage_"+b);if(ifdefNN(k)){setTimeout(function(){k.addClass("seen")},500)}},onComplete:function(){delete a[c]}}).send()}})(),recordUnattached:function(b,a){new Request({url:"/ActionRecord?action=START_UNATTACHED_RVW_SEARCH"}).send();a.removePropertyEvent("keyup","ta.servlet.Reviews.recordUnattached")},changeSearchType:function(p,c){if(window.searchType){$$("span."+window.searchType.id).hide()}window.searchType=c;ta.select("span."+c.id).setStyle("display","inline");var g=c.getAttribute("data-type")||c.value;ta.find('input[name="type"]').value=g;var s=ta.id("query");var j=s.retrieve("typeahead");if(s&&j){var r=ta.servlet.Reviews.poiTypeIdMap[g];j.options.search=TypeAhead.utils.query(false,r,null,null,true,10);j.options.minChars=r=="al"?2:3;j.search()}var b=ta.find(".poiSearch");if(b){if(c.id=="type_rental"){ta.select(".poiSearchForm, #UR_SELECT, #SRCH_RSLT").hide();ta.select(".vrSearchForm").show();var l=ta.id("reviewGeo");if(l){l.focus();l.select()}}else{var n={type_hotel:"hotel",type_attraction:"attr",type_restaurant:"eat",type_airline:"al",type_location:"geo"};ta.store("tpAhdType",n[c.id]);ta.select(".vrSearchForm, #SRCH_RSLT_VR, #MAIN_COL, #POST_PHOTOS_FORM").hide();ta.select(".poiSearchForm, #UR_SELECT").show();if(s.value.length>0){searchByType()}s.focus();s.select();var o=ta.id("queryGeo");if(o){var h=o.retrieve("typeAhead");if(h){var d="GEO";if(c.id=="type_attraction"){d="ATTRGEO"}else{if(c.id=="type_restaurant"){d="RESTGEO"}}h.changeUrl("/TypeAheadJson?action="+d);h.query();h.updateChoices()}}}ta.select("#SRCH_RSLT, .tips").hide();ta.store("searchResultFlag",true)}else{var k="GEO";if(c.id!="type_rental"){switch(c.id){case"type_hotel":ta.store("tpAhdType","hotel");break;case"type_attraction":ta.store("tpAhdType","attr");k="ATTRGEO";break;case"type_restaurant":ta.store("tpAhdType","eat");k="RESTGEO";break;case"type_location":ta.store("tpAhdType","geo");break}if($("SRCH_BOX_VR")){$("SRCH_BOX_VR").hide()}if($("SRCH_RSLT_VR")){$("SRCH_RSLT_VR").hide()}if($("MAIN_COL")){$("MAIN_COL").hide()}if($("POST_PHOTOS_FORM")){$("POST_PHOTOS_FORM").hide()}$("SRCH_BOX").show();$("UR_SELECT").show();var a=ta.id("query");var f=a.retrieve("typeAhead");var m=ta.id("SEARCH_GEO");if(f){var i="/TypeAheadJson?action=SINGLELOCTYPE&types="+ta.retrieve("tpAhdType")+"&global=true";if(ifdefNN(m)&&ifdefNN(m.value)){i+="&parentids="+m.value}f.changeUrl(i);if(ifdefNN(a.value)&&a.value.trim().length!==0){f.query();f.updateChoices()}}a.focus();a.select();var o=ta.id("queryGeo");if(o){var h=o.retrieve("typeAhead");if(h){h.changeUrl("/TypeAheadJson?action="+k);h.query();h.updateChoices()}}}else{$("SRCH_BOX_VR").show();$("SRCH_BOX").hide();$("UR_SELECT").hide();var l=$("reviewGeo");l.focus();l.select()}ta.store("searchResultFlag",true);ta.id("SRCH_RSLT").hide()}},unattachedSearchOnFocus:function(f,c,b){var d=ta.retrieve("tpAhdType");var a={xargs:"&types="+d};if(b){a.geo=b}ta.run("ta.widgets.typeahead.factory.global_mutable",{},f,c,"SINGLELOCTYPE","ta.widgets.typeahead.events.onSelectUnattached",a);c.removePropertyEvent("focus","ta.servlet.Reviews.unattachedSearchOnFocus")},unattachedSearchGeoOnFocusAttach:function(d,a){var b=ta.retrieve("tpAhdType"),c=a.retrieve("typeAhead");ta.run("ta.widgets.typeahead.factory.global_mutable",{},d,a,"GEOGRAPHICONLY","ta.widgets.typeahead.events.onSelectGeoUnattached",{xargs:"&types="+b,minLength:1,noSearchPrompt:true});a.removePropertyEvent("focus","ta.servlet.Reviews.unattachedSearchGeoOnFocus")},unattachedSearchGeoOnFocus:function(c,a){var b=ta.id("SEARCH_GEO");b.value=1;a.value=""},unattachedSearchGeoOnBlur:function(h,b){var g=ta.id("SEARCH_GEO"),c=ta.id("query"),d=b.retrieve("typeAhead"),a=c.retrieve("typeAhead");if(!d.selected){var f=d.choices.getFirst();if(b.value==""||!f||!f.responseObj||f.responseObj.notFound){g.value=1;b.value=""}else{g.value=f.responseObj.value;b.value=f.responseObj.name}a.changeUrl("/TypeAheadJson?action=SINGLELOCTYPE&types="+ta.retrieve("tpAhdType")+"&global=true&parentids="+g.value)}},ratingFlyoutScroll:function(b){try{var c=b.getScroll().y,a=b.getScrollSize().y;if(b.retrieve("canFetchMore",true)&&c>a-ta.servlet.Reviews.PAGING_HEIGHT){b.store("canFetchMore",false);ta.servlet.Reviews.fetchRatingPage(b)}}catch(d){ta.util.error.record(d,"ratingFlyoutScroll")}},fetchRatingPage:function(b){var a=b.getElement(".ratingVal").innerHTML,c=b.getElement(".locId").innerHTML,f=b.getElement(".revId"),d=f.innerHTML;if(d!=0){new Request({url:"/RatingPagingAjax",data:{locId:c,ratingVal:a,revId:d},method:"get",onSuccess:function(g,h){f.destroy();b.innerHTML+=g;b.store("canFetchMore",true)}}).send()}},toggleOnRecentReview:function(i,g,a){if(!i||!g||!a){return}var f=ta.id(i.target||i.srcElement);var d=ta.id("RECENT_REVIEW_QUOTE_"+a);if(d&&f&&f.id==g.id){var h=d.getElement(".speechBubble");if(h){h.addClass("highlight")}var c=d.getElement(".recentReview_meta_content");if(c){c.addClass("highlight")}}if(!d||!d.hasClass("hidden")){return}var b=ta.id("RECENT_REVIEW_ATTRIBUTION_"+a);if(!b){return}ta.select("#HR_HACKATHON_CONTENT .recentReviewQuote").each(function(j){if(j.get("id")!="RECENT_REVIEW_QUOTE_"+a){if(!j.hasClass("hidden")){j.addClass("hidden")}}else{j.removeClass("hidden")}});ta.select("#HR_HACKATHON_CONTENT .recentReviewAttribution").each(function(j){if(j.get("id")!="RECENT_REVIEW_ATTRIBUTION_"+a){if(!j.hasClass("hidden")){j.addClass("hidden")}}else{j.removeClass("hidden")}})},toggleOffRecentReview:function(h,f,a){if(!h||!f||!a){return}var c=ta.id("RECENT_REVIEW_QUOTE_"+a);if(!c){return}var d=ta.id(h.target||h.srcElement);if(d&&d.id==f.id){var g=c.getElement(".speechBubble");if(g){g.removeClass("highlight")}var b=c.getElement(".recentReview_meta_content");if(b){b.removeClass("highlight")}}},onClickRecentReview:function(d,c,a){if(!d||!c||!a){return}var b=ta.id("RECENT_REVIEW_QUOTE_"+a);if(!b){return}var f=b.getElement(".quoteLnk");if(f){f.click()}},toggleReview:function(a,c,b,f){if(!a||!c||!b){return}var h=ta.id("review_"+b);var g=ta.id("UR"+b);var j;if(g){j=g}else{if(h){j=h}else{return}}var i=j.getElement(".col2of2");var d=j.getElement(".innerBubble");if(i&&d){if(f){i.addClass("highlight");d.addClass("highlight")}else{i.removeClass("highlight");d.removeClass("highlight")}}},scrollToReview:function(b,d,c){var j=document.getElements(".persistent_tabs_header");var f=0;if(j&&j.length!=0){f=j.getHeight()}var h=ta.id("review_"+c);if(h){window.scrollTo(0,h.getPosition().y-f)}else{var g=ta.retrieve("location.helpful_review_highlight.full."+c);if(g){var i=ta.select("#REVIEWS .reviewSelector");var a=Elements.from(g);i.some(function(k){if(!k.getParent("#FRIENDS_LOCATION_CONTENT_SUMMARY")){a.inject(k,"before");h=ta.id("review_"+c);window.scrollTo(0,h.getPosition().y-f);return true}return false})}}},poiTypeIdMap:{2:"hotel",7:"eat",5:"attr",15:"al"},selectPoiType:function(d,a){ta.select(".poiTypes li").removeClass("selected");a.addClass("selected");var b=a.id.replace("type_","");ta.ReviewTracking.trackEvent("TYPE",b);var c=ta.find(".unattachedTypeahead");c&&c.toggleClass("hidden",a.id=="type_rental");ta.servlet.Reviews.changeSearchType(d,a)},selectPoiIcon:function(d,a){ta.select(".poiTypes li").addClass("collapsed");a.removeClass("disabled");a.getSiblings().addClass("disabled");var b=a.id.replace("type_","");ta.ReviewTracking.trackEvent("TYPE",b);var c=ta.find(".unattachedTypeahead");c&&c.toggleClass("hidden",a.id=="type_rental");ta.servlet.Reviews.changeSearchType(d,a)},createUnattachedTypeahead:function(f,c){c.onfocus=null;var b=ta.find('input[name="type"]').value;var d=ta.servlet.Reviews.poiTypeIdMap[b];var g=TypeAhead.utils.query(false,d,null,null,true,10,null,null,null,null,["no_closed"]);var a={name:"UnattachedWarLander",minChars:d=="al"?2:3,maxResults:10,containerParent:ta.id("PAGE"),containerClass:"typeaheadResults",search:g,itemTemplate:TypeAhead.views.itemTemplate(),itemSelector:"li",width:348,positionRelative:false,selectInputText:false,selectOnBlur:false,assumeOnBlur:false,cacheResults:false,autopopulateHighlighted:false,forceProcessResults:true,shouldSubmit:function(){searchByType(c);h.hide();return false},onSelect:function(i){var j=ta.find('input[name="type"]').value;ta.trackEventOnPage("Unattached_search","action",ta.servlet.Reviews.poiTypeIdMap[j]);var k=ta.id("UR_SELECT");if(k&&i){k.appendChild(new Element("input",{type:"hidden",name:"detail",value:i.value}));k.submit()}},resolveSelection:function(i){return i.name.stripTags()},onShow:function(i){i.container.addClass("visible")},onHide:function(i){i.container.removeClass("visible")}};TypeAhead.views.configureTypeAheadForSegmentedResults(a);var h=new TypeAhead(c,a);c.store("typeahead",h)},initializeMap:function(c,h,d,b){var g=c;var f=h;function a(){var i=new ta.servlet.Reviews.Map();i.initialize(g,f,d,b);ta.store("reviews.map."+c,i)}if(document.readyState==="complete"){a()}else{google.maps.event.addDomListener(window,"load",a)}},addDraggableMarker:function(a){var b=ta.retrieve("reviews.map."+a);if(b){b.addMarker();b.userMarker.setDraggable(true)}},makeMarkerDraggable:function(a){var b=ta.retrieve("reviews.map."+a);if(b&&b.userMarker){b.userMarker.setDraggable(true)}},restoreDefaultMarker:function(a){var b=ta.retrieve("reviews.map."+a);if(b){b.resetMap();if(b.userMarker){b.userMarker.setDraggable(false)}if((ta.retrieve("reviews.pinRedist"))!="true"){b.userMarker.setVisible(false)}}},mapPinConfirmationOverlay:function(c,b){var a=ta.retrieve("map_pin_confirmation_overlay");if(!a){a=new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_NEVER,showArrow:true,arrowClass:"arrow arrowLeft",showCloseButton:true,style:"tooltip ttGreen small",mirrorIfRtl:true,offsetRight:3,offsetTop:77},b);ta.store("map_pin_confirmation_overlay",a)}a.show()},trackMapPinConfirmationEvent:function(a,c){var b=ta.retrieve("reviews.map."+a);if(b){ta.trackEventOnPage("WAR_Optional",b.trackingPrefix+c)}},pinVoteNo:function(c,b,a){ta.servlet.Reviews.trackMapPinConfirmationEvent(a,"no");ta.id("PIN_YES").removeClass("selected");ta.id("PIN_NOTSURE").removeClass("selected");ta.id("PIN_NO").addClass("selected");ta.id("pinVote").value="no";if((ta.retrieve("reviews.pinRedist"))=="true"){ta.servlet.Reviews.makeMarkerDraggable(a);ta.servlet.Reviews.mapPinConfirmationOverlay(c,ta.id("MAP_CONTAINER"))}else{ta.servlet.Reviews.restoreDefaultMarker(a)}},pinVoteNotSure:function(c,b,a){ta.servlet.Reviews.trackMapPinConfirmationEvent(a,"unsure");ta.id("PIN_YES").removeClass("selected");ta.id("PIN_NO").removeClass("selected");ta.id("PIN_NOTSURE").addClass("selected");ta.id("pinVote").value="unsure";ta.servlet.Reviews.restoreDefaultMarker(a)},pinVoteYes:function(c,b,a){ta.servlet.Reviews.trackMapPinConfirmationEvent(a,"yes");ta.id("PIN_NO").removeClass("selected");ta.id("PIN_NOTSURE").removeClass("selected");ta.id("PIN_YES").addClass("selected");ta.id("pinVote").value="yes";if((ta.retrieve("reviews.pinRedist"))!="true"){ta.servlet.Reviews.addDraggableMarker(a);ta.servlet.Reviews.makeMarkerDraggable(a);ta.servlet.Reviews.mapPinConfirmationOverlay(c,ta.id("MAP_CONTAINER"))}else{ta.servlet.Reviews.restoreDefaultMarker(a)}},showReviewOverlay:function(){ta.find("#TOP_REVIEW_OVERLAY_HEADING_TITLE").innerHTML=ta.find(".altHeadInline a").innerHTML;var b=ta.find("#OVERLAY_REVIEW");if(b){var a=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true,style:"reviewMsgOverlay"}).loadRemoteSuccess(b.innerHTML);ta.store("userreview.overlayReview",a);ta.trackEventOnPage("UserReviewSearch","overlay_open","")}},initUserReviewOnTopTracking:function(){var b=ta.find(".writeAnotherReviewCta");if(b==null){return}ta.util.element.doIfElementIsVisible(b,ta.trackEventOnPage,["User_review_top","inView"]);var c;var d=function(){c=f.delay(500,b)};var a=function(){clearTimeout(c)};var f=function(){ta.trackEventOnPage("User_review_top","Impression","");b.removeEvent("mouseenter",d);b.removeEvent("mouseleave",a)};b.addEvent("mouseenter",d);b.addEvent("mouseleave",a)},initOwnersFavoriteReviewTracking:function(a){var c=function(){new Request({url:"/BLImpRecord",data:{blImps:JSON.stringify([{locationId:modelLocId,servlet:servletName,tab:"Reviews",display:"FavoriteReview",details:"REVIEW",position:1}])}}).send()};var b=ta.id("review_"+a);if(b){ta.util.element.doIfElementIsVisible(b,c);ta.select(b,".helpful_text").addEvent("click",function(){ta.trackEventOnPage(servletName,"FAVORITE_HELPFUL",modelLocId)});ta.select(b,".reportTxt").addEvent("click",function(){ta.trackEventOnPage(servletName,"FAVORITE_REPORT",modelLocId)});ta.select(b,"#rn"+a).addEvent("click",function(){ta.setEvtCookie(servletName,"FAVORITE_REVIEW_TITLE",modelLocId,0,this.href)});ta.select(b,".moreLink").addEvent("click",function(){ta.trackEventOnPage(servletName,"FAVORITE_MORE",modelLocId)});ta.select(b,".ownerFavHeader").addEvent("mouseover",function(){ta.trackEventOnPage(servletName,"FAVORITE_TOOLTIP",modelLocId);ta.id(this).removeEvents("mouseover")})}}};ta.servlet.Reviews.Map=function Map(){this.mapId=null;this.isInteractive=false;this.isZoomInitialized=false;this.googleMap=null;this.streetField=null;this.localStreetField=null;this.street1_local=null;this.street1=null;this.city=null;this.state=null;this.country=null;this.defaultLat=null;this.defaultLng=null;this.hasDefault=false;this.redistributable=false;this.userMarker=null;this.userMarkerMoved=false;this.userMarkerZoom=-1;this.resetPinButton=null;this.trackingPrefix=null;this.trackingInteractivePrefix=null;this.updateTimeout=null};ta.servlet.Reviews.Map.prototype.initialize=function(c,i,f,b){this.mapId=c;this.isInteractive=i;this.streetField=ta.id(f);this.localStreetField=ta.id(b);this.populateMapInfoFromServlet();ta.trackEventOnPage("WAR_Optional",this.trackingPrefix+"load");var a={center:this.hasDefault?{lat:this.defaultLat,lng:this.defaultLng}:{lat:13.081,lng:80.274},zoom:this.hasDefault?this.streetLevelZoom+1:2,streetViewControl:i,draggable:i,scrollwheel:i,disableDefaultUI:!i,disableDoubleClickZoom:!i};this.googleMap=new google.maps.Map(document.getElementById(c),a);var d,g;if(i){d=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pinSearchCustom.png");g=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pinSearchCustomOver.png")}else{d=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pin_v2_CurrentCenter.png");g=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pin_v2_CurrentCenterOver.png")}this.userMarker=new google.maps.Marker({visible:false,icon:d,zIndex:10,optimized:false,draggable:false,title:i?ta.retrieve("reviews.userMarkerTooltip"):""});this.userMarker.setMap(this.googleMap);this.userMarker.setVisible(this.redistributable);this.userMarker.setPosition(this.googleMap.getCenter());this.removeReportAnErrorButton(this.googleMap);if(i){this.addListeners(d,g);this.addMapControls()}this.clearMapWarnings();var h=this;google.maps.event.addListenerOnce(this.googleMap,"tilesloaded",function(){h.setupGeoCodes()})};ta.servlet.Reviews.Map.prototype.addListeners=function(b,a){Element.NativeEvents.input=2;var c=this.userMarker;var d=this;[this.streetField,this.localStreetField].forEach(function(h){if(h){var g="mapChangeEvent."+d.mapId+"."+h.id;var f=function(j){d.updateGeoCodes()};var i=ta.retrieve(g);["change","input"].forEach(function(j){h.removeEvent(j,i);h.addEvent(j,f)});ta.store(g,f)}});google.maps.event.addListener(c,"mouseover",function(){c.setIcon(a)});google.maps.event.addListener(c,"mouseout",function(){c.setIcon(b)});google.maps.event.addListener(this.googleMap,"bounds_changed",function(){if(d.isZoomInitialized){ta.trackEventOnPage("WAR_Optional",d.trackingPrefix+"map_zoom")}if(d.userMarker.getVisible()&&d.googleMap.getBounds().contains(d.userMarker.getPosition())){d.userMarkerZoom=Math.max(d.googleMap.getZoom(),d.userMarkerZoom)}d.validateMap()});google.maps.event.addListener(c,"dragend",function(){ta.trackEventOnPage("WAR_Optional",d.trackingInteractivePrefix+"pin_move");d.resetTimeout();d.userMarkerMoved=true;d.userMarkerZoom=d.googleMap.getZoom();d.validateMap();ta.id("newLat").value=c.getPosition().lat();ta.id("newLng").value=c.getPosition().lng()})};ta.servlet.Reviews.Map.prototype.removeReportAnErrorButton=function(d){var a={name:"Dummy Style"};var b=[{featureType:"road",elementType:"all",stylers:[{visibility:"on"}]}];var c=new google.maps.StyledMapType(b,a);d.mapTypes.set("Dummy Style",c);d.setMapTypeId("Dummy Style")};ta.servlet.Reviews.Map.prototype.populateMapInfoFromServlet=function(){this.streetLevelZoom=parseInt(ta.retrieve("reviews.street_level_zoom"))||15;this.redistributable=(ta.retrieve("reviews.pinRedist"))=="true";this.defaultLat=parseFloat(ta.retrieve("reviews.pinLat"));this.defaultLng=parseFloat(ta.retrieve("reviews.pinLng"));this.hasDefault=!!(this.defaultLat&&this.defaultLng);this.city=ta.retrieve("reviews.address_city");this.state=ta.retrieve("reviews.address_state");this.country=ta.retrieve("reviews.address_country");this.street1=ta.retrieve("reviews.address_street1");this.street1_local=ta.retrieve("reviews.address_street1_local");if(this.redistributable){this.trackingPrefix="map_confirm_";this.trackingInteractivePrefix="map_confirm_no_"}else{if(this.hasDefault){this.trackingPrefix="map_addpin_noregc_";this.trackingInteractivePrefix="map_addpin_noregc_yes_"}else{this.trackingPrefix="map_addpin_nogc_";this.trackingInteractivePrefix="map_addpin_nogc_yes_"}}};ta.servlet.Reviews.Map.prototype.handleNewGeoCodes=function(f,c){var g=null;var d=null;var b=false;if(c==google.maps.GeocoderStatus.OK){if(f&&f[0]&&f[0].geometry&&f[0].geometry.location){b=true;var a=f[0].geometry.location;this.googleMap.fitBounds(f[0].geometry.viewport);this.userMarker.setPosition(this.googleMap.getCenter());if(this.street1||this.street1_local){g=a.lat();d=a.lng();this.googleMap.setZoom(this.streetLevelZoom+1)}}}else{if(c==google.maps.GeocoderStatus.ZERO_RESULTS){b=true}}if(b){this.defaultLat=g;this.defaultLng=d;this.hasDefault=!!(g&&d);this.userMarker.setVisible(this.hasDefault);this.userMarkerMoved=false}this.validateMap()};ta.servlet.Reviews.Map.prototype.resetTimeout=function(){if(this.updateTimeout){clearTimeout(this.updateTimeout);this.updateTimeout=null}};ta.servlet.Reviews.Map.prototype.updateGeoCodes=function(b){if(this.updateTimeout){clearTimeout(this.updateTimeout)}var c=this;var a=function(){c.updateTimeout=null;c.street1=c.streetField?c.streetField.value:null;c.street1_local=c.localStreetField?c.localStreetField.value:null;var h=c.googleMap;var f=[];f.push(c.street1_local||c.street1);f.push(c.city);f.push(c.state);f.push(c.country);var d=f.join(", ");var g=new google.maps.Geocoder();g.geocode({address:d},function(j,i){c.handleNewGeoCodes(j,i)})};if(b){a()}else{this.updateTimeout=setTimeout(a,500)}};ta.servlet.Reviews.Map.prototype.setupGeoCodes=function(){if(this.hasDefault){this.userMarker.setPosition(new google.maps.LatLng(this.defaultLat,this.defaultLng));this.userMarker.setVisible(this.redistributable);this.googleMap.setCenter(this.userMarker.getPosition());this.googleMap.setZoom(this.streetLevelZoom+1);this.validateMap();this.isZoomInitialized=true}else{this.updateGeoCodes(true);var a=this;google.maps.event.addListenerOnce(this.googleMap,"tilesloaded",function(){a.isZoomInitialized=true})}};ta.servlet.Reviews.Map.prototype.resetMap=function(){this.resetTimeout();if(this.hasDefault){var a=new google.maps.LatLng(this.defaultLat,this.defaultLng);this.userMarker.setPosition(a);if(!this.googleMap.getBounds().contains(a)){this.googleMap.setCenter(a)}ta.id("newLat").value="";ta.id("newLng").value=""}else{this.userMarker.setVisible(false)}this.userMarkerMoved=false;this.validateMap()};ta.servlet.Reviews.Map.prototype.addMarker=function(){this.resetTimeout();this.userMarker.setPosition(this.googleMap.getCenter());this.userMarkerZoom=this.googleMap.getZoom();this.userMarker.setVisible(true);this.validateMap()};ta.servlet.Reviews.Map.prototype.addMapControls=function(){var f=this;var c=document.createElement("div");var b=ta.retrieve("reviews.resetPinText");var d=ta.retrieve("reviews.resetPinTooltip");var a=function(){return function(){ta.trackEventOnPage("WAR_Optional",f.trackingInteractivePrefix+"pin_reset");f.resetMap()}};f.resetPinButton=ta.servlet.Reviews.Map.prototype.createButton("resetPinButton",b,d,a());c.appendChild(f.resetPinButton);c.index=0;this.googleMap.controls[google.maps.ControlPosition.RIGHT_TOP].push(c)};ta.servlet.Reviews.Map.prototype.createButton=function(h,f,g,b){var a=document.createElement("div");a.id=h;a.className="mapButton";var d=document.createElement("div");d.className="mapButtonBorder";d.title=g;a.appendChild(d);var c=document.createElement("div");c.className="mapButtonText";c.innerHTML=f;d.appendChild(c);if(b!=null){google.maps.event.addDomListener(d,"click",b)}return a};ta.servlet.Reviews.Map.prototype.addMapWarning=function(c){var b=ta.id("warningMessages");var a=ta.id("warningMessageContainer");if(a){ta.id(a).show()}if(b){if(b.innerHTML.length>0){b.innerHTML+="<br />"}b.innerHTML+=c}};ta.servlet.Reviews.Map.prototype.clearMapWarnings=function(){var b=ta.id("warningMessages");var a=ta.id("warningMessageContainer");if(a){ta.id(a).hide()}if(b){b.innerHTML=""}};ta.servlet.Reviews.Map.prototype.validateMap=function(){if(!this.isInteractive){return}this.clearMapWarnings();if(!this.checkZoom()){this.addMapWarning(ta.retrieve("reviews.zoomInWarningMsg"))}if(!this.userMarkerMoved){ta.id(this.resetPinButton).hide()}else{ta.id(this.resetPinButton).show()}};ta.servlet.Reviews.Map.prototype.checkZoom=function(){return this.userMarkerZoom>this.streetLevelZoom||!this.userMarkerMoved};ta.servlet.Location={distanceUnitsCookieName:"TAdistanceCookie",showMi:function(){$$("#NEARBY .milesOption").each(function(b,a){b.checked=true});$$("#NEARBY .milesLabel").each(function(b,a){$(b).addClass("selected")});$$("#NEARBY .kmLabel").each(function(b,a){$(b).removeClass("selected")});$$("#NEARBY .distanceMiles").show();$$("#NEARBY .distanceKm").hide();Cookie.write(this.distanceUnitsCookieName,0)},showKm:function(){$$("#NEARBY .kmOption").each(function(b,a){b.checked=true});$$("#NEARBY .milesLabel").each(function(b,a){$(b).removeClass("selected")});$$("#NEARBY .kmLabel").each(function(b,a){$(b).addClass("selected")});$$("#NEARBY .distanceMiles").hide();$$("#NEARBY .distanceKm").show();Cookie.write(this.distanceUnitsCookieName,1)},reportClosedVote:function(b,a,c){if(c&&c>0){c=encodeURIComponent(c);new Request({method:"get",url:"/ReportIAP?action=geocodeclosed&id="+c,onSuccess:function(d){ta.overlays.showInLightbox(d,{style:"mg s4",delayedPosition:true})}}).send()}},reportGeoCode:function(d,c,e,b,a){if(e&&e>0){e=encodeURIComponent(e);new Request({method:"get",url:"/ReportIAP?action=geocodebad&id="+e,onSuccess:function(f){ta.overlays.showInLightbox(f,{style:"mg s4",delayedPosition:true})}}).send()}if(ta.trackEventOnPage&&b&&a){ta.trackEventOnPage(b,a,e)}},reportCorrectAddr:function(c,f,k,n,d,i,l,o){if(k&&k>0){k=encodeURIComponent(k);var h=document.getElementById("street").value;var j=document.getElementById("city").value;var b=document.getElementById("state").value;var e=document.getElementById("zip").value;var g=document.getElementById("country").value;var m=document.getElementById("phone").value;var a=document.getElementById("website").value;if(n==h&&d==j&&i==e&&l==m&&o==a){new Request({method:"post",url:"/ReportIAP?action=geocodecorrect&updated=false&id="+k,onSuccess:function(p){ta.overlays.showInLightbox(p,{style:"mg s4",delayedPosition:true})}}).send()}else{h=encodeURIComponent(h);j=encodeURIComponent(j);b=encodeURIComponent(b);e=encodeURIComponent(e);g=encodeURIComponent(g);m=encodeURIComponent(m);a=encodeURIComponent(a);new Request({method:"post",url:"/ReportIAP?action=geocodecorrect&updated=true&id="+k+"&street="+h+"&city="+j+"&state="+b+"&zip="+e+"&country="+g+"&phoneNumber="+m+"&webSite="+a,onSuccess:function(p){ta.overlays.showInLightbox(p,{style:"mg s4",delayedPosition:true})}}).send()}}},reportGeoCodeDialog:function(d,c,e,b,a){if(typeof(incorrectLocation)!="undefined"&&!this.incorrectLocationLink){this.incorrectLocationLink=Asset.css(incorrectLocation)}if(e&&e>0){e=encodeURIComponent(e);new Request({method:"get",url:"/ReportIAP?id="+e+"&action=geocodedialog",onSuccess:function(f){ta.overlays.showInLightbox(f,{style:"mg s4",delayedPosition:true})},evalScripts:true}).send()}if(ta.trackEventOnPage&&b&&a){ta.trackEventOnPage(b,a,e)}},updateListingInformation:function(a,c,e,i,f,b,h,g){if(e&&e>0){if(g){window.location.href=g}else{var d={style:"glnew_lightbox",closeButtonClass:"innerClose",delayedPosition:true,attachCloseEvent:false,permanent:true,showCloseButton:true};new Request({url:"/GetListedUpdate"+b+"?id="+e,onSuccess:function(k){var j=ta.overlays.showInLightbox(k,Object.merge(d,{title:h}));j.closeBtn.addEvent("click",function(){ta.GetListedNew.closeOverlay()})},evalScripts:true}).send()}}if(ta.trackEventOnPage&&i&&f){ta.trackEventOnPage(i,f,e)}},reportClosedVoteNew:function(d,c,f,b,a,e){if(f&&f>0){new Request({method:"post",url:"/"+e+"?action=closedareyousure&id="+f,onSuccess:function(g){ta.overlays.showInLightbox(g,{style:"glnew_update_areyousure mg s4",delayedPosition:true,isChild:true,showCloseButton:false})},evalScripts:true}).send()}},recordOpenVote:function(d,c,f,b,a,e){if(f&&f>0){new Request({method:"post",url:"/"+e+"?action=voteopen&id="+f,onSuccess:function(g){ta.overlays.showInLightbox(g,{style:"mg s4",delayedPosition:true,showCloseButton:false})},evalScripts:true}).send()}},requestListingWithLightbox:function(b,c,a,h,k,e,l){l=l||{};var f={};var i=document.getElementById("query");if(i&&i.value){f.query=i.value}var d={style:"glnew_lightbox",closeButtonClass:"innerClose",delayedPosition:true,attachCloseEvent:false,permanent:true,showCloseButton:true};var j={showthanks:k,fromWARToDo:e,placetype:a,reviewID:l.reviewID};var g="/GetListedLightbox?"+Object.toQueryString(j);new Request({method:"post",url:g,data:f,onSuccess:function(n){var m=ta.overlays.showInLightbox(n,Object.merge(d,{title:h}));m.closeBtn.addEvent("click",function(){ta.GetListedNew.closeOverlay()});if(l.onHide){m.addEvent("hide",function(){l.onHide({display:"form"})})}m.container.store("onhide",l.onHide);ta.select(".overlayBG").setStyle("height",Math.max(window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),document.body.scrollHeight))},evalScripts:true}).send()},showReportForm:function(b,a,c){if(c&&c>0){c=encodeURIComponent(c);new Request({method:"get",url:"/ReportIAP?id="+c+"&action=geocodeform",onSuccess:function(d){ta.overlays.showInLightbox(d,{style:"mg s4",delayedPosition:true})},evalScripts:true}).send()}},setTrackPID:function(c,b,a){if(a==10022){ta.util.cookie.setPIDCookie(17138)}else{if(a==10021){ta.util.cookie.setPIDCookie(17137)}}},closeLightbox:function(){var a=ta.retrieve("overlays.current");if(a){a.hide()}},activateReportButton:function(){var a=ta.id("REPORT_LOCATION").getElements(".button")[0];a.removeClass("inactive");a.removeProperty("disabled")}};ta.servlet.Popup={index:0,open:function(a,b,c,p,l,k,g,o){try{if(isNaN(parseInt(c))){c=600}else{c=parseInt(c)}if(isNaN(parseInt(p))){p=400}else{p=parseInt(p)}if(isNaN(parseInt(l))){l=0}else{l=parseInt(l)}if(isNaN(parseInt(k))){k=0}else{k=parseInt(k)}if(a.indexOf("p=HotelsCom")>-1){c=Math.max(c,960);p=Math.max(p,window.getHeight(),600)}if(Browser.chrome){g=true}var f=1;if(g){f=0}var j=1;if(ta.browser.isIE9orHigher()){var j=0}var i=false;if(b&&typeof b=="string"){i=b}if(!i){var q=ta.servlet.Popup.index++;i="TripPop"+q}var d="";if(o){d="toolbar=1,resizable=1,location=1,status=1"}else{j=0;d="toolbar=0,resizable=1,location=0,status=0"}d+=",menubar="+j;d+=",scrollbars="+f;d+=",width="+c;d+=",height="+p;d+=",screenX="+l+",left="+l;d+=",screenY="+k+",top="+k;var m=window.open(a,i,d);if(m!=null){try{m.focus();m.opener=self}catch(n){}return m}}catch(h){ta.util.error.record(h,"Popup.open",null,{name:b,width:c,height:p,x:l,y:k,noScroll:g,allOptions:o})}},openExternalWithDefaultOptions:function(a){try{var b=475;var n=390;var k=210;var j=5;if(screen.width>=1024&&screen.height>=768){b=900;n=768;k=240}else{if(screen.width>1024){b=800;n=600;k=240}else{if(screen.width>800){b=620;n=500;k=240}}}if(a.indexOf("p=HotelsCom")>-1){b=Math.max(b,960);n=Math.max(n,window.getHeight(),600)}var f=false;if(Browser.chrome){f=true}var d=1;if(f){d=0}var i=1;if(ta.browser.isIE9orHigher()){var i=0}var o=ta.servlet.Popup.index++;var h="TripPop"+o;var c="toolbar=1,resizable=1,location=1,status=1";c+=",menubar="+i;c+=",scrollbars="+d;c+=",width="+b;c+=",height="+n;c+=",screenX="+k+",left="+k;c+=",screenY="+j+",top="+j;var l=window.open(a,h,c);if(l!=null){try{l.focus();l.opener=self}catch(m){}return l}}catch(g){ta.util.error.record(g,"Popup.open - openExternalWithDefaultOptions",null,{name:name,width:b,height:n,x:k,y:j,noScroll:f})}},openSizedPopup:function(e,b,d){new Event(e).preventDefault();var c=600;var a=400;if(sz=b.className.match(/sz(\d+)x(\d+)/)){c=sz[1];a=sz[2]}ta.servlet.Popup.open(b.href,"photoTPW",c,a,false,false,((typeof d!="undefined")?d:true),true)},checkrates:function(b,a){b.preventDefault();if(a.get("tag")!="a"){a=a.getParent("a")}ta.servlet.Popup.open(a.href,"cr",245,610,5,5);if(ta.trackEventOnPage){ta.trackEventOnPage("map_pin_overlay","check_rates_click")}},sponsorCheckRates:function(d,b){d.preventDefault();if(b.get("tag")!="span"){b=b.getParent("span")}var a=b.className.match(/id_(\d+)/)[1];var c="/HotelDateSearch?d="+a+"&fromPop=false&sponsid="+ta.retrieve("sponsor.id")+"&area=QC_Button_Map&from=HACSearchButton&returnTo=__2F__GMapsLocationController&sponsdet=mapsHacBottom";ta.servlet.Popup.open(c,"cr",245,610,5,5)},termsPopup:function(b,a){popup.apply(a,[b,"terms",300,300,30,25]);return false},openInParent:function(e,d,c){var a=false;if(window.top&&window.top.opener){a=window.top}else{if(window.opener){a=window}}if(!a){return true}var b="";if(d.get("tag")=="form"){b=d.action+"?"+d.toQueryString()}else{if(d.get("tag")=="a"){b=d.href}else{d=d.getParent("a");b=d.href}}if(b!=""){if(e){e.preventDefault()}a.opener.location=b;if(!(typeof c!="undefined"&&c)){a.close()}else{window.blur()}}},openInParentOrSelf:function(d,c){var a=false;if(window.top&&window.top.opener){a=window.top}else{if(window.opener){a=window}}var b="";if(c.get("tag")=="form"){b=c.action+"?"+c.toQueryString()}else{if(c.get("tag")=="a"){b=c.href}else{c=c.getParent("a");b=c.href}}if(b!=""){if(d){d.preventDefault()}if(!a||(typeof a.opener=="undefined")||!a.opener||(typeof a.opener.closed=="undefined")||a.opener.closed){window.location=b}else{a.opener.location=b;a.close()}}},photoGallery:function(a,d){try{if(!d){return false}if(!d.get||!d.getParentBySelector){d=$(d)}if(!d.get||!d.getParentBySelector){ta.util.error.record(j,"photoGallery - elmt not wrapped");return false}if(d.get("tag")!="a"){d=d.getParentBySelector("a")}}catch(j){ta.util.error.record(j,"photoGallery - get anchor elmt");return false}var b="";var c="1";if(d.className){b=d.className.match(/u_([^ ]*)/)[1];c=d.className.match(/#([0-9]+)/)[1]}try{if(typeof cookieDomain=="undefined"){var g=window.location.hostname.split("."),f=0,l;while(g[f]&&g[f]!="tripadvisor"){f++}l=g.slice(f).join(".");if(l){cookieDomain="."+l}}Cookie.write("PhotoPop",c,{domain:cookieDomain})}catch(j){ta.util.error.record(j,"photoGallery - cookie set")}try{var k="";if(b){k=ta.servlet.Popup.open(b,"media",780,800)}else{}try{if(k&&k.showImage){k.showImage(c)}}catch(j){}}catch(j){ta.util.error.record(j,"photoGallery - pop window")}return false},openAIMLink:function(d,c){new Event(d).preventDefault();var b;if(c.get("tag")=="span"&&c.hasClass("fkASDF")){b=c.className.match(/u_([^ ]*)/)[1]}else{if(c.getParent("div.fkASDF")){b=c.getParent("div.fkASDF").className.match(/u_([^ ]*)/)[1]}else{if(c.get("tag")=="a"){b=c.href}else{if(c.getParent().get("tag")=="a"){b=c.getParent().href}else{return}}}}b=b.replace("%7Cnavarea%7C",ta.meta.link.getPhotoNavArea(c));var a=c.className.match(/win(.+)/);if(a&&a.length>1){a=a[1]}else{a=null}ta.store("commerce.AIMWindow",ta.servlet.Popup.open(b,a,980,800,240,5,false,true))},openProviderWindow:function(b,a){new Event(b).preventDefault();ta.servlet.Popup.open(a.href,"photoTPW",1260,922,false,false,true,true)}};ta.servlet.Hotel={detailsTabClicked:function(b,a){showTab(locationId,"tabDetails")},photosTabClicked:function(b,a){showTab(locationId,"tabPhotos")},mapTabClicked:function(b,a){showTab(locationId,"tabMap")},ratingsTabClicked:function(b,a){showTab(locationId,"tabRatings")},anchorAtHotelsSortingHeader:function(){var a=ta.id("hotels_list_sorting_header");if(a){new Fx.Scroll(document.body,{offset:{x:0,y:a.getPosition().y}}).toTop()}},setPid:function(a){ta.util.cookie.setPIDCookie(a)},setConceptCookie:function(){if(ta.has("topconcepts.lastconcept")){var a=ta.retrieve("topconcepts.lastconcept");Cookie.write("CONCEPT",a,{domain:cookieDomain,time:5})}return true},voteRecorded:false,recordVote:function(b,g,e,c,a){if(a.checked&&!ta.servlet.Hotel.voteRecorded){ta.servlet.Hotel.voteRecorded=true;new Request({url:"/ActionRecord-g"+b+"-d"+g+"?action=TopConceptsHelpful_"+e}).send();var d=$("preVote");var f=$("postVote");if(d&&f){d.style.display="none";f.style.display="inline"}else{ta.util.error.record(null,"recordVote - cannot find voting spans")}}return true},isHotelsServlet:function(a){if(ta.has("is_hotels_serv")){return ta.retrieve("is_hotels_serv")}var b=ta.id("PAGE");if(b&&typeof b!="undefined"){if(b.hasClass("hotels_like")){ta.store("is_hotels_serv",true);return true}else{if(b.hasClass("non_hotels_like")){ta.store("is_hotels_serv",false);return false}}}if(typeof a!="undefined"){return a}return false},selectLanguage:function(d,b,e){var c=ta.id("LANG_FORM");var a=ta.id("filterLang");if(c&&a){ta.setEvtCookie("Reviews_Controls","language_sort","",0,window.location.href);a.value=e;c.submit()}},selectSeason:function(a,f,i,b,d,e){var g=ta.find("#MONTH_FORM .seasonLabel");if(ta.util.localstorage&&ta.util.localstorage.canUseLocalStore()){var h=new Date();h.setHours(h.getHours()+12);if(d!=0){localStorage.setItem("season_memory_expiry_time",h);localStorage.setItem("season_memory_loc_id",i);localStorage.setItem("season_memory_geo_id",b)}else{localStorage.removeItem("season_memory_expiry_time");localStorage.removeItem("season_memory_popup_shown");localStorage.removeItem("season_memory_loc_id");localStorage.removeItem("season_memory_new_popup_shown");localStorage.removeItem("season_memory_geo_id")}}if(g&&e){g.set("text",e)}var c=ta.id("MONTH_FORM");var k=ta.id("filterSeasons");if(c&&k){k.value=d;ta.trackEventOnPage("Reviews_Controls","season","",d);function j(){var l=ta.select(".seasonList .spinner img");l.forEach(function(n){n.remove()});var m=ta.find(".spinner",f);if(m){new Asset.image(CDNHOST+"/img2/spinner.gif").inject(m)}}j();c.submit()}}};ta.widgets.calendar={multiDateFormatter:function(f,g,e,c,d){var b={cname:"",contents:f.getDate()};var a="";if(!e){a="invalid"}else{if(f.getTime()==this.today.getTime()){if(this.newInDate&&f.getTime()==this.newInDate.getTime()){a="today inDate"}else{if(!g){a="today disabled"}else{a="today"}}}else{if(this.newInDate&&f.getTime()==this.newInDate.getTime()){a=d.inDateClass}}}b.cname=a;return b},calendarSingleSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.singleDaySelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarSingleSelect issue")}},calendarMCSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.multiCitySelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarMCSelect issue")}},dateFromString:function(d){d=d.replace(/\n/g,"");var a=ta.widgets.calendar.getDatePickerFormat("classic");var c=a.replace(/\w/g,"")[0];a=a.replace(/ /g,"").split(c);var b=d.replace(/ /g,"").split(c);if(a.contains("MM")&&a.contains("dd")&&a.contains("yyyy")){var h=a.indexOf("MM"),f=a.indexOf("dd"),g=a.indexOf("yyyy");var e=new Date(b[g],b[h]-1,b[f]);if(ta.retrieve("thai_buddhist_era_year")){e.setFullYear(e.getFullYear()-ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)}if(e!="Invalid Date"){return e}}return undefined},lastDateBefore:function(b,c){if(b.multiCityFlight&&c>1){var a;var d=c;while((!a||a.trim()==="")&&d>1){--d;a=ta.id("date_picker_in_"+d).innerHTML}if(a&&a.trim()!==""){return ta.widgets.calendar.dateFromString(a)}}return this.getPageInDate()},calendarMultiSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.multiSelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarMultiSelect issue")}},calendarMouseOver:function(f,e,a,c,b){ta.id(b).getParent(".overlay").overlay.calendar.dayOver(f,ta.util.date.create(e,a,c),b)},calendarPrev:function(c,b){var a=ta.id(b);if(a&&a.hasClass("sprite-date_picker-btnLeftInactive")){return}if(ta.util.i18n.isRtl()&&a&&a.hasClass("sprite-date_picker-btnRightInactive")){return}a.getParent(".overlay").overlay.calendar.prev()},calendarNext:function(c,b){var a=ta.id(b);if(a&&a.hasClass("sprite-date_picker-btnRightInactive")){return}if(ta.util.i18n.isRtl()&&a&&a.hasClass("sprite-date_picker-btnLeftInactive")){return}a.getParent(".overlay").overlay.calendar.next()},adultsOver:function(c,b){var a=document.getElements(".date_picker_adults_option");if(a){Array.each(a,function(d){ta.id(d).removeClass("adults_selected")})}ta.id(b).addClass("adults_selected")},removeMetaCalendarFromSync:function(c){if(!ta.has("metaDatePickerEnabled")){return}var b="avail.data."+c+"._met";var a=ta.retrieve("avail.data.objects");if(a){a.erase(b)}ta.store("avail.data.objects",a);ta.remove(b)},getCalendarObjectKey:function(d,b,a){var c="avail.data";if(a){c=c+"."+a}c=c+"."+d;if(b){c=c+"."+b}return c},trackCalendarObject:function(d){var a=d.calendar?d.calendar.options.pickerOption:null;var b=ta.widgets.calendar.getCalendarObjectKey(d.locId,d.ext,a);ta.store(b,d);var c=ta.retrieve("avail.data.objects");if(!c){c=[]}c.include(b);ta.store("avail.data.objects",c)},trackCalendarFlyout:function(d,c,e){var f="date.picker.calendarflyout";var b=ta.retrieve(f);if(!b){b=[]}var a={};a.elmt=d;a.overlay=c;a.overlaySrc=e;b.push(a);ta.store(f,b);ta.remove("date.picker.calendarflyout.allCleared")},clearCalendarFlyouts:function(){var b="date.picker.calendarflyout";var a=ta.retrieve(b);if(a){a.each(function(c){var e=c.elmt;var d=c.overlay;var f=c.overlaySrc;if(e&&d&&f){e.removeEvent("mouseenter",d.showWithDelay);e.removeEvent("mouseleave",d.hideWithDelay);e.removeEvent("mouseenter",d.show);e.removeEvent("mouseleave",d.hide);e.removeEvent("click",d._pin);e.adopt(f)}});ta.store("date.picker.calendarflyout.allCleared",true)}},getDateBefore:function(b){var a=new Date(b.getTime());a.setDate(a.getDate()-1);return a},getDateAfter:function(b){var a=new Date(b.getTime());a.setDate(a.getDate()+1);return a},setPageInDate:function(b,a){if(b&&b.getDate){ta.store("date.picker.pageInDate",b)}if(ta.has("date.picker.pageOutDate")){ta.store("meta.page_dates",true)}if(!a&&ta.page&&ta.page.setDates){ta.page.setDates("CHECKIN",[b]);ta.page.emit("dateSelected",null,"CHECKIN",[b])}},setPageOutDate:function(b,a){if(b&&b.getDate){ta.store("date.picker.pageOutDate",b)}if(ta.has("date.picker.pageInDate")){ta.store("meta.page_dates",true)}ta.widgets.calendar.updateCalendarPropertiesOnDateSet();if(!a&&ta.page&&ta.page.setDates){ta.page.setDates("CHECKOUT",[b]);ta.page.emit("dateSelected",null,"CHECKOUT",[b])}},setTimeoutPageDates:function(){var b=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDateTimeout"));if(b){ta.widgets.calendar.setPageInDate(b)}var a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDateTimeout"));if(a){ta.widgets.calendar.setPageOutDate(a)}},clearPageDates:function(a){ta.store("data.picker.cachedDateCleared",true);ta.remove("date.picker.pageInDate");ta.remove("date.picker.pageOutDate");ta.remove("multiDP.inDate");ta.remove("multiDP.outDate");ta.remove("meta.page_dates");ta.remove("meta.session_dates");ta.remove("multiDP.priorDates");if(ta.isMetaHotelsRequest()||ta.has("meta.mini_meta_on_accommodations")){ta.store("dates.datesCleared",true)}if(!a&&ta.page&&ta.page.clearDates){ta.page.clearDates("STAYDATES");ta.page.emit("dateSelected",null,"STAYDATES",[null,null])}},clearPageInDate:function(a){ta.remove("date.picker.pageInDate");ta.remove("multiDP.inDate");ta.remove("meta.page_dates");if(!a&&ta.page&&ta.page.setDates){ta.page.setDates("CHECKIN",[null]);ta.page.emit("dateSelected",null,"CHECKIN",[null])}},clearPageOutDate:function(a){ta.remove("date.picker.pageOutDate");ta.remove("multiDP.outDate");ta.remove("meta.page_dates");if(!a&&ta.page&&ta.page.setDates){ta.page.setDates("CHECKOUT",[null]);ta.page.emit("dateSelected",null,"CHECKOUT",[null])}},updateCalendarPropertiesOnDateSet:function(){var a=ta.retrieve("avail.data.objects");if(a){Array.each(a,function(c){var b=ta.retrieve(c);if(b&&b.calendar){b.calendar.setPermanent(false)}})}},setPageAdultsCount:function(a){if(a){ta.store("date.picker.adultsCount",a)}},getPageInDate:function(){var a=false;if(ta.has("date.picker.pageInDate")){a=ta.retrieve("date.picker.pageInDate")}if(!a&&ta.has("multiDP.inDate")){a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDate"));if(a){ta.widgets.calendar.setPageInDate(a)}}if(a){return new Date(a.getTime())}return false},getPageOutDate:function(){var a=false;if(ta.has("date.picker.pageOutDate")){a=ta.retrieve("date.picker.pageOutDate");if(!ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageOutDate();return false}if(a){return new Date(a.getTime())}}if(!a&&ta.has("multiDP.outDate")){a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDate"));if(a){ta.widgets.calendar.setPageOutDate(a)}if(!ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates();return false}if(a){return new Date(a.getTime())}}return false},haveDatesChanged:function(){var a=ta.widgets.calendar.getPageInDate(),b=ta.widgets.calendar.getPageOutDate(),d=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDate")),c=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDate"));return(!d||a.getTime()!=d.getTime())||(!c||b.getTime()!=c.getTime())},isValidStayLength:function(b){var c=ta.widgets.calendar.getPageInDate();if(!c||!b){return true}var d=0,a=0;if(ta.retrieve("allowLongTrips")){d=b-new Date();a=ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT}else{d=b-c;a=ta.util.date.MAX_STAY_DURATION_DAYS}d=Math.round(d/1000/60/60/24);if(d>a){return false}return true},getPageAdultsCount:function(){if(ta.has("date.picker.adultsCount")){return ta.retrieve("date.picker.adultsCount")}if(ta.has("multiDP.adultsCount")){ta.store("date.picker.adultsCount",ta.retrieve("multiDP.adultsCount"));return ta.retrieve("multiDP.adultsCount")}return"2"},getGuestsRoomsPickerData:function(){var g=ta.retrieve("guests.rooms.object"),c,b;if(!g){try{var f=Cookie.read("TATravelInfo");var a=ta.widgets.calendar.getGuestsRoomsValue(f,"A");if(a&&a!==""){c=parseInt(a,10)}var d=ta.widgets.calendar.getGuestsRoomsValue(f,"RS");if(d&&d!==""){b=parseInt(d,10)}if(c&&c>0&&b&&b>0){g={rooms:b,guests:c};ta.store("guests.rooms.object",g)}}catch(h){ta.util.error.record(h,"ta.widgets.calendar.getGuestsRoomsPickerData")}}if(!g){g={rooms:1,guests:2};ta.store("guests.rooms.object",g)}return g},getCheckRatesData:(function(){function b(){var d=ta.widgets.calendar.getPageInDate(),c=ta.widgets.calendar.getPageOutDate();if(!d||!c||!d.getMonth||!c.getMonth){return false}return{inMonth:(d.getMonth()+1)+" "+d.getFullYear(),inDay:d.getDate(),outMonth:(c.getMonth()+1)+" "+c.getFullYear(),outDay:c.getDate()}}function a(c){c=c||"STAYDATES";return ta.page.datesToQueryJson(c)}return function(d){var c=(ta.page&&ta.page.datesToQueryJson)?a(d):b();c.adults=ta.widgets.calendar.getPageAdultsCount();if(ta.has("guests_rooms_picker.enabled")){var e=ta.widgets.calendar.getGuestsRoomsPickerData();c.adults=e.guests;c.rooms=e.rooms}return c}})(),_parseDatePickerDate:function(c){try{if(c&&c.split&&c.split(" ").length>1){var a=c.split(" ");var b=new Date();ta.util.date.normalize(b);b.setFullYear(a[0]);b.setDate(1);b.setMonth(parseInt(a[1],10)-1);b.setDate(a[2]);return b}}catch(d){return false}},hasPageDates:function(){if(!ta.has("metaDatePickerEnabled")){return false}if(ta.has("meta.page_dates")){return true}ta.widgets.calendar.getPageInDate();ta.widgets.calendar.getPageOutDate();return ta.has("meta.page_dates")},oneDayMill:(24*60*60*1000),updateDateWidgetDisplay:function(a){if(!a){return}ta.id(a).removeClass("date_picker_error");var c=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();ta.widgets.calendar.updateDateDisplay(a,c,b);var d=document.getElements(".adults");if(d){d.each(function(e){ta.widgets.calendar.updateAdultsDisplay(e)})}},getPageInCalendarField:function(b,a){return ta.id("date_picker_in_"+b+a)},getPageOutCalendarField:function(b,a){return ta.id("date_picker_out_"+b+a)},getErrorDates:function(){var c="no dates";try{var a=ta.widgets.calendar.getDatePickerFormat("classic");if(ta.widgets.calendar.hasPageDates()){c=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),a);c=c+" - "+ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageOutDate(),a)}}catch(b){}return c},updateDateDisplay:function(b,c,g){var d,a,f,i,e,h,j;if(c&&g&&c.getTime()>g.getTime()){d=c;c=g;g=d}a=ta.widgets.calendar.getDatePickerFormat("classic");if(ta.id(b).getParent(".dual_date")){b.innerHTML=c?ta.widgets.calendar.dateToString(c,a):ta.retrieve("multiDP.checkIn");f=b.id.replace("date_picker_in","date_picker_out");if(f&&ta.id(f)){ta.id(f).innerHTML=g?ta.widgets.calendar.dateToString(g,a):ta.retrieve("multiDP.checkOut")}}else{i=b.innerHTML=ta.retrieve("multiDP.enterDatesText");e=ta.widgets.calendar.getSingleDateFieldDatesText(c,g,a);if(e){i=e}b.innerHTML=i;h=ta.id(b).getParent();if(h){j=h.getElement(".date_picker_calendar_nights");ta.widgets.calendar.updateNightsDisplay(j,c,g)}}},getSingleDateFieldDatesText:function(d,b,a){var c="";var e=ta.retrieve("multiDP.dateSeparator")||" - ";if(d){c=ta.widgets.calendar.dateToString(d,a)+e;if(b){c=c+ta.widgets.calendar.dateToString(b,a)}}return c},updateNightsDisplay:function(d,c,a){if(!d){return}if(!a){d.innerHTML="";return}var b=ta.widgets.calendar.getNumberOfNightsFromDates(c,a);if(b==1){d.innerHTML=ta.retrieve("multiDP.singleNightText")}else{d.innerHTML=ta.retrieve("multiDP.multiNightsText").replace(/\d+/,b)}},getNumberOfNights:function(){var b=ta.widgets.calendar.getPageInDate(),a=ta.widgets.calendar.getPageOutDate();return ta.widgets.calendar.getNumberOfNightsFromDates(b,a)},getNumberOfNightsFromDates:function(b,a){if(b&&a){return Math.round(Math.abs((b.getTime()-a.getTime())/ta.widgets.calendar.oneDayMill))}else{return 0}},updateAdultsDisplay:function(b){if(!b){return}var a=ta.widgets.calendar.getPageAdultsCount();if(a=="1"){b.innerHTML=ta.retrieve("multiDP.singleAdultsText")}else{b.innerHTML=ta.retrieve("multiDP.multiAdultsText").replace(/\d+/,a)}},syncAllDatePickers:function(){var c=document.getElements(".date_picker.date");if(c){Array.each(c,function(g){if(g&&!ta.id(g).hasClass("out_date")&&!ta.id(g).hasClass("multiCity")&&!ta.id(g).hasClass("oneWay")){ta.widgets.calendar.updateDateWidgetDisplay(g)}})}var a=$$(".tablet_date_label");if(a&&ta.widgets.calendar.hasPageDates()){a.addClass("showLabels")}a=document.getElements(".dateLabel");if(a){var f=ta.widgets.calendar.getDatePickerFormat("short");var b=ta.widgets.calendar.getDatePickerFormat("classic");var e=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),b);if(ta.has("guests_rooms_picker_3.enabled")){e=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),f)}var d=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageOutDate(),b);Array.each(a,function(g){var h=ta.id(g);if(h){if(h.hasClass("inDate")){h.innerHTML=e?e:ta.retrieve("multiDP.checkIn")}else{if(h.hasClass("outDate")){h.innerHTML=d?d:ta.retrieve("multiDP.checkOut")}}}})}},getDatePickerFormat:function(a){if(a==="classic"&&typeof DATE_PICKER_CLASSIC_FORMAT!="undefined"){return DATE_PICKER_CLASSIC_FORMAT}else{if(a==="short"&&typeof DATE_PICKER_SHORT_FORMAT!="undefined"){return DATE_PICKER_SHORT_FORMAT}else{if(typeof DATE_PICKER_META_FORMAT!="undefined"){return DATE_PICKER_META_FORMAT}}}if(typeof a!="string"){a="not_a_string"}return""},dateToString:function(d,e){var b,j,a,h,c,k,i,f,g;if(!d.getDate||!e){return""}if(e==ta.widgets.calendar.getDatePickerFormat("classic")){b=new Date(d);if(ta.retrieve("thai_buddhist_era_year")){b.setFullYear(b.getFullYear()+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)}j="MM";a="yyyy";h="dd";f=b.getDate()+"";if(f&&f.length===1){f="0"+f}g=(b.getMonth()+1)+"";if(g&&g.length===1){g="0"+g}e=e.replace(j,g).replace(h,f).replace(a,b.getFullYear()).replace(/'/g,"");return e}else{if(e==ta.widgets.calendar.getDatePickerFormat("short")){b=new Date(d);j="MM";h="dd";f=b.getDate()+"";if(f&&f.length==1){f="0"+f}g=(b.getMonth()+1)+"";if(g&&g.length==1){g="0"+g}e=e.replace(j,g).replace(h,f).replace(/'/g,"");return e}}c=ta.retrieve("multiDP.abbrevMonthList");k=d.getDay();if(ta.retrieve("multiDP.isMondayFirstDayOfWeek")){k=k-1}if(k==-1){k=6}i="EEE";j="MMM";if(e=="EEEE d MMMM"){i="EEEE";j="MMMM"}e=e.replace(i,jsGlobalDaysAbbrev[k]).replace(j,c[d.getMonth()]).replace(/\bd\b/,d.getDate()).replace(/'/g,"");return e},showCalendarByLocId:function(b,a){if(!/^\d+$/.test(b)){ta.util.error.record(null,"Cannot show calendar due to missing/invalid location ID: "+b);return}a=a||"";var c={id:"",className:"id_"+b+a,"data-date_suffix":a,toString:function(){return"[showCalendarSrc: "+b+a+"]"}};ta.widgets.calendar.setErrorStyling(c)},clickCalendarEvent:function(b){if(document.createEvent){var a=document.createEvent("HTMLEvents");a.initEvent("click",true,true);b.dispatchEvent(a)}else{b.click()}},setErrorStyling:function(d){var c=false,g=d["data-date_suffix"]||null;var b=d.id.match(/CHECK_RATE_([a-zA-Z]+)/);if(b&&b.length>1&&(b[1]=="mnf"||b[1]=="mnl"||b[1]=="photoviewer"||b[1]=="albumMeta")){g="_"+b[1]}try{c=d.className.match(/\bid_(\d+)/)[1]}catch(f){}if(c){var a=false;var h="date_picker_in_";if(!a&&g){a=ta.id(h+c+g)}if(!a){a=ta.id(h+c+"_met")}if(!a){a=ta.id(h+c+"_cro")}if(!a){a=ta.id(h+c+"_per")}if(!a){a=ta.id(h+c+"_pop")}if(!a){a=ta.id(h+c+"_mnl")}if(!a){a=ta.id(h+c+"_mnm")}if(!a){a=ta.id(h+c+"_smt")}if(!a){a=ta.id(h+c+"_pto")}if(!a){a=ta.id(h+c+"_pal")}if(!a){a=ta.id(h+c+"_amo")}if(!a&&d.id.slice(-4)=="_inm"){a=ta.id(h+c+"_inm")}if(!a){a=ta.id(h+c)}if(a){setTimeout(function(){ta.widgets.calendar.clickCalendarEvent(a)},100)}}},launchInlineMeta:function(a){ta.widgets.calendar._crBtnOnclick("#CHECK_RATE",a)},launchMetaLightboxUpdate:function(){},launchCRLBUpdate:function(){ta.commerce.meta.clearStoredMiniData();ta.overlays.Factory.updateMiniMetaPlacements()},_crBtnOnclick:function(b,c){ta.store("meta.calendarCR",true);var a=document.getElement(b);if(a){document.getElement(b).onclick(c)}ta.remove("meta.calendarCR")},onShowPricesClick:function(a,b){if(!ta.widgets.calendar.hasPageDates()){return}ta.trackEventOnPage("GuestRoomSelector","ShowPrices_Calendar_click");if(b==="Hotels"){ta.servlet.HACSearch.doMetaDateSearch();ta.commerce.meta.updateHeaderDates()}else{if(b==="HotelHighlight"){ta.widgets.calendar.onCalendarRangeSelect(a)}else{window.fireEvent("newInlinePageDates",[a])}}ta.widgets.calendar.closeCalendarWidgets();if(ta.has("guests_rooms_picker_3.enabled")){this.displayStayInfoPicker()}},displayStayInfoPicker:function(){$$(".stayInfoHeader").removeClass("hidden");$$(".changeStayInfoButton").removeClass("hidden");$$(".date_control_wrapper").addClass("hidden")},closeCalendarWidgets:function(){var b=document.getElements(".date_picker_calendar");if(b){Array.each(b,function(e){if(e&&e.overlay){var d=true;var c=e.overlay.source;if(c&&(c.hasClass("isPreDatesPermanent")||c.getParent(".isPreDatesPermanent"))){d=false}if(d){e.overlay.hide()}}})}var a=document.getElement(".dp.overlay");if(a&&a.overlay){a.overlay.hide()}},getInOutTrackingKey:function(b){var a="avail.data.dateClicked";if(b){return a+".in"}else{return a+".out"}},removeInOutCalendarSelected:function(a){ta.remove(ta.widgets.calendar.getInOutTrackingKey(a))},trackInOutCalendarSelected:function(a){ta.store(ta.widgets.calendar.getInOutTrackingKey(a),true)},inOutCalendarSelected:function(a){return ta.retrieve(ta.widgets.calendar.getInOutTrackingKey(a))},trackCalendarEvent:function(c,d,b,g){try{var a=ta.has("multiDP.priorDates")?ta.retrieve("multiDP.priorDates"):ta.widgets.calendar.hasPageDates();b+=a?"|CHANGE":"|PRE";ta.trackEventOnPage(c,d,b,g,true)}catch(f){}},cancelAllExistingHAC:function(){if(ta.hac.filters&&ta.hac.filters.removeProcessingForExistingHACQuery){ta.hac.filters.removeProcessingForExistingHACQuery()}if(ta.meta.update&&ta.meta.update.cancelAllMetaCurrentQuery){ta.meta.update.cancelAllMetaCurrentQuery()}if(ta.commerce.metajson&&ta.commerce.metajson.cancelCurrentBulkFetch){ta.commerce.metajson.cancelCurrentBulkFetch()}},submitHacSearch:function(d,c,f){if(typeof(f)=="undefined"){f=false}if(ta.has("useHotelsFilterState")){return ta.widgets.calendar.submitHotelsForm(d,c,f)}var b="";c=ta.id(c);if(c.get("tag")=="form"){var e=c.getElement("input[name=q]");if(e){e.name=""}b=c.action+"?"+c.toQueryString()}else{if(c.get("tag")=="a"){b=c.href}else{c=c.getParent("a");b=c.href}}if(b!==""){if(ta.widgets.calendar.hasPageDates()){if(!b.match(/\?/)){b=b+"?"}var a=ta.widgets.calendar.getCheckRatesData();if(a){b=b+"&"+Object.toQueryString(a)}}if(d){new Event(d).preventDefault()}if(f){window.open(b)}else{window.location=b}}},clearSessionDates:function(b,a){new Request({url:"/UpdateSessionDatesAjax?clear=true",onSuccess:function(){ta.widgets.calendar.clearDates();if(b){document.location.href="./"+b}if(a&&typeof a==="function"){a()}window.fireEvent("sessionDatesCleared")}}).send()},clearAllDatePickers:function(){var c=ta.retrieve("avail.data.objects");if(c){Array.each(c,function(d){var e=ta.retrieve(d);if(e){e.clear()}})}var b=document.getElements(".date_picker.date");if(b){Array.each(b,function(d){ta.widgets.calendar.updateDateWidgetDisplay(d);ta.widgets.calendar.showEnterDates(d)})}var a=$$(".tablet_date_label");if(a){a.removeClass("showLabels")}},showEnterDates:function(a){if(!a){return}if(ta.id(a).getParent(".dual_date")){if(ta.id(a).hasClass("out_date")){a.innerHTML=ta.retrieve("multiDP.checkOut")}else{a.innerHTML=ta.retrieve("multiDP.checkIn")}}else{a.innerHTML=ta.retrieve("multiDP.enterDatesText")}},clearDates:function(){ta.widgets.calendar.clearPageDates();ta.widgets.calendar.clearAllDatePickers();var a=document.getElement(".clear_dates_button")||document.getElement(".clearDates");var j=document.getElement(".clear_dates_wrapper")||document.getElement(".clearDatesWrapper");var c=document.getElement(".showPriceButton");var b=document.getElement(".change_dates_button");var h=document.getElement(".date_picker_post_dates");var e=document.getElement(".date_picker_pre_dates");var f=document.getElement(".show_prices_button");var i=ta.id("ANIMATED_DATE_CTA");var d=ta.id("BC_PHOTOS");var g=document.getElement("#BC_PHOTOS .photo_slideshow");var k=document.getElement("#BC_PHOTOS .ug_thumbs");if(ta.retrieve("animate_date_reformat")){i=ta.id("ANIMATED_DATE_CTA_REFORMAT")}if(e){e.show()}if(h){h.hide()}if(a){a.hide()}if(j){j.hide()}if(b){b.hide()}if(f){f.show()}if(i){ta.servlet.HACSearch.loadAnimatedDateCTA()}if(c){c.hide()}if(d){d.style.opacity=1}if(g){g.style.opacity=1}if(k){k.style.opacity=1}if(ta.servlet.HACSearch&&ta.has("hac_timezone_awareness")){ta.servlet.HACSearch.clearDateFieldHighlighting()}},clearDatesAndRedirect:function(){var a=window.location.hash;var b=false;var c=window.location.href.match(/geo=\d+/g);if(c&&c[0]){b=c[0]}if(!b){c=window.location.href.match(/-g\d+/g);if(c&&c[0]){b="geo="+c[0].substring(2)}}if(b){var d="HACSearch?"+b+a;ta.widgets.calendar.clearSessionDates(d)}},storePriorDates:function(){ta.store("multiDP.priorDates",ta.retrieve("multiDP.priorDates")||ta.widgets.calendar.hasPageDates())},datesExist:function(){var b=ta.widgets.calendar.getPageInDate();var a=ta.widgets.calendar.getPageOutDate();return b&&a},datesInRange:function(){var c=ta.widgets.calendar.getPageInDate();var a=ta.widgets.calendar.getPageOutDate();if(!ta.widgets.calendar.datesExist()){return false}var b=Math.round(Math.abs((c.getTime()-a.getTime())/ta.widgets.calendar.oneDayMill));return b>=1&&b<=ta.util.date.MAX_STAY_DURATION_DAYS},openFirstDatePicker:function(b){new Event(b).stopPropagation();var a=$$(".date_picker_calendar_wrap");if(a&&a.length>0){a[0].click()}ta.trackEventOnPage("price_filter_dates_link","click","")},justUpdateSessionDates:function(b,c,a){if((c&&!ta.widgets.calendar.haveDatesChanged())||(ta.util.date.getDaysApart(this.inDate,this.outDate)>ta.util.date.MAX_STAY_DURATION_DAYS)||(this.inDate&&this.outDate&&ta.util.date.normalize(this.inDate)==ta.util.date.normalize(this.outDate))){if(b&&typeof(b)=="function"){b()}return}new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",async:(a!==true),onSuccess:function(){if(b&&typeof(b)==="function"){b()}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}ta.fireEvent("hotels.sessionDatesUpdated")}}).send();return true},justUpdateSessionAdults:function(a){var b=ta.widgets.calendar.getPageAdultsCount();if(b<=0){return}new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString({adults:b,onlyAdults:true}),method:"post",onSuccess:function(){if(a&&typeof(a)==="function"){a()}}}).send()},getGuestsRoomsValue:function(d,c){if(!d){return}var a=d.split("*");for(var b=0;b<a.length;b++){var e=a[b].split(".");if(e.length!=2){continue}if(e[0]===c){return e[1]}}},updateGuestsRoomsPickerDataFromCookie:function(){var e=Cookie.read("TATravelInfo"),f,b,c,a,d;a=ta.widgets.calendar.getGuestsRoomsValue(e,"A");if(a&&a!==""){c=parseInt(a,10)}d=ta.widgets.calendar.getGuestsRoomsValue(e,"RS");if(d&&d!==""){b=parseInt(d,10)}if(c>=1&&b>=1&&c.toFixed&&b.toFixed){f={rooms:b,guests:c};ta.store("guests.rooms.object",f)}},updateGuestsRoomsPickerUI:function(){var b=ta.widgets.calendar.getGuestsRoomsPickerData();var a=document.getElements(".grp-rooms-value");a.each(function(c){if(c){c.innerHTML=b.rooms}});a=document.getElements(".grp-guests-value");a.each(function(c){if(c){c.innerHTML=b.guests}})},updateGuestsRoomsButtonLabelsPluralization:function(b,c){var a=$$(b);a.each(function(d){if(c>1){d.addClass("multiple")}else{d.removeClass("multiple")}})},checkDatesMakeHacCallHR:function(a){if(ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.handleNewDates(a)}},checkDatesMakeHacCallHotels:function(a){if(ta.widgets.calendar.hasPageDates()){ta.servlet.HACSearch.doMetaDateSearch(a)}},updateSDCalendar:function(){new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",onSuccess:function(){var e,d,c,b,a=document.getElement("#STATIC_DATE_PICKER_BAR .filterControls");window.fireEvent("sd_hh_datesChanged");if(ta.id("SDDatesHeaderCenter")){e=ta.id("SDDatesHeaderCenter");e.addClass("hide")}if((ta.id("SD_DATEBAR_TOOLTIP"))){e=ta.id("SDDatePickerBarStaticButton");e.addClass("hide");d=ta.id("SDDatePickerBarStaticChangeDates");d.removeClass("hide")}if(ta.id("SD_TV_CAMPAIGN")){c=ta.id("SD_TV_CAMPAIGN");c.addClass("hide")}if(ta.id("SD_MAP")){b=ta.id("SD_MAP");b.addClass("hide")}if(a){if(ta.widgets.calendar.datesExist()){a.removeClass("noDatesSelected");a.addClass("datesSelected")}else{a.removeClass("datesSelected");a.addClass("noDatesSelected")}}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}if(ta.retrieve("sd_progress_bar")){ta.servlet.SmartDeals.initProgressBar()}}}).send()},updateHLCalendar:function(){new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",onSuccess:function(){var h,a,d;window.fireEvent("sd_hh_datesChanged");a=ta.id("BODYCON");if(a){h=a.getElement("#HLDatePickerBar .metaDatePicker.moreProminent");d=a.getElement("#STATIC_DATE_PICKER_BAR .filterControls");if(d){if(ta.widgets.calendar.datesExist()){d.removeClass("noDatesSelected");d.addClass("datesSelected")}else{d.removeClass("datesSelected");d.addClass("noDatesSelected")}}}if(h){var f=document.getElement(".overlayBG");var c=document.getElement(".rgba_flyout.gray.overlay.relative");var g=document.getElement(".baseHotelInfoLeft");var b=document.getElement(".baseHotelInfoRight");var e=document.getElement(".HLBaseDisclaimer");if(f){f.destroy()}if(c){c.destroy()}if(g&&b){b.inject(g,"before")}if(e&&e.hasClass("hide")){e.removeClass("hide")}}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}}}).send()},updateSessionDates:function(a,b){new Request({url:"/UpdateSessionDatesAjax",data:b,method:"post",onSuccess:function(){if(a){if(ta.retrieve("smartDealsSearchIframe")){window.open(a,"_blank")}else{window.location=a}}},onFailure:function(){if(a){if(ta.retrieve("smartDealsSearchIframe")){window.open(a,"_blank")}else{window.location=a}}}}).send()},redirectToHotelOverview:function(a){this._redirectToHotelOverview(a,function(b){window.location=b})},openTabToHotelOverview:function(a){this._redirectToHotelOverview(a,function(b){window.open(b)})},_redirectToHotelOverview:function(b,c){if(b){b=JSON.decode(b);var a=b.url;if(ta.retrieve("is_from_sdprospect")&&a.contains("Hotels")){a=a.replace("Hotels","SmartDeals")}c(a)}else{c("/Hotels")}},submitHotelsForm:function(e,b,d){b=ta.id(b);if(typeof(d)=="undefined"){d=false}var c=b.toQueryString();if(ta.widgets.calendar.hasPageDates()){var a=ta.widgets.calendar.getCheckRatesData();if(a){c=c+"&"+Object.toQueryString(a)}}new Request({url:"/FilterState",data:c,method:"post",onSuccess:function(f){d?ta.widgets.calendar.openTabToHotelOverview(f):ta.widgets.calendar.redirectToHotelOverview(f)},onFailure:function(){d?ta.widgets.calendar.openTabToHotelOverview(null):ta.widgets.calendar.redirectToHotelOverview(null)}}).send();if(e){new Event(e).preventDefault()}return false},getPlacement:function(h){if(!h||!h.id){return null}var e=/date_picker_[0-9]*_([a-z]*)/;var i=/date_picker_in_[0-9]*_([a-z]*)/;var g=/date_picker_out_[0-9]*_([a-z]*)/;var f=/date_picker_adults_[0-9]*_([a-z]*)/;var a=h.id;var d=e.exec(a);if(!d){d=i.exec(a)}if(!d){d=g.exec(a)}if(!d){d=f.exec(a)}if(d){d=d[1]}if(!d){var b=h.getParent(".HotelDateSearch");if(b&&b.id){var c=(b.id).split("_");if(c.length>1){d=c[(c.length-1)]}}}return d},handleNewDates:function(k,n){if(ta.retrieve("hotel_review_low_price_message")){var e=document.getElement("#PRICE_ALERT_RIBBON");if(e){e.hide()}ta.remove("hidePriceAlertRibbon")}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}if(ta.retrieve("tablet_maps_v1")&&n){var b=n.getParent(".flexCard");if(b){b.addClass("withMeta")}}ta.store("meta.requestFromArea","");if(ta.retrieve("origHTMLForUserReviews")){var h=ta.id("noAvailRHS");if(h){h.innerHTML=ta.retrieve("origHTMLForUserReviews")}}var j=document.getElement(".seeMoreHotels");if(j){j.hide()}var d=ta.id("BC_PHOTOS");if(d){d.style.opacity=1}var g=document.getElement("#BC_PHOTOS .photo_slideshow");if(g){g.style.opacity=1}var m=document.getElement("#BC_PHOTOS .ug_thumbs");if(m){m.style.opacity=1}var c=ta.widgets.calendar.getPlacement(n);if(c=="geo"){ta.widgets.calendar.justUpdateSessionDates();return}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){if(pageServlet=="Hotel_Review"||pageServlet=="ShowUserReviews"||pageServlet=="LocationPhotoDirectLink"){ta.store("meta.isFromDatesChange",true)}}ta.store("hotels.datesChanged",true);if(ta.commerce.datepickerpersist){ta.commerce.datepickerpersist.update()}var f="property_"+k;var i=ta.id(f);var a=ta.retrieve("overlay.lastElmt.className");var l=(c=="pop")&&(pageServlet=="Hotels")&&i&&a&&a.match(/custom_area_QC_Hotels_Meta/);if(ta.meta&&ta.meta.update&&!l){if(pageServlet==="Hotels"){ta.servlet.HACSearch.displayPostDatesLinks()}ta.overlays.Factory&&ta.overlays.Factory.tryToHideCROverlayPostDatesClose();window.fireEvent("newInlinePageDates",[k,c]);return}else{if(!l&&ta.util&&ta.util.error){ta.util.error.record(null,"handleNewDates - no meta js");return}}ta.store("hotels.datesChanged",true);ta.servlet.HACSearch.displayPostDatesLinks();ta.store("meta.redirectingToHR",true);ta.remove("overlay.lastElmt.className");ta.widgets.calendar.justUpdateSessionDates(false,false,true);ta.hac.filters.updateResultsFromDateSearch();window.open(i.href);document.getElements(".overlay").each(function(o){if(o.overlay&&o.overlay.hide){o.overlay.hide()}})},trackCRButtonClick:function(a){var c=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();var d=[a];if(c){d.push("CHECKIN")}if(b){d.push("CHECKOUT")}ta.trackEventOnPage("CRBUTTON","CLICK",d.join("|"))},setupNewDatesEvent:function(){try{ta.util.customEvent.addListener("newInlinePageDates",window,ta.widgets.calendar.inlineCalendarOnDateSelection)}catch(a){ta.util.error.record(a,"trouble building event - newInlinePageDates")}},inlineCalendarOnDateSelection:function(){ta.widgets.calendar.onCalendarChangeDates();var a=window.modelLocId;if(a){ta.widgets.calendar.onCalendarRangeSelect(a)}},onCalendarChangeDates:function(){ta.commerce.meta.tracking.resetAllTimingLocks();ta.commerce.meta.tracking.clearSuppressedAreas();ta.commerce.meta.polling.clearAllPollingInfo();if(ta.isHacMap()){ta.servlet.hotelsMap.map.cleanupOverlays()}},onCalendarRangeSelect:function(c,b){if(ta.commerce.metajson){ta.commerce.metajson.refetchAll()}if(typeof oxapp!="undefined"&&oxapp&&oxapp.context){var a=oxapp.context.has("TravelDates")&&oxapp.context.get("TravelDates");if(a){a.save()}}if(c&&ta.has("checkrates.meta_af")&&!(ta.retrieve("tablet_maps_v1")&&ta.retrieve("maps_v2_open"))){ta.commerce.meta.loadMetaAF(c,"AV_ABOVE_FOLD_META",false)}ta.store("ta.calRangeSelectCtx",{locId:c,ext:b});ta.fireEvent("onCalendarRangeSelect");ta.store("ta.calRangeSelectCtx",null)},trackCalendarSelect:function(c){var i=document.getElement(".inline_calendar");if(i){i=i.getParent()}if(!i){return}var f=i.getElement(".meta_date_field.first .date_picker");if(c){f=i.getElement('.meta_date_field:not([class="first"]) .date_picker')}if(!f){return}var d=ta.id(f).get("id");d=d.substring(d.length-3,d.length);var b="START";var g="DATES";var a=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();if(d=="upt"){g="Interrupter"}if(c){b="SELECT";if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){g="PRICE_CALENDAR"}else{if(a&&e){var h=ta.util.date.getDaysInRange(a,e)-1;if(h>ta.util.date.MAX_STAY_DURATION_DAYS){g="DATES_OVER_30_DAYS"}}}}if(ta.retrieve("meta.prof_photo_lb.post_date_close.overlay")){g="CalendarLightbox"}ta.widgets.calendar.trackCalendarEvent(ta.widgets.calendar.getTrackingString(),b,g)},setFirstDisplayMonth:function(c){var a=document.getElement(".month");if(!a){return false}var b=ta.widgets.calendar.getDateFromElem(a);if(!b){b=new Date(ta.util.date.normalize(new Date()))}if(c){b.setDate(1);b.setDate(32);b.setDate(1)}else{b.setDate(1);b.setDate(-1);b.setDate(1)}return b},updateCalendarMonths:function(a,g){try{if(!ta.has("ta.calendar.date.clickFunction")){ta.widgets.calendar.setClickMouseOverFunctions()}if(!a){return}a=ta.id(a);if(!g){if(ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonRight")){return}else{if(!ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonLeft")){return}}}else{if(ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonLeft")){return}else{if(!ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonRight")){return}}}var c=ta.widgets.calendar.setFirstDisplayMonth(g);var b=document.getElement(".inline_calendar");var d=b.getElements(".month");if(d){Array.each(d,function(e){e.dispose()})}var f=ta.widgets.calendar.createMonth(c);ta.widgets.calendar.injectMonth(f.elmt,b,true);ta.widgets.calendar.updatePrevNext(b,f)}catch(h){ta.util.error.record(h,"update calendar months")}},updatePrevNext:function(b,g){var c=g.date;var e=g.date;if(!ta.has("ta.calendar.firstDate")){ta.widgets.calendar.setFirstLastDates()}var i=ta.util.date.inSameMonth(c,ta.retrieve("ta.calendar.firstDate"));var a=ta.util.date.inSameMonth(e,ta.retrieve("ta.calendar.lastDate"));var f=ta.util.i18n.isRtl()?"sprite-date_picker-arrowButtonRight":"sprite-date_picker-arrowButtonLeft";var h=ta.util.i18n.isRtl()?"sprite-date_picker-arrowButtonLeft":"sprite-date_picker-arrowButtonRight";b.getElement(".prev").addClass(i?"":f).removeClass(i?f:"");b.getElement(".next").addClass(a?"":h).removeClass(a?h:"");var d=b.getElement(".prevText");if(d){if(i||!g.date){d.innerHTML=""}else{d.innerHTML=jsGlobalMonthsAbbrev[(g.date.getMonth()-1)%12]}}d=b.getElement(".nextText");if(d){if(a||!g.date){d.innerHTML=""}else{d.innerHTML=jsGlobalMonthsAbbrev[(g.date.getMonth()+1)%12]}}},dayClick:function(l,j,c,h,b){try{b=ta.id(b);if(!b||b.getParent(".disabled")){return}var k=ta.util.date.create(j,c,h);var a=ta.widgets.calendar.getPageOutDate();if(k){if(!ta.has("ta.first.date.selected")){if(a&&ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates()}ta.widgets.calendar.setPageInDate(k);ta.widgets.calendar.setFirstDateSelected(true);ta.widgets.calendar.trackCalendarSelect(false,b)}else{var i=ta.widgets.calendar.getPageInDate();if(!i){if(a&&ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates()}ta.widgets.calendar.setPageInDate(k);ta.widgets.calendar.setFirstDateSelected(true);return}else{if(i.getTime()==k.getTime()){return}else{if(i.getTime()>k.getTime()){ta.widgets.calendar.setPageInDate(k);ta.widgets.calendar.setPageOutDate(i)}else{ta.widgets.calendar.setPageOutDate(k)}}}ta.widgets.calendar.setFirstDateSelected(false);var f=1;if(typeof modelLocId!="undefined"){f=modelLocId}ta.widgets.calendar.handleNewDates(f);ta.widgets.calendar.showInlineCalendar(false);ta.widgets.calendar.trackCalendarSelect(true,b)}ta.widgets.calendar.updateSelectedDays(l,k,b);ta.widgets.calendar.syncAllDatePickers()}}catch(g){ta.util.error.record(g,"dayClick")}},setFirstDateSelected:function(a){if(a){ta.store("ta.first.date.selected",true);ta.widgets.calendar.addFirstDateFlag()}else{ta.remove("ta.first.date.selected");ta.widgets.calendar.removeFirstDateFlag();ta.widgets.calendar.removeHoverDateFlag()}ta.widgets.calendar.setMaxLengthOfStayStyling();ta.widgets.calendar.setInDateInputSelectState(a)},clearCalendarSelections:function(){ta.widgets.calendar.clearSelectedDays();ta.widgets.calendar.clearDates();ta.widgets.calendar.setFirstDateSelected(false)},addFirstDateFlag:function(){var a=ta.widgets.calendar.getPageInDate();var d=ta.widgets.calendar.getDayElemFromDate(a);var b=ta.retrieve("calendar.checkInText");if(b){var c=new ta.widgets.ArrowLabel(d,b);ta.store("ta.calendar.firstDateFlag",c)}},removeFirstDateFlag:function(){if(ta.has("ta.calendar.firstDateFlag")){var a=ta.retrieve("ta.calendar.firstDateFlag");if(a){a.remove();ta.remove("ta.calendar.firstDateFlag")}}},addHoverDateFlag:function(c,f,b){var a=ta.widgets.calendar.getPageInDate();if(a.getTime()==c.getTime()){ta.widgets.calendar.removeHoverDateFlag();return}if(ta.has("ta.calendar.hoverDateFlag")){var e=ta.retrieve("ta.calendar.hoverDateFlag");if(e){e.setParentElem(f);e.setText(b)}return}var d=new ta.widgets.ArrowLabel(f,b,{labelArrowBaseClass:"calendarDateStyling hoverDateStyling"});ta.store("ta.calendar.hoverDateFlag",d)},removeHoverDateFlag:function(){if(ta.has("ta.calendar.hoverDateFlag")){var a=ta.retrieve("ta.calendar.hoverDateFlag");if(a){a.remove();ta.remove("ta.calendar.hoverDateFlag")}}},addChooseDatesFlag:function(){if(!ta.has("ta.calendar.chooseDateFlag")){var a=ta.retrieve("calendar.enterDatesText");var b=document.getElement(".metaContentSection .largeOpenCalCRButton");var c=new ta.widgets.ArrowLabel(b,a,{labelArrowBaseClass:"calendarDateStyling enterDatesArrowElem",arrowSpriteClass:"sprite-date_picker-orangeArrowUp"});ta.store("ta.calendar.chooseDateFlag",c)}},removeChooseDatesFlag:function(){if(ta.has("ta.calendar.chooseDateFlag")){var a=ta.retrieve("ta.calendar.chooseDateFlag");if(a){a.remove();ta.remove("ta.calendar.chooseDateFlag")}}},onDateInputClick:function(a,b){var c=document.getElement(".inline_calendar");if(c&&c.hasClass("hidden")){ta.widgets.calendar.showInlineCalendar(true,!b.getParent(".meta_date_field.first"))}else{if(c&&ta.has("ta.first.date.selected")&&b&&b.getParent(".meta_date_field.first")){ta.widgets.calendar.clearCalendarSelections()}}},onDateInputOver:function(){if(!ta.widgets.calendar.hasPageDates()&&!ta.has("ta.first.date.selected")){ta.widgets.calendar.addChooseDatesFlag()}},onDateInputOut:function(){ta.widgets.calendar.removeChooseDatesFlag()},getDayElemFromDate:function(a){if(!a||!a.getTime){return false}return document.getElement(".date_"+a.getDate()+".month_"+a.getMonth()+".year_"+a.getFullYear())},getDateFromElem:function(c){var a,b=1,f=false,d=false,e;if(!c){return false}c=ta.id(c);a=c.className;if(!a){return false}e=a.match(/date_(\d+)/);if(e&&e[1]){b=e[1]}e=a.match(/month_(\d+)/);if(e&&e[1]){f=e[1]}e=a.match(/year_(\d+)/);if(e&&e[1]){d=e[1]}if(f===false||d===false){return false}return ta.util.date.create(d,f,b)},setMaxLengthOfStayStyling:function(){var e=ta.has("ta.first.date.selected");var f=document.getElements(".month td");if(e){var a=ta.widgets.calendar.getPageInDate();var c=ta.widgets.calendar.getPageInDate();c.setDate(c.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS);if(f&&a){Array.each(f,function(h){var g=ta.widgets.calendar.getDateFromElem(h);if(g&&(g.getTime()<a.getTime()||c.getTime()<g.getTime())){h.addClass("disabled")}})}}else{if(f){var b=new Date(ta.util.date.normalize(new Date()));if(!ta.has("ta.calendar.lastDate")){ta.widgets.calendar.setFirstLastDates()}var d=ta.retrieve("ta.calendar.lastDate");Array.each(f,function(h){var g=ta.widgets.calendar.getDateFromElem(h);if(g&&(b.getTime()<=g.getTime()&&g.getTime()<=d.getTime())){h.removeClass("disabled")}})}}},setInDateInputSelectState:function(b,d){var c=document.getElements(".metaContentSection .date_picker_calendar_wrap");var a=ta.widgets.calendar.getSelArrowElem();if(c){Array.each(c,function(e){if(!d){if(e.getParent()&&e.getParent().hasClass("first")){if(b){e.removeClass("selectionStyle")}else{e.addClass("selectionStyle");e.getParent().adopt(a)}}else{if(b){e.addClass("selectionStyle");if(e.getParent()){e.getParent().adopt(a)}}else{e.removeClass("selectionStyle")}}}else{e.removeClass("selectionStyle");a.dispose()}})}},getSelArrowElem:function(){var a=document.getElement(".selectionUpArrow");if(!a){if(document.getElement(".inline_calendar")){a=new Element("div",{"class":"sprite-date_picker-pointer-orange-ac selectionUpArrow"})}else{a=new Element("div",{"class":"sprite-date_picker-pointer selectionUpArrow"})}}return a},showInlineCalendar:function(f,d){var h=document.getElement(".inline_calendar");if(h){if(f){var c=h.hasClass("hidden");h.removeClass("hidden");var b=document.getElement("#HR_HACKATHON_CONTENT .postShowMetaCR");if(b){b.dispose()}if(d){if(!ta.has("date.picker.pageInDate")){d=false}}ta.widgets.calendar.setFirstDateSelected(!!d);if(c){ta.widgets.calendar.trackCalendarEvent(ta.widgets.calendar.getTrackingString(),"OPEN","DATES")}}else{h.addClass("hidden");ta.widgets.calendar.setInDateInputSelectState(false,true);var g=document.getElement(".largeOpenCalCRButton");if(g){g.dispose()}var a=document.getElement(".open_calendar_legend");if(a){a.addClass("miniMetaHideHdr").removeClass("miniMetaShowHdr")}var e=document.getElement(".open_calendar_highlight_bg");if(e){e.removeClass("open_calendar_highlight_bg")}}}},dayOver:function(f,e,a,c,b){if(typeof(isIPad)!="undefined"&&isIPad){ta.widgets.calendar.dayClick(f,e,a,c,b);return}ta.widgets.calendar.updateSelectedDays(f,ta.util.date.create(e,a,c),b)},updateSelectedDays:function(p,l,m){var n,f="prevSel",j="start",b="end",h=false,e,k,c,o,g,a,i;if(!ta.has("ta.first.date.selected")){return}if(!m){ta.widgets.calendar.removeHoverDateFlag();return}m=ta.id(m).getParent();n=l;ta.widgets.calendar.clearSelectedDays();e=ta.widgets.calendar.getPageInDate();k=ta.widgets.calendar.getPageOutDate();h=false;c=false;if(e){h=document.getElement(".month_"+e.getMonth()+".date_"+e.getDate());c=e}else{if(k){h=document.getElement(".month_"+k.getMonth()+".date_"+k.getDate());c=k}}a=h;i=m;if(!a){a=document.getElement(".month td");if(a){a.addClass(f)}}else{a.addClass(j).addClass(f)}if(n.getTime()<c.getTime()){ta.widgets.calendar.removeHoverDateFlag();return}if(!i){i=document.getElement(".month_"+n.getMonth()+".date_"+ta.util.date.getLastDayOfMonth(n));i.addClass(f)}else{i.addClass(b)}ta.widgets.calendar.updateSelectedDaysHelper(a,i,true,f);if(m.hasClass("disabled")){ta.widgets.calendar.removeHoverDateFlag()}else{o=ta.retrieve("calendar.singleNightText");g=ta.util.date.getDaysInRange(c,n)-1;if(1<g){o=ta.retrieve("calendar.multiNightsText");o=o.replace(/\d+/,g)}ta.widgets.calendar.addHoverDateFlag(n,m,o)}},updateSelectedDaysHelper:function(e,j,g,h){if(!e||e==j){return}var f="nextSibling";var k="firstChild";if(!g){f="previousSibling";k="lastChild"}var d=false;if(ta.widgets.calendar.isValidDateElem(e.getNext())){d=e.getNext()}else{var a=ta.id(e.parentNode);if(a&&a.getNext()){d=a.getNext()[k]}else{if(a&&ta.id(a).getParent(".month")){var c=ta.id(a).getParent(".month");if(ta.util.i18n.isRtl()){f=(f=="previousSibling")?"nextSibling":"previousSibling"}var i=c.getNext();if(!i){return}var b=ta.id(i).getElements("td");if(!g){b.reverse()}b.some(function(l){if(ta.widgets.calendar.isValidDateElem(l)){d=l;return true}return false},this)}}}if(d){ta.id(d).addClass(h);ta.widgets.calendar.updateSelectedDaysHelper(d,j,g,h)}},isValidDateElem:function(b){if(!b||b.tagName!="TD"){return false}var a=b.className;if(a.match(/other/)||a.match(/disabled/)){return false}return true},clearSelectedDays:function(){var a=["prevSel","selected","start","end","inDate","inDate_DP7"];Array.each(a,function(c){var b=document.getElements(".inline_calendar .month td."+c);if(b){Array.each(b,function(d){d.removeClass(c)})}})},injectMonth:function(d,b,f){var c=b,a="top",e=b.getElement(".navCal");if(f&&e){c=e;a="after"}else{if(!f){a="bottom"}}d.inject(c,a);ta.widgets.calendar.setMaxLengthOfStayStyling();ta.widgets.calendar.removeFirstDateFlag();if(ta.has("ta.first.date.selected")){ta.widgets.calendar.addFirstDateFlag()}},setFirstLastDates:function(){var c=11;var b=new Date();b=new Date(ta.util.date.normalize(b));ta.store("ta.calendar.firstDate",b);var f=new Date(b.getTime());f.setDate(1);var a=f.getMonth();var e=a+c;f.setFullYear(f.getFullYear()+e/12);f.setMonth(e%12);f=new Date(ta.util.date.normalize(f));ta.store("ta.calendar.lastDate",f)},setClickMouseOverFunctions:function(){ta.store("ta.calendar.date.clickFunction","ta.widgets.calendar.dayClick");ta.store("ta.calendar.date.mouseOverFunction","ta.widgets.calendar.dayOver")},buildDayClass:function(a){var f="";var e=ta.widgets.calendar.getPageInDate();var c=ta.widgets.calendar.getPageOutDate();var b=new Date(ta.util.date.normalize(new Date()));if(!ta.has("ta.calendar.lastDate")){ta.widgets.calendar.setFirstLastDates()}var d=ta.retrieve("ta.calendar.lastDate");if(e&&e.getTime()==a.getTime()){f="inDate_DP7 start prevSel"}else{if(e&&c&&e.getTime()<a.getTime()&&c&&a.getTime()<c.getTime()){f="prevSel"}else{if(c&&c.getTime()==a.getTime()){f="inDate_DP7 end prevSel"}else{if(a.getTime()<b.getTime()||d.getTime()<a.getTime()){f="disabled"}}}}if(a.getTime()==b.getTime()){f="today "+f}return f},createMonth:function(l){var k={date:l},g,c="",o,m,b,p,a,e=-1,j,n,f,q,r,h;if(!ta.has("ta.calendar.firstDate")){ta.widgets.calendar.setFirstLastDates()}g=new Date(l.getTime());g.setDate(1);ta.util.date.normalize(g);o=l.getFullYear();m=l.getMonth();b;p=new Date(ta.util.date.normalize(new Date()));a=ta.retrieve("ta.calendar.lastDate");j=ta.widgets.calendar.getPageInDate();if(j&&g.getMonth()==j.getMonth()){e=j.getDate()}if(j){b=new Date(j.getTime());b.setDate(b.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS+1)}n=o;if(ta.retrieve("thai_buddhist_era_year")){n=n+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}c+='<table cellspacing="0" cellpadding="0" border="0"><thead><tr><th class="caption" colspan="7">';if(typeof DATE_FORMAT_MMM_YYYY!="undefined"){c+=DATE_FORMAT_MMM_YYYY.replace(/MMM/,jsGlobalMonths[m]).replace(/YYYY/,n)}c+="</th></tr><tr>";for(f=0;f<jsGlobalDaysShort.length;f++){c+="<th>";c+=jsGlobalDaysShort[f];c+="</th>"}c+="</tr></thead><tbody><tr>";q=new Date(g.getTime());q.setDate(1);r=1-q.getDay();q.setDate(r);for(f=1;f<=42;f++){if(q.getDay()===0){c+="</tr><tr>"}h=ta.widgets.calendar.buildDayClass(q)+" "+ta.widgets.calendar.buildCalendarFrameClass(f);c+='<td class="month_'+q.getMonth()+" date_"+q.getDate()+" year_"+q.getFullYear()+" "+h+'">';if(q.getTime()<p.getTime()||a.getTime()<q.getTime()){c+=q.getDate()}else{c+=ta.widgets.calendar.buildDayAnchorTag(q)}c+="</td>";q.setDate(q.getDate()+1)}c+="</tr></tbody></table>";k.elmt=new Element("div",{"class":"month month_"+k.date.getMonth()+" year_"+k.date.getFullYear()}).set("html",c);return k},buildCalendarFrameClass:function(b){var a="";if(b%7===1){a="leftCalFrame"}else{if(b%7===0){a="rightCalFrame"}}if(b<8){a=a+" topCalFrame"}else{if(35<b){a=a+" bottomCalFrame"}}return a},buildDayAnchorTag:function(a){var b="";if(ta.has("checkrates.add_holding_windows")){b+='<a href="javascript:void(0);" class="no_cpu" '}else{b+='<a href="javascript:void(0);"'}if(ta.has("ta.calendar.date.clickFunction")){b+=' onmouseover="';b+=ta.retrieve("ta.calendar.date.mouseOverFunction");b+="(event,";b+=a.getFullYear();b+=",";b+=a.getMonth();b+=",";b+=a.getDate();b+=',this);"'}if(ta.has("ta.calendar.date.clickFunction")){b+=' onclick="';b+=ta.retrieve("ta.calendar.date.clickFunction");b+="(event,";b+=a.getFullYear();b+=",";b+=a.getMonth();b+=",";b+=a.getDate();b+=',this)";'}b+=">";b+=a.getDate();b+="</a>";return b},addCustomDayStyleString:function(g,f,d,h,c){var i="";var a=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();var b="";if(a&&e){b=" inDate_DP7 prevSel";if(c.getTime()>a.getTime()&&c.getTime()<e.getTime()){i=i+" prevSel"}}if(a&&d.date.getMonth()==a.getMonth()&&h==a.getDate()){i=i+" start"+b}if(e&&d.date.getMonth()==e.getMonth()&&h==e.getDate()){i=i+" end"+b}return i},getDateArgsObject:function(){try{var b=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();var h=ta.widgets.calendar.getPageAdultsCount();if(!b||!e||!h){return null}var i=b.getDate();var k=b.getMonth()+1;var g=b.getFullYear();var c=e.getDate();var f=e.getMonth()+1;var a=e.getFullYear();var j={inDay:i,inMonth:k+" "+g,outDay:c,outMonth:f+" "+a,adults:h};return j}catch(d){ta.util.error.record(d,"Unable to create calendar date args object");return null}},loadDateEnteredMonikers:function(){ta.common.ads.loadMonikers.delay(2000)},getTrackingString:function(){return ta.retrieve("multiDP.trackString")||"DATEPICKER"},clickDatepickerThroughBackdrop:function(f,c,a){if(!f){return}f=new Event(f);var g=f.page.x;var d=f.page.y;var b=false;Array.from([c,a]).each(function(i){if(!b){var j=i.getPosition();var h=i.getSize();if(g>=j.x&&g<=(j.x+h.x)&&d>=j.y&&d<=(j.y+h.y)){b=true;var e=new MouseEvent("click",{view:window,bubbles:true,cancelable:true});i.dispatchEvent(e);f.stopPropagation()}}})},datesExplicitlySetByUser:function(){return ta.has("date.picker.pageInDate")&&ta.has("date.picker.pageOutDate")}};ta.widgets.ArrowLabel=new Class({Implements:Options,Binds:["shiftLeft","shiftRight"],options:{charWidth:7,sidePadding:0,labelArrowBaseClass:"calendarDateStyling",arrowElemClass:"defaultArrowElemStyling",textElemClass:"arrowTextElemStyling",arrowSpriteClass:"sprite-date_picker-grayDownArrow",arrowIconClass:"arrowIconStyling",arrowIconWidth:16},initialize:function(f,d,i){this.setOptions(i);if(!f||!d){return false}this.labelText=d;this.parentElem=f;var a=d.length+1;var h=(a*this.options.charWidth);var b=0;if(this.parentElem.getCoordinates&&this.parentElem.getCoordinates().width){b=this.parentElem.getCoordinates().width;if(b%2==1){b=b+1}}var c=0;if(h){if(h%2==1){h=h+1}c=(-1)*((h/2)-(b/2))}var g="left";if(ta.util.i18n.isRtl()){g="right"}this.inlineRelElem=new Element("div",{"class":this.options.labelArrowBaseClass+" inlineRelElemStyling"});this.arrowElem=new Element("div",{"class":this.options.arrowElemClass,styles:{width:h,padding:"0 "+this.options.sidePadding+"px"}});this.arrowElem.setStyle(g,c);this.arrowTextElem=new Element("div",{html:this.labelText,"class":this.options.textElemClass});this.arrowIconElem=new Element("div",{"class":this.options.arrowSpriteClass+" "+this.options.arrowIconClass});var e=0;if(this.options.arrowIconWidth){e=(-1)*((this.options.arrowIconWidth/2)-(b/2))}else{if(b){e=b/2}}this.arrowIconElem.setStyle(g,e);this.arrowTextElem.inject(this.arrowElem);this.arrowElem.inject(this.inlineRelElem);this.arrowIconElem.inject(this.inlineRelElem);this.inlineRelElem.inject(f)},setParentElem:function(a){if(a&&this.inlineRelElem){this.parentElem=a;this.parentElem.adopt(this.inlineRelElem)}},setText:function(a){this.labelText=a;this.arrowTextElem.innerHTML=this.labelText},remove:function(){if(this.inlineRelElem){this.inlineRelElem.destroy()}}});ta.widgets.Calendar=new Class({Binds:["addCustomDayStyleString","getCreatorElement"],Implements:[Options,Events],options:{selectedDate:null,firstDate:null,lastDate:null,dualCalendar:true,invalidDates:null,useLinks:true,dayNames:false,formatter:null,offsetOther:0,choiceLink:null,prevAction:null,nextAction:null,monthHeadingFormat:"",monthspan:11,indicateTurnoverDays:false,monthChangeDuration:500,postContent:null,prevStyle:false,nextStyle:false,showRange:false,isFirstCal:null,creatorElem:null,includeTodayInRange:false,holidaysOnCalendar:false,stableTableHeight:false,treatInvalidAsOutOfRange:false,useInoutMonth:true},initialize:function(b){this.setOptions(b);if(!this.options.firstDate){var c=ta.retrieve("calendar.serverTime");if(ta.has("hac_timezone_awareness")&&ta.has("ta.hac.locationTimezoneOffset")){var e=ta.retrieve("ta.hac.locationTimezoneOffset");var a=c?new Date(c):new Date();var d=a.getTime();d+=(a.getTimezoneOffset()*60000);var f=d+e;this.options.firstDate=new Date(f)}else{this.options.firstDate=c?new Date(c):new Date()}}if(!this.options.lastDate){this.setLastDate(this.options.monthspan)}this.today=new Date();this.selectedDate=this.options.selectedDate;if(b.oneWayFlight){this.options.choiceLink="ta.widgets.calendar.calendarSingleSelect"}if(b.multiCityFlight){this.options.choiceLink="ta.widgets.calendar.calendarMCSelect"}ta.util.date.normalize(this.today);if(this.options.firstDate){ta.util.date.normalize(this.options.firstDate)}if(this.options.lastDate){ta.util.date.normalize(this.options.lastDate)}if(this.selectedDate){ta.util.date.normalize(this.selectedDate)}this.container=new Element("div",{"class":"calendar"});this.addPrevNext();if(this.options.postContent){if(typeof(this.options.postContent)==="function"){this.options.postContent=this.options.postContent()}this.container.adopt(this.options.postContent)}if(this.options.wrapper){if(typeof(this.options.wrapper)==="function"){this.options.wrapper=this.options.wrapper()}this.options.wrapper.getElement(".wrapper_inner").adopt(this.container);this.container=this.options.wrapper}if(this.options.monthHeadingFormat==""&&DATE_FORMAT_MMM_YYYY){this.options.monthHeadingFormat=DATE_FORMAT_MMM_YYYY}},setLastDate:function(b){if(b==null||b<1){b=11}var e=new Date();e.setDate(1);var a=e.getMonth();var c=a+b;e.setFullYear(e.getFullYear()+c/12);e.setMonth(c%12);this.options.lastDate=e},getFirstDate:function(){return this.selectedDate||(this.theOtherCal&&this.theOtherCal.selectedDate)||this.today},update:function(){if(this.currentMonth){this.removeTable(null,this.currentMonth)}if(this.nextMonth){this.removeTable(null,this.nextMonth)}var c=this.getFirstDate();if(this.options.useInoutMonth){if(ta.widgets.calendar.getPageInDate()){c=new Date(ta.widgets.calendar.getPageInDate());if(ta.has("datepicker_autoadvance_fday")){c=ta.retrieve("datepicker_autoadvance_fday")}}if(ta.widgets.calendar.getPageOutDate()&&(!ta.widgets.calendar.getPageInDate()||(this.options.flights&&!this.isIn))){c=new Date(ta.widgets.calendar.getPageOutDate());c.setDate(0)}}if(this.options.firstDate&&c<this.options.firstDate){c=this.options.firstDate}if(this.options.dualCalendar){var f=new Date(c);f.setDate(ta.util.date.DAYS_IN_MONTH[f.getMonth()]);ta.util.date.normalize(f);if(f>=this.options.lastDate){c=new Date(c);if(c.getMonth()==0){c.setFullYear(c.getFullYear()-1,11,1)}else{c.setMonth(c.getMonth()-1,1)}}}this.currentMonth=this.createMonth(c);this.injectMonth(this.currentMonth.elmt,true);if(this.options.dualCalendar){var e=new Date(this.currentMonth.date);var a=e.getDate();var b=e.getMonth()+1;if(a>ta.util.date.DAYS_IN_MONTH[b]){a=ta.util.date.DAYS_IN_MONTH[b]}e.setMonth(b,a);this.nextMonth=this.createMonth(e);this.injectMonth(this.nextMonth.elmt,false)}this.updatePrevNext();return this},injectMonth:function(c,d){if(ta.util.i18n.isRtl()){d=!d}var b=this.container,a="top";if(!d&&ta.id(this.container).getElement(".wrapper_inner .calendar")){b=ta.id(this.container).getElement(".wrapper_inner .calendar")}if(d&&this.nav){b=this.nav;a="after"}else{if(!d){if(this.options.postContent){b=this.options.postContent;a="before"}else{a="bottom"}}}c.inject(b,a)},reposition:function(){this.currentMonth.elmt.setStyle("left","0px");if(this.options.dualCalendar){if(!ta.util.i18n.isRtl()){this.nextMonth.elmt.setStyle("left",this.currentMonth.elmt.getCoordinates().width+this.options.offsetOther+"px")}else{this.nextMonth.elmt.setStyle("left","0px");this.currentMonth.elmt.setStyle("left",this.nextMonth.elmt.getCoordinates().width+this.options.offsetOther+"px")}}return this},updatePrevNext:function(){var b=this.currentMonth.date;var a=this.options.dualCalendar?this.nextMonth.date:this.currentMonth.date;var d=ta.util.date.inSameMonth(b,this.options.firstDate);var c=ta.util.date.inSameMonth(a,this.options.lastDate);getChildByClass(this.container,"prev").style.display=(d?"none":"block");getChildByClass(this.container,"next").style.display=(c?"none":"block")},createPagingElement:function(a,b,c){return'<span class="'+a+'"><a style="display: block;" onclick="'+b+'(event, this);">'+c+"</a></span>"},addPrevNext:function(){if(!(this.options.prevAction&&this.options.nextAction)){return}var a=[],b=this.nav=new Element("div",{"class":"navCal"}).inject(this.container);a.push(this.createPagingElement("prev"+(this.options.prevStyle?" "+this.options.prevStyle:""),this.options.prevAction,"Previous Month"));a.push(this.createPagingElement("next"+(this.options.nextStyle?" "+this.options.nextStyle:""),this.options.nextAction,"Next Month"));b.set("html",a.join(""))},getHolidays:function(f,c,d,b){var e;if(f){var a=c+"-"+(d+1)+"-"+b;e=f[a]}return e},createMonth:function(C){var E={date:C};var o=new Date(C);o.setDate(1);ta.util.date.normalize(o);var q=(o.getDay()-jsGlobalDayOffset+7)%7;var A=new Date(C);A.setDate(0);this.prevDayValid=(this.isInvalidDate(A)?0:1);if(A<this.options.firstDate||A>this.options.lastDate){this.prevDayValid=-1}if(this.options.multiCityFlight&&this.crId>1){this.options.firstDate=ta.widgets.calendar.lastDateBefore(this.options,this.crId)}var c=[];var s=C.getFullYear();var u=C.getMonth();var h=new Date();var v;var B=ta.util.date.inSameMonth(h,C)?h.getDate():-1;var p=-1;if(this.selectedDate&&this.selectedDate.getMonth()==u&&this.selectedDate.getFullYear()==s){p=this.selectedDate.getDate()}var D;if(this.options.showRange&&this.theOtherCal&&this.theOtherCal.selectedDate){D=this.theOtherCal.selectedDate;ta.util.date.normalize(D)}if(this.options.singleSelect){if(this.options.pickerOption=="out"&&ta.widgets.calendar.getPageInDate()){if(!this.options.flights){v=new Date(ta.widgets.calendar.getPageInDate());v.setDate(v.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS)}else{v=new Date();ta.util.date.normalize(v);v.setDate(v.getDate()+ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT)}}}var t=s;if(ta.retrieve("thai_buddhist_era_year")){t=t+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}c.push('<table cellspacing="0" cellpadding="0" border="0"><thead><tr><th class="caption" colspan="7">');c.push(this.options.monthHeadingFormat.replace(/MMM/,jsGlobalMonths[u]).replace(/YYYY/,t));c.push("</th></tr><tr>");for(var y=0;y<jsGlobalDaysShort.length;y++){c.push("<th>");c.push(this.options.dayNames?jsGlobalDaysAbbrev[y]:jsGlobalDaysShort[y]);c.push("</th>")}c.push("</tr></thead><tbody><tr>");var g=0;for(var y=0;y<q;y++){c.push('<td class="other">&nbsp;</td>');g++}q--;var x=0;var b=ta.util.date.DAYS_IN_MONTH[E.date.getMonth()];if(E.date.getMonth()==1&&E.date.getYear()%4==0){b+=1}var k=b;while(x<b){q=(q+1)%7;x++;o.setDate(x);var z=x;var e=null;var r=this.getHolidays(this.options.holidaysOnCalendar,s,u,x);if(this.options.includeTodayInRange){var a=!(o<=this.options.firstDate||o>this.options.lastDate||(v&&o>v))}else{var a=!(o<this.options.firstDate||o>this.options.lastDate||(v&&o>v))}var w=!this.isInvalidDate(o);var n=this.options.choiceLink;var m=!((this.selectedDate&&this.selectedDate.getTime()<o.getTime())||(D&&D.getTime()<o.getTime()));if(this.options.formatter){this.options.selectedDay=p;this.options.otherDate=D;var f=this.options.formatter.call(this,o,a,w,q,this.options);e=f.cname;z=f.contents;n=f.link||n}else{if(!w){e="invalid"}else{if(x==B){if(x==p||(D&&o.getTime()===D.getTime())){e="today selected "+(m?"start":"end");m=!m;if(this.selectedDate&&D){e+=" rngDt"}}else{if(!a){e="today disabled"}else{e="today"}}}else{if(x==p||(D&&o.getTime()===D.getTime())){e="selected "+(m?"start":"end");m=!m;if(this.selectedDate&&D){e+=" rngDt"}}else{if(this.selectedDate&&D&&((this.selectedDate.getTime()<o.getTime()&&o.getTime()<D.getTime())||(this.selectedDate.getTime()>o.getTime()&&o.getTime()>D.getTime()))){e="rngDt"}}}}}if(this.options.indicateTurnoverDays){if(w){if(this.prevDayValid==0){if(e){e+=" depart"}else{e="depart"}}this.prevDayValid=1}else{if(this.prevDayValid==1){if(e){e+=" arrive"}else{e="arrive"}}this.prevDayValid=0}if(!a){this.prevDayValid=-1}}if(q==0){c.push("</tr><tr>")}if(!a||(this.options.treatInvalidAsOutOfRange&&!w)){c.push('<td class="');c.push(e||"disabled");c.push('">');if(r){c.push(r)}else{c.push(z||x)}c.push("</td>")}else{if(this.options.singleSelect){var j=this.date;if(j&&j.getDate()==x&&j.getMonth()==u){e=e+" selected"}}var l=this.addCustomDayStyleString(n,s,E,x,o,z);if(l){e+=l}if(e){c.push('<td class="');c.push(e);c.push('">')}else{c.push("<td>")}c.push(this.buildDayAnchorTag(n,s,u,x,z,o));c.push("</td>")}}while(++q<7){c.push("<td class='other'>&nbsp;</td>");g++}if(this.options.stableTableHeight){while((b+g)<42){c.push("</tr><tr>");var y=0;for(y=0;y<7;y++){c.push("<td class='other'>&nbsp;</td>");g++}}}c.push("</tr></tbody></table>");E.elmt=new Element("div",{"class":"month"}).set("html",c.join(""));return E},addCustomDayStyleString:function(d,b,f,a,e,c){},buildDayAnchorTag:function(f,c,e,b,d,g){var a=[];if(this.options.useLinks&&f){if(ta.has("checkrates.add_holding_windows")){a.push('<a href="javascript:void(0);" class="no_cpu" ondragstart="return false;" onclick="')}else{a.push('<a href="javascript:void(0);" ondragstart="return false;" onclick="')}a.push(f);a.push("(event,");a.push(c);a.push(",");a.push(e);a.push(",");a.push(b);a.push(',this)"');if(this.options.dayMouseOver){a.push(' onmouseover="');a.push(this.options.dayMouseOver);a.push("(event,");a.push(c);a.push(",");a.push(e);a.push(",");a.push(b);a.push(',this)"')}if(this.options.dayMouseOut){a.push(' onmouseout="');a.push(this.options.dayMouseOut);a.push("(event,");a.push('this)"')}a.push(">");a.push(d);a.push("</a>")}else{a.push(d)}return a.join("")},isInvalidDate:function(a){return ta.util.date.inDateSet(a,this.options.invalidDates)},isValid:function(){if(!this.selectedDate){return true}return this.selectedDate.getTime()>=this.options.firstDate.getTime()&&this.selectedDate.getTime()<=this.options.lastDate.getTime()},prev:function(){if(this.animating){return}var k=this.options.dualCalendar;this.animating=true;var h=new Date(this.currentMonth.date);var g=h.getMonth()-1;if(g<0){g=g+12;h.setFullYear(h.getFullYear()-1)}var i=h.getDate();if(i>ta.util.date.DAYS_IN_MONTH[g]){i=ta.util.date.DAYS_IN_MONTH[g]}h.setMonth(g,i);var j=this.currentMonth.elmt.getCoordinates().width;var f=j+(k?this.nextMonth.elmt.getCoordinates().width:0);var b=this.createMonth(h);if(!ta.util.i18n.isRtl()){b.elmt.style.left="-"+j+"px"}else{b.elmt.style.left=f+"px"}this.injectMonth(b.elmt,true);var e=this.container.getElements("div.month");var a;if(!ta.util.i18n.isRtl()){a={"0":{left:[-j,0]},"1":{left:[0,j+this.options.offsetOther]}};if(k){a["2"]={left:[j+this.options.offsetOther,j*2+this.options.offsetOther]}}}else{a={"0":{left:[0,-j]},"1":{left:[j+this.options.offsetOther,0]}};if(k){a["2"]={left:[j*2+this.options.offsetOther,j+this.options.offsetOther]}}}var c=new Fx.Elements(e,{onComplete:this.doneAnimating.bind(this).partial(Function._,this.nextMonth||this.currentMonth),duration:this.options.monthChangeDuration});if(k){this.nextMonth=this.currentMonth}this.currentMonth=b;this.updatePrevNext();c.start(a)},next:function(){if(this.animating){return}var k=this.options.dualCalendar;this.animating=true;var h=new Date(this.currentMonth.date);var g=h.getMonth()+(k?2:1);if(g>11){g=g-12;h.setFullYear(h.getFullYear()+1)}var i=h.getDate();if(i>ta.util.date.DAYS_IN_MONTH[g]){i=ta.util.date.DAYS_IN_MONTH[g]}h.setMonth(g,i);var j=this.currentMonth.elmt.getCoordinates().width;var f=j+(k?this.nextMonth.elmt.getCoordinates().width:0);var b=this.createMonth(h);if(!ta.util.i18n.isRtl()){b.elmt.style.left=f+"px"}else{b.elmt.style.left="-"+j+"px"}this.injectMonth(b.elmt,false);var e=this.container.getElements("div.month");var a;if(!ta.util.i18n.isRtl()){a={"0":{left:[0,-j]},"1":{left:[j+this.options.offsetOther,0]}};if(k){a["2"]={left:[j*2+this.options.offsetOther,j+this.options.offsetOther]}}}else{a={"0":{left:[-j,0]},"1":{left:[0,j+this.options.offsetOther]}};if(k){a["2"]={left:[j+this.options.offsetOther,j*2+this.options.offsetOther]}}}var c=new Fx.Elements(e,{onComplete:this.doneAnimating.bind(this).partial(Function._,this.currentMonth),duration:this.options.monthChangeDuration});if(k){this.currentMonth=this.nextMonth;this.nextMonth=b}else{this.currentMonth=b}this.updatePrevNext();c.start(a)},removeTable:function(b,a){a.elmt.dispose()},doneAnimating:function(b,a){this.removeTable(b,a);this.animating=false},select:function(a,b){this.selectedDate=b;this.fireEvent("onSelect",[this,a])},clear:function(a){this.selectedDate=null;this.fireEvent("onClear",[this,a])},nearbyMonth:function(b,a){var c=b+a;if(c>11){c-=12}else{if(c<0){c+=12}}return c},getCreatorElement:function(){return this.options.creatorElem}});(function(){ta.widgets.SingleDateCalendar=new Class({Extends:ta.widgets.Calendar,Implements:[Options,Events],Binds:["onOutDateCalShow","updateInputStyling","updateDualDateInputStyling","showCalendarOverlay","setPositionElement","hashHack","getCalendarTopOffset","getCalendarLeftOffset","callOnSelect","setPageDates","getPageInDate","getPageOutDate"],options:{singleSelect:true,pickerOption:"in",autoAdvance:true,dualCalendar:true,dayMouseOver:"ta.widgets.calendar.calendarMouseOver",choiceLink:"ta.widgets.calendar.calendarMultiSelect",prevAction:"ta.widgets.calendar.calendarPrev",nextAction:"ta.widgets.calendar.calendarNext",selectedHoverClass:"rngDt",previousSelectedClass:"prevSel",inDateClass:"inDate",outDateClass:"outDate",selectionStartClass:false,selectionEndClass:false,captureKeyEvents:true,autoShow:false,displayCalendarInOverlay:true,formatter:ta.widgets.calendar.multiDateFormatter,monthChangeDuration:150,submitOnEnter:true,useClassicSkin:false,classicStyling:false},inDate:false,newInDate:false,oldInDate:false,startRangeElem:false,outDate:false,oneSelected:false,monthOffset:0,initialize:function(f,p,r,w,x){this.isIn=x;this.parent(f,this.input);this.crId=p;this.setPositionElement();if(typeof r==="function"){this.onSelect=r.bind(this)}this.argArray=w;if(this.options.displayCalendarInOverlay){var d=this.onCalendarOverlayShow.bind(this);var a=this.onCalendarOverlayHide.bind(this);var n=this.onCalendarOverlayShow.bind(this);var k=this.positionElement.getParent(".overlay");if(k){this.parentOverlay=k.overlay}var B=ta.overlays.ACTIVATE_CLICK;var o=ta.retrieve("datepicker_autoadvance")?0:(this.options.offsetLeft?this.options.offsetLeft:this.getCalendarLeftOffset());var v=this.options.offsetTop?this.options.offsetTop:this.getCalendarTopOffset();var z="date_picker_calendar";if(this.options.useClassicSkin){z="typeO"}if(this.options.classicStyling){z=z+" classicStyling"}if(this.options.oneWayStyling){z=z+" oneWayStyling"}if(!this.options.dualCalendar){z=z+" singleWidth"}if(!ta.widgets.calendar.hasPageDates()){z=z+" predates"}var t=ta.retrieve("tablet_calendar_update.enabled")?ta.overlays.BACKDROP_ALWAYS:ta.overlays.BACKDROP_NEVER;var c=ta.retrieve("tablet_calendar_update_v2.enabled")?0.01:0.6;var A=null;if(ta.retrieve("tablet_calendar_update_v2.enabled")){var e=ta.id("date_picker_in_"+this.crId+this.options.ext);var h=ta.id("date_picker_out_"+this.crId+this.options.ext);A=function(C){ta.widgets.calendar.clickDatepickerThroughBackdrop(C,e,h)}}var u=ta.overlays.RelativeOverlayBelow;var y={style:z,noPadding:true,autoShow:false,noCpu:true,backdrop:t,backdropOpacity:c,onBackdropClick:A,offsetLeft:o,offsetTop:v,activate:B,onShow:d,onHide:a,onFocus:n,zIndex:1001,showCloseButton:false,parentContainer:this.options.parentContainer,fontSize:this.options.fontSize,dontCloseOnClick:window.tabletOnFullSite&&ta.retrieve("meta.full_meta_photos_v4")};if(ta.has("hr_meta_focus_predates")||ta.has("hr_meta_focus_with_dates")||ta.has("sd_datepicker_focus")||ta.has("hotels_meta_focus")){y.zIndex=10001}if(f&&f.isGuestsRoomsCalendar){y.useTransparentOverlayPadding=true;y.transparentOverlayPaddingValue=80}if(ta.isTabletAlbumViewer()||ta.retrieve("tablet_maps_v1")){var m=document.getElement(".footerPocketWithInsert");if(m&&m.isVisible()){if(this.positionElement&&this.positionElement.getParent(".footerPocketWithInsert")){y.parentContainer=m}else{y.positionType="fixed"}var s=y.onShow;y.onShow=function(C){if(s){s(C)}window.addEvent("orientationchange",this.hide)};var q=y.onHide;y.onHide=function(C){if(q){q(C)}window.removeEvent("orientationchange",this.hide)}}}this.calendarOverlay=new u(y,this.positionElement);var b=ta.id(this.positionElement).getParent();if(b&&b.hasClass("date_picker_calendar_wrap")){b.onclick=function(){};ta.id(this.positionElement).removeEvents("click");ta.id(this.positionElement).getParent().addEvent("click",this.showCalendarOverlay.bind(this))}if(b&&!window.tabletOnFullSite){b.addEvent("focus",this.showCalendarOverlay.bind(this))}if(this.outDateField){ta.id(this.outDateField).getParent().onclick=function(){};ta.id(this.outDateField).getParent().addEvent("click",this.onOutDateCalShow.bind(this));if(!window.tabletOnFullSite){ta.id(this.outDateField).getParent().addEvent("focus",this.onOutDateCalShow.bind(this))}}this.calendarOverlay.inner.adopt(this.container);this.calendarOverlay.calendar=this;if(this.positionElement&&(this.positionElement.hasClass("isPreDatesPermanent")||this.positionElement.getParent(".isPreDatesPermanent"))){this.calendarOverlay.options.permanent=true;this.calendarOverlay.options.pinnable=ta.overlays.PINNABLE_ALWAYS}this.calendarOverlay.container.addEvent("click",function(C){if(C||window.event){C=new Event(C||window.event);C.stopPropagation()}});this.update();this.reposition()}var l=this.onDocumentClick.bind(this);document.addEvent("click",l);if(ta.retrieve("datepicker_autoadvance")){var j=ta.id("date_picker_out_"+this.crId+this.options.ext);var g=ta.id("date_picker_in_"+this.crId+this.options.ext);var i=(j&&g)?j.getCoordinates().left-g.getCoordinates().left:0;if(x){this.container.addClass("calIn");if(ta.util.i18n.isRtl()){this.calendarOverlay.options.offsetLeft=0-i}}else{this.container.addClass("calOut");if(!ta.util.i18n.isRtl()){this.calendarOverlay.options.offsetLeft=i}}this.container.addEvent("mouseleave",this.resetDatepickerOnHover.bind(this))}},addCustomDayStyleString:function(k,j,h,l,g,c){var m="";var b=this.getPageInDate();var i=this.getPageOutDate();var f="";if(b&&i){f=" prevSel"+(ta.retrieve("datepicker_autoadvance")?"":" inDate_DP7");if(g.getTime()>b.getTime()&&g.getTime()<i.getTime()){m=m+" prevSel"}}if(b&&h.date.getMonth()==b.getMonth()&&l==b.getDate()){m=m+" inDate start"+f}if(i&&h.date.getMonth()==i.getMonth()&&l==i.getDate()){m=m+" inDate end"+f}if(ta.retrieve("cal_xsell")&&(this.today.getMonth()==g.getMonth()||((this.today.getMonth()+1)%12)==g.getMonth())){var e=ta.util.date.getDaysInRange(this.today,g)-1;if(!this.isIn){e-=1}var a=ta.retrieve("cal_xsell");if(e>=0&&e<a.availability.length){var d=a.availability[e];if(!d){m+=" calXSellUnAvail"}}}return m},buildDayAnchorTag:function(g,d,f,b,e,h){var a=[];var c=this.getHolidays(this.options.holidaysOnCalendar,d,f,b);if(this.options.useLinks&&g){if(ta.has("checkrates.add_holding_windows")){a.push('<div href="javascript:void(0);" class="day no_cpu')}else{a.push('<div href="javascript:void(0);" class="day')}if(c){a.push(" hld")}a.push(" day_"+b);a.push('" onclick="');a.push(g);a.push("(event,");a.push(d);a.push(",");a.push(f);a.push(",");a.push(b);a.push(',this)"');if(this.options.dayMouseOver){a.push(' onmouseover="');a.push(this.options.dayMouseOver);a.push("(event,");a.push(d);a.push(",");a.push(f);a.push(",");a.push(b);a.push(',this)"')}a.push(' value="');a.push(h.valueOf());a.push('"');a.push(">");if(c){a.push(c)}else{a.push(e)}a.push("</div>")}else{a.push(e)}return a.join("")},callOnSelect:function(){if(this.onSelect){this.fireEvent("onChangeDates");if(this.argArray&&this.argArray.length>0){this.onSelect.apply(this,this.argArray)}else{this.onSelect.call(this,this.crId,this.positionElement);if(ta.has("guests_rooms_picker_3.enabled")){ta.store("calendarClosedByDocClick",false)}}}},clear:function(b){this.date=null;ta.widgets.calendar.clearPageDates();if(this.positionElement&&!(this.positionElement.hasClass("tab0")&&this.positionElement.hasClass("header_tab"))){var a="";if(this.isIn){if(this.options.classicDateFormat&&typeof JS_DateFormat!="undefined"){a=JS_DateFormat}else{a=ta.retrieve("multiDP.checkIn")}}else{if(this.options.classicDateFormat&&typeof JS_DateFormat!="undefined"){a=JS_DateFormat}else{a=ta.retrieve("multiDP.checkOut")}}this.positionElement.innerHTML=a}this.fireEvent("onClear",[this,b]);if(this.calendarOverlay){this.calendarOverlay.hide()}},clearPrevSelectedDays:function(){if(!this.calendarTop){this.calendarTop=this.calendarOverlay.container.getElement(".calendar")}var a=this.calendarTop.getElements("td."+this.options.previousSelectedClass);a.removeClass(this.options.previousSelectedClass);this.options.selectionStartClass&&a.removeClass(this.options.selectionStartClass);this.options.selectionEndClass&&a.removeClass(this.options.selectionEndClass)},clearSelectedDays:function(){if(!this.calendarTop){this.calendarTop=this.calendarOverlay.container.getElement(".calendar")}var a=this.calendarTop.getElements("td."+this.options.selectedHoverClass);a.removeClass(this.options.selectedHoverClass);this.options.selectionStartClass&&a.removeClass(this.options.selectionStartClass);this.options.selectionEndClass&&a.removeClass(this.options.selectionEndClass)},createPagingElement:function(a,b,c){return'<span class="'+a+'" onclick="'+b+'(event, this);"></span>'},dayOver:function(c,f,b){ta.util.date.normalize(f);if(!this.oneSelected){if(ta.retrieve("datepicker_autoadvance")){if(!this.cursorLeftInitSel){if(!this.isIn&&this.getPageInDate()||this.isIn&&this.getPageOutDate()){var a=this.getPageInDate()||this.getPageOutDate();if(!b.getAttribute("value")||parseInt(b.getAttribute("value"))==a.valueOf()){return}}this.cursorLeftInitSel=true}this.updateDatepickerOnHover(f)}this.updateHoverElem(b);return}this.hoverDay=f;this.updateSelectedDays(f,b)},ensureValidDates:function(){var c=this.getPageInDate();var b=this.getPageOutDate();if(this.options.firstDate&&c){if(c<this.options.firstDate){ta.util.date.normalize(this.options.firstDate);c=this.options.firstDate;ta.widgets.calendar.setPageInDate(c);this.bypassSecondCal=true;var a=ta.widgets.calendar.getDateAfter(c);if(b&&b<a){b=a;ta.widgets.calendar.setPageOutDate(b)}}}if(b&&!c){c=ta.widgets.calendar.getDateBefore(b)}if(c&&!b){b=ta.widgets.calendar.getDateAfter(c)}ta.widgets.calendar.setPageInDate(c);ta.widgets.calendar.setPageOutDate(b)},focusOtherCalendar:function(){var a;if(this.isIn){a=ta.widgets.calendar.getPageOutCalendarField(this.crId,this.options.ext)}else{a=ta.widgets.calendar.getPageInCalendarField(this.crId,this.options.ext)}var b=document.getElement("#PERSISTENT_DATE_PICKER:not(.hidden)")||document;if(a===null&&ta.has("guests_rooms_picker_3.enabled")){if(this.isIn){a=b.getElement(".stayInfoHeaderDateTrigger.outDateTrigger")}else{a=b.getElement(".stayInfoHeader.inDateTrigger")}}if(a){if(a.click){ta.store("overlay.dontCloseOnClick",true);a.click();ta.store("overlay.dontCloseOnClick",false)}else{if(document.createEvent&&a.dispatchEvent){var c=document.createEvent("MouseEvent");c.initEvent("click",true,true);a.dispatchEvent(c)}}}},getCalendarLeftOffset:function(){var a=1;if(ta.util.i18n.isRtl()){a=127}if(ta.isMetaHomepageIntegration2013()){a=2;if(ta.util.i18n.isRtl()){a=121}}if(ta.retrieve("ta.calendar.isOutDateTrigger")&&ta.retrieve("ta.calendar.isPriceOverlayCalendar")){a=138}if(ta.has("hotels_left_filters_redesign")){return 0}return a},getCalendarTopOffset:function(){if(ta.has("hotels_left_filters_redesign")){return -7}if(ta.isMetaHomepageIntegration2013()){return -1}return -4},getFirstDate:function(){var b=this.getPageInDate();var a=this.getPageOutDate();if(this.options.multiCityFlight&&this.crId>1){return ta.widgets.calendar.lastDateBefore(this.options,this.crId)}if(this.isSecondCalShown()){if(!this.isIn&&b){return b}else{if(this.isIn&&a){return a}}}else{if((this.isIn)&&b){return b}else{if(!this.isIn&&a){return a}}}return this.today},getPageInDate:function(){return ta.widgets.calendar.getPageInDate()},getPageOutDate:function(){return ta.widgets.calendar.getPageOutDate()},getState:function(){var c=this.inDate,b=this.outDate,a={};if(c instanceof Date){Object.append(a,{inMonth:(c.getMonth()+1)+" "+c.getFullYear(),inDay:c.getDate()})}if(b instanceof Date){Object.append(a,{outMonth:(b.getMonth()+1)+" "+b.getFullYear(),outDay:b.getDate()})}return a},hashHack:function(){var a=ta.id(this.positionElement).get("id");if(a){a=a.substring(a.length-3,a.length);if(a=="olb"||a=="bin"||a=="som"){window.location.hash=" ";window.location.hash="#MetaPricesTab"}}},includeElemInRange:function(b,a){b.className=b.className+" "+a},isSecondCalShown:function(){if(!this.options.autoAdvance){return true}var a=ta.widgets.calendar.inOutCalendarSelected(!this.isIn);return a},isValidDateElem:function(b){if(!b||b.tagName!="TD"){return false}var a=b.className;if(a.match(/other/)||a.match(/disabled/)){return false}return true},initTracking:function(){if(!ta.remove("meta.datepicker_tracked")){var c=ta.id(this.positionElement).get("id")||this.options.ext||"_owl";var d=c.indexOf("_persist")>0;c=c.substring(c.length-3,c.length);var b=this.isIn?"CheckIn|":"CheckOut|";if(d){b+="Persistent|"}if(ta.retrieve("cal_xsell")){b+="CalXSell|"}switch(c){case"pto":b+="PHOTOS_LIGHTBOX";break;case"amo":b+="AMENITIES_LIGHTBOX";break;case"pop":b+="DHTML_FLYOUT";break;case"cro":b+="CalendarLightbox";break;case"inm":b+="DATES_INLINE|Tabs";ta.store("isPricesTabDatePicker",true);break;case"bin":b+="DATES_INLINE_FLEXIBLE";break;case"met":b+="DATES_LIGHTBOX";break;case"olb":b+="DATES_LIGHTBOX_FLEXIBLE";break;case"som":b+="DATES_State-Optimized-Modal_FLEXIBLE";break;case"cmp":b+="footer";break;case"hpt":b+="HOMEPAGE_PYPT";break;case"thc":b+="HAC_TOURISM";break;case"gnv":b+="GLOBAL_NAV";break;case"ond":b+="RoomTab";break;default:b+="DATES"}var a=this.getTrackingPrefix()+ta.widgets.calendar.getTrackingString();ta.widgets.calendar.trackCalendarEvent(a,"OPEN",b);ta.store("multiDP.trackString",false)}},singleDaySelect:function(g,i,f){if(g){new Event(g).stop()}ta.util.date.normalize(i);if(!i||!i.getTime){return}this.date=i;var c=new Date(i);c.increment("week",1);if(this.options.flights){var h=(new Date()).increment("day",ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);if(c>h){c=h}}this.setPageDates(i,c);if(ta.retrieve("flights_lander_redesign")){var a=ta.widgets.calendar.getDatePickerFormat("classic");i=ta.widgets.calendar.dateToString(i,a);var b=ta.id(f).getParent(".overlay");b.overlay.calendar.options.creatorElem.innerHTML=i}if(this.calendarOverlay){this.calendarOverlay.hide()}},multiCitySelect:function(g,i,f){if(g){new Event(g).stop()}ta.util.date.normalize(i);if(!i||!i.getTime){return}var a=ta.widgets.calendar.getDatePickerFormat("classic");var b=ta.id(f).getParent(".overlay");if(b.overlay.calendar.crId==="1"){var c=undefined;if(NE){c=new Date(i);c.increment("week",1);if(this.options.flights){var h=(new Date()).increment("day",ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);if(c>h){c=h}}}this.setPageDates(i,c)}if(NE){NE.checkMultiCityFields(b.overlay.calendar.crId,i)}i=ta.widgets.calendar.dateToString(i,a);b.overlay.calendar.options.creatorElem.innerHTML=i;b.setStyles({left:"-999em",top:"-999em"}).dispose();b.overlay.visible=false},multiSelect:function(g,h,b){if(g){new Event(g).stop()}ta.util.date.normalize(h);if(!h||!h.getTime){return}this.date=h;var a=null;var i=null;a=this.getPageInDate();i=this.getPageOutDate();var f=!a&&!i;var l=true;this.closedByDocOrDateClick=true;var k=false;if((!ta.widgets.calendar.getPageInDate()&&!ta.widgets.calendar.getPageOutDate())||(ta.retrieve("enteredDatesInPreDates")&&!ta.widgets.calendar.hasPageDates())){ta.store("enteredDatesInPreDates",true)}else{ta.store("enteredDatesInPreDates",false)}var j=!ta.has("hotels_left_filters_redesign")&&ta.has("guests_rooms_picker_3.enabled")&&this.isIn;if(ta.retrieve("datepicker_autoadvance")||j&&!f){ta.widgets.calendar.cancelAllExistingHAC();this.bypassSecondCal=false;if(this.isIn){a=h;if(i&&h.getTime()>=i.getTime()){i=false;k=true;ta.widgets.calendar.clearPageOutDate(this.crId,this.options.ext);ta.widgets.calendar.removeInOutCalendarSelected(false)}if(!i){if(h.getDate()<=23){ta.store("datepicker_autoadvance_fday",this.currentMonth.date)}else{ta.remove("datepicker_autoadvance_fday")}}}else{i=h;if(a&&h.getTime()<(new Date()).getTime()){a=new Date();i=ta.widgets.calendar.getDateAfter(a)}else{if(a&&h.getTime()<=a.getTime()){a=false;k=true;ta.widgets.calendar.clearPageInDate(this.crId,this.options.ext);ta.widgets.calendar.removeInOutCalendarSelected(true)}else{if(a){ta.widgets.calendar.trackInOutCalendarSelected(true);this.bypassSecondCal=true}}}}}else{if(this.isIn){var c=i&&(h.getTime()==i.getTime()&&!this.options.flights);if(i&&(h.getTime()>i.getTime()||c)){a=this.date;i=false;k=true;ta.widgets.calendar.clearPageOutDate(this.crId,this.options.ext)}else{a=h;if(i){this.bypassSecondCal=true}}}else{var c=a&&(h.getTime()==a.getTime()&&!this.options.flights);if(a&&h.getTime()<(new Date()).getTime()){a=new Date();i=ta.widgets.calendar.getDateAfter(a)}else{if(a&&(h.getTime()<a.getTime()||c)){i=this.date;a=false;k=true;ta.widgets.calendar.clearPageInDate(this.crId,this.options.ext)}else{i=h;if(a){this.bypassSecondCal=true}}}}}this.inDate=a;this.outDate=i;if(ta.has("guests_rooms_picker_3.enabled")){this.setPredatesState()}this.setPageDates(a,i);if(ta.has("guests_rooms_picker_3.enabled")&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.syncAllDatePickers();ta.commerce.meta.updateHeaderDates()}this.hoverDay=false;if(!ta.retrieve("datepicker_autoadvance")){if(!this.bypassSecondCal&&((!this.getPageOutDate()||!this.getPageInDate())&&!k)){this.bypassSecondCal=true}}this.updateNumNights();if(this.calendarOverlay){this.calendarOverlay.hide()}if(this.bypassSecondCal&&!f&&(!this.getPageInDate()||!this.getPageOutDate())){this.bypassSecondCal=false}ta.overlays.Factory.destroyAnimatedDateCTA();if(!this.isSecondCalShown()&&!this.bypassSecondCal||(f&&ta.retrieve("metaUI.isMetaCalendarAutoadvancePredates"))){ta.widgets.calendar.trackInOutCalendarSelected(this.isIn);this.focusOtherCalendar()}else{this.hashHack()}this.removeErrorState();if(!ta.retrieve("datepicker_autoadvance")){if(this.getPageInDate()&&this.getPageOutDate()){this.fireEvent("onRangeSelect",[this.crId,this.options.ext])}this.fireEvent("onSelect",[this,g])}},next:function(){this.parent();this.resetStartRangeElem(true);var a=(this.currentMonth&&this.currentMonth.date?this.currentMonth.date.get("month"):"");ta.trackEventOnPage("DATEPICKER","NEXT_MONTH",(this.isIn?"Checkin":"Checkout"),a)},onCalendarOverlayKeyDown:function(a){if(this.options.submitOnEnter&&"enter"===a.key&&ta.isMetaHomepageIntegration2013()){var c=this.positionElement.getParent("form "),b="function"!==typeof this.options.submitOnEnter||this.options.submitOnEnter(a,c);if(b){c&&c.submit()}else{this.calendarOverlay.hide()}}if(a.key=="esc"||(ta.isMetaHomepageIntegration2013()&&!ta.retrieve("freeform_datepicker")&&a.key=="tab")){this.calendarOverlay.hide()}},onCalendarOverlayHide:function(b){if(this.isSecondCalShown()||ta.widgets.calendar.hasPageDates()){this.ensureValidDates()}ta.widgets.calendar.syncAllDatePickers();if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}if(this.options.captureKeyEvents&&this.keyEventListener){document.removeEvent("keydown",this.keyEventListener)}this.updateInputStyling(false);var g=this.getPageInDate();var e=this.getPageOutDate();var d=g&&g.getDate&&e&&e.getDate;if(this.isSecondCalShown()&&d){this.bypassSecondCal=true}var a=false;if((this.shouldFireOnSelect()||this.bypassSecondCal||(this.closedByDoc&&ta.has("guests_rooms_picker_3.enabled")))&&d&&this.closedByDocOrDateClick){var c=ta.retrieve("datepicker_autoadvance");if(this.closedByDoc&&ta.has("guests_rooms_picker_3.enabled")){ta.store("calendarClosedByDocClick",true);c=true}this.fireEvent("onChangeDates");if(c){this.fireEvent("onRangeSelect",[this.crId,this.options.ext])}this.callOnSelect();this.trackSelect(true);if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){a=true}if(ta.commerce.persistentdatepicker){ta.commerce.persistentdatepicker.update()}if(ta.has("price_finder")){var f=document.getElements(".roomGuestsInfoWrap");if(f){f.forEach(function(h){h.removeClass("hidden")})}}}else{if(!this.closedByDoc){this.trackSelect(false)}}if(this.resetFireOnSelectCriteria&&(this.isSecondCalShown()&&this.closedByDocOrDateClick||ta.retrieve("datepicker_autoadvance")&&this.calendarOverlay.closedByDocClick)){this.resetFireOnSelectCriteria()}if(a){this.parentOverlay.hide()}if(ta.has("guests_rooms_picker_3.enabled")&&!ta.has("hotels_left_filters_redesign")&&!ta.has("hr_pricefinder_datebar")&&d){ta.widgets.calendar.displayStayInfoPicker()}},onCalendarOverlayShow:function(){ta.widgets.calendar.storePriorDates();this.inDate=this.getPageInDate();this.outDate=this.getPageOutDate();this.cursorLeftInitSel=false;this.bypassSecondCal=false;this.date=this.isIn?this.getPageInDate():this.getPageOutDate();if(ta.retrieve("datepicker_autoadvance")&&this.date){ta.widgets.calendar.trackInOutCalendarSelected(this.isIn)}if(ta.has("guests_rooms_picker_3.enabled")){this.setPredatesState();ta.widgets.calendar.updateGuestsRoomsPickerUI()}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.update();this.reposition();this.closedByDocOrDateClick=false;this.closedByDoc=false;var a=ta.id(this.positionElement).getParent("#hotels_lf_header_bar_wrap");if(ta.id(this.positionElement).getParent("#PERSISTENT_DATE_PICKER, #STATIC_DATE_PICKER_BAR.sticky")){ta.commerce.persistentdatepicker&&ta.commerce.persistentdatepicker.initCalendar(this)}else{if(ta.id(this.positionElement).getParent("#PERSISTENT_CHECK_RATES")||(a&&a.hasClass("fixed"))){var b=ta.id(this.positionElement).getCoordinates().top+29;if(typeof(isIPad)=="undefined"||!isIPad){b=b-window.getScrollTop()}if(a){b=this.positionElement.getCoordinates().bottom+7-(window.isTabletOnFullSite?0:window.getScrollTop())}ta.id(this.calendarOverlay.container).setStyles({position:"fixed",top:b,zindex:9997})}else{ta.id(this.calendarOverlay.container).setStyle("position","absolute")}}if(ta.retrieve("tablet_calendar_update.enabled")&&this.container){if(ta.retrieve("tablet_calendar_update_v2.enabled")){var f=window.innerWidth/document.documentElement.clientWidth;var c=Math.max(Math.min(Math.floor(150*f),150),100);this.container.setStyle("zoom",c+"%")}else{this.container.setStyle("zoom","150%")}if(this.calendarOverlay&&this.calendarOverlay.position){this.calendarOverlay.position()}}if(this.options.captureKeyEvents){try{this.keyEventListener=this.onCalendarOverlayKeyDown.bind(this);document.addEvent("keydown",this.keyEventListener)}catch(d){}}ta.id(this.positionElement).removeClass("date_picker_error");this.positionElement.blur();this.initTracking();this.updateInputStyling(true);window.fireEvent("onCalendarOverlayShow",this)},onDocumentClick:function(a){this.closedByDocOrDateClick=true;this.closedByDoc=true},onOutDateCalShow:function(a){ta.store("ta.calendar.isOutDateTrigger",true);this.calendarOverlay.show(a)},prev:function(){this.parent();this.resetStartRangeElem(false);var a=(this.currentMonth&&this.currentMonth.date?this.currentMonth.date.get("month"):"");ta.trackEventOnPage("DATEPICKER","PREV_MONTH",(this.isIn?"Checkin":"Checkout"),a)},removeErrorState:function(){if(ta.id("NO_DATES_ERROR")){ta.id("NO_DATES_ERROR").hide()}if(ta.id("calPnt")){ta.id("calPnt").removeClass("errorState")}var a=ta.find("#CHECK_RATES_CONT .date_picker_calendar_wrap");if(a){a.removeClass("errorState")}},resetDatepickerOnHover:function(){var d=this.getPageInDate();var c=this.getPageOutDate();var a=this.positionElement;if(!this.isIn){a=a.id.replace("date_picker_out","date_picker_in");if(a){a=ta.id(a)}}ta.widgets.calendar.updateDateDisplay(a,d,c);this.updateHoverElem();if(d){d=d.valueOf()}if(c){c=c.valueOf()}var b=document.getElements(".date_picker_calendar.overlay .calendar .today");var e=document.getElements(".date_picker_calendar.overlay .calendar .day");e.forEach(function(f){var g=f.getAttribute("value");if(g){g=parseInt(g);f=f.getParent();f.className="";if(d&&d==g){f.addClass("start")}else{if(c&&c==g){f.addClass("end")}}if(d&&c&&d<=g&&g<=c){f.addClass("prevSel")}}}.bind(this));b.addClass("today")},resetFireOnSelectCriteria:function(){ta.widgets.calendar.removeInOutCalendarSelected(this.isIn);ta.widgets.calendar.removeInOutCalendarSelected(!this.isIn)},resetStartRangeElem:function(e){if(!this.oneSelected){return}this.startRangeElem=false;this.clearSelectedDays();if(ta.util.i18n.isRtl()){e=!e}e?this.monthOffset++:this.monthOffset--;var b=this.calendarOverlay.container.getElements(".month");if(e){b.shift()}else{b.pop()}b.some(function(g,f){if(g){var h=ta.id(g).getElement("."+this.options.inDateClass);if(h){this.startRangeElem=h;return true}}return false},this);if(!this.startRangeElem){var a=false;if(this.monthOffset>0){var d=0;a=ta.id(b[d]).getElements("td");if(ta.util.i18n.isRtl()){a.reverse()}}else{var c=b.length-1;a=ta.id(b[c]).getElements("td");if(!ta.util.i18n.isRtl()){a.reverse()}}if(a){a.some(function(g,f){if(this.isValidDateElem(g)){this.startRangeElem=g;return true}return false},this)}}},selectLeftRightButtons:function(){var a={};if(this.options.useClassicSkin){a.leftIdle="classicLeftBtn";a.leftInactive="";a.rightIdle="classicRightBtn";a.rightInactive=""}else{a.leftIdle="sprite-date_picker-btnLeftIdle";a.leftInactive="sprite-date_picker-btnLeftInactive";a.rightIdle="sprite-date_picker-btnRightIdle";a.rightInactive="sprite-date_picker-btnRightInactive"}return a},setPageDates:function(b,a){ta.widgets.calendar.storePriorDates();if(b){ta.widgets.calendar.setPageInDate(b)}if(a){ta.widgets.calendar.setPageOutDate(a)}},setPermanent:function(b){if(this.calendarOverlay){this.calendarOverlay.options.permanent=b;this.calendarOverlay.options.pinnable=(b?ta.overlays.PINNABLE_ALWAYS:ta.overlays.PINNABLE_NEVER);var a=this.positionElement;if(this.positionElement&&!this.positionElement.hasClass("isPreDatesPermanent")){a=this.positionElement.getParent(".isPreDatesPermanent")}if(a){a.removeClass("isPreDatesPermanent")}}},setPositionElement:function(){if((ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")&&!ta.has("hotels_left_filters_redesign"))&&this.options.creatorElem&&!this.options.creatorElem.getParent(".geoChkRates")&&!this.options.creatorElem.getParent("#PERSISTENT_DATE_PICKER")&&(this.options.creatorElem.getParent(".filterControls")||this.options.creatorElem.getParent(".jfy_header_dates_holder")||this.options.creatorElem.getParent(".meta_chevron_module_2014")||this.options.creatorElem.getParent("#HotelDateSearch")||(this.options.creatorElem.getParent(".baseHotelInfoLeft")))){this.positionElement=$$(".miniMetaShowHdr")[0];if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".hr_pre_date_minimalist .title")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".legend.metaDatesChosen")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".p13n_header_tab_wrap .tab0")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$("#STYLE2HEADER_V3 h1")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$("#HLDatesHeader")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".change_dates_button")[0];if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".changeStayInfoButton")[0]}}}else{var a="date_picker_in_";if(!this.isIn){a="date_picker_out_"}this.positionElement=ta.id(a+this.crId+this.options.ext);if(!this.positionElement&&this.options.creatorElem.getParent("#PERSISTENT_DATE_PICKER")){this.positionElement=$$("#PERSISTENT_DATE_PICKER .bestPricesMsg")[0]}}if(!this.positionElement){ta.util.error.record(null,"ta.widgets.SingleDateCalendar.setPositionElement - this.positionElement is undefined",null,{},"WARN")}},setPredatesState:function(){if(this.inDate&&this.outDate){this.calendarOverlay.container.removeClass("predates")}else{this.calendarOverlay.container.addClass("predates")}},shouldFireOnSelect:function(){if(!this.onSelect){return false}return this.isSecondCalShown()&&this.calendarOverlay&&this.calendarOverlay.closedByDocClick},showCalendarOverlay:function(a){if(!this.calendarOverlay){return}if(this.parentOverlay&&this.parentOverlay.container&&ta.id(this.parentOverlay.container).hasClass("persistentCR")){this.calendarOverlay.options.activate=ta.overlays.ACTIVATE_CLICK}this.calendarOverlay.show(a);ta.fireEvent("calendarShown")},trackSelect:function(c){var e=ta.id(this.positionElement).get("id");if(!e){var d="date_picker_in_";if(!this.isIn){d="date_picker_out_"}e=d+this.crId+this.options.ext}var i=e.indexOf("_persist")>0;e=e.substring(e.length-3,e.length);var b="START";var f="DATES";var h=-1;if(e=="ond"){f="RoomTab"}if(c){b="SELECT";if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){f="PRICE_CALENDAR"}else{if(this.inDate&&this.outDate){var g=ta.util.date.getDaysInRange(this.inDate,this.outDate)-1;if(g>ta.util.date.MAX_STAY_DURATION_DAYS){f="DATES_OVER_30_DAYS"}}}}if(this.isIn&&this.today&&this.inDate){h=ta.util.date.getDaysInRange(this.today,this.inDate)-1}else{if(!this.isIn&&this.inDate&&this.outDate){h=ta.util.date.getDaysInRange(this.inDate,this.outDate)-1}}if(ta.retrieve("meta.prof_photo_lb.post_date_close.overlay")){f="CalendarLightbox"}if(ta.retrieve("cal_xsell")){f="CalXSell"}if(f){f="|"+f}if(i){f="|Persistent"+f}if(ta.retrieve("isPricesTabDatePicker")){ta.remove("isPricesTabDatePicker");f+="|Tabs"}if(this.isIn){f="CheckIn"+f}else{f="CheckOut"+f}var a=this.getTrackingPrefix()+ta.widgets.calendar.getTrackingString();ta.widgets.calendar.trackCalendarEvent(a,b,f,h)},getTrackingPrefix:function(){return this.options.isVR?"VR_":""},updateDatepickerOnHover:function(d){var f=this.getPageInDate();var e=this.getPageOutDate();var b;if(this.isIn){f=d;if(e&&d.getTime()>=e.getTime()){e=null}b=this.positionElement}else{e=d;if(f&&d.getTime()<=f.getTime()){f=null}b=this.positionElement.id.replace("date_picker_out","date_picker_in");if(b){b=ta.id(b)}}ta.widgets.calendar.updateDateDisplay(b,f,e);f=this.getPageInDate();if(f){f=f.valueOf()}e=this.getPageOutDate();if(e){e=e.valueOf()}d=d.valueOf();var a=this.isIn?"end":"start";var c=document.getElements(".date_picker_calendar.overlay .calendar .today");var g=document.getElements(".date_picker_calendar.overlay .calendar .day");g.forEach(function(h){var i=h.getAttribute("value");if(i){i=parseInt(i);h=h.getParent();if(h.hasClass(a)){h.className="";h.addClass(a);if(this.isIn&&i<d||!this.isIn&&i>d){h.addClass("invalidPrevSel")}}else{h.className=""}if((this.isIn&&e&&e>=i&&i>=d&&e!=d)||(!this.isIn&&f&&f<=i&&i<=d&&f!=d)){h.addClass("prevSel")}}}.bind(this));c.addClass("today")},updateHoverElem:function(c){if(!this.calendarOverlay){return}var b="msdp_hover";var d=this.calendarOverlay.container.getElement("."+b);var a=ta.retrieve("datepicker_autoadvance")?(this.isIn?"start":"end"):"";if(d){d.removeClass(b);d.removeClass(a)}if(c&&c.getParent()){c.getParent().addClass(b+" "+a)}},updateInputStyling:function(b){var a=this.positionElement.getParent();if(a){b?a.addClass("dualFieldOn"):a.removeClass("dualFieldOn")}},updateNumNights:function(){if(!ta.has("guests_rooms_picker_3.enabled")||!ta.widgets.calendar.hasPageDates()){return}var a=ta.widgets.calendar.getNumberOfNights(),b=$$(".grp-nights-value");if(b&&b.length>0){b.each(function(c){c.set("html",a)});ta.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.nights",a)}},updatePrevNext:function(){var d=this.currentMonth.date;var c=this.options.dualCalendar?this.nextMonth.date:this.currentMonth.date;var g=ta.util.date.inSameMonth(d,this.options.firstDate);var f=ta.util.date.inSameMonth(c,this.options.lastDate);var b=ta.id(getChildByClass(this.container,"prev"));var a=ta.id(getChildByClass(this.container,"next"));if(ta.util.i18n.isRtl()){b=ta.id(getChildByClass(this.container,"next"));a=ta.id(getChildByClass(this.container,"prev"));g=ta.util.date.inSameMonth(c,this.options.lastDate);f=ta.util.date.inSameMonth(d,this.options.firstDate)}var e=this.selectLeftRightButtons();if(g){b.addClass(e.leftInactive).removeClass(e.leftIdle).setStyle("cursor","default")}else{b.addClass(e.leftIdle).removeClass(e.leftInactive).setStyle("cursor","pointer")}if(f){a.addClass(e.rightInactive).removeClass(e.rightIdle).setStyle("cursor","default")}else{a.addClass(e.rightIdle).removeClass(e.rightInactive).setStyle("cursor","pointer")}},updateSelectedDays:function(c,b){this.clearSelectedDays();var a=this.startRangeElem;this.includeElemInRange(a,this.options.selectedHoverClass);if(c.getTime()>this.newInDate.getTime()){this.updateSelectedDaysHelper(a,b.parentNode,true,this.options.selectedHoverClass);this.options.selectionStartClass&&ta.id(a).addClass(this.options.selectionStartClass);this.options.selectionEndClass&&ta.id(b.parentNode).addClass(this.options.selectionEndClass)}else{this.updateSelectedDaysHelper(a,b.parentNode,false,this.options.selectedHoverClass);this.options.selectionStartClass&&ta.id(a).addClass(this.options.selectionEndClass);this.options.selectionEndClass&&ta.id(b.parentNode).addClass(this.options.selectionStartClass)}},updateSelectedDaysHelper:function(e,j,g,h){if(!e||e==j){return}var f="nextSibling";var k="firstChild";if(!g){f="previousSibling";k="lastChild"}var d=false;if(this.isValidDateElem(e[f])){d=e[f]}else{var a=e.parentNode;if(a&&a[f]){d=a[f][k]}else{if(a&&ta.id(a).getParent(".month")){var c=ta.id(a).getParent(".month");if(ta.util.i18n.isRtl()){f=(f=="previousSibling")?"nextSibling":"previousSibling"}var i=c[f];if(!i){return}var b=ta.id(i).getElements("td");if(!g){b.reverse()}b.some(function(m,l){if(this.isValidDateElem(m)){d=m;return true}return false},this)}}}this.includeElemInRange(d,h);this.updateSelectedDaysHelper(d,j,g,h)}})})();ta.widgets.tabContainer=function(d,i){var a=d.getElements(".current");if(a.length!=1){throw new Error("You must have exactly one tab with a class of 'current'.")}else{a=a[0]}var g=a.className.match(/tab(\d+)/);if(g!=null&&g.length>=2){var b=Number(g[1])}else{return}if($("HOMEPAGE")&&window.location.hash){var h=window.location.hash.match(/t(\d)/);if(h&&h.length>0){b=parseInt(h[1]);a.removeClass("current");d.getElements(".tab")[b].addClass("current")}}var c=d.getElements(".tabContainerHead .tab");if(c.length==0){return}var f=d.getElements(".tabContainerBody .tabContent");return new TabSet(c,f,{show:b,onActive:function(l,m,j){var n=m.hasClass("xhr");if(n&&!m.hasClass("xhrComplete")){var e=m.getElement("a").href;if(e){var k=m;j.addEvent("onContentReplaced",function(){k.addClass("xhrComplete")});ta.util.element.replaceContent(l,j,e)}}if(m.hasClass("recordAction")){new Request({url:"/ActionRecord?action="+m.id}).send()}m.addClass("current");if(n&&l){l.stop()}},onBackground:function(j,k,e){k.removeClass("current")}})};ta.widgets.Carousel=new Class({Implements:Options,Binds:["shiftLeft","shiftRight"],options:{width:50,height:50,padding:5,num:7,offset:0,horizontal:true},initialize:function(a,b){this.setOptions(b);this.container=a;this.viewport=this.container.getElement(".viewport");this.leftKnob=this.container.getElement(".shiftLeft");this.rightKnob=this.container.getElement(".shiftRight");this.images=this.viewport.getElements("img");this.offset=this.options.offset;if(this.options.horizontal){this.viewport.setStyles({width:this.options.width*this.options.num+this.options.padding*(this.options.num-1),height:this.options.height})}else{this.viewport.setStyles({width:this.options.width+this.options.padding*2,height:this.options.height*this.options.num+this.options.padding*(this.options.num-1)})}this.leftKnob.addEvent("click",this.shiftLeft);this.rightKnob.addEvent("click",this.shiftRight);this.render()},render:function(){var a=this.offset+this.options.num;for(var b=this.images.length-1;b>=0;b--){if(b<this.offset||b>=a){this.images[b].setStyle("left",-999)}else{if(this.options.horizontal){this.images[b].setStyle("left",(this.options.width+this.options.padding)*(b-this.offset))}else{this.images[b].setStyles({top:(this.options.height+this.options.padding)*(b-this.offset),left:0})}}}if(this.offset==0){this.leftKnob.addClass("disabled")}else{this.leftKnob.removeClass("disabled")}if(this.offset==this.images.length-this.options.num){this.rightKnob.addClass("disabled")}else{this.rightKnob.removeClass("disabled")}},shiftLeft:function(){var a=this.offset;this.offset=Math.max(0,this.offset-this.options.num);if(this.offset!=a){this.render()}},shiftRight:function(){var a=this.offset;this.offset=Math.min(this.offset+this.options.num,this.images.length-this.options.num);if(this.offset!=a){this.render()}}});(function(b){b.util.action={record:function a(i,g,e){var f=null;if(b.util.Deferred){f=new b.util.Deferred()}var h=Object.merge({url:"/ActionRecord",data:{action:i},onSuccess:function(j){if(f){f.resolve(j)}},onFailure:function(j){if(f){f.reject(j)}}},g);e&&(h.trackEvent=e);new Request(h).get();if(f){return f.promise()}},recordPlus:function c(i,g,e){var f=null;if(b.util.Deferred){f=new b.util.Deferred()}var h=Object.merge({url:"/ActionRecordPlus",data:{action:i},onSuccess:function(j){if(f){f.resolve(j)}},onFailure:function(j){if(f){f.reject(j)}}},g);e&&(h.trackEvent=e);new Request(h).get();if(f){return f.promise()}},recordPid:function d(e){new Request({url:"/ActionRecord?pid="+e}).send()}}}(ta));ta.util.partials={requestTimeout:1000,maxDataRequests:12,dataRequestCount:0,incompleteDataRegex:/<\!-- incomplete\: ([\w, ]*) -->/,failedDataRegex:/<\!-- failed\: ([\w, ]*) -->/,partialsErrorRegex:/<\!-- error -->/,noOauthTokenRegex:/<\!-- no Oauth Token -->/,finishedInitialMPASequence:false,_resetPolling:function(){ta.util.partials.dataRequestCount=0},_newSeriesArgs:[],_runNextSeries:function(){var a=ta.util.partials._newSeriesArgs.shift();if(a){ta.util.partials.requestPartials.apply(this,a)}},requestMorePartials:function(a,d,b,c){ta.util.partials._newSeriesArgs.push(arguments);if(ta.util.partials.dataRequestCount===0&&ta.util.partials.finishedInitialMPASequence){ta.util.partials._runNextSeries()}},requestPartials:function(b,e,c,d){if(ta.util.partials.dataRequestCount>ta.util.partials.maxDataRequests||b.length==0){ta.util.partials.finishMPASequence();return}ta.util.partials.dataRequestCount++;if(ta.has("fb.partial.extraJS")){ta.retrieve("fb.partial.extraJS").each(function(g){new Asset.javascript(g)})}if(ta.has("fb.partial.extraCSS")){ta.retrieve("fb.partial.extraCSS").each(function(g){new Asset.css(g)})}var a=ta.remove("facebook.authcode.param");var f=Object.merge({parts:b.join(","),requestUrl:ta.retrieve("page.urlSafe")},e);if(a!=null){f=Object.merge(f,{FBAuthCode:a})}new Request({url:"/MultiPartAjax",method:"post",data:f,keepScripts:true,onRequest:function(){},onSuccess:function(g){ta.util.partials.dataAvailable(e,b,c,d,null,null,g)}}).send()},handlePartialPaging:function(h,e,f){var g=f||{};ta.util.partials.dataRequestCount=0;if(!e||e.href==null){ta.util.error.record(null,"handlePartialPaging elmt.href null:"+e,null,null);return false}/parts=([\w,]+)/.test(e.href);var d=RegExp.$1.split(",");ta.store("partial.event.element",e);ta.store("partial.event.params",f);var c=ta.remove("facebook.authcode.param");var a=Object.merge({requestUrl:ta.retrieve("page.urlSafe")},g);var b=Object.clone(a);if(c!=null){a=Object.merge(a,{FBAuthCode:c})}new Request({url:e.href,method:"post",data:a,keepScripts:true,onSuccess:function(i){ta.store("fb.partial.isHandlePartialPaging",true);ta.util.partials.dataAvailable(b,d,"facebook",false,h,e,i)}}).send();return false},dataAvailable:function(d,j,i,f,o,c,g){if(f){var e=ta.util.partials.dataAvailable.pass([d,j,i,false,o,c,g]);f(e,g,j,d,i,f);return}if(g.match(ta.util.partials.noOauthTokenRegex)){if(ta.remove("fb.partial.isHandlePartialPaging")){ta.support.Facebook.pageDataAvailable(o,c,d,g)}return}if(g.match(ta.util.partials.partialsErrorRegex)){if(ta.has(i+".onPartialsError")){ta.remove(i+".onPartialsError").each(function(p){p()})}return}var m=[];var h=[];if(g.match(ta.util.partials.incompleteDataRegex)){m=RegExp.$1.split(",")}if(g.match(ta.util.partials.failedDataRegex)){h=RegExp.$1.split(",")}if(ta.has(i+".onDataAvail")){ta.remove(i+".onDataAvail").each(function(p){p()})}var n=[];var b=null;var l=/<style[^>]*>([\s\S]*?)<\/style>/gi;while((b=l.exec(g))){n.push(b[1])}if(n.length>0){n=n.join("\n");var k=document.createElement("style");k.type="text/css";document.getElementsByTagName("head")[0].appendChild(k);if(Browser.ie&&Browser.version<11){k.styleSheet.cssText=n}else{k.appendChild(document.createTextNode(n))}}g=g.stripScripts(true);g=g.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi,"");var a=ta.id("PARTIAL_DATA")||new Element("div",{id:"PARTIAL_DATA",styles:{display:"none"}}).inject(document.body);a.adopt(Elements.from(g));setTimeout(function(){ta.util.partials.notifyListeners(j,i,m,h,a,d)},0)},notifyListeners:function(d,e,c,b,a,f){d.each(function(l){var p=e+".data.onAvail."+l;var n=c.contains(l);var k=b.contains(l);var q=ta.remove(p);if(q){for(var o=0,m=q.length;o<m;o++){if(q[o](a,n,k)===false){q[o]=null}}q=q.erase(null);if(n){if(q.length>0){ta.store(p,q)}else{c.erase(l)}}}if(!c.contains(l)&&!k){ta.keep("partials.pageProperties",l)}});var h="partials.data.onPage";var g=ta.remove(h);if(g){g.each(function(i){i()})}if(c.length>0){ta.util.partials.requestPartials.invokeLater(ta.util.partials.requestTimeout,null,[c,f,e])}else{ta.util.partials.finishMPASequence()}},finishMPASequence:function(){if(!ta.util.partials.finishedInitialMPASequence){ta.util.partials.recordGAEvent();ta.util.partials.finishedInitialMPASequence=true}ta.util.partials._resetPolling();ta.util.partials._runNextSeries()},recordGAEvent:function(){var b=ta.remove("partials.pageProperties");if(!b||b.length==0){return}var a="-"+b.sort().join("-")+"-";ta.trackEventOnPage("social","show",a)}};ta.util.partials.handleLightbox=ta.util.partials.handlePartialPaging;if(!ta.util){ta.util={}}ta.util.customEvent={_register:function(a){if(!Element.Events[a]){Element.Events[a]={}}},addListener:function(b,c,a){ta.util.customEvent._register(b);c=ta.id(c);if(c&&c.addEvent){c.addEvent(b,a)}},removeListener:function(b,c,a){c=ta.id(c);if(c&&c.addEvent){c.removeEvent(b,a)}}};ta.support.Facebook={ready:false,queue:[],defaultRequestedPermissions:["email","user_hometown","user_friends","user_likes","user_location","user_status","user_photos"],enqueueForFBReady:function(a){if(ta.support.Facebook.ready){a()}else{ta.support.Facebook.queue.push(a)}},dequeueForFBReady:function(){try{ta.support.Facebook.queue.each(function(b){b()})}catch(a){ta.util.error.record(a,"Error calling dequeueForFBReady")}ta.support.Facebook.queue=[]},ipRevoke:function(a){setTimeout(function(){ta.util.pending.lock("fb.revoke.lb",function(){ta.util.pending.unlock("fb.revoke")})},a)},enqueueForFBAvailable:function(a){if(ta.retrieve("facebook.session.available")){a()}else{ta.keep("facebook.onSessionAvail",a)}},init:function(){if(ta.has("facebook.available")){return}ta.util.pending.multilock("facebook.data.canDisplay",ta.support.Facebook.showData,2);var a=ta.support.Facebook.timing=new ta.support.IPTiming();if(!ta.retrieve("facebook.invalidFBCreds")){ta.support.Facebook.initData(true)}ta.support.Facebook.markAvailable();FB.init({appId:ta.retrieve("facebook.appId"),status:true,cookie:true,xfbml:true,version:ta.retrieve("facebook.apiVersion"),frictionlessRequests:true,oauth:true});ta.support.Facebook.ready=true;ta.support.Facebook.dequeueForFBReady();if(!ta.retrieve("facebook.disableLogin")){if(ta.retrieve("facebook.skip.session.check")=="true"){ta.support.Facebook.sessionAvailable()}else{FB.getLoginStatus(ta.support.Facebook.onLoginStatus)}}else{if(!ta.has("facebookuserid")){ta.support.Facebook.sessionUnavailable()}}},transformToAuthResponse:function(c){var a=ta.retrieve("facebook.authFailed");var d=ta.retrieve("facebook.authSuccess");var b=c.authResponse;if(!b){if(a){a()}return null}if("connected"===c.status){b.uid=ta.store("fb.auth.userId",b.userID);b.token=ta.store("fb.auth.token",b.accessToken);if(d){d()}return b}if(a){a()}return null},onLoginStatus:function(b){var a=ta.support.Facebook.transformToAuthResponse(b);if(a){if(ta.has("cached.facebookuid")&&ta.retrieve("cached.facebookuid")!==""+a.uid){ta.util.error.record(null,"Mismatched Facebook uid between cached value and authResponse. cached: "+ta.retrieve("cached.facebookuid")+", response: "+a.uid);ta.store("facebook.preFailed",true);ta.store("facebook.AuthCode.onAvail.needsReload",function(){window.location.reload()});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a));return}if(ta.retrieve("facebook.invalidFBCreds")&&!ta.retrieve("facebook.signout.process")){ta.store("facebook.AuthCode.onAvail",ta.support.Facebook.sessionAvailable);ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a))}else{ta.support.Facebook.sessionAvailable()}}else{if(!ta.retrieve("facebook.invalidFBCreds")){ta.store("facebook.preFailed",true);setOneTimeCookieOnFQDN("FacebookAuthCode2","NoFBSessionAvailable");new Request({url:"/ActionRecord?action=fb_cached_token_no_session"}).send()}ta.support.Facebook.sessionUnavailable()}},initData:function(a){if(ta.remove("facebook.data.initialRequest.failed")){ta.support.Facebook.loadData({pre:a})}else{ta.util.pending.lock("facebook.data.initialRequest",ta.support.Facebook.loadData.partial({pre:a}))}},loadData:function(b){if(!ta.has("facebook.data.request")){return}ta.support.Facebook.timing.setBeginPartials();var a=ta.retrieve("facebook.data.request");ta.util.partials.requestPartials(a,Object.merge({},b,ta.retrieve("facebook.data.params")),"facebook",ta.support.Facebook.dataAvailable)},receiveCode:function(d){var a=ta.retrieve("facebook.AuthCode.onAvail");if(a!=null){ta.store("facebook.authcode.param",d);setOneTimeCookieOnFQDN("FacebookAuthCode2",d);a()}var c=ta.retrieve("facebook.AuthCode.onAvail.needsReload");if(c!=null){setOneTimeCookieOnFQDN("FacebookAuthCode2","ConflictedFBAccount");if("function"!==typeof c){ta.util.error.record(null,"needsReload was not a function.")}c();return}var b=ta.retrieve("facebook.AuthCode.onAvail.paging");if(b!=null){ta.store("facebook.authcode.param",d);setOneTimeCookieOnFQDN("FacebookAuthCode2",d);b()}},getCodeFromOAuthResponse:function(b){var d=ta.support.Facebook.parseFBSignedRequest(b.signedRequest).code;var c=ta.remove("facebook.taServerTime");var a=c-3600;var e=null;if(d&&!isNaN(a)){e=d.split(".")}if(e!=null&&e.length>3&&!isNaN(e[3])&&e[3]<a){ta.util.error.record(null,"Facebook sending up expired Code: ",null,{code:d,serverTime:c})}return d},parseFBSignedRequest:function(c){if(!c){return null}var a=c.split(".",2);var d=a[1];if(d){var b=ta.util.decoder.base64Decoder(d);try{return JSON.decode(b)}catch(f){ta.util.error.record(null,"couldn't parse Facebook SignedRequest to JSON object after decode ",null,{signedRequest:c,decoded:b})}}else{ta.util.error.record(null,"Facebook SignedRequest TA received doesn't contain data",null,{signedRequest:c})}},preemptiveRegex:/<\!-- PREEMPTIVE RESPONSE -->/,noOauthTokenRegex:/<\!-- no Oauth Token -->/,limitOfTry:4,dataAvailable:function(a,b,c,f,d,e){if(b.match(ta.support.Facebook.preemptiveRegex)&&ta.remove("facebook.preFailed")){return}if(b.match(ta.support.Facebook.noOauthTokenRegex)){delete f.pre;var g=ta.util.partials.requestPartials.partial(c,f,d,e);ta.store("facebook.AuthCode.onAvail",g);ta.support.Facebook.tryRegetOauthToken()}ta.store("facebook.data.handler",a);if(ta.retrieve("facebook.data.isShowDataOnce")){ta.support.Facebook.showData()}else{ta.util.pending.unlock("facebook.data.canDisplay")}},tryRegetOauthToken:function(){var a=ta.retrieve("fb.noOauthToken.counter");if(a==null){a=0}if(a<ta.support.Facebook.limitOfTry){ta.store("fb.noOauthToken.counter",a+1);FB.getLoginStatus(ta.support.Facebook.checkStatusAndGetCode)}},checkStatusAndGetCode:function(b){var a=ta.support.Facebook.transformToAuthResponse(b);if(a){if(ta.has("cached.facebookuid")&&ta.retrieve("cached.facebookuid")!==""+a.uid){ta.util.error.record(null,"Mismatched Facebook uid between cached value and authResponse. cached: "+ta.retrieve("cached.facebookuid")+", response: "+a.uid);ta.store("facebook.AuthCode.onAvail.needsReload",function(){window.location.reload()})}ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a))}},pageDataAvailable:function(e,b,d,a){var c=ta.util.partials.handlePartialPaging.partial(e,b,d);ta.store("facebook.AuthCode.onAvail.paging",c);ta.support.Facebook.tryRegetOauthToken()},showData:function(){ta.remove("facebook.data.handler")();if(!ta.retrieve("facebook.data.isShowDataOnce")){ta.store("facebook.data.isShowDataOnce",true);ta.support.Facebook.timing.recordEndTimes()}},markAvailable:function(){ta.store("facebook.available",true);if(ta.has("facebook.onAvail")){ta.remove("facebook.onAvail").each(function(a){a()})}},sessionAvailable:function(){var a=ta.retrieve("facebook.session.available");ta.store("facebook.session.available",true);ta.support.Facebook.timing.recordLoadTime();if(ta.has("facebook.onSessionAvail")){ta.remove("facebook.onSessionAvail").each(function(b){b()})}if(!a){ta.util.pending.unlock("facebook.data.canDisplay")}ta.support.Facebook.initData(false)},sessionUnavailable:function(){ta.store("facebook.session.available",false);ta.support.Facebook.timing.recordLoadTime();if(ta.has("facebook.onSessionUnavail")){ta.remove("facebook.onSessionUnavail").each(function(a){a()})}$$("#HEAD .FB_login_button").forEach(function(a){a.addEvent("click",function(){new Request({url:"/ActionRecord?action=FBC_Masthead"}).send()})});$$("#WoF_SigninLander .fbcBtnsmall").forEach(function(a){a.addEvent("click",function(){new Request({url:"/ActionRecord?action=WoF_SigninLander"}).send()})})},havePermission:function(b,d,c){var a=ta.retrieve("facebook.permissions");if(a){if(a.indexOf(b)==-1){return c?c():null}return d?d():null}else{FB.api("/me/permissions",function(e){var f=false;e.data.each(function(g){if(g.permission==b&&g.status==="granted"){f=true}});if(f&&d){d()}else{if(!f&&c){c()}}})}},requirePermission:function(a,c,b){ta.support.Facebook.login([a],c,b)},ifLoggedIn:function(b,a){if(ta.retrieve("facebook.session.available")&&b){b()}else{if(a){a()}}},loginButton:function(b,a){ta.support.Facebook.login()},login:function(n,a,e,c,b,l,p){var l=!!l;n=Array.from(n||[]);if(b!=null&&b.length>0){ta.store("facebook.flow",b)}else{ta.store("facebook.flow","FBC")}var f=userLoggedIn?"Connect":"Login";var g=f=="Login"?"":ta.retrieve("facebook.isFBC")=="true"?"Upgrade":"New";var k=(p&&p.pid)||ta.retrieve("facebook.trackingpid");ta.util.cookie.setPIDCookie(k);function d(i,q){return Object.merge({module:i,action:q},k&&{value:k}||{})}ta.util.action.record("FacebookConnect",null,d("social",f+"Attempt"+g));var o=function(){ta.util.cookie.setPIDCookie(k);ta.util.action.record("FacebookConnect",null,d("social",f+"Success"+g));var i={action:f,userType:g};if(a){a(i)}};if(!userLoggedIn||!userFbConnected||c){ta.support.Facebook._doLogin(n,o,e,c,l,p);return}var m=[];for(var j=0;j<n.length;j++){m.push(ta.support.Facebook.havePermission.partial(n[j]))}function h(){if(o){o()}}Function.executeContinuations([ta.support.Facebook.ifLoggedIn].concat(m).concat([h]),ta.support.Facebook._doLogin.partial(n,o,e,l,p))},addEmailLogin:function(b,a){var d={};var c=document.getElement("."+b).get("value");if(!c||!c.match(/.+\@.+\..+/)){document.getElement("."+a).removeClass("hidden");return}if(c){d.email=c}ta.support.Facebook.fbcRegistration(null,null,false,d)},basicLogin:function(d,a,g){if(!ta.support.Facebook.ready){return}var f=function(i){try{var h=ta.support.Facebook.transformToAuthResponse(i);if(!h||!h.token){a&&a(h);return}var j=ta.support.Facebook.getCodeFromOAuthResponse(h);if(j){setOneTimeCookieOnFQDN("FacebookAuthCode2",j);d&&d(h)}else{a&&a(h)}}catch(k){ta.util.error.record(k,"fb.basicLogin callback failed")}};try{var b=g||{scope:ta.support.Facebook.defaultRequestedPermissions.join(",")};FB.login(f,b)}catch(c){ta.util.error.record(c,"fb.basicLogin failed")}},_doLogin:function(c,g,a,f,b,e){var d=f;FB.login(function(i){var h=ta.support.Facebook.transformToAuthResponse(i);if(h&&h.token){ta.support.Facebook.setResultPID();ta.store("facebook.AuthCode.onAvail",function(){ta.store("facebook.uid",h.uid);ta.support.Facebook.fbcRegistration(d,g,b,e)});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(h))}else{if(a){a()}}},{scope:ta.support.Facebook.defaultRequestedPermissions.join(",")})},setResultPID:function(){var a=ta.retrieve("facebook.trackingpid");if(a){ta.util.cookie.setPIDCookie(a)}},fbcRegistration:function(d,g,b,c){var e=!ta.retrieve("facebook.session.available")||!userLoggedIn||!userFbConnected;c||(c={});var a=c.pid;if(d!=null){e=e||d}if(e){var f={flow:ta.retrieve("facebook.flow"),noreload:b};a&&Object.merge(f,{pid:a});ta.store("facebook.session.available",true);ta.store("registration.action","FB_CONNECT");ta.run("ta.overlays.registration.logAndPost",{},f,"FBC-start",Object.merge(c,{action:"FB_CONNECT"}))}if(g){g()}},loginWithFlow:function(a,b){ta.store("facebook.flow",a);ta.support.Facebook.login(null,null,null,b)},logout:function(){FB.logout(function(){window.location.reload()})},logoutNoRefresh:function(a){FB.logout(function(b){userLoggedIn=false;ta.store("facebook.session.available",false);ta.store("facebook.isFBC",false);if(a){a(b)}})},restart:function(){FB.logout(function(){ta.overlays.registration.post({action:"FB_LOGIN"})})},revoke:function(){FB.api({method:"Auth.revokeAuthorization"})},postWall:function(h,f,j,e,c,m,g,d,k,a,i,l,b){FB.ui({method:"feed",message:h,picture:m,link:f,name:j,to:k,caption:e,description:c,display:a,properties:i,actions:[{name:g,link:d}]},function(n){if(n&&n.post_id){if(l){l(n)}}else{if(n&&!n.post_id){ta.util.error.record(null,"Facebook postWall error response from facebook",null,null)}else{if(b){b(n)}}}})},publishStream:function(e,a,g,h,c,f,b,d){FB.login(function(j){var i=ta.support.Facebook.transformToAuthResponse(j);if(i){if(i.token){new Request({url:"/ActionRecord?action=POSTTOWALL_GRANTED"}).send();ta.support.Facebook.postWall(e,a,g,h,c,f,b,d)}}},{scope:"publish_stream"})},loginRequestSpecificPermission:function(b,c,a){FB.login(function(e){var d=ta.support.Facebook.transformToAuthResponse(e);if(d){if(d.token){ta.store("facebook.AuthCode.onAvail",function(){ta.support.Facebook.fbcRegistration(null,c)});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(d))}else{if(a){a()}}}},{scope:b})},loginWithFlowAndRequest:function(b,c,d,a){ta.store("facebook.flow",b);ta.support.Facebook.loginRequestSpecificPermission(c,d,a)},signOutComplete:function(){try{ta.support.Facebook.ifLoggedIn(function(){ta.support.Facebook.logout()},function(){window.location.reload()})}catch(a){ta.util.error.record(a,"signoutAction - fb signout failed");window.location.reload()}},enqueueListenForFBAuthChange:function(a){ta.support.Facebook.enqueueForFBReady(function(){FB.Event.subscribe("auth.statusChange",a)})},googleClick:function(c,a){new Request({url:"/ActionRecord?action=Google404Test&pid="+a}).send();if(c){c.onclick=null}var b=ta.id("GOOG_SORRY");if(b){b.show()}}};ta.support.IPTiming=new Class({initialize:function(){this.active=ta.has("facebook.iptiming");if(this.active){this.timers=ta.retrieve("facebook.iptiming")}else{}},recordLoadTime:function(){if(this.active){this.sendActionRecord("LoadPage",this.timers.loaded-this.timers.started)}},setBeginPartials:function(){if(this.active&&!this.timers.partials){this.timers.partials=new Date().getTime()}},recordEndTimes:function(){if(this.active){var a=new Date().getTime();this.sendActionRecord("GetPartials",a-this.timers.partials);this.sendActionRecord("LoadAll",a-this.timers.started)}},sent:{},sendActionRecord:function(c,a){if(this.sent[c]){return}this.sent[c]=true;a=Math.round(a/1000);var b;if(a<=10){b=a.toString()}else{if(a>10&&a<=15){b="11-15"}else{if(a>15&&a<=20){b="16-20"}else{b="21+"}}}c+="_";c+=ta.retrieve("facebook.session.available")?"IP_":"NonIP_";c+=b+"_"+this.timers.servletName;if(this.timers.firstPage){c+="_FirstPage"}ta.util.action.record(c)}});(function(){window.ta||(window.ta={});window.ta.util||(window.ta.util={});var a=function(b){this.constructor=b};window.ta.util.extend=function(f){var c={};var g,h,e,d,b;for(d=1,b=arguments.length;d<b;d++){h=arguments[d];for(e in h){if(h.hasOwnProperty(e)){c[e]=h[e]}}if(h.hasOwnProperty("constructor")){c.constructor=h.constructor}}g=c.hasOwnProperty("constructor")?c.constructor:function(){return f.apply(this,arguments)};a.prototype=f.prototype;g.prototype=new a(g);g.prototype.__super__=f.prototype;for(e in c){g.prototype[e]=c[e]}return g}}());(function(d){d.fb||(d.fb={});var b=new RegExp(["User is already associated","Permissions error"].join("|"));var a=new RegExp(["Timeline is not activated","Requires extended permission","An unexpected error has occurred","An unknown error has occurred","load-error: unknown","Error validating access token","Object at URL.*requires an object of og:type","Could not retrieve data from URL","^unknown error"].join("|"));var c=/Temporarily Blocked/;d.fb.graph={api:function(i,k,j,g){var f=Array.prototype.slice.call(arguments);var e=d.util.Deferred();k||(k="get");j||(j={});g||(g={});g.recordErrors=(g.recordErrors!==false);(function h(l){FB.api(i,k,j,function(n){if(n&&!n.error){e.resolve(n)}else{var o={name:"None",message:"No FB.api response"};var m="ERROR";if(n&&n.error){o.name=n.error.type;o.message=(typeof n.error==="string")?n.error:n.error.message}if(l&&o.message.match("has og:type of '(?:tripadvisortravelmap|civ)")){j.scrape=true;h(false);return}if(a.test(o.message)){m="WARN"}if(g.recordErrors&&!b.test(o.message)){this.recordError(o,{FB_API_ARGS:f,FB_API_RESPONSE:n,FB_AUTH_RESPONSE:FB.getAuthResponse()},m)}e.reject(o)}}.bind(this))}.call(this,true));return e.promise()},remove:function(f,e){e||(e={});e.method="delete";return this.api("/"+f,"delete",e)},recordError:function(g,h,e){var f="ta.fb.graph.api";if(c.test(g.message)){f+=" blocked feature"}if(d.util.error){d.util.error.record(g,f,null,h,e)}return this}}}(ta));(function(a){a.fb.graph.Base=a.util.extend(Object,{constructor:function b(d,c){this.set(d);this.options=c||{};this.connections||(this.connections={})},set:function(d){for(var c in d){d.hasOwnProperty(c)&&(this[c]=d[c])}return this},api:function(c,f,e){if(!(this.id&&this.accessToken)){var d={name:"Missing auth credentials",message:"Facebook Graph object API calls require an id and access token"};a.fb.graph.recordError(d,{FB_ID:this.id,FB_ACCESS_TOKEN:this.accessToken,FB_API_ARGS:arguments},"WARN");return a.util.Deferred().reject(d)}c||(c="");if(/^\//.test(c)){c=c.slice(1)}e||(e={});e.access_token=this.accessToken;return a.fb.graph.api("/"+this.id+"/"+c,f,e)},getConnection:function(c){if(this.connections[c]){return new a.util.Deferred().resolve(this.connections[c])}return this.api(c).success(function(d){this.connections[c]=d.data;return a.util.Deferred().resolve(d.data)},this)},getClientConnection:function(c){if(!this.connections[c]){this.connections[c]=[];this.connections[c].all=false;this.connections[c].clientCount=0}return this.connections[c]},evictConnection:function(c){if(this.connections[c]){delete this.connections[c]}}})}(ta));ta.fb.graph.Application=ta.util.extend(ta.fb.graph.Base);(function(){ta.fb.openFeedDialog=function(b){var a=new ta.util.Deferred();b||(b={});b.method="feed";FB.ui(b,function(c){if(c&&c.post_id){a.resolve(c)}else{a.reject(c)}});return a.promise()}}());(function(a){a.fb.graph.mixin||(a.fb.graph.mixin={});var e=true;var b=true;var d=new RegExp(["Timeline is not activated","Requires extended permission"].join("|"));var c=300;a.fb.graph.mixin.OpenGraph={recordOpenGraph:function(g){var f=this.options.MapAction;if(f){Math.random()>0.2||f.record(g)}return this},getActions:function(f,g){f=this.options.appName+":"+f;var h=this.getClientConnection(f);if(h.all||(!g&&h.length>h.clientCount)){return a.util.Deferred().resolve(h)}return this.api(f,"get",{offset:h.length,limit:c}).success(function(i){Array.prototype.push.apply(h,i.data);if(!i.paging||(i.paging.previous&&!i.paging.next)){h.all=true}return a.util.Deferred(h)})},publishAction:function(g,j,i,h){if(!(a.retrieve("feature.ogPublish")&&e&&b)){return a.util.Deferred().reject("Publishing open graph actions is disabled.")}var f=this.options.appName;var k=this.options.ref;g=f+":"+g;h||(h={});h[j]=(!(/^http/).test(i)?"http://"+this.options.hostname:"")+i;if(k){h.ref=k+(h.ref?"__"+h.ref:"")}if(!a.retrieve("feature.openGraphLocationTagging")){delete h.place}var l=this.api(g,"POST",h).success(function(m){var o=this.getClientConnection(g);var n={id:m.id,data:{}};n.data[j]={url:h[j]};o.splice(o.clientCount,0,n);o.clientCount++;this.recordOpenGraph("OpenGraph_"+g)},this).failure(function(m){if(d.test(m.message)){e=false}});return l},publishLocatedAction:function(i,h,g,f){f||(f={});f.place=(!(/^http/).test(g)?"http://"+this.options.hostname:"")+g;return this.publishAction(i,h,g,f)},deleteActionsByObject:function(h,j,i){var g=this;if(+i!=i){i=(!(/^http/).test(i)?"http://"+this.options.hostname:"")+i}var k=Array.prototype.each?"each":"forEach";return(function f(l){return g.getActions(h,{next:l}).success(function(r){if(!r.all){return f(true)}var m=a.util.Deferred();var q=[];var p,n,o;for(o=0;o<r.length;o++){p=r[o];n=p.data[j];if(n&&(n.url==i||n.id==i)){q.push(p)}}if(!q.length){return m.resolve()}q[k](function(s){a.fb.graph.api(s.id,"delete").success(function(){q.splice(q.indexOf(s),1);var t=r.indexOf(s);r.splice(t,1);if(t<r.clientCount){r.clientCount--}if(!q.length){m.resolve()}}).failure(function(){m.reject()})});return m.promise()},this)}(false))},scrape:function(f){return a.fb.graph.api("/","post",{id:f,scrape:true})},setPublishState:function(f){e=!!f;b=!!f}}}(ta));(function(a){a.fb.graph.mixin||(a.fb.graph.mixin={});a.fb.graph.mixin.Feed={postLink:function(){},postStatus:function(){},postCheckin:function(){},postPhoto:function(){},postVideo:function(){},postFeed:function(b){return this.api("feed","POST",b)}}}(ta));(function(a){a.fb.graph.User=a.util.extend(a.fb.graph.Base,a.fb.graph.mixin.OpenGraph,a.fb.graph.mixin.Feed)}(ta));ta.fb.graph.User.prototype.inviteFriends=(function(b){var d=50;function a(e,f,i,h,g){var j=e.splice(0,d);g||(g=[]);FB.ui({method:"apprequests",message:f||"",title:i||"",new_style_message:true,to:j.join(",")},function(k){if(k&&k.to&&k.to.length){g.push.apply(g,k.to);if(!e.length){a(e,f,i,h,g)}else{h.resolve(g,k)}}else{h.reject(g,k)}})}return function c(f,g,h){var e=b.util.Deferred();a(f,g,h,e);return e.promise()}}(ta));ta.fb.graph.User.prototype.getAppRequests=function(a){if(!a&&this.appRequests){return ta.util.Deferred().resolve(this.appRequests)}return this.api("apprequests").success(function(b){this.appRequests=b},this)};ta.fb.graph.User.prototype.recordAndDeleteAppRequests=function(d,c,f){var a=this;d||(d=[]);if(!c){var b=window.location.search.match(/[?&](?:ref|fb_source)=([^&]*)/);c=b&&b[1]}function e(h){var j=[];var i=0;var g=ta.util.Deferred();h.each(function(l){var k="";ta.fb.graph.api("/"+l,"get").success(function(m){if(m&&m.from&&m.from.id){k=m.from.id}}).always(function(){ta.fb.graph.api("/"+l,"delete",null,{recordErrors:false});j.push((f?f+"_":"")+"AppRequestId_"+l+"_"+k);i++;if(i==h.length){if(a.options.MapAction&&j.length){a.options.MapAction.record(j.join(",")).success(function(){g.resolve()}).failure(function(){g.reject()})}else{g.resolve()}}})});return g.promise()}if(c=="bookmarks"){return this.getAppRequests().success(function(g){g.data.each(function(h){var i=h.id.split("_")[0];~d.indexOf(i)||d.push(i)})}).always(function(){return e(d)})}return e(d)};(function(a){var b=10000;a.fb.graph.TAUser=a.util.extend(a.fb.graph.User,{locationToOgType:function(c){return/^g(?:eo)?|10004/.test(c)?"city":/^a(?:ttraction)?|10021/.test(c)?"attraction":/^e(?:atery)?|10022/.test(c)?"restaurant":/^h(?:otel)?|^lodging|10023/.test(c)?"hotel":null},pin:function(c,f,m){m||(m={});var k=a.util.Deferred();var e=false;var d,h,i,l;if(c){d=this.locationToOgType(c.type);h=c.url}if(!(d&&c.url&&f&&f.length)){return k.reject()}i=!!(this.location&&this.location.latitude&&this.location.longitude);l=!!(this.hometown&&this.hometown.latitude&&this.hometown.longitude);var j=Array.prototype.each?"each":"forEach";var g=0;f[j](function(o){var q=o=="been"?"pin":o;var p={};var r=false;if(a.retrieve("feature.ogRefContainsFbid")){p.ref="fbid="+this.id}if(q=="pin"){var n={};var s;if(i){n.lat=this.location.latitude;n.lng=this.location.longitude}else{if(l){n.lat=this.hometown.latitude;n.lng=this.hometown.latitude}}s=a.travelmap.util.getDistance(c,n,this.locale);if(s){p.distance=s.value;p.distance_unit=s.unit;p.cur_loc_used=i}}else{if(q=="going"){p.end_time="5000-01-01"}}if(m.suppressFeed||(q=="pin"&&f.length>1)){p.no_feed_story=1}if(m.suppressMap||d!="city"||q=="going"||!c.redistributable||q=="pin"&&f.length>1){r=true}this[r?"publishAction":"publishLocatedAction"](q,d,h,p).failure(function(){e=true}).always(function(){if(++g==f.length){k[e?"reject":"resolve"]()}})},this);return k.promise()},visit:function(e,h,g,d){var c=a.util.Deferred();var f={};var i=h.join(",");f.tags=i;if(g){f["fb:explicitly_shared"]=true}this.publishLocatedAction("visit","city",e,f);return c.promise()},removePin:function(e,j){var c=a.util.Deferred();var d=false;var g,f;if(e){g=this.locationToOgType(e.type);f=e.url}if(!(g&&e.url&&j&&j.length)){return c.reject()}var i=Array.prototype.each?"each":"forEach";var h=0;j[i](function(k){var l=k=="been"?"pin":k;var m={};this.deleteActionsByObject(l,g,f).failure(function(){d=true}).always(function(){if(++h==j.length){c[d?"reject":"resolve"]()}})},this);return c.promise()},removeBadge:function(c){var d=false;var f,e;if(c){var f="badge";var e="/MemberTravelMap?ns=badge&badgeId="+c.id}if(!(f&&e)){return new a.util.Deferred().reject()}return this.deleteActionsByObject("earn",f,e)},rate:function(c){var g="rate";var f="attraction";var e=c.url;var d={};if(a.retrieve("feature.ogRefContainsFbid")){d.ref="fbid="+this.id}return this[c.redistributable?"publishLocatedAction":"publishAction"](g,f,e,d)},review:function(e,h,c){var g="review";var f="";if(e.indexOf("/Attraction")==0){f="attraction"}else{if(e.indexOf("/Hotel")==0){f="hotel"}else{if(e.indexOf("/Restaurant")==0){f="restaurant"}}}var d={title:h,body:c};d["fb:explicitly_shared"]=true;return this.publishAction(g,f,e,d)},earnBadge:function(c,f,i){var h="earn";var g="badge";var e="/MemberTravelMap?ns=badge&badgeId="+c;var d={};if(f){d["fb:explicitly_shared"]=true;e+="&story_type=badge_explicit_og"}if(i){d.no_feed_story=true}return this.publishAction(h,g,e,d)},endorseFriend:function(d,c){var h="endorse";var g="friend";var f="/MemberTravelMap?ns=friend&serial="+d;var e={city:"http://"+this.options.hostname+c};return this.publishAction(h,g,f,e)},updateMap:function(c){this._needToScrapeMap=true;if(this._intervalID&&!c){return a.util.Deferred().resolve()}this._intervalID||(this._intervalID=window.setInterval(this.scrapeMap.bind(this),b));return this.options.MapAction.getTravelMapMetaData().always(function(d){var h="publish";var g="map";var f="/MemberTravelMap?ns=map&uid="+this.options.guid;var e={};if(d&&d.tmTotalDistance){e={total_distance:Math.round(d.tmTotalDistance),distance_unit:d.tmDistanceUnit}}if(a.retrieve("feature.ogRefContainsFbid")){e.ref="fbid="+this.id}if(c){e["fb:explicitly_shared"]=true;f+="&story_type=map_explicit_og"}return this.publishAction(h,g,f,e)},this)},shareMapLink:function(){var c={};c.name=tm.hub.messages.myTravelMap;c.link="http://"+this.options.hostname+"/MemberTravelMap?ns=map&uid="+this.options.guid+"&story_type=map_link";c.picture="http://"+this.options.hostname+"/img2/facebook/dlRecentPinned.jpg";return this.postFeed(c)},scrapeMap:function(c){if(this._needToScrapeMap||c){this._needToScrapeMap=false;return this.scrape("http://"+this.options.hostname+"/MemberTravelMap?ns=map&uid="+this.options.guid)}return a.util.Deferred().resolve()}})}(ta));ta.common.wisdomoffriends={reloadASAP:function(){window.location.reload()},showWelcome:function(){ta.store("wof.showWelcome",true)}};if(!ta.popups){ta.popups={}}ta.popups.PopUtil={windowType:{CHECK_RATE:0,PROV_WIN:1,HOLDING:2,COMMERCE:3,VFM:4,COOKIE:5},taPopunderSlots:null,taPopupSlots:null,taHoldingWindowCap:2,taPopWindowSet:[],taWindowCount:0,maxPopunders:4,hwClosed:false,getAndUpWindowCount:function(){return this.taWindowCount++},tryHoldingWindows:function(a,b){try{var g=true;for(var c=0;c<b;c++){var f=this.launchHoldingWindow(a);if(!f.windowObject){g=false}}if(g){return true}}catch(d){ta.util.error.record(d,"try two hw")}return false},getPopunderSlots:function(){if(this.taPopunderSlots===null){this.taPopunderSlots=new ta.popups.PopunderSlotSet()}return this.taPopunderSlots},getPopupSlots:function(){if(this.taPopupSlots===null){this.taPopupSlots=new ta.popups.PopupSlotSet()}return this.taPopupSlots},createCheckRatesWindow:function(a){return this.buildNewWindow(this.windowType.CHECK_RATE,a)},createHoldingWindow:function(b){var a=this.buildNewWindow(this.windowType.HOLDING,b);if(a&&ta.has("checkrates.belligerent_hw")&&Browser.version>22){ta.store("checkrates.popunder",a)}return a},createVFMWindow:function(a){return this.buildNewWindow(this.windowType.VFM,a)},createCookieConsentWindow:function(a){return this.buildNewWindow(this.windowType.COOKIE,a)},buildNewWindow:function(b,d){var a=new ta.popups.TAPopWindow(b,d);if(!a){return false}if(!a.errorOpening&&!a.errorMoving&&a.windowObject){try{if(ta.has("checkrates.add_holding_windows")&&d.windowHook&&d.windowHook.location&&d.windowHook.location.href.test(/RuleBasedPopunder/)){this.taPopWindowSet.unshift(a)}else{this.taPopWindowSet[this.taPopWindowSet.length]=a}if(!d.windowHook&&b==this.windowType.HOLDING){this.trackPopunder(d.url,this.numPopundersCheck())}return a}catch(c){ta.util.error.record(c,"Window Popup - could not register new window")}}return false},getHoldingWindowSet:function(){var e=[];for(var b=0;b<this.taPopWindowSet.length;b++){var a=this.taPopWindowSet[b];if(a&&a.type==this.windowType.HOLDING){var c=a.windowObject;if(c&&"closed" in c){if(!c.closed){e[e.length]=a}else{if(ta.has("checkrates.add_holding_windows")&&c.closed){this.hwClosed=true;var d=window.cookieDomain;if(d){Cookie.write("CommercePopunder","SuppressAll",{domain:d,duration:0})}}}}}}return e},attemptHoldingWindowFromGeoCR:function(){},attemptHoldingWindowWNumChecked:function(){},openCloseTab:function(){var c,d;if(ta.has("popunder.popunder_by_self_closing_tab")){try{d=document.createElement("a");d.href="http://"+window.location.hostname+"/vpages/tab.html";document.body.appendChild(d);c=document.createEvent("MouseEvents");c.initMouseEvent("click",false,true,window,0,0,0,0,0,true,false,false,true,0,null);d.dispatchEvent(c);d.parentNode.removeChild(d)}catch(h){ta.util.error.record(h,"self-closing tab blur method failed")}}else{if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){try{d=document.createElement("a");d.href="about:blank";d.target="popunderwindowhelper";document.body.appendChild(d);c=document.createEvent("MouseEvents");var f=true;var b=true;c.initMouseEvent("click",f,b,window,0,0,0,0,0,true,false,false,true,0,null);d.dispatchEvent(c);d.parentNode.removeChild(d);window.open("about:blank","popunderwindowhelper").close()}catch(h){ta.util.error.record(h,"shift-ctrl blur method failed")}}else{var a=ta.retrieve("checkrates.popunder");if(ta.has("checkrates.belligerent_hw")&&a&&Browser.version>22){var g=window.open("about:blank");if(g){g.close()}ta.remove("checkrates.popunder");try{if(a.windowObject&&a.isTAWindow()){a.moveBehindMain(a.windowObject)}}catch(h){ta.util.error.record(h,"holding window blur")}}}}},attemptHoldingWindow:function(a){if(this.useShiftClick()){return}if(ta.has("checkrates.add_holding_windows")){var b=this.numPopundersCheck();if(b>=this.maxPopunders){return}else{this.launchHoldingWindow(a)}}else{if(this.taHoldingWindowCap>this.getHoldingWindowSet().length){this.launchHoldingWindow(a)}}},launchHoldingWindow:function(a){if(!a){return false}var b=ta.retrieve("checkrates.holdingWindowURI");if(ta.has("checkrates.avlb_popup_win")){b="http://"+window.location.hostname+"/AlsoViewedLB?checkRatesType=checkRates&avlbType=popup&d="+a}if(b){ta.store("checkrates.HWtracking","date");var c={url:b};return this.createHoldingWindow(c)}return false},launchAddHoldingWindow:function(c,a){var b=a||{};b.url=c;return this.createHoldingWindow(b)},popunderReminder:function(b){var a={windowHook:b};this.createHoldingWindow(a)},numPopundersCheck:function(){try{var f=this.getHoldingWindowSet();var b=0;var a=new Cookie("CommercePopunder").readRaw();var d=a?a.match(/\d+/):null;if(!a||!d){b=f.length}else{b=Math.max(f.length,parseInt(d[0],10))}return b}catch(c){ta.util.error.record(c,"CommercePopunder - numPopundersCheck")}},trackPopunder:function(i,h){try{if(!h||!i){return}var c="CommerceEnhancedPopunder";if(i.match(/AlsoViewedLB/)){c="AlsoViewedLB"}else{var a=i.match(/RuleBasedPopunder\?Rule=\d+/);if(a){var d=a[0].match(/\d+/);c="RuleBasedPopunder_"+d[0]}}var b="OpenWindow";var g=ta.retrieve("checkrates.HWtracking");if(g){b="OpenWindow_"+g;ta.remove("checkrates.HWtracking")}ta.trackEventOnPage("CommercePopunder",b,c,h,true)}catch(f){ta.util.error.record(f,"CommercePopunder - trackPopunder")}},trackPopup:function(f){try{if(!f){return}var b="DHTMLOverlay";var g=f.match(/RuleBasedPopup/);if(g){var a=f.match(/Rule=\d+/);if(a){var c=a[0].match(/\d+/);b="RuleBasedPopup_"+c[0]}}ta.trackEventOnPage("Popup","OpenPopup",b,1,true)}catch(d){ta.util.error.record(d,"Popup - trackPopup")}},hasMTPU:function(){try{var c=false;var f=this.getHoldingWindowSet();for(var a=f.length;a--;){var b=f[a].windowObject;if(b&&b.location.href.match(/RuleBasedPopunder/)){c=true;break}}return c}catch(d){ta.util.error.record(d,"CommercePopunder - hasMTPU")}},getProviderWindowDims:function(a,d){var b=null;var f=null;var e=null;var c=null;if(a=="hotels.com"){b=975}if(screen.width>=1280){b=1000;f=897;if(!d){e=0;c=0;if(Browser.chrome){f-=50}else{if(Browser.firefox){f-=87}else{if(Browser.ie){b-=12;f-=179}}}}}return{customWidth:b,customHeight:f,widthOffset:e,heightOffset:c}},useShiftClick:function(){if(ta.has("checkrates.chrome_provider_on_shift_click")){var b=this.getProviderWindowDims();var a=66;if(((window.outerHeight>b.customHeight)||(window.outerWidth>b.customWidth))&&((window.outerHeight<(screen.height-a))&&(window.outerWidth<(screen.width-a)))){ta.store("checkrates.use_chrome_provider_on_shift_click",true);return true}}if(!ta.has("checkrates.cr_provider_on_mousedown")){ta.remove("checkrates.use_chrome_provider_on_shift_click")}return false},expandSidebarWindow:function(c,a,b){if(ta.trackEventOnPage){ta.trackEventOnPage("traffic_acquisition_sidebar","any",a,1)}if(b=="true"){window.moveTo(0,0);window.resizeTo(screen.width,screen.height)}document.getElementById("SliderHolder").style.display="none";document.getElementById("PAGE").style.marginLeft="0px"},cookieSettingsPanel:function(d){if(d){d.stop()}var a={};a.en=451;a.en_UK=834;a.en_IE=835;a.en_ZA=2635;a.sv=720;a.no=721;a.da=1199;a.fr=1197;a.fr_BE=6409;a.fr_CH=6410;a.de=1201;a.de_AT=2719;a.de_CH=6431;a.el=1198;a.it=1202;a.it_CH=6432;a.es=1200;a.pl=1208;a.nl=1209;a.nl_BE=6411;a.fi=2968;a.hu=3049;a.cs=3128;a.sk=3233;a["default"]=451;var b;if(posLocale in a){b="http://info.evidon.com/pub_info/"+a[posLocale]+"?v=1&nt=0"}else{b="http://info.evidon.com/pub_info/"+a["default"]+"?v=1&nt=0"}var c={customWidth:830,customHeight:620,name:"Cookie Consent Tool",url:b,scrollbars:1,menubar:0,toolbar:0,left:0,top:0};ta.popups.PopUtil.createCookieConsentWindow(c)},newWindowFromExitPop:function(b,a){var c=window.open(a,"_blank","height="+screen.height+",width="+screen.width+",toolbar=yes,menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes");if(window.focus){c.focus()}},pollForPartnerLoad:function(a,b,c,d){if(a){setTimeout(function(){var g=null;var f=new Date().getTime()-b.getTime();try{g=a.document}catch(h){}if(!g){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_LOADED",(window.pageServlet||"")+"|"+(d||"")+"|"+(c||""),f)}else{if(f>20000){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_TIMEOUT",(c||""),f)}else{if(a.closed){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_CLOSED",(c||""),f)}else{ta.popups.PopUtil.pollForPartnerLoad(a,b,c,d)}}}},100)}},extractSlotFromCommerceUrl:function(b){if(!b){return 0}var a=b.match("[&|\\?]slot=([^&]*)");return a?a[1]:0},redirectToUrl:function(a,c){if(a){if(ta.retrieve("commerce_history_injection.enabled")&&a.history&&a.history.pushState){try{a.history.pushState({fromBackClick:true},"",window.location.href);ta.trackEventOnPage("COMMERCE_HISTORY_INJECT","history_injected","")}catch(b){ta.util.error.record(b,"commerce history injection failed",null,null,"WARN")}}a.location=c}else{window.location=c}},maximizeWindow:function(){window.moveTo(0,0);window.resizeTo(screen.availWidth,screen.availHeight)},beforePopTargetBlankIE:function(c){var b,d,a;if(!c||!c.href){return true}b=ta.id(c);if(!b||!b.getProperty||b.getProperty("target")!=="_blank"){return true}if(!ta.browser||!ta.browser.isIE10Metro()){if(ta.browser&&!ta.browser.isIE9orHigher()){a=window.getSize();if(a){d=window.open(c.href,"_blank","location=yes,resizable=yes,menubar=yes,scrollbars=yes,toolbar=yes,width="+a.x+",height="+a.y)}}else{d=window.open(c.href,"_blank")}}if(!d||d.closed||typeof d.closed==="undefined"){b.removeProperty("target");if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38821)}return true}else{return false}},attemptOpenUrlNewTab:function(b){var c;if(!ta.browser||!ta.browser.isIE10Metro()){if(ta.browser&&window.isIE&&!ta.browser.isIE9orHigher()){var a=window.getSize();if(a){c=window.open(b,"_blank","location=yes,resizable=yes,menubar=yes,scrollbars=yes,toolbar=yes,width="+a.x+",height="+a.y)}}else{c=window.open(b,"_blank")}}if(!c||c.closed||typeof c.closed==="undefined"){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38821)}window.location=b;return false}return c}};ta.popups.TAPopWindow=new Class({Implements:Options,options:{name:"TAWin",url:"",windowHook:false,customWidth:false,customHeight:false,toolbar:1,location:1,directories:1,status:1,menubar:ta.browser.isIE9orHigher()?0:1,resizable:1,copyhistory:1,scrollbars:1,alwaysRaised:false,alwaysLowered:false,widthOffset:8,heightOffset:164,delayLoad:false},initialize:function(g,j){var c,i,b;this.setOptions(j);this.type=g;this.assignSlot();if(this.options.customWidth){this.width=this.options.customWidth}if(this.options.customHeight){this.height=this.options.customHeight}if(this.options.widthOffset!=null){this.widthOffset=this.options.widthOffset}if(this.options.heightOffset!=null){this.heightOffset=this.options.heightOffset}if(this.options.delayLoad){this.delayLoad=this.options.delayLoad}if(this.options.windowHook){this.windowObject=this.options.windowHook;if(!ta.has("checkrates.add_holding_windows")){this.windowObject.refresh()}return true}if(ta.has("checkrates.chrome_dates_entry_holding")){this.options.scrollbars=0}this.url=this.options.url;this.assignWinArgs();try{if(this.type==ta.popups.PopUtil.windowType.HOLDING){ta.util.cookie.setPIDCookie(28962)}if(Browser.chrome&&this.options.inTab){var f=Math.random().toString(36).substring(7);if(this.options.popunder){c=document.createElement("a");c.href=this.url;c.target=f;document.body.appendChild(c);i=document.createEvent("MouseEvents");i.initMouseEvent("click",false,true,window,0,0,0,0,0,true,false,false,true,0,null);c.dispatchEvent(i);c.parentNode.removeChild(c);this.windowObject=window.open(this.url,f);return}else{this.windowObject=window.open(this.url,f);return}}if(ta.has("checkrates.use_chrome_provider_on_shift_click")){c=document.createElement("a");c.href=this.url;document.body.appendChild(c);i=document.createEvent("MouseEvents");i.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,true,false,0,null);this.windowObject=c.dispatchEvent(i);c.parentNode.removeChild(c)}else{if(this.type==ta.popups.PopUtil.windowType.HOLDING&&ta.has("popunder.popunder_by_self_focus")){window.open("javascript:window.focus()","_self","")}var a=Browser.chrome&&Browser.version>31;if(a){this.windowObject=window.open("","_blank")}else{if(this.options.popunder){if(Browser.ie8||Browser.ie9||Browser.ie10||Browser.ie11){this.windowObject=window.open("pages/blank.html","_blank",this.winArgs);window.document.focus()}else{if(Browser.safari&&Browser.Platform.name!=="ios"){this.windowObject=window.open("","_blank",this.winArgs);if(this.windowObject){var h=window.open("","_blank");h.close()}window.focus()}else{if(Browser.firefox){this.windowObject=window.open("","_blank",this.winArgs);window.open("","_self","");window.focus()}else{this.windowObject=window.open("","_blank",this.winArgs)}}}}else{this.windowObject=window.open("","_blank",this.winArgs)}}b=this.windowObject;if(b&&this.isTAWindow()){if(this.type==ta.popups.PopUtil.windowType.CHECK_RATE){ta.popups.PopUtil.pollForPartnerLoad(b,new Date(),this.options.name,ta.popups.PopUtil.extractSlotFromCommerceUrl(this.options.url))}if(!this.delayLoad){ta.popups.PopUtil.redirectToUrl(this.windowObject,this.url)}}else{if(!b&&Browser.ie&&this.type===ta.popups.PopUtil.windowType.CHECK_RATE&&this.url&&ta.has("ta.ie_commerce_popup_block_fix")){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38822)}window.location=this.url}}}}catch(d){this.errorOpening=d;ta.util.error.record(this.errorOpening,"pop window opening failure",null,{type:this.type,url:this.url})}try{b=this.windowObject;if(b&&this.isTAWindow()){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.moveBehindMain(b)}}}catch(d){this.errorMoving=d;ta.util.error.record(this.errorMoving,"popunder window moving",null,{type:this.type,url:this.url})}},repurpose:function(d,b,f){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.type=ta.popups.PopUtil.windowType.CHECK_RATE;this.slot.occupied=false;this.assignSlot();this.url=d;if(b){this.width=b;this.options.widthOffset=0}if(f){this.height=f;this.options.heightOffset=0}var a=this.windowObject;if(a&&this.isTAWindow()){try{if(!this.options.inTab){a.moveTo(0,0);a.resizeTo(this.width+this.options.widthOffset,this.height+this.options.heightOffset);a.moveTo(this.x,this.y)}if(!this.delayLoad&&!this.options.keepFocus){a.focus()}if(!this.delayLoad){a.location=this.url}}catch(c){ta.util.error.record(this.errorMoving,"repurpose popunder fail",null,{type:this.type,url:this.url})}}return this}return false},assignWinArgs:function(){this.winArgs="toolbar="+this.options.toolbar;this.winArgs+=",location="+this.options.location;this.winArgs+=",directories="+this.options.directories;this.winArgs+=",status="+this.options.status;this.winArgs+=",menubar="+this.options.menubar;this.winArgs+=",resizable="+this.options.resizable;this.winArgs+=",copyhistory="+this.options.copyhistory;this.winArgs+=",scrollbars="+this.options.scrollbars;this.winArgs+=",width="+this.width;this.winArgs+=",height="+this.height;this.winArgs+=",left="+this.x;this.winArgs+=",top="+this.y;this.winArgs+=",screenx="+this.x;this.winArgs+=",screeny="+this.y;if(this.options.alwaysRaised){this.winArgs+=",alwaysRaised"}if(this.options.alwaysLowered){this.winArgs+=",alwaysLowered"}},assignSlot:function(){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.slot=ta.popups.PopUtil.getPopunderSlots().getOpenSlot();this.width=this.slot.tw;this.height=this.slot.th;this.x=this.slot.tx;this.y=this.slot.ty}else{this.slot=ta.popups.PopUtil.getPopupSlots().getOpenSlot();this.width=this.slot.w+this.options.widthOffset;this.height=this.slot.h+this.options.heightOffset;this.x=this.slot.x;this.y=this.slot.y}this.slot.occupied=this},moveBehindMain:function(c){if(!ta.has("popunder.popunder_by_self_focus")||ta.has("popunder.popunder_by_self_focus_shift_ctrl")){if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){ta.popups.PopUtil.openCloseTab()}else{if(ta.has("checkrates.chrome_dates_entry_holding")&&!(ta.has("checkrates.belligerent_hw")&&Browser.version>22)){try{var a=window.open("about:blank");if(a){a.focus();a.close()}}catch(b){ta.util.error.record(b,"holdingWindow - Chrome blur failed")}}}}c.blur();c.opener=self;c.moveTo(this.slot.x,this.slot.y);c.resizeTo(this.slot.w,this.slot.h);if(!this.delayLoad){c.location=this.url}window.focus();if(!document.activeElement.hasClass("globalNav2011_reset")){ta.trackEventOnPage("checkrates","no_focus_on_main",Browser.version,1)}},isTAWindow:function(){var c=true;try{var a=this.windowObject.location;this.windowObject.status="";if(a===null||a===""){c=false}}catch(b){c=false}return c}});ta.popups.Slot=new Class({initialize:function(c,b,d,a){this.x=c;this.y=b;this.w=d;this.h=a;this.occupied=null}});ta.popups.SlotSet=new Class({initialize:function(){this.nW=525;this.nH=460;this.nXI=24;this.nYI=24;this.totalSlots=20;this.slots=[];try{if(screen.width>1024){this.nW=800;this.nH=600;this.nXI=80;this.nYI=40}else{if(screen.width>800){this.nW=620;this.nH=500;this.nXI=60;this.nYI=30}}}catch(a){this.error=a;ta.util.error.record(this.error,"slot set",null,{"slot set":"general"})}},getUsedCount:function(){var b=0;if(this.slots){for(var a=0;a<this.slots.length;a++){if(this.slots[a].occupied&&!this.slots[a].occupied.closed){b++}}}return b},getOpenSlot:function(f){if(!f||f<0||f>this.totalSlots){f=0}var d=function(l){try{var h=false;var j=false;try{j=this.slots[l].occupied}catch(k){}if(!j){h=true}else{try{var g=j.windowObject;if(!g||g.closed){h=true}}catch(k){h=true}}}catch(k){ta.util.error.record(k,"get open slot - get pop slot",null,{totalSlots:this.totalSlots,slotNumber:l})}if(h){this.slots[l].occupied=null;var i=this.slots[l];i.slotPos=l;return i}return false}.bind(this);try{for(var a=f-1;a>=0;a-=1){var c=d(a);if(c){return c}}for(var a=f;a<this.slots.length;a++){var c=d(a);if(c){return c}}}catch(b){ta.util.error.record(b,"get open slot",null,{totalSlots:this.totalSlots})}return false}});ta.popups.PopunderSlot=new Class({Extends:ta.popups.Slot,initialize:function(b,i,d,f,c,a,e,g){this.parent(b,i,d,f);this.tx=c;this.ty=a;this.tw=e;this.th=g}});ta.popups.PopupSlotSet=new Class({Extends:ta.popups.SlotSet,initialize:function(){this.parent();this.nX=500;var b=1160;try{if(screen.width<1660){if(screen.width>1024&&screen.width<1280){b=960}else{if(screen.width<=1024){b=740}}this.nX=screen.width-b}this.nY=!isNaN(window.screenTop)?window.screenTop:!isNaN(window.screenY)?window.screenY:0}catch(c){this.error=c;this.nY=0;ta.util.error.record(this.error,"slot set",null,{"slot set":"popup"})}for(var a=0;a<this.totalSlots;a++){this.slots[a]=new ta.popups.Slot(this.nX,this.nY,this.nW,this.nH);this.nX=this.nX+this.nXI;this.nY=this.nY+this.nYI}}});ta.popups.PopunderSlotSet=new Class({Extends:ta.popups.PopupSlotSet,initialize:function(){this.parent();try{this.nX=(window.screenLeft||window.screenX);this.nY=(window.screenTop||window.screenY)}catch(b){this.error=b;this.nX=200;this.nY=200}this.w=1;this.h=1;this.x=5000;this.y=5000;this.totalSlots=4;try{if(Browser.ie7){this.w=250;this.h=100}if(Browser.safari||Browser.chrome){this.w=85;this.h=100}if(typeof(this.nX)=="undefined"){this.nX=0;this.nY=0;this.x=this.nX+window.screen.availWidth-this.w;this.y=this.nY+window.screen.availHeight-this.h}else{this.x=this.nX+window.getWidth()-this.w;this.y=this.nY+window.getHeight()-this.h}if(Browser.ie7){this.y=this.y-95;this.x=this.x+13}else{if(Browser.safari||Browser.chrome){this.y=this.y-16}}}catch(b){this.error=b}if(this.error){ta.util.error.record(this.error,"slot set",null,{"slot set":"popunder"})}for(var a=0;a<this.totalSlots;a++){this.slots[a]=new ta.popups.PopunderSlot(this.nX,this.nY,this.nW,this.nH,this.x,this.y,this.w,this.h);this.nX=this.nX+this.nXI;this.nY=this.nY+this.nYI}}});window.setupLazyLoad=function(){var a=new LazyLoad({range:200},lazyImgs,lazyHtml);return a};var LazyLoad=new Class({Implements:[Options,Events],options:{range:200,fireScroll:true,mode:"vertical"},initialize:function(n,l,o){this.setOptions(n);this.container=window;var b=(this.options.mode=="vertical"?"y":"x");this.containerDimension=this.container.getSize()[b];this.start=0;var k=this.containerDimension+this.options.range;var j=ta.retrieve("ta.commerce.obf");if(j){try{var h=j.given.split("");var f=j.replace.split("");var d=j.token}catch(i){ta.util.error.record(i,"obfuscation object corrupted")}}var m=0;this.htmlBlocks=o.filter(function(r){var q=ta.id(r.id);if(q&&(q.getPosition()[b]>k&&r.scroll)){m++;return true}else{if(q){try{var u=r.data.indexOf(d);if(j&&u==0){var s=r.data.substr(d.length).split("");for(var p=s.length;p--;){var t=s[p];var u=f.indexOf(t);if(u!=-1){s[p]=h[u]}}q.innerHTML=s.join("")}else{q.innerHTML=r.data}}catch(v){ta.util.error.record(v,"lazy html",null,{id:r.id})}return false}else{return false}}},this);var c=0;this.images=l.filter(function(p){var e=ta.id(p.id);if(e){e.oSRC=p.src||p.data;e.priority=p.priority||1000;if(p.logerror){e.onerror=function(){ta.util.error.record(new Error("lazy img did not load from "+e.src),null,null,null,"WARN")}}if((!e.isVisible()||e.getPosition()[b]>k)&&p.scroll){c++;return true}else{ta.queueLazyImg(e);return false}}else{return false}},this);ta.processLazyImages();var a=function(e){var p=this.getScroll();if(e=="force"||p>this.start){this.load();this.start=p}this.fireEvent("scroll");if(!this.images.length){this.container.removeEvent("scroll",a);this.fireEvent("complete")}}.bind(this);this.load=function(){this.htmlBlocks=this.htmlBlocks.filter(function(q){try{var p=ta.id(q.id);if((p&&p.getPosition&&((this.getScroll()+this.options.range+this.containerDimension)>=p.getPosition()[b]))||(p&&!p.getPosition)){p.innerHTML=q.data;return false}}catch(r){ta.util.error.record(r,"lazy",null,{id:q.id})}return true},this);this.images=this.images.filter(function(q){try{var p=ta.id(q.id);if((p&&p.getPosition&&((this.getScroll()+this.options.range+this.containerDimension)>=p.getPosition()[b]))||(p&&!p.getPosition)){ta.queueLazyImg(p);return false}}catch(r){ta.util.error.record(r,"lazy",null,{src:q.src})}return true},this);ta.processLazyImages()}.bind(this);var g=function(){var e=this.container.getSize()[b];if(e>this.containerDimension){this.containerDimension=e;this.load()}}.bind(this);this.container.addEvent("scroll",a);this.container.addEvent("resize",g);if(this.options.fireScroll){this.container.fireEvent("scroll")}},getScroll:function(){if(this.container&&this.container.getScroll){return this.container.getScroll()[this.options.mode=="vertical"?"y":"x"]}else{return 9000}}});var TypeAhead=(function(g){var N={minChars:1,search:null,itemTemplate:function(S){return S&&S.value},listTemplate:function(T){var S=T.results?T.results:T;return'<div class="typeahead-choices">'+S.map(function(V,U){return'<div class="typeahead-choice">'+V.rendered+"</div>"}).join("")+"</div>"},errorTemplate:function(S){return'<div class="message">'+S+"</div>"},resolveSelection:function(S){return S&&S.value},equal:function(T,S){return T.value==S.value},shouldSubmit:function(){return true},eligibleForHistoryInjection:function(S){return(S.data_type=="LOCATION")},shouldReplaceHistoryItem:function(S){return true},getHistoryMatchingKey:function(S){return S.value},validator:null,containerClass:"typeahead-container",itemSelector:".typeahead-choice",errorClass:"error",defaultTextClass:false,defaultValue:null,width:true,showOnFocus:true,onUserFocus:null,autoSelectFirst:false,selectOnBlur:true,assumeOnBlur:true,onUserBlur:null,restoreOnFocus:false,cycleInput:true,autopopulateHighlighted:true,selectInputText:true,onSelect:null,onRestore:null,onSync:null,onRender:null,onShow:null,onHide:null,onError:null,nextField:null,offsetY:0,offsetX:0,syncro:null,containerParent:document.body,positionRelative:false,unselectOnEscape:false,cacheResults:false,autoHighlightFirst:false,ignoreKeysWhenInvisible:false,name:"unknown",geoId:undefined,startEventOn:"focus",queryLengthLimit:100,postResultsFnList:null,showHistory:false,integrateHistory:false,highlightHistory:false,recentHistory:[],maxHistoryItems:5,historyTypes:["geo","eatery","hotel","attraction"],historyLinkType:"url",historyPredicate:null,minHistoryChars:null,historySort:null,jpFirefoxIME:false,jpFirefoxIMEInterval:500,clearDefaultTextOnFocus:true,focusOnCreation:false,searchParams:null,errorOnSearchFailure:"error",enableQueryDelay:false,doSelectionBeforeLogging:false,suggestedItems:[],showSuggested:false,maxSuggestedItems:5},P=8,L=9,F=13,q=16,m=17,o=18,D=20,p=27,x=37,M=38,B=39,C=40,y=46,z=91,e="click",s="enter",t="tab";var a=function(S){return(S&&S.searchSessionId)?S.searchSessionId:"no_search_session_id"};var H=function(T){var S=ta.util.Deferred();var V=this.getSearchParams();var U=this;V.query=T;V.action="API";V.uiOrigin=this.options.name;V.source=this.options.name;V.startTime=this.options.startTime;V.searchSessionId=a(this.options);new ta.util.ajax({method:"GET",url:"/TypeAheadJson",data:V}).always(function(W){if(W){S.resolve(W)}else{S.reject(U.options.errorOnSearchFailure)}});return S.promise()};var j=function(U){var S=0;for(var T=this.source.value.length-1;T>=0;T--){S++;var V=this.source.value.charCodeAt(T);if((V>=19968&&V<=40959)||(V>=12352&&V<=12543)||(V>=44032&&V<=55295)){S++}if(!U&&S>=this.options.minChars){return true}}return U?S:false};var d=function(){var S=this.source;if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus!==true){window.setTimeout(function(){S.setSelectionRange(0,0)},0)}};var l=function(S){if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus!==true){g.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}if(this.options.startEventOn==="type"){n.call(this)}if(this.options.ignoreKeysWhenInvisible&&!this.visible){return}switch(S.keyCode){case F:S.preventDefault();S.stopPropagation();if(this.selectedIndex>=0){this.select(true,s);A.call(this)}else{if(this.options.assumeOnBlur&&this.results&&this.results.length){if(typeof this.options.assumeOnBlur=="function"){this.setSelectedIndex(this.options.assumeOnBlur(this))}else{this.setSelectedIndex(0)}O.call(this);this.select(true,s);A.call(this)}if(this.options.shouldSubmit()){if(!this.options.validator||this.options.validator(S)){if(this.options.onSubmit){this.options.onSubmit(this)}this.abortSearch();this.hide();this.source.form.submit()}}}break;case C:this.highlightNextChoice();S.preventDefault();S.stopPropagation();break;case M:this.hightlightPreviousChoice();S.preventDefault();S.stopPropagation();break;case p:this.restore();this.hide();break;case L:this.tabPressed=true;break}if(this.options.onKeyDown){this.options.onKeyDown(S,this)}};var K=function(S){setTimeout(I.bind(this),0)};var c=function(S){if(S){switch(S.keyCode){case L:case q:case m:case o:case D:case x:case M:case B:case C:case z:case F:case p:return}}I.call(this)};var i=function(){var S=this.source.value;if(this.intervalHandler){window.clearTimeout(this.intervalHandler)}if(!this.options.enableQueryDelay||this.lastQueryTime+500<=new Date().getTime()){this.intervalHandler=null;this.search()}else{this.intervalHandler=setTimeout(function(){if(!this.aborted&&this.source.value===S){this.search()}}.bind(this),300)}};var w=function(){var S=this.results&&this.results.length===0;return !this.hasDefaultText()&&j.call(this)&&this.source.value!==this.query&&(this.selectedIndex<0||!this.results||S||this.source.value!==this.results[this.selectedIndex].value)};var I=function(){if(!w.call(this)&&j.call(this,true)<this.options.minChars){this.selected&&g.removeClass(this.selected,"selected");g.removeClass(this.source,this.options.errorClass);this.results=null;this.error=null;this.setSelectedIndex(-1);this.selected=null;this.query=null;this.historyShown=false;var S=this.source&&(!this.source.value||G(this.source.value).trim().length==0);if((this.shouldShowHistory()||this.shouldShowSuggested())&&(S||this.hasDefaultText())){this.showHistoryIfEnabled();this.showSuggestedIfEnabled()}else{this.hide()}}else{i.call(this,this.query)}};var J=function(S){if(!(this.results&&this.results.length)){return}this.setSelectedIndex(this.selectedIndex+S);if(this.selectedIndex>=this.results.length){this.setSelectedIndex(this.options.cycleInput?-1:0)}else{if(this.selectedIndex<(this.options.cycleInput?-1:0)){this.setSelectedIndex(this.results.length-1)}}O.call(this)};var O=function(){this.selected&&g.removeClass(this.selected,"selected");if(-1===this.selectedIndex){this.selected=null;this.options.autopopulateHighlighted&&this.query&&(this.source.value=this.query);this.options.selectInputText&&this.source.select(false)}else{this.selected=this.items[this.selectedIndex];g.addClass(this.selected,"selected");this.options.autopopulateHighlighted&&this.results&&(this.source.value=this.options.resolveSelection(this.results[this.selectedIndex]))}};var f=function(U,T){if(!T){return false}for(var S=0;S<T.length;++S){var V=T[S];if(V&&V.match(U)){return true}}return false};var v=function(Z,aj,ab,ah,X,ag,Y,af,ak,ac,U,ad,ae,S,aa,W,V){var ai={uiOrigin:ak,global:af<=1,scope:af>1?af:undefined,fromHistory:ad,hadHistory:ae,type:aa.type,value:aj,indexInType:aa.indexInType?aa.indexInType:0,tagId:aa.tagId?aa.tagId:0,eventType:Z,source:ak,startTime:ac,action:"RECORD",selDepth:ab,totalNum:ah,userInteractionType:ag,errors:Y,query:U,dataType:aa.data_type,url:aa.url,searchSessionId:V};if(S){ai=S(ai,aa)}var T;if(typeof X==="function"){if(W){X()}else{T=function(){ta.addTypeAheadDebugMevt(ai);X()}}}new Request({method:"GET",url:"/TypeAheadJson",data:ai,onSuccess:T,onFailure:T}).send()};var n=function(){if(!this.startNotificationSent){this.startNotificationSent=true;var S=new Date();this.options.startTime=S.getTime()+(S.getTimezoneOffset()*60*1000);var T=this.options.geoId;var U=this.options.name;new Request({method:"GET",data:{action:"RECORD",eventType:"start",uiOrigin:this.options.name,startTime:this.options.startTime,source:U,linkedTypeAhead:this.options.linkedTypeAhead?this.options.linkedTypeAhead.options.startTime:void 0,global:T?false:true,hadHistory:this.options.recentHistory.length>0,scope:T,searchSessionId:a(this.options)},url:"/TypeAheadJson"}).send()}};var E=function(T){if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus===true){g.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}d.call(this);if(!this.autoFocusing){if(this.options.onUserFocus){this.options.onUserFocus(this)}var S=this.lastSuccessfulQuery!==this.query;if(this.options.showOnFocus&&(!S)){this.show()}if(this.options.restoreOnFocus){this.restore()}if(this.options.showOnFocus&&this.query&&!this.results&&!this.error&&j.call(this)){this.search()}if(this.options.jpFirefoxIME){R.call(this)}this.showHistoryIfEnabled();this.showSuggestedIfEnabled()}if(this.options.startEventOn==="focus"){n.call(this)}this.autoFocusing=false};var R=function(){if(this.source==document.activeElement){var S=function(){I.call(this);if(this.jpTypeAheadTimerId){clearTimeout(this.jpTypeAheadTimerId)}this.jpTypeAheadTimerId=setTimeout(S.bind(this),this.options.jpFirefoxIMEInterval)};S.call(this)}};var u=function(U,S){if(this.checkMenuInteraction()){return}this.hide();var T=this.tabPressed;this.tabPressed=false;if(!this.options.restoreOnFocus&&!this.query){this.results=null;this.error=null;this.setSelectedIndex(-1);this.selected=null;this.items=[];this.container&&this.container.empty()}this.options.selectOnBlur&&-1!==this.selectedIndex&&this.select(T,T?t:undefined);if(this.options.assumeOnBlur&&-1===this.selectedIndex&&this.results&&this.results.length){if(typeof this.options.assumeOnBlur=="function"){this.setSelectedIndex(this.options.assumeOnBlur(this))}else{this.setSelectedIndex(0)}O.call(this);this.select(T,T?t:undefined)}if(this.source&&this.source.value===""){this.source.value=this.options.defaultValue;if(this.options.defaultTextClass){g.addClass(this.source,this.options.defaultTextClass)}}if(this.options.onUserBlur){this.options.onUserBlur(this)}if(this.jpTypeAheadTimerId){clearTimeout(this.jpTypeAheadTimerId)}};var b=function(U){var T=U.target;if(T.getParent(this.options.itemSelector)){T=T.getParent(this.options.itemSelector)}if(this.selected&&this.selected===T){return}for(var S=this.items.length-1;S>=0;S--){if(this.items[S]===T){this.setSelectedIndex(S);O.call(this);return}}};var h=function(S){d.call(this)};var A=function(){var S=this.source.tabIndex,U;if(false===this.options.nextField){return}if(this.options.nextField){if(typeof this.options.nextField==="string"){this.options.nextField=g.find(this.options.nextField)}else{if(typeof this.options.nextField==="function"){U=this.options.nextField(this)}else{U=this.options.nextField}}}if(false===U){return}if(!U&&S){S=parseInt(S,10)+1;U=g.find("[tabindex="+S+"]",this.source.form)}if(!U){for(var T=this.source.form.elements.length-1;T>=0;T--){var V=this.source.form.elements[T];if(this.source===V){U=this.source.form.elements[T+1];break}}}U&&U.focus()};var r=function(){this.options.syncro&&this.options.syncro.sync(this,{query:this.query,value:this.source.value,result:this.selectedIndex>=0&&this.results[this.selectedIndex]})};var Q=function(){(document.activeElement===this.source&&!this.aborted&&this.show())||u.call(this)};var k=function(T,aa){this.setSource(T);this.lastQueryTime=0;var S=false;this.checkMenuInteraction=function(){return S};if(!N.containerParent){N.containerParent=document.body}this.options=g.extend({},N,aa);this.options.postResultsFnList=this.options.postResultsFnList||[];if(this.options.postResultsFn){this.options.postResultsFnList.unshift(this.options.postResultsFn);delete this.options.postResultsFn}if(!this.options.recentHistory){this.options.recentHistory=[]}else{this.applyOptionsToHistoryList()}this.historyShown=false;if(!this.options.suggestedItems){this.options.suggestedItems=[]}else{this.applyOptionsToSuggestedList()}this.setSelectedIndex(-1);this.selected=null;this.visible=false;this.lastSuccessfulQuery="";this.source.autocomplete="off";if(!this.options.defaultValue&&this.options.defaultValue!=""){this.options.defaultValue=this.source.getAttribute("data-defaultValue")||this.source.defaultValue}if(!this.options.minHistoryChars){this.options.minHistoryChars=this.options.minChars}this.handlers={keyup:g.bind(c,this),focus:g.bind(E,this),blur:g.bind(u,this),click:g.bind(h,this)};this.handlers[g.checkBrowser("ie","safari","chrome")?"keydown":"keypress"]=g.bind(l,this);for(var X in this.handlers){g.addEvent(this.source,X,this.handlers[X])}this.source.addListener("paste",g.bind(K,this));this.source.addListener("cut",g.bind(K,this));var Z="position: absolute";if(g.find("body").hasClass("rtl")){Z+="; right: -999em"}else{Z+="; left: -999em"}Z+="; "+(typeof this.options.positionRelative==="string"?this.options.positionRelative:"top")+":-999px";this.container=g.createElement("div",{"class":this.options.containerClass,style:Z});this.options.containerParent.appendChild(this.container);var V=function(ad){S=false;if(!this.visible){return}var ac=g.getPosition(this.container),ab=g.getSize(this.container);if(ad.clientX>=ac.x&&ad.clientX<=ac.x+ab.x&&ad.clientY>=ac.y&&ad.clientY<=ac.y+ab.y){return}this.setSelectedIndex(-1);O.call(this)};var W=function(ab){S=true;ab.stopPropagation();ab.preventDefault()};var Y=function(ab){S=false;ab.stopPropagation();ab.preventDefault();this.select(true,e);A.call(this)};this.containerHandlers={mouseout:g.bind(V,this),mousedown:g.bind(W,this),click:g.bind(Y,this)};for(X in this.containerHandlers){g.addEvent(this.container,X,this.containerHandlers[X])}if(true===this.options.width){this.container.style.width=g.getSize(this.source).x+"px"}g.bindAll(this,"cleanUp","show","hide","processResults","renderResults","renderError");this.options.syncro&&this.options.syncro.add(this);var U=document.activeElement===this.source;if(this.options.showOnFocus&&U){if(this.hasDefaultText()){if(this.options.clearDefaultTextOnFocus===true){g.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}else{g.addClass(this.source,this.options.defaultTextClass)}}if(this.source.value!==this.options.defaultValue&&j.call(this)){if(this.source.value!==this.query){this.highlightResult=this.source.value}this.query&&(this.source.value=this.query);this.search()}}if(!Browser.ie11){if(window.onpagehide||null===window.onpagehide){window.addEventListener("pagehide",this.cleanUp,false)}else{g.addEvent(window,Browser.ie?"unload":"beforeunload",this.cleanUp)}}if(this.options.jpFirefoxIME){R.call(this)}if(this.options.startEventOn==="creation"||(this.options.startEventOn==="focus"&&U)){n.call(this)}if(this.options.focusOnCreation===true){this.autoFocusing=true;this.source.focus()}};k.prototype.getInputLength=j;k.prototype.searchFn=H;k.prototype.setGeoId=function(S){this.options.geoId=S;this.clearCache();this.lastSuccessfulQuery=""};var G=function(S){return S&&S.replace(/\s+/g," ")};k.prototype.setSource=function(S){if(!this.source){this.source=S}};k.prototype.getNormalizedQuery=function(){if(this.query){return G(this.query)}else{return this.query}};k.prototype.reset=function(){if(this.options.defaultTextClass){g.addClass(this.source,this.options.defaultTextClass)}g.removeClass(this.source,this.options.errorClass);this.error=null;this.container&&this.render("");this.source.value=this.options.defaultValue||""};k.prototype.getChosenResult=function(){var T=null;if(this.source&&this.source.value&&this.results){var V=this.source.value;for(var U=0;U<this.results.length;U++){var S=this.results[U];if(V.toLowerCase()===ta.util.string.stripHTMLFromText(S.name).toLowerCase()){T=S;break}}}return T};k.prototype.clearResults=function(){this.query="";this.render("")};k.prototype.search=function(V,Z){this.selected=null;this.lastQueryTime=new Date().getTime();this.setSelectedIndex(-1);this.query=this.source.value;var X=this.getNormalizedQuery();this.aborted=false;if(this.options.cacheResults&&this.resultsCache&&this.resultsCache[X]){this.processResults(this.resultsCache[X],true);if(false!==V){Q.call(this)}Z&&Z()}else{var Y;if(this.query.length<=this.options.queryLengthLimit){if(this.options.search){Y=this.options.search(this.query,this)}else{Y=H.call(this,this.query)}}else{var S=ta.util.Deferred();var W={results:[],query:{query:this.query}};S.resolve(W);Y=S.promise()}var T=this.options.postResultsFnList;for(var U=0;U<T.length;U++){Y=Y.success(T[U])}if(this.options.integrateHistory){Y=Y.success(this.integrateHistoryIntoResults.bind(this))}Y=Y.success(this.processResults).failure(this.renderError);if(false!==V){Y.always(g.bind(Q,this))}Z&&Y.always(Z)}};k.prototype.processResults=function(Y,U){var X=this.options.itemTemplate,T=this;U=this.options.forceProcessResults||U;var S=!!Y.results;if(!S){Y={results:Y,query:{query:this.query}}}var V=Y.results;if(this.options.cacheResults&&S){var W=G(Y.query&&Y.query.query?Y.query.query:this.getNormalizedQuery());if(!this.resultsCache){this.resultsCache={}}this.resultsCache[W]=Y}if(U||this.getNormalizedQuery()!==G(this.lastSuccessfulQuery)){this.results=V;this.error=null;this.setSelectedIndex(-1);if(this.options.autoHighlightFirst){this.setSelectedIndex(0)}V.forEach(function(aa,Z){aa.index=Z;aa.rendered=X(aa);if(T.highlightResult&&T.highlightResult===T.options.resolveSelection(aa)){T.setSelectedIndex(Z)}if(T.options.onProcessResult){T.options.onProcessResult(aa,Z,T)}})}this.renderResults(Y,null,U)};k.prototype.renderResults=function(Y,V,U){if(U||this.getNormalizedQuery()!==G(this.lastSuccessfulQuery)){var T=this;var X=Y.results?Y.results:Y;this.lastSuccessfulQuery=Y.query&&Y.query.query?Y.query.query:null;g.removeClass(this.container,this.options.errorClass);g.removeClass(this.source,this.options.errorClass);var S=this.options.listTemplate(Y);if(V){var Z=new Element("div");var W=[Elements.from(this.options.errorTemplate(V))];if(typeOf(S)=="string"){S=Elements.from(S)}W.push(S);W.flatten();Z.adopt(W);S=Z}this.render(S);this.items=g.select(this.options.itemSelector,this.container);this.items.forEach(function(aa){g.addEvent(aa,"mouseover",g.bind(b,T))});if(this.selectedIndex>=0){O.call(this)}else{this.options.autoSelectFirst&&this.highlightNextChoice()}this.options.onRender&&this.options.onRender(this,X)}};k.prototype.setSelectedIndex=function(S){this.selectedIndex=S;if(this.options&&this.options.onSetSelectedIndex){this.options.onSetSelectedIndex(S,this)}};k.prototype.renderError=function(S,T){if(T&&this.results){this.renderResults(this.results,S)}else{this.results=null}this.error=S;g.addClass(this.container,this.options.errorClass);g.addClass(this.source,this.options.errorClass);!T&&this.render(this.options.errorTemplate(S));this.options.onError&&this.options.onError(this,S)};k.prototype.render=function(S){if(!this.container){return}if(typeOf(S)=="string"){this.container.innerHTML=S}else{if(typeOf(S)=="element"){this.container.empty();this.container.appendChild(S)}}};k.prototype.show=function(){if(!this.container||this.visible||!this.container.childNodes.length){return this}var U=g.getPosition(this.source),S=g.getSize(this.source);if(this.options.positionRelative){if(g.find("body").hasClass("rtl")){this.container.style.right="auto"}else{this.container.style.left=(this.options.offsetX||0)+"px"}if(typeof this.options.positionRelative==="string"){this.container.style[this.options.positionRelative]=(S.y+(this.options.offsetY||0))+"px"}else{this.container.style.top=(S.y+(this.options.offsetY||0))+"px"}}else{this.container.style.right="auto";this.container.style.left=U.x+(this.options.offsetX||0)+"px";if(this.options.positionAbove){var T=g.getSize(this.container);this.container.style.top=(U.y-T.y+(this.options.offsetY||0))+"px"}else{this.container.style.top=(U.y+S.y+(this.options.offsetY||0))+"px"}}this.visible=true;this.options.onShow&&this.options.onShow(this);return this};k.prototype.hide=function(){if(!this.visible||!this.container){return false}if(g.find("body").hasClass("rtl")){this.container.style.right="-999em"}else{this.container.style.left="-999em"}this.container.style[typeof this.options.positionRelative==="string"?this.options.positionRelative:"top"]=-999;this.visible=false;this.options.onHide&&this.options.onHide(this);return this};k.prototype.highlightNextChoice=function(){J.call(this,1)};k.prototype.hightlightPreviousChoice=function(){J.call(this,-1)};k.prototype.select=function(V,T){this.hide();if(this.selectedIndex<0||!this.results){return}this.source.value=this.options.resolveSelection(this.results[this.selectedIndex]);if(this.error){g.removeClass(this.container,this.options.errorClass);g.removeClass(this.source,this.options.errorClass);this.error=null;this.renderResults(this.results)}var W;if(this.options.onSelect){W=this.options.onSelect.bind(this.options,this.results[this.selectedIndex],this.source.value,this,V,T)}if(V){var S=this.results[this.selectedIndex];var X=0;if(this.results){X=this.results.length}var Z=this.lastSuccessfulQuery?this.lastSuccessfulQuery:this.query;var U=S.scope=="history";var Y=this.options.loggingOverride;if(Y){Y=Y.bind(this)}if(S.type==="SEARCH"){v("search_bttn",undefined,undefined,undefined,W,T,null,this.options.geoId,this.options.name,this.options.startTime,Z,U,this.historyShown,Y,S,this.options.doSelectionBeforeLogging,a(this.options))}else{v("select",S.value,this.selectedIndex+1,X,W,T,null,this.options.geoId,this.options.name,this.options.startTime,Z,U,this.historyShown,Y,S,this.options.doSelectionBeforeLogging,a(this.options))}}else{if(W){W()}}r.call(this);return this};k.prototype.restore=function(){this.query&&this.query.length&&(this.source.value=this.query);this.setSelectedIndex(-1);if(this.selected){g.removeClass(this.selected,"selected");this.selected=null}this.options.onRestore&&this.options.onRestore(this.query);r.call(this);return this};k.prototype.sync=function(U){var S=this;if(this.query&&this.query!==U.query){this.results=null;this.error=null}this.query=U.query;U.value&&(this.source.value=U.value);this.setSelectedIndex(-1);this.selected&&g.removeClass(this.selected,"selected");var T=function(){if(S.results&&S.results.length){var V=S.results.some(function(X,W){if(S.options.equal(X,U.result)){S.setSelectedIndex(W);return true}return false});if(!V&&S.options.assumeOnBlur){S.setSelectedIndex(0)}if(S.selectedIndex>=0){S.selected&&g.removeClass(S.selected,"selected");S.selected=S.items[S.selectedIndex];g.addClass(S.selected,"selected");S.source.value=S.options.resolveSelection(S.results[S.selectedIndex]);S.options.onSelect&&S.options.onSelect(S.results[S.selectedIndex],S.source.value,S,false)}}S.options.onSync&&S.options.onSync(S.query,S.source.value,S.selectedIndex>=0&&S.results[S.selectedIndex])};if(!this.results){this.query&&(this.source.value=this.query);this.search(false,T)}else{T()}};k.prototype.cleanUp=function(){this.container=null;this.item=null;this.selected=null;this.source=null;this.setSelectedIndex(-1);this.query=null;this.historyShown=false;this.results=null;this.error=null;this.timeoutHandler=null;this.clearCache()};k.prototype.clearCache=function(){this.resultsCache=null};k.prototype.abortSearch=function(){this.aborted=true;if(this.timeoutHandler){window.clearTimeout(this.timeoutHandler)}};k.prototype.hasDefaultText=function(){return this.source&&this.source.value===this.options.defaultValue};k.prototype.integrateHistoryIntoResults=function(X){var Y=X.results||X;var aa=(X.query&&X.query.query)||this.query;var ac=false;if(X.normalized&&X.normalized.query){aa=X.normalized.query;ac=true}var ah=Y.getLast();if(ah&&ah.type=="SEARCH"){Y.length-=1}else{ah=null}var T=this.getHistoryMatchingQuery(aa,ac);var ae=T.length;var V={};var ad=[];for(var W=0;W<T.length;W++){var af=T[W];V[this.options.getHistoryMatchingKey(af)]=W}for(var W=0;W<Y.length;W++){var ab=Y[W];var U=this.options.getHistoryMatchingKey(ab);var S=V[U];if(ab.isChild&&S!==undefined){T[S]=null;delete V[U]}if((U in V)&&this.options.eligibleForHistoryInjection(ab)){ae--;if(this.options.shouldReplaceHistoryItem(ab)){ab.scope="history";T[S]=ab}}else{ad.push(ab)}}T=T.clean();var Z=T.concat(ad);if(Z.length>Y.length&&Z.length>this.options.maxResults){Z.length=Y.length}if(ah){Z.push(ah)}if(X.results){X.results=Z}else{X=Z}var ag=ta.util.Deferred();ag.resolve(X);if(T.length>0){this.historyShown=true}return ag.promise()};k.prototype.getHistoryMatchingQuery=function(Y,Z){if(Y&&Y.length<this.options.minHistoryChars){return[]}var V=new RegExp("\\b"+String.escapeRegExp(Y),"i");var X=this.options.recentHistory;var T=[];var U=function(ab){return"<b>"+ab+"</b>"};for(var W=0;W<X.length&&T.length<this.options.maxHistoryItems;W++){var aa=X[W];if(!aa){continue}var S=aa.name;if(Z&&aa.normalized_name){S=aa.normalized_name}if((S&&S.match(V))||f(V,aa.aliases)){if(this.options.highlightHistory){aa=g.extend({},aa);aa.name=aa.name.replace(V,U)}T.push(aa)}}return T};k.prototype.applyOptionsToHistoryList=function(X){var Y=[];var ab;var S;var Z;var aa=function(ac,ae){ac=g.extend({},ac);ac.scope="history";S=ac.url;if(ac.urls){for(var ad=0;ad<ac.urls.length;ad++){Z=ac.urls[ad];if(Z.url_type==ae.options.historyLinkType){S=Z.url;break}}}ac.url=S;return ac};for(var W=0;W<this.options.recentHistory.length;W++){ab=this.options.recentHistory[W];if(!this.options.historyTypes.contains(ab.type.toLowerCase())){continue}ab=aa(ab,this);if(this.options.historyPredicate&&!this.options.historyPredicate(ab)){continue}Y.push(ab);var U=ab.children;if(U&&U.length>0){for(var V=0;V<U.length;V++){var T=U[V];T=aa(T,this);T.parent=ab;Y.push(T)}}}this.options.recentHistory=Y};k.prototype.shouldShowHistory=function(){var S=this.options.showOnFocus&&this.options.showHistory;var U=!!this.query&&this.query.length>0;var T=this.options.recentHistory.length>0;return S&&!U&&T};k.prototype.getSearchParams=function(){if(this.options.searchParams){if(typeof this.options.searchParams==="function"){return this.options.searchParams(this)}else{return this.options.searchParams}}else{return{}}};k.prototype.showHistoryIfEnabled=function(){if(!this.shouldShowHistory()){return}var S=this.options.recentHistory.slice(0,this.options.maxHistoryItems);if(this.options.historySort){S=S.sort(this.options.historySort)}var T={results:S};this.processResults(T,true);this.restore();this.show()};k.prototype.injectHistory=function(U,S){U.scope="history";var T=this.options.recentHistory.length;if((!S&&S!=0)||S<0||S>T){S=T}this.options.recentHistory.splice(S,0,U);return U};k.prototype.removeHistory=function(S){this.options.recentHistory.splice(S,1)};k.prototype.clearHistory=function(){this.options.recentHistory=[];this.clearCache()};k.prototype.showSuggestedIfEnabled=function(){if(!this.shouldShowSuggested()){return}var S=this.options.suggestedItems.slice(0,this.options.maxSuggestedItems);var T=this.results?this.results.concat(S):S;this.processResults(T,true);this.restore();this.show()};k.prototype.shouldShowSuggested=function(){var U=this.options.showOnFocus&&this.options.showSuggested;var T=!!this.query&&this.query.length>0;var S=this.options.suggestedItems.length>0;return U&&!T&&S};k.prototype.applyOptionsToSuggestedList=function(){var T=[];var S;for(var U=0;U<this.options.suggestedItems.length;U++){S=this.options.suggestedItems[U];S=g.extend({},S);S.scope="suggested";T.push(S)}this.options.suggestedItems=T};return k}(api));(function(a){window.ta||(ta={});ta.backbone||(ta.backbone={});ta.backbone.ModuleLoader=a(ta.Logging)})(function(a){var g=new ta.util.Deferred(true);function e(){if(typeof jsDesktopBackboneAsset==="undefined"){a&&a.error("Couldn't load JS module loader assets");return g.reject()}else{if(typeof bbapp!=="undefined"){g.resolve()}else{ta.loadInOrder(jsDesktopBackboneAsset,g.resolve)}}}function c(h){return function(){var i={modules:h,token:JS_SECURITY_TOKEN,authenticator:"DEFAULT",geoId:typeof modelGeoId!=="undefined"?modelGeoId:null,locationId:typeof modelLocId!=="undefined"?modelLocId:null};return new ta.util.ajax({method:"POST",url:"/ModuleBootstrap",evalScripts:true,data:i,aplus:true})}}function d(h){var i=new ta.util.Deferred(true);return function(j){if(!j||j.code!==200){return}var k=document.createElement("div");k.innerHTML=j.text;h&&h.appendChild(k);i.resolve(k);return i.promise()}}function f(i){if(!i){return function(){}}var h=new ta.util.Deferred(true);return function(o){var n=o.getElementsByTagName("script");var k=[];for(var m=n.length-1;m>=0;m--){var p=n[m].getAttribute("src");if(p){k.unshift(p);n[m].parentNode.removeChild(n[m])}}ta.loadInOrder(k,function(){h.resolve(o)});n=o.getElementsByTagName("link");for(var l=n.length-1;l>=0;l--){new Asset.css(n[l].href)}return h.promise()}}var b={};return function(i,l){var h=Array.prototype.slice.call(arguments,2);var m=typeof l==="string"?l:null;var j=!m&&l;g.isFulfilled()||e();var k=b[i]||(b[i]=g.promise().then(c(i)).then(d(j)).success(f(m)));m&&k.success(function(n){require&&require([m],function(o){h.unshift(n);o.init&&o.init.apply(o,h)})});return k}});(function(a){window.ta||(ta={});ta.masthead||(ta.masthead={});ta.masthead.NotificationDropdown=a(ta,ta.backbone.ModuleLoader)})(function(o,q){var p=-10;var j=false;var v=false;var e=false;var g=null;var l=null;var d=null;var m=null;var b=null;var s=null;var u=null;var k="modules.engagement.NotificationDropdown";var c=function(w){if(!e||!l||(w&&b.contains(w.target))){return}e=false;l.style.left=p+"px";o.addClass(l,"hidden");o.removeClass(s,"masthead_notifctr_active");var x=window.bbapp&&bbapp.getView(k);if(x){x.record("CloseNotifDropdown")}};var n=function(){if(!l||e){return}e=true;o.removeClass(l,"hidden");o.addClass(s,"masthead_notifctr_active");var w=b.getPosition().x;var y=l.getWidth();var x=window.getSize().x;if(w+y>x){l.style.left=(p+(x-w)-y)+"px"}i(0)};var h=function(){if(u){return}u=setTimeout(function(){u=null;m=o.find(".notifdd_list",g);d.removeClass("hidden");m&&m.addClass("hidden");n()},250)};var t=function(){if(u){clearTimeout(u);u=null}d.addClass("hidden");m=o.find(".notifdd_list",g);m&&m.removeClass("hidden");n()};var i=function(x){var w=o.find(".masthead_notifctr_jewel",g);w.innerText=x;if(x==0&&!w.hasClass("hidden")){w.addClass("hidden");s.removeClass("masthead_notifctr_unread")}else{if(x>0&&w.hasClass("hidden")){w.removeClass("hidden");s.addClass("masthead_notifctr_unread")}}};var a={initialize:function(){this.listenTo(this.context.get("Engagement_MemberNotifications.data.notifications"),"reset",this.render);this.listenTo(this,"render",this.onRender);this.onRender()},onRender:function(){this.listEl=o.find(".notifdd_list",this.el);var w=this;require(["underscore"],function(x){var y=[];x.each(o.select(".notifdd_notif_container",w.el),function(z){if(z.hasClass("notifdd_unread")){y.push(+z.getAttribute("data-notif-id"))}});w.record("OpenNotifDropdown",{value:y.length});if(y.length>0){w.context.save("modules.engagement.entity.NotificationStatusUpdate",{set:true,status:["READ"],notifs:y})}})},refreshData:function(){var y=this.context.get("Engagement_MemberNotifications");if(y){return y.fetch()}var x=new ta.util.Deferred();var w=this;setTimeout(function(){x.resolve();w.onRender()},0);return x.promise()},events:{"click a.notifdd_link":function(w,x){this.record("NotifDropdownClick",{context:x.getAttribute("data-notif-type")});var y=this.context.save("modules.engagement.entity.NotificationStatusUpdate",{set:true,status:["USED"],notifs:[+x.getAttribute("data-notif-id")]});var z=function(){window.location.assign(x.href)};y.always(z);setTimeout(z,100);w.preventDefault()},mousewheel:function(w){var x=w.wheel||w.event.wheelDelta||-w.event.detail;if((this.listEl.scrollTop<=0&&x>0)||(x<0&&this.listEl.scrollTop>=(this.listEl.scrollHeight-this.listEl.offsetHeight))){w.preventDefault()}}}};var r=function(){require(["backbone/modbone/View"],function(w){w.create(k,a)})};var f=function(){b=o.find(".masthead_notification",g);s=o.find(".masthead_notifctr_btn",g);b.removeChild(o.find(".masthead_notifctr_dropdown",b));b.appendChild(l);var w=e?o.addClass:o.removeClass;w(s,"masthead_notifctr_active")};return{toggleNotifCenter:function(){g=o.find(".masthead_notification_enabled");b=o.find(".masthead_notification",g);l=o.find(".masthead_notifctr_dropdown",b);d=o.find(".notifdd_loading",l);s=o.find(".masthead_notifctr_btn",b);if(!v){v=true;o.addEvent(window,"click",c);o.addEvent(window,"mastheadFlyoutOpened",c);o.addEvent(window,"afterIpHeaderInjection",f)}if(!j){j=true;h();q(k,l).success(r).success(t);return}if(o.hasClass(l,"hidden")){var w=window.bbapp&&bbapp.getView(k);if(!w){return}h();w.refreshData().success(t);o.fireEvent(window,"mastheadFlyoutOpened")}else{c()}}}});var sTAMGFooterCookieName="hideTAMGFooter";var sFooterDivId="TM_FTR";var hmOngoingHover={};var savedDomain="tripadvisor.com";if(typeof cookieDomain!="undefined"){savedDomain=cookieDomain.substring(1,cookieDomain.length)}function _closeOverlay(){var a=ta.retrieve("overlays.current");if(a){a.hide()}}function setTAMGFooterCookie(d,c){var b=new Date();b.setTime(b.getTime());var e=1000*60*60*24*7;var a=new Date(b.getTime()+(e));document.cookie=sTAMGFooterCookieName+"="+escape(d)+";expires="+a.toGMTString()+";path=/"+((savedDomain)?";domain="+savedDomain:"");hideFooter(c)}function openUrl(b){var a=window.open(b);a.opener=null}function getTAMGFooterCookie(){var e=document.cookie.split(";");var a="";var c="";var d="";var b=false;for(i=0;i<e.length;i++){a=e[i].split("=");c=a[0].replace(/^\s+|\s+$/g,"");if(c==sTAMGFooterCookieName){b=true;if(a.length>1){d=unescape(a[1].replace(/^\s+|\s+$/g,""))}return d}a=null;c=""}if(!b){return null}}function hideFooter(b){if(!b){b=sFooterDivId}var a=document.getElementById(b);if(a){a.style.display="none"}}function tamgShowFly(c,d,b,a){hmOngoingHover[d]=true;setTimeout(function(){if(hmOngoingHover[d]){tamgCreateFly(c,b,a)}},250)}function tamgHideFly(a,c,b){var d=b.toElement||b.relatedTarget;while(d&&d!=a){d=d.parentNode}if(d!=a){hmOngoingHover[c]=false;setTimeout(function(){if(hmOngoingHover[c]==false){$$("."+c)[0].hide()}},250)}}function tamgCreateFly(g,j,e){var f=$(g).getElements(".ftrFly")[0];if($(f).getElements("img")[0]){f.show()}else{var k=CDNHOST+"/img2/x.gif";var h="ftrFlyLogo "+j;var d=new Element("img",{"class":h,src:k}).inject(f,"top");d.setProperty("height","25");d.setProperty("width",e);var c=new Element("div",{"class":"triWrap"});var b=new Element("span",{"class":"cssTri"});var a=new Element("span",{"class":"cssTri"});b.inject(a);a.inject(c);c.inject(f,"bottom");f.show()}}function getTAMGFooterViaAjax(d,c,a,b,e){new Request({url:"/TAMGFooterAjax",onSuccess:function(g){var h=ta.id("TAMGFooterHolder");if(h){h.innerHTML=g}var f="RuleBasedFooter_"+e;ta.trackEventOnPage("Footer","OpenFooter",f,1,true)},data:{a:"SHOW_FOOTER",dis:d,loc:c,"new":a,serv:b},evalScripts:true,method:"get"}).send()}function getFullDisclaimerText(){new Request({url:"/TAMGFooterAjax",onSuccess:function(b){try{ta.id("PDISCLAIMER").innerHTML=b}catch(a){ta.util.error.record(a,"Fail to find element (id PDISCLAIMER)")}},data:{a:"SHOW_FULL_DISCLAIMER"},evalScripts:true,method:"get"}).send()};(function(c){c.util=c.util||{};var f=false;var e={};var b=function(g,h){if(c.util.error&&c.util.error.record&&("function"===typeof c.util.error.record)){c.util.error.record(g,h)}else{if(c.merror&&c.merror.recordError&&("function"===typeof c.merror.recordError)){c.merror.recordError(h,null,null,null,g)}}};var a=function(){if(c.trackEventOnPage&&("function"===typeof c.trackEventOnPage)){c.trackEventOnPage("captcha","recaptcha","displayed")}};var d=function(h,g){var i=document.getElementById(g);if(!i||("INPUT"!==i.tagName)){b(null,"The recaptcha input id was not found on the page: "+g);return}i.value=h||""};c.util.ReCaptcha={init:function(i){try{if(f||("undefined"!==typeof grecaptcha)&&grecaptcha&&grecaptcha.render&&("function"===typeof grecaptcha.render)){return}if(!i){b(null,"No language specified for recaptcha.")}var h=document.createElement("script");h.type="text/javascript";h.async=true;h.defer=true;h.src="https://www.google.com/recaptcha/api.js?render=explicit&hl="+i;document.getElementsByTagName("head")[0].appendChild(h);f=true}catch(g){b(g,"Could not inject recaptcha script on to page.")}},reset:function(g){if(!g){b(null,"No reset key specified.");return}if(e[g]||(0===e[g])){try{if(("undefined"!==typeof grecaptcha)&&grecaptcha&&grecaptcha.reset&&("function"===typeof grecaptcha.reset)){grecaptcha.reset(e[g])}}catch(h){b(h,"Error resetting recaptcha object: "+g)}}},resetAll:function(){for(var g in e){if(e.hasOwnProperty(g)){c.util.ReCaptcha.reset(g)}}},showSync:function(j,h,i){var g=0;var k=window.setInterval(function(){if(++g>=40){window.clearTimeout(k);b(null,"Recaptcha JS was not loaded on the page.");return}if("undefined"===typeof grecaptcha){return}c.util.ReCaptcha.show(j,h,i);window.clearTimeout(k)},250)},show:function(j,g,h){try{if(("undefined"===typeof grecaptcha)||!grecaptcha||!grecaptcha.render||("function"!==typeof grecaptcha.render)){b(null,"Recaptcha JS was not loaded on the page.");return}if(!j||!g||!h){b(null,"Please pass a site key, element id, and input id.");return}var k=document.getElementById(g);if(!k){b(null,"The recaptcha element id was not found on the page: "+g);return}if(e[g]&&("object"===typeof e[g])){return}e[g]=grecaptcha.render(g,{sitekey:j,theme:"light",type:"image",tabindex:0,callback:function(l){d(l,h)},"expired-callback":function(){c.util.ReCaptcha.reset(g)}});a()}catch(i){b(i,"Error loading recaptcha.")}}}}(ta));(function(c){c.util=c.util||{};var g=false;var d="float";var e={};var f="";var b=function(i,j){if(c.util.error&&c.util.error.record&&("function"===typeof c.util.error.record)){c.util.error.record(i,j)}else{if(c.merror&&c.merror.recordError&&("function"===typeof c.merror.recordError)){c.merror.recordError(j,null,null,null,i)}}};var a=function(){if(c.trackEventOnPage&&("function"===typeof c.trackEventOnPage)){c.trackEventOnPage("captcha","geetest","displayed")}};var h=function(j){var i=j.getElementsByClassName("gt_guide_tip");if(i&&i.length>0&&f){i[0].innerHTML=f}};c.util.GeeTest={init:function(l,i){try{if(g||("undefined"!==typeof Geetest)&&Geetest){return}d=i?i:d;f=l;var k=document.createElement("script");k.type="text/javascript";k.async=true;k.defer=true;k.src="https://api.geetest.com/get.php?callback=ta.util.GeeTest.onloadCallback";document.getElementsByTagName("head")[0].appendChild(k);g=true}catch(j){b(j,"Could not inject geetest script on to page.")}},reset:function(i){try{if(e[i]&&("function"===typeof e[i].refresh)){e[i].refresh()}}catch(j){b(j,"Error resetting recaptcha object: "+i)}},resetAll:function(){for(var i in e){if(e.hasOwnProperty(i)){c.util.GeeTest.reset(i)}}},showSync:function(l,j,k){var i=0;var m=window.setInterval(function(){if(++i>=40){window.clearTimeout(m);b(null,"GeeTest JS was not loaded on the page.");return}if("undefined"===typeof Geetest){return}c.util.GeeTest.show(l,j,k);window.clearTimeout(m)},250)},show:function(l,i,k){try{if(("undefined"===typeof Geetest)||!Geetest){b(null,"GeeTest JS was not loaded on the page.");return}if(!l||!i){b(null,"Please pass a site key and element id.");return}var m=document.getElementById(i);if(!m){b(null,"The geetest element id was not found on the page: "+i);return}if(e[i]&&("object"===typeof e[i])&&!k){return}e[i]=new Geetest({gt:l,product:d,https:true});e[i].onReady(function(){h(m)}).appendTo(m);a()}catch(j){b(j,"Error loading geetest captcha.")}},onloadCallback:function(){}}}(ta));ta.common.header=(function(){var c=false;var a=false;ta.queueForLoad(function b(){var g=4;var h=ta.select(".masthead h1")[0];if(!h||!h.textContent||!h.textContent.length){return}var d=h.cloneNode(true);d.style.overflow="hidden";d.style.visibility="hidden";d.style.position="absolute";h.appendChild(d);var f=d.textContent;var e=f.length-1;while(e>0&&d.clientHeight>=45){while(e>0&&f.charAt(e)!==" "){e--}f=f.substring(0,e)+"...";d.textContent=f;d.offsetWidth}if(d.textContent.length>=g){h.textContent=d.textContent}},50,"ta.Header.truncateLongMasthead");return{createNavMenu:function(e,d){d=d||{};e.hoverIntent({over:(function(){var f=false;return function(){if((this.hasClass("ownerMenu")||this.hasClass("warLink"))&&ta.has("disableBehindAccountMenu")){return}if(d.initFn&&!f){d.initFn();f=true}var g=ta.find(".subNav",this);g.show();if(d.showFn){d.showFn.call(null,evnt)}window.fireEvent("onOverlayShow")}})(),out:function(g){var f=ta.find(".subNav",this);f.hide();if(d.hideFn){d.hideFn.call(null,g)}},timeout:d.timeout||500})},clear:function(e,d){d=ta.id(d);d.value="";d.removeClass("hasDefault");d.removeEvent("focus","ta.common.header.clear")},clearIfEquals:function(f,d,e){if(d.value==e){ta.run("ta.common.header.clear",{},f,d)}},addClearParam:function(d){if(typeof document.cookie!=="undefined"&&document.cookie&&document.cookie.indexOf("TASession")>=0){if(ta.hac&&ta.hac.filters&&ta.hac.filters.cancelAllExistingHAC){ta.hac.filters.cancelAllExistingHAC()}var e="?";if(typeof d!=="undefined"&&d&&typeof d.href!=="undefined"&&d.href&&d.href.indexOf("clearFilters=true")<=-1){if(d.href.indexOf("?")>-1){e="&"}d.href+=e+"clearFilters=true"}}},setSearchText:function(g,e,f){e=ta.id(e);var d=e.getParent().getNext("input");d.value=f;d.addClass("hasDefault");d.addEvent("focus",function(h){ta.call("ta.common.header.clear",h,d)})},changeSearchType:function(k,e,i){e=ta.id(e);var g=e.getParent("form"),d=e.getParent().getNext("input"),h=d.getParent().getNext(),j=d.retrieve("nameTA"),f=d.retrieve("geoTA");ta.run("ta.common.header.setSearchText",{},k,e,i);if(e.id=="dropGeoRadio"){if(j){j.pause()}if(f){f.resume()}else{if(!ta.retrieve("hotelGeoTA")){ta.store("hotelGeoTA",true);ta.run("ta.widgets.typeahead.factory.location_mutable",{onComplete:function(l){d.store("geoTA",l)}},k,d,"GEO",function(){},{minLength:3})}}g.action="/HACSearch";h.show()}else{if(f){f.pause()}if(j){j.resume()}else{if(!ta.retrieve("hotelNameTA")){ta.store("hotelNameTA",true);ta.run("ta.widgets.typeahead.factory.standard_mutable",{onComplete:function(l){d.store("nameTA",l)}},k,d,"LOCATION","ta.widgets.typeahead.events.onSelectHotelDrop",{minLength:3,xargs:"&types=hotel"})}}g.action="/Search";h.hide()}},createDrop:function(f,d){d=ta.id(d);var e=d.getNext().getElement(".subNav");ta.run("ta.overlays.Factory.createDropDown",{},f,d,e)},firstClickHotelText:function(i,e,h){e=ta.id(e);var g=e.getParent("form"),d=ta.id("dropGeoRadio"),f=ta.retrieve("hotelNameTA");hasGeoTA=e.retrieve("hotelGeoTA");if(d.checked){if(!hasGeoTA){ta.store("hotelGeoTA",true);ta.run("ta.widgets.typeahead.factory.location_mutable",{onComplete:function(j){e.store("geoTA",j)}},i,e,"GEO",function(){},{minLength:3})}}else{if(!f){ta.store("hotelNameTA",true);ta.run("ta.widgets.typeahead.factory.standard_mutable",{onComplete:function(j){e.store("nameTA")}},i,e,"LOCATION","ta.widgets.typeahead.events.onSelectHotelDrop",{minLength:3,xargs:"&types=hotel"})}}ta.run("ta.common.header.clear",{},i,e);e.removePropertyEvent("focus","ta.common.header.firstClickHotelText")},submitAndSetPid:function(f,e,d){setPID(d);form=e.getParent("form");if(d&&d==18898&&ta.id("dropVracGeo").value==""){window.location="/Rentals"}else{form.submit()}},submitHotelsForm:function(g,e,d){setPID(d);form=e.getParent("form");if(ta.has("useHotelsFilterState")){var f=form.toQueryString();new Request({url:"/FilterState",data:f,method:"post",onSuccess:function(h){ta.widgets.calendar.redirectToHotelOverview(h)},onFailure:function(h){ta.widgets.calendar.redirectToHotelOverview(null)}}).send()}else{form.submit()}},showFriendsOverlay:function(){var e=ta.id("FRIENDSTAB");var f=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,showArrow:true,arrowClass:"ttarrow",activate:ta.overlays.ACTIVATE_BOTH,style:"fbtt"},e);ta.store("friendsToolTip",f);if(ta.retrieve("friends_1st_resize")){var d=false;window.addEvent("resize",function(){if(!d){d=true}else{ta.common.header.hideFriendsToolTip(true)}})}else{window.addEvent("resize",function(){ta.common.header.hideFriendsToolTip(true)})}},checkFriendsToolTip:function(){if(!ta.util.localstorage||!ta.util.localstorage.canUseLocalStore()){return}var f=false;try{var d="taFriendsToolTipShown";if(!localStorage.getItem(d)){localStorage.setItem(d,true);f=true}}catch(h){ta.util.error.record(h,"checkFriendsToolTip - localStorage",null,{},"WARN")}if(f){var g=ta.id("COOKIE_BANNER");if(!ta.overlays||!ta.overlays.RelativeOverlayBelow){if(typeof(taExtraOverlayJs)!="undefined"){new Asset.javascript(taExtraOverlayJs,{onload:ta.common.header.showFriendsOverlay})}}else{if(typeof(g)!="undefined"&&g){ta.common.header.showFriendsOverlay.delay(2000)}else{ta.common.header.showFriendsOverlay()}}}},hideFriendsToolTip:function(e){var d=ta.retrieve("friendsToolTip");if(d){d.hide();window.removeEvent("resize",ta.common.header.hideFriendsToolTip)}var f=ta.id("FRIENDSTAB");if(f&&(typeof(e)=="undefined"||(e!=true))){f.addClass("hidenew")}},seeMoreOnToDoList:function(j,f,h){j.stopPropagation();var i=f.getParent("#WAR_MORE_TO_DO_ITEMS");if(i){var d=i.getChildren();if(d&&d.length>0){var e;var g=false;Array.each(d,function(n){if(n.getProperty("id")=="WAR_ADD_A_LISTING"){return}var l=n.getChildren();if(n.getProperty("id")!=h){if(g){if(l&&l.length>0){Array.each(l,function(o){if(!o.hasClass("warHeader")){o.addClass("hidden")}})}var m=n.getElement(".warHeader img.downarrow");var k=n.getElement(".warHeader img.rightarrow");if(m&&k){m.addClass("hidden");k.removeClass("hidden")}}}else{if(l&&l.length>0){Array.each(l,function(o){if(o.getProperty("id")=="warMore"){o.addClass("hidden")}else{o.removeClass("hidden")}})}g=true}})}}},seeLessOnToDoList:function(j,h,g){j.stopPropagation();var e=h.getParent("#WAR_MORE_TO_DO_ITEMS");if(e){var d=e.getChildren();if(d&&d.length>0){var f;var i=false;Array.each(d,function(m){var l=m.getChildren();if(m.getProperty("id")!=g){if(i){ta.common.header.openWARToDoListSection(m)}}else{var k=0;if(l&&l.length>0){Array.each(l,function(n){if(n.getProperty("id")=="warMore"){n.removeClass("hidden")}if(n.getProperty("id")=="warLess"){n.addClass("hidden")}if(n.hasClass("warLoc")){k++;if(k>3){n.addClass("hidden")}}})}i=true}})}}},expandWARToDoList:function(h,e,d){h.stopPropagation();var g=e.getParent("#"+d);var f=e.getChildren(".downarrow");if(f&&f.length>0){if(f[0].hasClass("hidden")){ta.common.header.openWARToDoListSection(g)}}},openWARToDoListSection:function(h){var f=h.getChildren("#warLess");if(f&&f.length>0&&!f[0].hasClass("hidden")){return}var g=h.getChildren();if(g&&g.length>0){var e=0;Array.each(g,function(j){if(j.getProperty("id")=="warMore"){j.removeClass("hidden")}if(j.hasClass("warLoc")&&e<3){j.removeClass("hidden");e++}})}var i=h.getElement(".warHeader img.downarrow");var d=h.getElement(".warHeader img.rightarrow");if(i&&d){i.removeClass("hidden");d.addClass("hidden")}},getWARNotificationFlag:function(){var f=ta.id("NO_WAR_NOTIFICATION_FLAG");if(f){return}var d=ta.id("WAR_NOTIFICATION_FLAG");if(d&&d.hasClass("hidden")){try{new Request({url:"/UserReviewToDoListAjax",data:{getCount:true},method:"get",onSuccess:function(j){var i=new Element("div",{html:j});var g=i.getElement("#WAR_NOTIFICATION_FLAG_NEW");if(g){g.replaces(d);g.setProperty("id","WAR_NOTIFICATION_FLAG")}else{var h=i.getElement("#NO_WAR_NOTIFICATION_FLAG");if(h){d.dispose()}}}}).send()}catch(e){ta.util.error.record(e,"ta.common.Header.getWARNotificationFlag");return}}},openImproveListing:function(e,f,d,g,h){window.processReq=function(){ta.servlet.Location.requestListingWithLightbox("",this,"",h,false,true)};if(d){processReq()}else{ta.store("registration.ga_module","WarToDoAddListing");ta.overlays.registration.connect({flow:"LISTINGREQ"},"SIGNIN",{LocationId:g})}},adjustFriendsLink:function(e){var d=$("TAIPPREFS");if(d){if(d.hasClass("auth_ip")){ta.util.cookie.setPIDCookie(18783)}else{if(d.hasClass("auth_fbc")){ta.util.cookie.setPIDCookie(15210)}else{return true}}window.location="/Friends";return false}return true},hideWarTodoDropdown:function(d){if(!c){return}var e=api.find(".masthead_war_dropdown");if(d===true||(d&&api.containsElement(e,d.target))){return}api.removeClass(api.find(".subNav",e),"shown");c=false;api.removeClass(e,"masthead_war_dropdown_active")},warTodoDropdownOnClick:function(f){if(!a){a=true;ta.run("ta.overlays.Factory.createWARToDoListOverlay",f);api.addEvent(window,"click",ta.common.header.hideWarTodoDropdown);api.addEvent(window,"mastheadFlyoutOpened",ta.common.header.hideWarTodoDropdown)}var e=ta.find(".masthead_war_dropdown");if(!c){ta.setEvtCookie("WAR","MASTHEAD_WAR_DROPDOWN","MASTHEAD_WAR_DROPDOWN_OPENED","39392","/UserReviewRedesign");api.addClass(e,"masthead_war_dropdown_active")}else{api.removeClass(e,"masthead_war_dropdown_active")}var d=api.find(".subNav",e);api.toggleClass(d,"shown");c=!c;api.fireEvent(window,"mastheadFlyoutOpened",true)}}})();ta.util.taLnk={mouseover:function(b){$(b).addClass("underline")},mouseout:function(b){$(b).removeClass("underline")},redirect:function(a){window.location.href=a}};var StringBuffer=new Class({initialize:function(a){this.strings=new Array();if(a){this.append(a)}},append:function(a){this.strings.push(a);return this},toString:function(){return this.strings.join("")},isEmpty:function(){return this.strings.length==0}});var Table=new Class({Implements:[Options],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[]},initialize:function(a){this.setOptions(a);this.table=new Element("table").setProperties(this.options.properties);this.tbody=new Element("tbody").inject(this.table);this.options.rows.each(this.push.bind(this))},push:function(d,c,a){var b=new Element("tr").inject(c||this.tbody);d.each(function(e){var f=new Element(a?"th":"td").inject(b);if(e.properties){f.setProperties(e.properties)}if(e.content){f.setContent(e.content)}else{f.setContent(e)}});return this},pushHead:function(a){if(!this.thead){this.thead=new Element("thead").inject(this.table,"top")}this.push(a,this.thead,true);return this},pushFoot:function(a){if(!this.tfoot){this.tfoot=new Element("tfoot").inject(this.table)}this.push(a,this.tfoot);return this},pushCaption:function(a){new Element("caption").setContent(a).inject(this.table,"top");return this}});var TabSet=new Class({Implements:[Options,Events],options:{onActive:function(){},onBackground:function(){},show:0,collapsable:false},initialize:function(){var a,b,c;Array.each(arguments,function(f,e){switch(typeOf(f)){case"object":a=f;break;default:var d=$$(f);if(!b){b=d}else{c=d}}});this.togglers=b||[];this.elements=c||[];this.setOptions(a);this.elements.each(function(e,d){this.togglers[d].addEvent("click",this.display.bind(this).partial(Function._,d));if(this.options.show===d){e.show();this.previous=d;this.fireEvent("onActive",[null,this.togglers[d],e])}else{e.hide()}},this)},display:function(b,a){if(this.options.collapsable&&a==this.previous){if(this.elements[a].isHidden()){this.fireEvent("onActive",[b,this.togglers[a],this.elements[a]]);this.elements[a].show()}else{this.fireEvent("onBackground",[b,this.togglers[a],this.elements[a]]);this.elements[a].hide()}return this}if(this.previous||this.previous===0){this.elements[this.previous].hide();this.fireEvent("onBackground",[b,this.togglers[this.previous],this.elements[this.previous]])}this.previous=a;this.elements[a].show();this.fireEvent("onActive",[b,this.togglers[a],this.elements[a]]);return this}});var ToggleSet=new Class({initialize:function(b,c,a){this.index=a||0;this.togglers=b||[];this.elements=c||[];this.togglers.each(function(e,d){this.togglers[d].addEvent("click",this.display.bind(this,d));this.elements[d].hide()},this)},add:function(c,b){var a=this.togglers.length;this.togglers.push(c);this.elements.push(b);c.addEvent("click",this.display.bind(this,a));b.hide()},expand:function(a){this.togglers[a].addClass("open");this.elements[a].show();return this},collapse:function(a){this.elements[a].hide();this.togglers[a].removeClass("open");return this},display:function(a){if(this.previous==a){if(this.elements[a].isHidden()){this.expand(a)}else{this.collapse(a)}}else{if(this.previous||this.previous===0){this.collapse(this.previous)}this.previous=a;this.expand(a)}return this}});var Slider=new Class({Implements:[Options,Events],Binds:["clickedElement","draggedKnob"],options:{onChange:function(){},onComplete:function(){},onTick:function(a){this.knob.setStyle(this.p,a)},mode:"horizontal",steps:100,offset:0},initialize:function(d,a,b){this.element=$(d);this.knob=$(a);this.setOptions(b);this.previousChange=-1;this.previousEnd=-1;this.step=-1;this.element.addEvent("mousedown",this.clickedElement);var c,f;switch(this.options.mode){case"horizontal":this.z="x";this.p="left";c={x:"left",y:false};f="offsetWidth";break;case"vertical":this.z="y";this.p="top";c={x:false,y:"top"};f="offsetHeight"}this.max=this.element[f]-this.knob[f]+(this.options.offset*2);this.half=this.knob[f]/2;this.getPos=this.element["get"+this.p.capitalize()].bind(this.element);this.knob.setStyle("position","relative").setStyle(this.p,-this.options.offset);var e={};e[this.z]=[-this.options.offset,this.max-this.options.offset];this.drag=new Drag(this.knob,{limit:e,modifiers:c,snap:0,onStart:this.draggedKnob(),onDrag:this.draggedKnob(),onComplete:function(){this.draggedKnob();this.end()}.bind(this)});if(this.options.initialize){this.options.initialize.call(this)}},set:function(a){this.step=a.limit(0,this.options.steps);this.checkStep();this.end();this.fireEvent("onTick",this.toPosition(this.step));return this},setDefault:function(a){if(a>this.options.steps){a=this.options.steps}else{if(a<0){a=0}}this.step=a;this.end();this.knob.setStyle(this.p,this.toPosition(this.step)+"px");return this},scrolledElement:function(a){if(a.wheel<0){this.set(this.step+1)}else{if(a.wheel>0){this.set(this.step-1)}}a.stop()},clickedElement:function(b){var a=b.page[this.z]-this.getPos()-this.half;a=a.limit(-this.options.offset,this.max-this.options.offset);this.step=this.toStep(a);this.checkStep();this.end();this.set(this.step)},draggedKnob:function(){if(!this.drag){return}this.step=this.toStep(this.drag.value.now[this.z]);this.checkStep();this.setDefault(this.step)},checkStep:function(){if(this.previousChange!=this.step){this.previousChange=this.step;this.fireEvent("onChange",this.step)}},end:function(){if(this.previousEnd!==this.step){this.previousEnd=this.step;this.fireEvent("onComplete",this.step+"")}},toStep:function(a){return Math.round((a+this.options.offset)/this.max*this.options.steps)},toPosition:function(a){return this.max*a/this.options.steps}});var rules={};var rulesN={};var ajaxRules={};var Behavior=new Class({register:function(b){this.rules=b;for(var a in this.rules){this.reload(a)}for(var c in rulesN){this.reloadN(c)}return this},reload:function(c){var a=$$(c);for(var d=0;d<a.length;d++){try{this.rules[c](a[d])}catch(b){ta.util.error.record(b,"rules",null,{element:ta.util.error.getSelectorString(a[d]),ruleCount:d})}}return a.length},reloadN:function(b){var a=0;while(n=ta.id(b+(a++))){rulesN[b](n)}return a-1},apply:function(a){processLinks(a);for(var b in this.rules){window.applyLastRule=b;a.getElements(b).each(function(c){this.rules[b](c)},this)}for(var b in ajaxRules){window.applyLastRule=b;a.getElements(b).each(function(c){ajaxRules[b](c)},this)}}});window.behavior=new Behavior();TAReadyEvent=window.TAReadyEvent||"domready";if(Browser.ie&&(typeof semHotelBoxFocus!="undefined")&&semHotelBoxFocus){ta.queueForLoad(behaviorFunction,"Behavior")}else{window.addEvent(TAReadyEvent,behaviorFunction)}var bfCount=0;function behaviorFunction(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.behaviorStart=new Date().getTime()}if(Browser.ie&&(!$("FOOT")||!$("FOOT").readyState||$("FOOT").readyState!="complete")&&bfCount<10){bfCount++;behaviorFunction.delay(30);return}if(window.hideOnLoad){Array.from(hideOnLoad).each(function(c){var b=$(c);if(b){b.hide()}})}if(!Browser.ie6){searchFocus()}processLinks(document);behavior.register(rules);var a=$("MAIN");if((window.location.hash=="#Calculator")&&($("HOMEPAGE")||(a&&a.hasClass("VacationRentals"))||$("HOTEL_LANDER"))){showDHTMLOverlayOnLoad=function(){};if(typeof vrCalculator!="undefined"){vrCalculator()}}if(typeof performancePingbackInit!="undefined"){performancePingbackInit.behaviorEnd=new Date().getTime()}}function searchFocus(){var a=ta.id("mainSearch");if(a&&a.className.match(/\b(focusOnLoad)\b/)){try{a.focus()}catch(b){}}}rulesN.EOBF=function(a){var b=a.innerHTML+"@tripadvisor"+a.title;new Element("a",{href:"mailto:"+b}).setContent(b).replaces(a)};var linkMap={};var popupIndex=0;function popup(r,t,o,l,h,g,b,d,c,q){try{new Event(r).preventDefault();var a="",k=this.className.match(/sz(\d+)x(\d+)/),j=ta.id(document.body),i,s,f;if(k){o=k[1];l=k[2]}if(this.href.indexOf("p=HotelsCom")>-1){o=Math.max(o,960);l=Math.max(l,window.getHeight(),600)}if(o){a+=",width="+o}if(l){a+=",height="+l}if(h){a+=",screenX="+h+",left="+h}if(g){a+=",screenY="+g+",top="+g}if(a!==""){if(c){a="toolbar=1,resizable=1,menubar=1,location=1,status=1,scrollbars=1"+a}else{a="toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars="+(b?0:1)+a}}if(!d){d=this.href}s=t||("p"+(popupIndex++));if(q&&Browser.ie){f=new Element("a",{target:s,href:d});f.inject(j,"bottom");i=window.open("",s,a);f.click();f.destroy()}else{i=window.open(d,s,a)}if(i!==null){try{i.opener=self}catch(m){}i.focus()}}catch(p){ta.util.error.record(p,"behavior popup",r);throw p}}linkMap.js_popup=function(a,b){popup.attempt(b,a)};linkMap.js_popComm=function(a,b){popup.attempt([b,null,950,610,null,null,null,null,true],a)};linkMap.js_popMap=function(a,b){Cookie.write("mapPopup","1",{domain:cookieDomain});popup.attempt([b,"map",820,960],a)};linkMap.js_popNoScroll=function(a,b){popup.attempt([b,null,null,null,null,null,true],a)};linkMap.js_popCR=function(a,b){popup.attempt([b,"cr",245,610,5,5],a)};linkMap.js_email=function(a,b){popup.attempt([b,"email",580,460,30,25],a)};linkMap.js_popReview=function(a,b){popup.attempt([b,"review",550,395,30,25],a)};linkMap.js_popPhoto=function(a,b){popup.attempt([b,"photo",650,350],a)};linkMap.js_popGallery=function(a,b){Cookie.write("PhotoPop","1",{domain:cookieDomain});popup.attempt([b,"media",782,820],a)};linkMap.js_popGalleryComm=function(a,b){Cookie.write("PhotoPop","1",{domain:cookieDomain});popup.attempt([b,"media",780,950],a)};linkMap.js_popDMO=function(a,b){popup.attempt([b,"dmo",400,400],a)};linkMap.js_popNxTall=function(a,b){popup.attempt([b,330,680],a)};linkMap.js_popNxWide=function(a,b){popup.attempt([b,730,380],a)};linkMap.js_popNxLogin=function(a,b){popup.attempt([b,"login",795,645],a)};linkMap.js_popFraud=function(a,b){popup.attempt([b,"fraud",640,460],a)};linkMap.js_popDestGd=function(a,b){popup.attempt([b,"dest_guide",565,700,(screen.width-700)/2,(screen.height-600)/2],a)};linkMap.js_popSmall=function(a,b){if(screen.width>1024){popup.attempt([b,null,800,600,240,5,false,false,true],a)}else{if(screen.width>800){popup.attempt([b,null,620,500,240,5,false,false,true],a)}else{popup.attempt([b,null,475,390,210,5,false,false,true],a)}}return a};linkMap.js_popProfPhoto=function(a,b){if(screen.width>1024){popup.attempt([b,null,800,500,240,5,false,false,true],a)}else{if(screen.width>800){popup.attempt([b,null,620,450,240,5,false,false,true],a)}else{popup.attempt([b,null,475,390,210,5,false,false,true],a)}}return a};linkMap.js_popPartner=function(a,b){if(screen.width>1024){popup.attempt([b,null,980,500,240,5,false,false,true],a)}else{if(screen.width>800){popup.attempt([b,null,800,500,240,5,false,false,true],a)}else{popup.attempt([b,null,620,450,210,5,false,false,true],a)}}return a};linkMap.js_noTAPD=function(a,b){Cookie.dispose("TAPD",{domain:cookieDomain})};rules["a#TERMS"]=function(a){a.addEvent("click",popup.bind(a).partial(Function._,"terms",300,300,30,25))};linkMap.js_ajaxSubmit=function(a,f){if(!a.className.match(/\bform_(\w+)\b/)){return}var d=$(RegExp.$1);var c={url:a.href,data:d,onFailure:function(e){if(d){d.removeClass("ajaxInFlight")}ta.util.error.ajaxFailure("behavior:js_ajaxSubmit",e)}};var g=window["callback"+d.id];if(a.className.match(/method_(\w+)\b/)){c.method=RegExp["$1"]}if(a.className.match(/\btgt_(\w+)\b/)){c.update=RegExp["$1"]}else{c.onSuccess=function(e){if(d){d.removeClass("ajaxInFlight")}ta.overlays.showInLightbox(e);if(g&&typeOf(g)=="function"){g()}}}new Event(f).preventDefault();var b=window["validate"+d.id];if(b&&typeOf(b)=="function"&&b.apply(d)==false){return}d.addClass("ajaxInFlight");if(a.className.match(/\bevalScripts\b/)){c.evalScripts=true}(c.update?new Request.HTML(c):new Request(c)).send()};linkMap.js_ajax=function(a,b){new Event(b).preventDefault();if(!(tgt=a.className.match(/\btgt_(\w+)\b/))){return}tgt=$(tgt[1]);new Request.HTML({url:a.href,update:tgt,onFailure:ta.util.error.ajaxFailure.partial("behavior:js_ajax")}).send()};linkMap.js_ajaxlogin=function(b,c){new Event(c).preventDefault();if(!(tgt=b.className.match(/\btgt_(\w+)\b/))){return}var a=b.href;tgt=$(tgt[1]);new Request({url:b.href,onSuccess:function(d,f){var e=(d.indexOf("<!--nologin-->")<0);if(!e){login(["tt","ajax","returnTo",a+"&rd=1","greeting","showuserreviews_vote_25ee"])}else{tgt.innerHTML=d}},onFailure:ta.util.error.ajaxFailure.partial("behavior:js_ajaxLogin")}).send()};linkMap.js_ajaxReport=function(a,b){ajaxReport.attempt(b,a)};var ajaxReport=function(a){new Event(a).preventDefault();ta.overlays.loadInLightbox(this.href)};function toggle(a){new Event(a).preventDefault();this.toggleClass("off")}var toggleMeRule=function(a){if(false==a.hasClass("defaultOpen")){a.addClass("off")}a.getElements(".show").addEvent("click",toggle.bind(a));a.getElements(".hide").addEvent("click",toggle.bind(a))};rules["#TOGGLEME"]=toggleMeRule;rules["#TOGGLEME2"]=toggleMeRule;ajaxRules["div.js_swapBlocks"]=function(b){var a=b.getElement(".js_swapOut");var c=b.getElement(".js_swapIn");var d=b.getElement("a.js_swapTrigger");var e=b.getElement("a.js_swapBackTrigger");if(a&&c&&d){d.addEvent("click",function(f){new Event(f).preventDefault();window.removedBit=a.dispose();c.show()});d.removeClass("js_swapTrigger")}if(a&&c&&e){e.addEvent("click",function(f){new Event(f).preventDefault();c.hide();$("parentOfSwapOut").appendChild(window.removedBit)});e.removeClass("js_swapBackTrigger")}};ajaxRules["#PM_UNBLOCK"]=function(a){a.addEvent("submit",function(c){new Event(c).stop();var b=$("PM_UNBLOCK");if(b.unblock.value=="1"){new Request({url:"/SendMessageRD",data:b,onSuccess:ta.overlays.showInLightbox,onFailure:ta.util.error.ajaxFailure.partial("behavior:#PM_UNBLOCK")}).request()}else{$("unblock-intercept").hide();$("blockedreply").show();b.unblock.value="1"}})};function enableCommunity(c,a){var b=c;if(!a){b=function(d){enableCommunityResponse(d,c)}}if(typeof(JS_SECURITY_TOKEN)=="undefined"){JS_SECURITY_TOKEN=""}new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeM2M",set:"on",token:JS_SECURITY_TOKEN},onSuccess:b,onFailure:ta.util.error.ajaxFailure.partial("behavior:enableCommunity")}).send()}function enableCommunityResponse(res,callback){var isf=document.getElementById("inviteStatusField");if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){isf.innerHTML=data.ERROR;isf.style.display="block"}}else{isf.innerHTML=JS_community_on;isf.style.display="block"}}function getRelativeURL(){return window.location.pathname+window.location.search+window.location.hash}var follow=function(a){return function(){window.location=$(a).href}};function showToggleBlock(a){$$(".js_toggleBlocks .js_toggleBlock").each(function(c,b){c.hide();if(c.hasClass(a)){c.show()}})}linkMap.js_toggleBlockTrigger=function(b,c){var a=b.getProperty("class");a.replace(/toggleBlock[0-9]+/g,function(d){a=d});showToggleBlock(a)};rules["#SWAPBLOCK .js_toggleBlock"]=function(b){if(b.hasClass("js_toggleBlockSelected")){var a=b.getProperty("class");a.replace(/toggleBlock[0-9]+/g,function(c){a=c});showToggleBlock(a)}};var showLastSavesRD=function(){var a=$("LAST_SAVES_PLACEHOLDER");if(typeof savesIncluded!="undefined"){if(!a){return renderLastSaves(SAVES_RECENT_SAVES)}else{a.innerHTML=renderLastSaves(SAVES_RECENT_SAVES);flyout.positionCorners()}}else{if(!a){new Asset.javascript(savesJS);showLastSavesRD.delay(125);return new Element("div",{id:"LAST_SAVES_PLACEHOLDER"})}}};var showSavesWidget=function(d,f,c,b,g,e,a){if(typeof savesIncluded!="undefined"){showSavesWidget2(d,f,c,b,g,e,a)}else{new Asset.javascript(savesJS);showSavesWidget.delay(125,null,[d,f,c,b,g,e,a])}};var savesInlineLoginOnClickHandler=function(c,a,b){if(typeof savesIncluded!="undefined"){savesInlineLoginOnClickHandler2(c,a,b)}else{new Asset.javascript(savesJS);savesInlineLoginOnClickHandler.delay(125,null,[c,a,b])}};linkMap.js_trackDirPop=function(a,b){if(actionToRecord=a.className.match(/ar_(\w+)/)){actionToRecord=actionToRecord[1];new Request({url:"/ActionRecord?action="+actionToRecord}).send()}};function clearPopupForm(){$$("#POPUP_FORM #pass").setProperty("value","");$$("#DHTMLPOPUP .error-message").empty()}linkMap.js_clearPopupForm=function(a,b){clearPopupForm()};function setPopupFormAction(a){$$("#POPUP_FORM #action").setProperty("value",a)}linkMap.js_popupFormAction1=function(a,b){setPopupFormAction("1")};linkMap.js_popupFormAction2=function(a,b){setPopupFormAction("2")};var replaceContent=ta.util.element.replaceContent;linkMap.js_replaceContent=function(d,f){var b=d.className.match(/id_([^\s"]*)?/);if(!b||b.length!=2){throw new Error("Links with behavior js_replaceContent must also have a style class id_??? to indicate which element's contents should be replaced")}b=b[1];var c=$(b);var a=d.href;if(a){replaceContent(f,c,a)}f.stop()};function doCookieCheck(){Cookie.write("SessionTest","true",{duration:0});if(Cookie.read("SessionTest")){Cookie.dispose("SessionTest");return true}return false}var doBehavior=function(b){var b=new Event(b||window.event);var a=ta.id(b.target);if(a.get("tag")!="a"){a=a.getParent("a")}if(/pid(\d+)/.test(a.className)){ta.util.cookie.setPIDCookie(RegExp.$1)}(a.className.match(/(js_\w+)/g)||[]).each(function(e){if(window.linkMap){var d=linkMap[e];if(typeof d==="function"){d(a,b)}}})};function _processLink(a){if(a.className.indexOf("js_")>=0||a.className.indexOf("pid")>=0){if(a.addEventListener){a.addEventListener("click",doBehavior,false)}else{a.attachEvent("onclick",doBehavior)}try{if(a.className.match(/\b(js_pop)/)&&window.noPopClass){a.className=a.className+" "+window.noPopClass}}catch(b){ta.util.error.record(b,"_processLink - add no pop class")}}}function processLinks(a){var b=Array.from(a.getElementsByTagName("a"));b.each(_processLink);return b.length}if(typeof behavior=="undefined"){ta.queueForLoad(function(){processLinks(document)},"ProcessLinkBehavior")}(function(){function a(){if(window==window.top){var j=Cookie.read("ajaxAction");if(j){j=j.split("|");if(/^target:(\/[\w\d_-]+)/.test(j[0])){if(window.location.pathname.indexOf(RegExp.$1)!==0){return}j=j.slice(1)}else{if(window.opener){return}}Cookie.dispose("ajaxAction",{domain:cookieDomain,path:"/"});if((j[0]=="focus"||j[0]=="click")&&j.length>1){for(var f=0;f<j.length;f+=2){var d=ta.select(j[f+1]);if(d&&d.length){try{d[0][j[f]]()}catch(g){ta.util.error.record(g,"ajaxAction",null,{funcName:j[f],elmt:j[f+1]})}}}}else{try{var b=j.slice(1);b.unshift({});b.unshift(j[0]);ta.run.apply(null,b)}catch(h){ta.util.error.record(h,"ajaxAction",null,{funcName:j[0]})}}}}}ta.queueForLoad(function(){Cookie.dispose("TATypeAhead");a();if(Browser.firefox||Browser.safari||Browser.chrome){var c=window.location.hash;if(c.length>1){c=c.substring(1)}var b=ta.id(c);if(b&&b.getTop()!=window.getScrollTop()){window.scrollTo(0,b.getTop())}}if(/^#save/.test(location.hash)){doSavesPostLoginPopup()}freshVSCookieCheck()},1,"On_Load_Popups")}());ta.queueForLoad(function(){if(typeof cpu_run!="undefined"){cpu_run()}},"Commerce Popunder");function freshVSCookieCheck(){if(typeof freshVSTrackingCookie!="undefined"&&freshVSTrackingCookie){var a=new Cookie("v1st").readRaw();if(a){new Request({url:"/VSCookieRequest"}).send()}}}function royBatty(){if(typeof taSecureToken=="undefined"||!taSecureToken){return}try{var d=Cookie.read("roybatty");if(!window.taEarlyRoyBattyStatus){if(!d){Cookie.write("roybatty",taSecureToken+",1",{domain:cookieDomain});if(ta.browser&&ta.browser.isIEMetro&&ta.browser.isIEMetro()){new Request({url:"/CookiePingback?metroBrowser=true"}).send()}else{new Request({url:"/CookiePingback"}).send()}}else{var b=d.split(",");if(b&&b.length==2){var a=parseInt(b[1],10);Cookie.write("roybatty",taSecureToken+","+a,{domain:cookieDomain})}else{if(b&&b.length==1){Cookie.write("roybatty",taSecureToken)}else{ta.util.error.record(null,"royBatty -- Bad value in cookie: "+d)}}}}ta.store("roybatty.checked",true)}catch(c){ta.util.error.record(c,"javascript exection bot detection error")}}ta.queueForLoad(function(){if(typeof royBatty!="undefined"){royBatty()}},"RoyBatty");var doSavesPostLoginPopup=function(){if(typeof savesIncluded!="undefined"){handleSavesPostLoginPopup()}else{new Asset.javascript(savesJS);doSavesPostLoginPopup.delay(125)}};if(window.showPopup){showPopup()}function setDHTMLPopupShown(){if(window.ta&&window.ta.store){window.ta.store("DHTML_POPUP_SHOWN",true)}}function checkDHTMLPopupShown(){return window.ta&&window.ta.has&&window.ta.has("DHTML_POPUP_SHOWN")}var popupConfig={};function DHTMLOverlayRequest(f,e,c,d){var b="?";if(popupConfig.servletUrl.contains(b)){b="&"}if(popupConfig.servletUrl.contains("fromServlet=")){var a=popupConfig.servletUrl+b+"Action="+f}else{var a=popupConfig.servletUrl+b+"Action="+f+"&fromServlet="+pageServlet}new Request({url:a,onSuccess:e,onFailure:c,data:d,evalScripts:true}).send()}function showDHTMLPopup(b,g,d,a,f){try{popupConfig.servlet=b;popupConfig.servletUrl=g;popupConfig.lightbox=d||(a&&a.lightbox)||false;popupConfig.options=a;if(a&&a.loading&&f){f=new Event(f);ta.id(a.loading).show().inject(document.body).setStyles({left:f.page.x+20,top:f.page.y})}DHTMLOverlayRequest("Open",DHTMLOverlayResponse,null,a?a.data:null);if(a&&a.trackInterrupt&&ta.util&&ta.util.recordInterruption){ta.util.recordInterruption("popup",a.popupName)}}catch(c){ta.util.error.record(c,"showDHTMLPopup - "+b,f)}}var DHTMLOverlayResponse=function(g){if(!g){return}if(!ta.overlays||!ta.overlays.Factory){ta.load("ta-overlays",function(){DHTMLOverlayResponse(g)});return}if(popupConfig.options&&popupConfig.options.forward&&window.popupForward){window.location=window.popupForward}$$("#FLYOUT").each(function(j,i){j.dispose()});window.lightbox.deactivate();$$(".overlay").each(function(j,i){if(j.overlay&&j.overlay.hide){j.overlay.hide()}else{if(j.hide){j.hide()}else{j.dispose()}}});if(popupConfig.options&&popupConfig.options.loading){ta.id(popupConfig.options.loading).hide()}var d;var c={};if(popupConfig.lightbox){c.backdrop=ta.overlays.BACKDROP_ALWAYS}if(popupConfig.options&&popupConfig.options.delayedPosition){c.delayedPosition=popupConfig.options.delayedPosition}if(popupConfig.options&&popupConfig.options.permanent){c.permanent=popupConfig.options.permanent}if(popupConfig.options&&popupConfig.options.closeOnDocumentClick){c.closeOnDocumentClick=popupConfig.options.closeOnDocumentClick}if(popupConfig.options&&popupConfig.options.center){c.autoShow=false;d=new ta.overlays.CenteredOverlay(c)}else{if(popupConfig.options&&popupConfig.options.permanent){c.xOffset=ta.id("PAGE").getLeft()+100;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.PermanentOverlay(c)}else{if(popupConfig.options&&popupConfig.options.daodaoPopup){c.xOffset=ta.id("PAGE").getLeft()+240;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.AbsoluteOverlay(c)}else{c.xOffset=ta.id("PAGE").getLeft()+100;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.AbsoluteOverlay(c)}}}d.loadRemoteSuccess(g);d.show();setDHTMLPopupShown();ta.popups.PopUtil.trackPopup(popupConfig.servletUrl);var h=function(){if(typeof dhtmlRedirectLink!="undefined"){window.location=dhtmlRedirectLink;return}if(this.inner.getElement(".refreshOnClose")){document.location.reload();return}if(typeof addPopupCloseClass!="undefined"&&!this.inner.getElement(".silentClose")){DHTMLOverlayRequest("Close")}if(this.inner.getElement(".popupBackOnClose")){if(/(?:^|;)\\s*TAReturnTo=\%1\%([^;]*)/.test(document.cookie)){window.location=decodeURIComponent(RegExp.$1)}else{window.location="/"}}};d.addEvent("onHide",h);if(popupConfig.servlet){d.container.addClass(popupConfig.servlet);d.container.addClass("np");if(popupConfig.servlet=="RuleBasedPopup"&&popupConfig.options&&popupConfig.options.cmsDisplayName){d.container.addClass(popupConfig.options.cmsDisplayName)}d.inner.getElements(".popupConvert").each(function(j,i){j.addEvent("click",function(){DHTMLOverlayRequest("Convert")})});d.inner.getElements(".popupDecline").each(function(j,i){j.addEvent("click",function(){DHTMLOverlayRequest("Decline")})});d.inner.getElements(".dhtmlclose").each(function(j,i){j.addEvent("click",function(){var k=d;k.hide()})});var b=function(j){var i=(j.charCode)?j.charCode:((j.which)?j.which:j.keyCode);if(i==13||i==10){e(j)}};var f=function(j){var i=(j.charCode)?j.charCode:((j.which)?j.which:j.keyCode);if(i==13||i==10){new Event(j).preventDefault()}};d.inner.getElements(".popupSubmitOnEnter").each(function(j,i){j.addEvent("keydown",b)});var a=function(i){$$("#POPUP_FORM #sendpass").setProperty("value","true");e(i)};d.inner.getElements(".popupSendForgotEmail").each(function(j,i){j.addEvent("click",a)});var e=function(i){new Event(i).preventDefault();d.inner.getElements(".popupSubmit").each(function(k,j){k.removeEvent("click",e)});d.inner.getElements(".popupSendForgotEmail").each(function(k,j){k.removeEvent("click",a)});d.inner.getElements(".popupSubmitOnEnter").each(function(k,j){k.removeEvent("keydown",b);k.addEvent("keydown",f)});d.inner.getElements(".focusClear").each(function(k,j){k.setProperty("value","")});if(popupConfig.options&&popupConfig.options.disableOnHideForSubmit){d.removeEvent("onHide",h)}DHTMLOverlayRequest("Submit",DHTMLOverlayResponse,null,d.inner.getElementById("POPUP_FORM"))};d.inner.getElements(".popupSubmit").each(function(j,i){j.addEvent("click",e)})}if(popupConfig.options&&popupConfig.options.callback){popupConfig.options.callback(d.container)}};function showOwnersDHTMLPopup(b,c){var a={callback:enableAffilBox};showDHTMLPopup(b,c,true,a)}function enableAffilBox(c){if(typeof c=="undefined"||c==null){return}for(var a=0;a<3;a++){var d="affil_"+a;var b=c.getElementById(d);if(b!=null&&b!=false&&b!=""){b.style.visibility="visible"}}};function expandIframe(c,a,b){if(document.getElementById(c)){document.getElementById(c).width=a;document.getElementById(c).height=b}}function collapseAd(c){var a=ta.id(c);if(a==null){return}var b=ta.id(a.parentNode);if(b&&b.hasClass&&b.hasClass("adServer")){b.addClass("taEmpty")}else{ta.util.error.record(null,"ta.common.ads.collapseAd:fail",null,{},"WARN")}}function createAdIframe(d,b,a){var c=document.createElement("iframe");c.setAttribute("id",d);c.setAttribute("name",d);c.setAttribute("height",0);c.setAttribute("width",0);c.setAttribute("scrolling","no");c.setAttribute("border","0");c.setAttribute("marginheight","0");c.setAttribute("marginwidth","0");c.setAttribute("frameBorder","0");c.setAttribute("src","//"+document.location.host+"/"+b+"#"+a);return c}function injectAds(){var d=$$(".adServer .details");if(d.length==0){return}var b="adp/adp.html";if(adpHtml){b=adpHtml}var a=window.documentDomainChanged?"dd+":"";for(var c=0;c<d.length;c++){var e=ta.id(d[c]).getParent(".adInner");if(e&&e.hasClass("deferAd")){continue}var f=d[c].id+"_iframe";if(!ta.id(f)){d[c].getParent().appendChild(createAdIframe(f,b,a+d[c].id))}}}function injectAdsTargeted(a,b){if(!ta.has("p13n.requestAds")||ta.retrieve("p13n.requestAds")){ta.common.ads.injectAdsTargeted(a,b)}}function getIncrementedAdsAjaxCount(){return ta.common.ads.getIncrementedAdsAjaxCount()}window.addEvent("load",function(){if(ta.has("ads.gptEnabled")){window.addEvent("onPopunderBlur",function(){ta.common.ads.resetAdRefreshFlag();ta.common.ads.setLocalStorageTargeting()});if(window.pageServlet==="Hotels"){ta.on("onUpdateHACAds",function(){googletag.cmd.push(function(){ta.common.ads.refreshAjaxAds("#HAC_RESULTS .gptAd")})});if(!ta.widgets.calendar.hasPageDates()){googletag.cmd.push(function(){ta.common.ads.refreshAjaxAds("#HAC_RESULTS .gptAd")})}}if(window.pageServlet==="Attractions"){window.addEvent("onAttractionFilterChange",ta.common.ads.refreshAllAds)}if(window.pageServlet==="Restaurants"){window.addEvent("onRestaurantFilterChange",ta.common.ads.refreshAllAds)}if((window.pageServlet==="HotelsList"&&ta.retrieve("ta.p13n.blender_with_category_xsells.enabled"))||(window.pageServlet==="ThemePark")){ta.on("onHACUpdateComplete",function(){ta.common.ads.refreshAllAdsPolitely(true)})}if(window.pageServlet==="VRACSearch"&&ta.retrieve("vrDblClickAdCallsEnabled")){ta.on("onVRACSearchFilterChange",function(){ta.common.ads.refreshAllAdsPolitely(true)})}if(!ta.has("ads.disableEventRefresh")){window.addEvent("focus",function(){ta.common.ads.refreshAllAdsPolitely(false)});window.addEvent("onOverlayClose",ta.common.ads.refreshAllAdsPolitely);if(ta.has("ads.calendarSelectRefresh")){window.addEvent("onCalendarSelect",function(){if(ta.common.ads.noOverlaysDisplayed()){ta.common.ads.refreshAllAdsPolitely()}})}if(window.pageServlet==="Search"){window.addEvent("onUpdateSearchResults",ta.common.ads.refreshAllAds)}}if(window.pageServlet==="Hotels"){window.addEvent("onChangeCategory",ta.common.ads.refreshAdsWithType)}if(ta.has("ads.reverseScroll")){if(window.pageServlet==="Hotel_Review"||window.pageServlet==="Attraction_Review"||window.pageServlet==="Restaurant_Review"){window.addEvent("scrollingTabs_Start",ta.common.ads.pauseOnScrollInjection);window.addEvent("scrollingTabs_End",ta.common.ads.resumeOnScrollInjection)}}}else{injectAds.delay(10)}});ta.common.ads=(function(f,C,h,p){var d=0,E=1237,l=0,n=new Date().getTime(),y=10000,I=true,J=true,b=29867505611,s=function(){J=true;C.removeEvent("scroll",s)},K=false,A=h.util&&h.util.localstorage&&h.util.localstorage.canUseLocalStore(),m=false,x=91472856971,t="gpt-ad-4x4-locationphotoalbum",z=function(M){return typeof M=="string"||typeof M=="number"||typeof M=="boolean"},i=null,v=null,o=function(M){return(M&&M.id.replace(/-ref\d+/,"")==i)},e=function(){var Q=C.getWidth,N=C.getHeight,P=100;var M=(typeof Q==="function")?Math.floor(Q()/P)*P:0;var O=(typeof N==="function")?Math.floor(N()/P)*P:0;M=(M>2000)?9999:M;O=(O>1500)?9999:O;return"w"+M+"_h"+O},k=function(O){var N="WIN_SIZE";if(O&&O.win_size&&O.report){var P=O.report;for(var M=0;M<P.length;M++){if(P[M].indexOf(N)>-1){P[M]=P[M].replace(N,O.win_size);break}}}},D=function(N){var R=[],P=[];P.top="a";P.bottom="b";if(N.constructor===Array){for(var O=0,M=N.length;O<M;O++){var Q=N[O];if(P[Q]){R.push(Q);R.push(P[Q])}}}else{if(P[N]){R.push(N);R.push(P[N])}}return(R.length)?R:N},a=function(){if(!K){return}h.remove("deferAds.ads");var N=C.getScroll().y;var R=h.retrieve("ads.adStubs");if(R){try{for(var Q=0,M=R.length;Q<M;Q++){var P=R[Q];var O=h.id(P.tgt);var T=h.common.ads.getAd(P);if(O&&T&&!T.adInjected&&!T.gutterAd){if(h.has("scrollAd.enableScroll")&&o(T)){h.common.scrollAd.resetScrollAd()}else{T.injectOnScrollUp=O.getCoordinates().bottom<N}T.injectWhenViewable(false)}}}catch(S){h.util.error.record(S,"error resetting ads after autoScroll")}K=false;if(h.has("scrollAd.enableScroll")){C.fireEvent("scroll")}}},q=function(M){var O=false;try{var Q=M.adStub.tgt;if(Q.match(/ref\d+/)){var N=parseInt(Q.match(/ref(\d+)/)[1],10)+1;O=Q.replace(/ref\d+/,"ref"+N)}else{O=Q+"-ref1"}}catch(P){h.util.error.record(P,"error building refresh ad id")}return O},r=function(Q){try{var R=Q.adStub;var M=q(Q);if(!M){var N=(Q&&Q.adElem&&Q.adElem.id)?Q.adElem.id:null;throw new Error("unable to build refresh ad id for "+N)}R.tgt=M;var U=h.id(Q.adElem.cloneNode(false));U.id=R.tgt;U.removeClass("taEmpty");if(U.className.toLowerCase().indexOf("gutterad")==-1){U.set("style","")}var T=h.id(Q.adId);var S=T.parentNode;S.replaceChild(U,T);var O=new h.common.ads.TripAd(R);O.addTargeting(Q.slotTargeting);O.injectWhenViewable()}catch(P){h.util.error.record(P,"error cloning ad for refresh")}},w=function(N){if(!I){return false}if(N){return true}var M=new Date().getTime();if(M-n>y){n=M;return true}else{return false}},j=function(M,P,N){var O=false;if(M){O=true;if(M.getParent(".ad.inactive")){return false}if(!N&&P&&P.slotTargeting&&P.slotTargeting.disable_event_refresh){return false}if(P.gutterAd&&h.common.gutterAd&&!h.common.gutterAd.shouldDisplay()){return false}}return O},L=function(){var O=0;if(!h.has("ads.reverseScroll")){return O}if(C.location.hash){var M=f.getElement(C.location.hash);if(M&&M.isVisible()){if(h.has("scrollingTabs.scrollOnPageLoad")){O=h.retrieve("scrollingTabs.scrollOnPageLoad")}else{O=M.getCoordinates().top}if(O>0){var N=C.getScroll().y;if(N==0){J=false;C.addEvent("scroll",s)}}}}return O},F=function(M,T,O,W,R){try{if(M&&T&&T.requestStart&&O&&W){var U=50,S=O-T.requestStart,X=Math.floor(S/U)*U,P=new Date().getTime()-T.requestStart,Q=Math.floor(P/U)*U,Z=T.adId.replace("gpt-ad-","").replace(/-ref\d+/g,""),Y=[Z,((R)?"ad:y":"ad:n"),M.creativeId],N="recvd_"+X;h.trackEventOnPage("ad_latency",Y.join("|"),N,Q,true);T.requestStart=null}}catch(V){}},u=function(P){if(P){try{var N=P.slot.getSlotId().getDomId();var M=h.id(N);if(N&&M){var T=h.retrieve("tripads."+N);if(T&&T.requestStart){var O=new Date().getTime();var S=!P.isEmpty&&!M.hasClass("taEmpty");var Q=M.getElement("div iframe");if(S&&Q){Q.addEvent("load",function(){F(P,T,O,new Date().getTime(),S)})}else{F(P,T,O,O,S)}}}}catch(R){}}},G=function(N){try{if(N&&N.slot&&N.creativeId){var M=h.id(N.slot.getSlotId().getDomId());if(M){M.setAttribute("data-creative-id",N.creativeId)}}}catch(O){}},g=function(M){if(M&&!m&&h.photos&&h.photos.sponsoredVideo&&t==M.slot.getSlotId().getDomId()){m=true;if(M.creativeId&&M.creativeId!=x){h.photos.sponsoredVideo.setSponsoredContentAvailable(true)}}},c=function(M){if("VacationRentalReview"==pageServlet&&M&&M.creativeId!=(b)){h.fireEvent("VRGalleryAdContentReceived")}},B=function(M){try{G(M);g(M);if(h.has("ads.requestTracking")){u(M)}c(M);C.fireEvent("onAdRender",{domId:M.slot.getSlotId().getDomId()})}catch(N){h.util.error.record(N,"post render processing error")}},H=function(N){if(h.has("scrollAd.enableScroll")){if(N&&N.id&&o(N)){try{h.common.scrollAd.addScrollHandler()}catch(M){h.util.error.record(M,"error checking for scrolling ad")}}}};return{TripAd:new Class({adBase:null,adElem:null,adId:null,adSizes:[],adInjected:false,refreshWithNewContext:true,requestStart:null,adStub:null,adSlot:null,slotTargeting:{},id:null,type:null,options:{debug:false,collapse:true},Implements:[Options],initialize:function(N,M){try{this.setOptions(M);this.adStub=N;this.adBase=N.base;this.adSizes=N.size;this.adId=N.tgt;this.id=N.tgt;this.type=N.type;this.errorKey="ads.fail."+N.tgt;this.adElem=h.id(this.adId);this.injectOnScrollUp=false;this.reservedHeight=(this.adElem&&this.adElem.getParent(".ad"))?this.adElem.getParent(".ad").offsetHeight:0;if(!this.adElem){throw new Error("element for ad slot does not exist")}if(!h.has("tripads."+this.adId)){this.adSlot=googletag.defineSlot(N.base,N.size,N.tgt).addService(googletag.pubads()).setCollapseEmptyDiv(this.options.collapse,!this.adStub.isExpanded);if(N.custom_targeting&&N.custom_targeting.companion){this.adSlot.addService(googletag.companionAds())}}else{throw new Error("ad slot has already been created")}if(N.custom_targeting){this.addTargeting(N.custom_targeting)}this.addElementTargeting();h.store("tripads."+this.adId,this)}catch(O){throw new Error("Unable to create TripAd for target "+this.adId+": "+O.message)}},inject:function(N){if(N==false){this.refreshWithNewContext=false}try{var M=h.id(this.adId);if(M&&M.hasClass("inactive")){return}if(this.adInjected){if(M){this.adStub.isExpanded=!M.hasClass("taEmpty")&&M.getStyle("display")!="none";M.removeClass("taEmpty");if(this.refreshWithNewContext){googletag.pubads().refresh([this.adSlot]);H(this)}else{this.refresh()}}else{throw new Error("ad refresh fail, elem does not exist: "+this.adId)}}else{googletag.display(this.adId);this.adInjected=true;if(h.has("ads.requestTracking")){this.requestStart=new Date().getTime()}H(this)}}catch(O){if(!h.has(this.errorKey)){h.util.error.record(O,"unable to inject TripAd for target: "+this.adId);h.store(this.errorKey,true)}}},refresh:function(){r(this)},injectWhenViewable:function(M){if(M==false){this.refreshWithNewContext=false}try{if(this.isInView()){this.inject(this.refreshWithNewContext)}else{this.defer()}}catch(N){h.util.error.record(N,"unable to inject/defer TripAd")}},defer:function(){var O=h.retrieve("deferAds.ads")||[];var M=O.length>0;var Q=false;if(M){for(var P=0;P<O.length;P++){var N=O[P];if(N&&this.adId==N.adId){Q=true;break}}if(!Q){O.push(this);h.store("deferAds.ads",O)}}else{O.push(this);h.store("deferAds.ads",O);C.ta_handleAdDefer=h.common.ads.deferAds;C.addEvent("scroll",C.ta_handleAdDefer)}},getPosY:function(){var M=this.adElem;return M.getCoordinates().top},isInView:function(){if(K){return false}if(!h.has("ads.deferEnabled")){return true}var M=C.getScroll().y;if(this.injectOnScrollUp){return J&&this.getPosY()+this.reservedHeight>M}else{return this.getPosY()<M+C.getHeight()}},isLeaderboard:function(){return this.adId.indexOf("gpt-ad-728x90")>-1},addElementTargeting:function(){if(this.adElem&&this.adElem.getAttribute("data-targeting")){var N=this.adElem.getAttribute("data-targeting");if(C.JSON&&JSON.parse){try{var M=JSON.parse(N.replace(/'/g,'"'));this.addTargeting(M)}catch(O){h.util.error.record(O,"error applying element ad targeting")}}}},addTargeting:function(N){try{N=this.mergeTargeting(N);if(N.pos){N.pos=D(N.pos)}this.slotTargeting=N;for(var M in N){this.adSlot.setTargeting(M,N[M])}}catch(O){h.util.error.record(O,"error applying ad slot targeting")}},mergeTargeting:function(S){var O=this.slotTargeting;for(var N in S){if(O[N]==S[N]){continue}if(N=="kw"){O.kw=S.kw;continue}if(N=="proptype"){O.proptype=S.proptype;continue}if(!O[N]){O[N]=S[N]}else{if(z(O[N])){O[N]=[O[N]]}if(z(S[N])){S[N]=[S[N]]}var R=O[N].concat(S[N]);var Q=[];for(var M=R.length-1;M>-1;M--){var P=R.pop();if(!Q.contains(P)){Q.push(P)}}O[N]=Q.reverse()}}return O},clearTargeting:function(){this.adSlot.clearTargeting();this.slotTargeting={}},updateHotelStyle:function(N){if(N&&this.adSlot){N=N.toLowerCase();var M={};M.triptype=N;var O=h.common.ads.SEGMENT_MAP[N];if(O){M.seg=O}this.addTargeting(M)}},updateHotelType:function(M){if(M&&this.adSlot){M=M.toLowerCase();var N={};N.proptype=M;var O=h.common.ads.SEGMENT_MAP[M];if(O){N.seg=O}this.addTargeting(N)}},isVisible:function(){return this.adElem.isVisible()}}),injectAjaxAds:function(O,M,N){if(!(C.googletag&&C.googletag.cmd)){h.util.error.record(null,"googletag not defined, unable to inject ads for servlet: "+O+","+M);return}googletag.cmd.push(function(){if(typeof O=="string"){var U="ads."+O.toLowerCase();var P=h.retrieve(U+".adStubs");var R=h.retrieve(U+".pageTargeting");var Y=f.getElement(M);if(P&&P.length&&Y&&Y.id){var X=false;for(var T=0;T<P.length;T++){var S=P[T];if(S&&S.tgt){var Q=S.tgt.split("-").slice(0,3).join("-");if(Y.id.indexOf(Q)>-1){S.tgt=Y.id;X=S;break}}}if(X){try{var W=h.common.ads.getAd(X);if(W){if(R){W.addTargeting(R)}W.inject(N)}}catch(V){h.util.error.record(V,"unable to inject ajax ad for: "+X.tgt)}}}}})},getSidebarElem:function(){if(h.retrieve("hr_below_the_fold_redesign.enabled")){return f.getElement(".accommodation_card_wrap")}if(h.retrieve("persistent_sidebar")){return f.getElements("#BODYCON .gridA .sidebar").getLast()}return f.getElement(".scrollAdSidebar")||f.getElement("#BODYCON .gridA .sidebar")},setAdIdThatEnablesScrolling:function(M){if(M){i=M.replace(/-ref\d+/,"");return}v=h.common.ads.getSidebarElem();if(v){var O=v.getElements(".gptAd");for(var N=O.length-1;N>=0;N--){if(!O[N].hasClass("inactive")){i=O[N].id.replace(/-ref\d+/,"");break}}}},getAd:function(U){var R=null;if(U){try{if(U.tgt){var X="tripads."+U.tgt;if(h.has(X)){R=h.retrieve(X);var V=h.id(R.adId);if(V){R.adElem=V}else{var Y=h.id(U.tgt.replace(/-ref\d+/,""));if(Y){R.adElem=Y;R.adId=R.id=Y.id}else{R=null}}}else{try{R=new h.common.ads.TripAd(U)}catch(T){return null}}}else{var S=U;var N=h.retrieve("ads.adStubs");if(N){for(var Q=0;Q<N.length;Q++){var P=N[Q];if(P.tgt&&P.tgt.test(/-ref\d+/)&&!S.test(/-ref\d+/)&&P.tgt.replace(/-ref\d+/,"")==S){var M=h.id(S);if(M){M.id=S=P.tgt}}if(P.tgt==S){try{var W="tripads."+P.tgt;if(h.has(W)){R=h.retrieve(W);break}else{R=new h.common.ads.TripAd(P);break}}catch(T){return null}}}}}if(h.common.gutterAd){var Z=h.id(U.tgt);if(Z&&Z.hasClass(h.common.gutterAd.adElemClass)&&R){R.gutterAd=true}}}catch(T){var O=(typeof U=="string")?U:U.tgt;h.util.error.record(T,"unable to get ad for id: "+O)}}return R},getIncrementedAdsAjaxCount:function(){return ++d},checkForSponsoredVideo:function(){if(h.id(t)){var M="#"+t;h.common.ads.injectAjaxAds("locationphotoalbum",M,false)}else{h.util.error.record(null,"sponsored video 4x4 ad target not found, sponsored video skipped")}},disableRefresh:function(){I=false},initDoubleClick:function(){var M=f.createElement("script");M.async=true;M.type="text/javascript";var O="https:"==f.location.protocol;M.src=(O?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var N=f.getElementsByTagName("script")[0];N.parentNode.insertBefore(M,N);googletag.cmd.push(function(){h.common.ads.addPageTargeting();if(h.has("jwplayerHelper.adUrl")){googletag.pubads().enableVideoAds()}h.common.ads.setAdIdThatEnablesScrolling();googletag.enableServices();h.common.ads.injectViewable();if(h.has("ads.peelbackEnabled")&&h.id("gpt-peelback")&&h.has("ads.gptBase")){if(f.body.offsetWidth>=E){googletag.defineOutOfPageSlot(h.retrieve("ads.gptBase"),"gpt-peelback").addService(googletag.pubads()).setCollapseEmptyDiv(true);googletag.display("gpt-peelback")}else{h.store("ads.pbSuppress",true)}}googletag.pubads().addEventListener("slotRenderEnded",B);if(h.has("ads.right_gutter_ad")){h.common.gutterAd.init({scroll:false,ads:[{max_width:200,adId:"gpt-ad-200x600-c"},{max_width:300,adId:"gpt-ad-300x250-300x600-c"}]})}else{if(h.has("ads.hotels_side_banner")){h.common.gutterAd.init()}else{if(h.has("ads.hotels_side_banner_control_tracking")){h.common.gutterAd.init_justTracking()}}}})},addPageTargeting:function(){try{var N=h.retrieve("ads.pageTargeting")||{};N.win_size=e();k(N);for(var M in N){googletag.pubads().setTargeting(M,N[M])}}catch(O){h.util.error.record(O,"GPT init: unable to add page targetiing")}},injectViewable:function(){l=L();var Q=h.retrieve("ads.adStubs");if(Q&&Q.length){for(var P=0;P<Q.length;P++){var O=Q[P];if(O.tgt){var N=h.id(O.tgt);if(N&&N.hasClass&&!N.hasClass("delayAd")){try{var M=new h.common.ads.TripAd(O);if(h.has("ads.reverseScroll")&&M.getPosY()<l){M.injectOnScrollUp=true}if(M.isInView()){M.inject()}else{M.defer()}}catch(R){h.util.error.record(R,"unable to create TripAd object for "+O.tgt)}}}}}},collapseAd:function(M){if(h.has("ads.gptEnabled")&&M&&M.parentNode){var N=M.parentNode;do{if(N.className&&N.className.indexOf("gptAd")>-1){N.className+=" taEmpty";break}}while(N=N.parentNode)}},injectAdsTargeted:function(P,R){if(P==null||typeof P!="object"){h.util.error.record("ad injection requires target element, element passed is "+typeof P);return}if(h.has("ads.gptEnabled")){var T=P;T.inject(this.refreshWithNewContext);return}var Q=P.getElements(".adServer .details");if(Q.length==0){return}var N="adp/adp.html";if(adpHtml){N=adpHtml}var M=C.documentDomainChanged?"dd+":"";for(var S=0;S<Q.length;S++){var W=Q[S].getParent(".adServer");var U=Q[S].id+"_iframe";if(h.id(U)){var V=Q[S].cloneNode(true);W.empty().grab(V)}var O=createAdIframe(U,N,M+Q[S].id);if(R){h.id(O).addEvent("load",R)}W.appendChild(O)}},getMetaContent:function(O){var R=f.getElementsByTagName("meta");for(var N=0;N<R.length;N++){var Q=R[N];var M=Q.name;var P=new RegExp(O,"i");if(M.match(P)){return Q.content.replace(/["<>]/g,"")}}return""},loadMonikersAdcomHelper:function(){var M=h.common.ads.getMetaContent("keywords");var O=h.common.ads.getMetaContent("description");var P=f.location.href;var R=f.referrer;var N="/uvpages/adcom.html?pageRef="+encodeURIComponent(R)+"&keywords="+encodeURIComponent(M)+"&description="+encodeURIComponent(O)+"&pageUrl="+encodeURIComponent(P);var Q=f.createElement("iframe");Q.setAttribute("width","1");Q.setAttribute("height","1");Q.setAttribute("src",N);f.body.appendChild(Q)},SEGMENT_MAP:{"family-friendly":"fam",trendy:"trendy_hotel",business:"biz",on_the_beach:"beach",ski_in_out:"ski",luxury:"luxury",spa:"spa",casino:"casino"},refreshAdAjax:function(N,M,O,P){new Request({url:"/InjectAdAjax?t="+M+"&adParamKey="+O+"&adParamVal="+P,method:"get",evalScripts:true,onSuccess:function(Q){var R=f.getElement(N);if(R){R.empty();R.set("html",Q);injectAdsTargeted(R)}else{h.util.error.record(null,"ta.common.ads.refreshAdAjax: target not found")}},onFailure:function(){h.util.error.record(null,"ta.common.ads.refreshAdAjax: request failed")}}).send()},deferAds:function(){var V=h.retrieve("deferAds.ads"),R,S;if(!V){return}try{var U=false;for(R=0,S=V.length;R<S;R++){var P=V[R];if(P&&P.isVisible()&&P.isInView()){injectAdsTargeted(P);if(h.servlet.HotelReview){h.servlet.HotelReview.pushXsellToBottom.delay(1000)}if(h.eateries){h.eateries.pushXsellToBottom.delay(1000)}if(h.attractions){h.attractions.pushXsellToBottom.delay(1000)}U=true;delete V[R]}}if(U){var M=[];for(R=0,S=V.length;R<S;R++){if(typeof V[R]!="undefined"){M.push(V[R])}}if(M.length>0){h.store("deferAds.ads",M)}else{h.remove("deferAds.ads");C.removeEvent("scroll",C.ta_handleAdDefer)}}}catch(T){try{C.removeEvent("scroll",C.ta_handleAdDefer)}catch(Q){}var N=(P&&P.id)?P.id:"undefined";var O="ta.common.Ads.deferAds: Error with defer. ad ID: "+N;h.util.error.record(T,O)}},queueForInjection:function(M){if(!(C.googletag&&C.googletag.cmd)){h.util.error.record(null,"googletag not defined, unable to queue ad for injection");return}if(M&&M.each){googletag.cmd.push(function(){M.each(function(N){var O=h.common.ads.getAd(N);if(O){O.injectWhenViewable(false)}})})}},resetAdRefreshFlag:function(){n=new Date().getTime()},setLocalStorageTargeting:function(){if(A){if(h.has("ads.gptBase")){localStorage.setItem("ads.storage.gptBase",h.retrieve("ads.gptBase"))}if(h.has("ads.pageTargeting")){localStorage.setItem("ads.storage.pageTargeting",JSON.stringify(h.retrieve("ads.pageTargeting")))}}},detectAdBlockers:function(){if(h.trackEventOnPage&&C.Browser){var N=function(Q){setTimeout(function(){var S=true;var U=h.id("ABCHK");var T=function(W,V){if(S){if(!V){W="none"}W+="_"+Browser.name;h.trackEventOnPage("ab_chk",W,V,0,false);S=false}};if(U){var R=U.style.display=="none"||U.className!="adInner";if(!R&&C.getComputedStyle){R=C.getComputedStyle(U).getPropertyValue("display")=="none"}T(Q,R)}},500)};var M=C.CDNHOST||"";var P=M+"/img2/x.gif?ads=1&rnd="+Math.floor(Math.random()*100000);var O=new Element("img",{id:"ABCHK","class":"adInner",height:0,width:0,src:P});O.onload=function(){N("ab")};O.onerror=function(){N("abp")};f.body.appendChild(O)}},getLocalStorageTargeting:function(){var M={};if(A){if(localStorage.getItem("ads.storage.gptBase")){M.gptBase=localStorage.getItem("ads.storage.gptBase")}if(localStorage.getItem("ads.storage.pageTargeting")){M.pageTargeting=JSON.parse(localStorage.getItem("ads.storage.pageTargeting"))}}return M},hasStoredGeo:function(){var M=false;if(A&&localStorage.getItem("ads.storage.pageTargeting")){var N=JSON.parse(localStorage.getItem("ads.storage.pageTargeting"));M=!!N.geo}return M},pauseOnScrollInjection:function(){if(h.has("deferAds.ads")){K=true}},resumeOnScrollInjection:function(){if(h.has("deferAds.ads")){a()}},noOverlaysDisplayed:function(){if(h.overlays&&h.overlays.getCurrent){return typeof h.overlays.getCurrent()==="undefined"}else{return true}},refreshAjaxAds:function(M){var N=f.getElements(M);N.each(function(O){var P=h.common.ads.getAd(O.id);if(P&&P.adElem&&P.adElem.getCoordinates){if(P.adElem.getCoordinates().bottom<scroll){P.injectOnScrollUp=true}else{P.injectOnScrollUp=false}P.injectWhenViewable(false)}})},refreshAllAdsPolitely:function(M){h.common.ads.refreshAllAds.delay(1,null,[M])},refreshAllAds:function(M){if(!(w(M)&&C.googletag&&C.googletag.cmd)){return}googletag.cmd.push(function(){try{var N=C.getScroll().y;var R=h.retrieve("ads.adStubs");if(R){googletag.pubads().updateCorrelator();for(var Q=0;Q<R.length;Q++){var P=R[Q];var O=h.id(P.tgt)||h.id(P.tgt.replace(/-ref\d+/,""));var T=h.common.ads.getAd(P);if(O&&T){if(j(O,T,M)){if(h.has("scrollAd.enableScroll")&&o(T)){h.common.scrollAd.resetScrollAd();T.injectWhenViewable(false)}else{if(T.gutterAd){T.inject(false)}else{if(T.adElem.getCoordinates().bottom<N){T.injectOnScrollUp=true}else{T.injectOnScrollUp=false}T.injectWhenViewable(false)}}}}}}}catch(S){h.util.error.record(S,"error refreshing all ads")}})},refreshAdsWithStyle:function(M){h.common.ads.refreshAdsWithStyleOrType(M)},refreshAdsWithType:function(M){if(!M){var N=h.retrieve("sel.category");if(N){var O={cat_1:"hotels",cat_2:"bbs_inns",cat_3:"spec_lodge"};M=O[N]}}if(M){h.common.ads.refreshAdsWithStyleOrType(null,M)}},refreshAdsWithStyleOrType:function(O,N){var M=h.id("right_hand_rail")!==null||h.find(".scrollingGutterAd")!==null;if(!O&&!N){return}if(O){O=O.toLowerCase()}if(N){N=N.toLowerCase()}if(h.has("ads.gptEnabled")){if(!(C.googletag&&C.googletag.cmd)){h.util.error.record(null,"googletag not defined, unable to refresh ads for style change");return}try{if(h.has("scrollAd.enableScroll")&&M){h.common.scrollAd.resetScrollAd()}googletag.cmd.push(function(){try{var T=h.retrieve("ads.adStubs");if(T&&T.each){if(M){T.each(function(W){if(W.tgt&&h.id(W.tgt)){var V=h.common.ads.getAd(W);if(V&&!(V.slotTargeting&&V.slotTargeting.kw)){O&&V.updateHotelStyle(O);N&&V.updateHotelType(N);V.injectWhenViewable(false)}}})}else{for(var S=0;S<T.length;S++){var R=T[S];if(R.type==="leaderboard_top"&&h.id(R.tgt)){var Q=h.common.ads.getAd(R);if(Q&&!(Q.slotTargeting&&Q.slotTargeting.kw)){O&&Q.updateHotelStyle(O);N&&Q.updateHotelType(N);Q.injectWhenViewable(false);break}}}}}}catch(U){h.util.error.record(U,"unable to refresh ads for style change via googletag")}})}catch(P){h.util.error.record(P,"unable to refresh ads for style change")}return}else{h.util.error.record(null,"Non GPT call to refresh ads for style change")}},refreshSidebarAds:function(){if(!v){return}var M=v.getElements(".gptAd");M.each(function(N){var O=h.common.ads.getAd(N.id);if(O){O.injectWhenViewable()}})},refreshSideBarAdsWithRefreshOrdKey:function(){if(h.retrieve("did_ad_refresh")){return}h.store("did_ad_refresh",true);if(h.has("ads.gptEnabled")){var N=h.select(".sidebar .gptAd");var M=f.getElement(".iab_leaBoa .gptAd");if(M){N.push(M)}if(N.length){N.each(function(O){var P=h.retrieve("tripads."+O.id);if(P){P.injectWhenViewable()}})}}else{h.util.error.record(null,"Non GPT call to refresh sidebar ads")}},stringifyTargeting:function(N){var O="";for(var M in N){if(O.length){O+="&"}if(z(N[M])||(typeof N[M]=="object"&&N[M].length)){O+=M+"="+N[M].toString()}}return encodeURIComponent(O)},setMinRefresh:function(M){y=M}}}(document,window,ta));ta.common.gutterAd=(function(x,j,k,f){var y=1446,e=1646,z=y,g=1024,d=true,r=300,u=null,w=6,m=5,l=1192,q=1645,p,C,A=k.id("PAGE"),D=function(F){function G(){try{var H=B(),I=false;if(!(H&&F&&t())){h()}else{if(k.util.i18n.isRtl()){I=F.getCoordinates().left-w;H.setStyles({right:(j.getSize().x-I),left:"auto"})}else{I=F.getCoordinates().right+w;H.setStyles({left:I})}}}catch(J){h();k.util.error.record(J,"gutterAd: unable to set left position")}}return G},n=function(){try{var G=B(),F=k.id("MAIN"),H=false;if(k.util.i18n.isRtl()){H=F.getCoordinates().left-w;G.setStyles({right:(j.getSize().x-H),left:"auto"})}else{H=F.getCoordinates().right+w;G.setStyles({left:H})}}catch(I){h();k.util.error.record(I,"gutterAd: unable to set left position")}},E=function(F){function G(){try{var H=B();if(!H||!F){h();return}var J;try{J=F.getCoordinates().top}catch(I){h();return}if(!t()){H.hide();return}H.setStyle("top",J+"px")}catch(I){h();k.util.error.record(I,"_positionTopFn: unable to set top position")}}return G},v=function(){try{var J=B();if(!J){h();return}if(!t()){J.hide();return}var N=j.getScroll().y;var L=u.getCoordinates().bottom-J.offsetHeight;var M=o().getCoordinates();var G=M.top;var O;var K=k.id("PERSISTENT_DATE_PICKER");var F=0;if(K&&!K.hasClass("hidden")){F+=K.getHeight()}if(N>=(G-F)&&N<=L){if(!J.style.cssText.match(":\\s*fixed")){O={position:"fixed",top:m,"padding-top":F}}}else{var H=J.style.cssText;if(!H.match("top")||H.match("top\\s*:\\s*"+m)){O={position:"absolute",top:(G+m),"padding-top":0};J.setStyles({position:"absolute",top:(G+m),"padding-top":0})}}if(O){J.setStyles(O)}}catch(I){h();k.util.error.record(I,"gutterAd: unable to set top position")}},o=function(){var F=k.find("#JFY_hotel_filters .checkboxes");if(!F){F=k.id("MAINWRAP")}return F},B=function(){return x.getElement("#PAGE ."+k.common.gutterAd.adElemClass)},h=function(){var F=B();if(F){F.destroy()}j.removeEvent("scroll",p);j.removeEvent("resize",i);if(A){A.removeClass("gutterAd")}},t=function(){var F=j.getSize().x;return F>=z},b=function(){var F=j.getSize().x;return l<=F&&F<=q},s=function(){C();p()},i=function(){if(t()){var F=B();if(F&&F.getStyle("display")=="none"){C()}}p();c()},c=function(){var G=d?"200":"300";var H=b()?"offset_true":"offset_false";var F="ads.gutter."+G+"."+H;if(k.localStorage.enabled&&!k.localStorage.hasSessionKey(F)){k.trackEventOnPage("hotels_gutter_ad",G,H);k.localStorage.setSessionKey(F,true)}},a=function(G){var F={};var H=j.getSize().x;G.ads.forEach(function(L,J,I){var K=g+2*(L.max_width+G.offsetLeft);if(K<=H){F.adId=L.adId;F.scroll=G.scroll;z=K}});return F};return{adElemClass:"scrollingGutterAd",init:function(K){var H={scroll:true,offsetLeft:6,offsetTop:5,injectDelay:300,ads:[{max_width:200,adId:"gpt-ad-200x600-c"},{max_width:300,adId:"gpt-ad-300x250-300x600-c"}]};for(var L in K){H[L]=K[L]}if(H&&H.hasOwnProperty("injectDelay")){r=H.injectDelay}if(H&&H.hasOwnProperty("offsetTop")){m=H.offsetTop}if(H&&H.hasOwnProperty("offsetLeft")){w=H.offsetLeft}var G=false;if(H&&H.hasOwnProperty("scroll")){G=H.scroll}d=j.getSize().x<e;var M,F;if(j.pageServlet&&((j.pageServlet==="Attraction_Review")||(j.pageServlet==="Restaurant_Review"))){M=k.id("LISTING_QUESTIONS");F=k.id("ABOVE_THE_FOLD")}else{if(k.retrieve("hr_below_the_fold_redesign.enabled")){M=k.id("HR_BTF_TOP")||k.id("HR_BTF_WRAP");F=k.id("MAIN")}else{M=k.id("PERSISTENT_TAB_HR");F=k.id("MAIN")}}if(!M||!F){k.util.error.record(null,"gutterAd: positioning element missing, unable to inject ad");return}C=v;p=n;if(!G&&M){C=E(M)}if(!G&&F){g=F.getSize().x;p=D(F)}var N=a(H);if(!N||!N.adId){h();return}var J=N.adId;if((k.id("hotels_one_col_bottom")||k.has("ads.right_gutter_ad"))&&!k.id("right_hand_rail")){u=k.id("MAIN");var I=new Element("div",{"class":"gptAd "+k.common.gutterAd.adElemClass,id:J,style:"position:absolute;"});if(A){A.appendChild(I);(function(){var O=k.common.ads.getAd(I.id);if(O){p();C();O.inject();if(G){j.addEvent("scroll",C)}j.addEvent("resize",i);C();j.addEvent("onAdRender",s)}}).delay(r)}}c()},init_justTracking:function(){d=j.getSize().x<e;c();j.addEvent("resize",c)},shouldDisplay:function(){return t()}}}(document,window,ta));var ta=window.ta||{};ta.common=ta.common||{};ta.common.ads=ta.common.ads||{};ta.common.ads.remarketingOptions=ta.common.ads.remarketingOptions||{};(function(){var b=function(c){return ta.common.ads.remarketingOptions[c]};var a=ta.util&&ta.util.error?ta.util.error.record:function(){};ta.common.ads.loadMonikers=function(c){try{if(!b("pixelsEnabled")){return null}c=c||{};c.pixelType="PAGEVIEW";if(b("pixelContext")&&(b("pixelContext").servlet=="HotelBookingRoomSelectionHtml"||b("pixelContext").servlet=="MobileHotelBookingRoomSelection")){c.pixelType="IB_CLICK";ta.common.ads._addIBPageViewContext(c)}var d=ta.common.ads._loadMonikers(c);if(window.ta&&ta.m&&b("cacheMobileClickoutResponse")){c.pixelType="CLICKOUT";ta.common.ads._cacheClickoutMonikers(c)}return d}catch(f){a(f,"ads.loadMonikers",null,{context:c})}return null};ta.common.ads.loadClickoutMonikers=function(c){try{if(!(b("pixelsEnabled")&&b("clickoutPixelsEnabled"))){return null}if(ta.common.ads._cachedClickoutMonikerText){return ta.common.ads._appendMonikersIFrameText(ta.common.ads._cachedClickoutMonikerText)}c=c||{};c.pixelType="CLICKOUT";return ta.common.ads._loadMonikers(c)}catch(d){a(d,"ads.loadClickoutMonikers",null,{context:c})}return null};ta.common.ads.loadIBClickMonikers=function(c){return ta.common.ads._loadMonikersForPixelType(c,"IB_CLICK")};ta.common.ads.loadIBRoomSelectMonikers=function(c){return ta.common.ads._loadMonikersForPixelType(c,"IB_ROOM_SELECT")};ta.common.ads.loadIBConfirmMonikers=function(c){return ta.common.ads._loadMonikersForPixelType(c,"IB_CONFIRM")};ta.common.ads._loadMonikersForPixelType=function(d,c){try{if(!(b("pixelsEnabled")&&b("ibPixelsEnabled"))){return null}d=d||{};d.pixelType=c;return ta.common.ads._loadMonikers(d)}catch(f){a(f,"loadMonikers for pixelType, ",null,{context:d})}return null};ta.common.ads._cacheClickoutMonikers=function(e){var f=b("pixelContext");var c=ta.common.ads._mergeContexts(f,e);var d=ta.common.ads._buildPixelUrl(c);if(!d){return}var g=new XMLHttpRequest();g.open("GET",d,true);g.onreadystatechange=function(){if(this.readyState==4){ta.common.ads._cachedClickoutMonikerText=this.response}};g.send()};ta.common.ads._addIBPageViewContext=function(c){if(document.getElementById("roomList")){c.lowestPrice=document.getElementById("roomList").dataset.lowestPrice}if(document.getElementById("roomInfoContainer")){c.lowestPrice=document.getElementById("roomInfoContainer").dataset.lowestPrice}};ta.common.ads._buildPixelUrl=function(e){if(!b("pixelServlet")){a(null,"ads._buildPixelUrl: remarketing.pixelServlet not set");return null}var f=b("pixelList");if(!f){return null}var c="/"+b("pixelServlet")+"?pixelList="+f;for(var d in e){if(e.hasOwnProperty(d)){c+="&"+d+"="+e[d]}}if(ta.uid){c+="&puid="+ta.uid}return c};ta.common.ads._appendMonikersIFrame=function(c){var d=document.createElement("iframe");d.setAttribute("id","Monikers");d.setAttribute("style","border:none");d.setAttribute("width","1");d.setAttribute("height","1");d.setAttribute("src",c);document.body.appendChild(d);return d};ta.common.ads._appendMonikersIFrameText=function(d){var c=document.createElement("iframe");c.setAttribute("id","Monikers");c.setAttribute("style","border:none");c.setAttribute("width","1");c.setAttribute("height","1");c.setAttribute("srcdoc",d);document.body.appendChild(c);return c};ta.common.ads._mergeContexts=function(f,e){if(!f){return e}else{if(!e){return f}}var d;var c={};for(d in f){if(f.hasOwnProperty(d)){c[d]=f[d]}}for(d in e){if(e.hasOwnProperty(d)){c[d]=e[d]}}return c};ta.common.ads._loadMonikers=function(f){var h,c;try{h=b("pixelContext");c=ta.common.ads._mergeContexts(h,f);var d=ta.common.ads._buildPixelUrl(c);if(!d){return null}return ta.common.ads._appendMonikersIFrame(d)}catch(g){a(g,"ads._loadMonikers",null,{pixelContext:h,extraContext:f})}return null}})();if(typeof ta.common=="undefined"){ta.common={}}ta.common.dmp=function(l,k,f){var d=null,h=null,e=false,c=false,i=[/^modules\.common\.CityPageRatings/,/^meta_lightbox_open_button/,/^Meta_VP_Submit_Hotels/,/^reviews_travelerphotos/i,/commerce_click_/i,/abandonedcart/i,/multi_click/i,/attractionbookbutton/i,/attractions?_/i,/map_/i,/filters/i,/floatingmap/i,/greenleaders/i,/herophotoscrollright/i,/photo_lb/i,/hotel_review/i,/meta_hac/i,/meta_style/i,/meta_click/i,/mobilehotel/i,/mobilehotels/i,/mobilerestaurant/i,/mobileviewphoto/i,/mobileattraction/i,/p13n/i,/photos_traveler/i,/reserveclick/i,/restaurant_/i,/restaurant_/i,/reviews_expand/i,/reviewstab_vr/i,/cruisecritic/i,/self_tags/i,/uber/i,/war_complete/i],g=function(n){if(n){var o=true;o&=b(n,"getName");o&=b(n,"load");o&=b(n,"setUUID");o&=b(n,"setBehaviors");o&=b(n,"addBehavior");o&=b(n,"send");return o}return false},b=function(o,n){if(o){return typeof o[n]=="function"}else{return false}},j=function(n,o){if(typeof o=="undefined"){o="INFO"}if(o=="ERROR"){f.common.dmp.errorRecord(null,n,null,null,o.toUpperCase())}if(c&&console.log){console.log("[ta.common.dmp] ["+o.toUpperCase()+"] "+n)}},m=function(o,n){if(typeof n=="undefined"||n==null||typeof n=="object"){return o}var p=n.toString();if(p.length){if(o==null||o.length<1){o=p}else{o+="_"+p}}return o},a=function(n){var q=f.common.dmp.store.getValue("dmpGARecordWhitelistEnabled");if(q){try{for(var o=0;o<i.length;o++){if(i[o].test(n)){return true}}}catch(p){j("Error evaluating GARecord behavior whitelists","ERROR")}return false}else{if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isValidGABehavior=="function"){return f.common.dmp.behaviorTracker.isValidGABehavior(n)}return true}};return{isEnabled:function(){if(!h){if(f.common.dmp.store){h=f.common.dmp.store.getValue("dmpEnabled")===true}else{h=false}}return h},errorRecord:function(){if(f&&f.util&&f.util.error&&f.util.error.record){f.util.error.record.apply(this,arguments)}},isValidBehavior:function(n){if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isValidBehavior=="function"){return f.common.dmp.behaviorTracker.isValidBehavior(n)}return true},isNewBehavior:function(n){if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isNewBehavior=="function"){return f.common.dmp.behaviorTracker.isNewBehavior(n)}return true},init:function(){try{if(!f.common.dmp.isEnabled()){j("DMP disabled","INFO");return}if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.init=="function"){f.common.dmp.behaviorTracker.init()}var o=f.common.dmp.store.getBehaviors();var p=f.common.dmp.store.getActiveDMP();if(p){if(g(p)){d=p;var s=f.common.dmp.store.getValue("taUUID");if(s){d.setUUID(s)}if(c){for(var r in o){for(var q=0;q<o[r].length;q++){j("setting initial behavior "+r+"="+o[r][q])}}}if(o!=null){d.setBehaviors(o)}f.common.dmp.store.clearBehaviors();d.load()}else{var n=(typeof p.getName=="function")?p.getName():"Unknown DMP";j(n+" failed interface sanity check","ERROR")}}e=true}catch(t){j("init failed. "+t,"ERROR")}},addBehavior:function(o,p){try{if(this.isEnabled()&&this.isValidBehavior(p)&&this.isNewBehavior(o+","+p)){if(e&&d){j("addBehavior "+o+"="+p,"DEBUG");d.addBehavior(o,p)}else{j("addBehavior called, but DMP not yet initialized; adding to stored behaviors: "+o+"="+p,"DEBUG");var n=f.common.dmp.store.getBehaviors();if(!n[o]){n[o]=[p]}else{n[o].push(p)}f.common.dmp.store.setBehaviors(n)}}}catch(q){j("addBehavior failed. "+q,"ERROR")}},addBehaviorBatch:function(n,r){if(this.isEnabled()){for(var q in n){if(n.hasOwnProperty(q)){var o=n[q];if(Object.prototype.toString.call(o)==="[object Array]"){for(var p=0;p<o.length;p++){this.addBehavior(q,o[p])}}else{if(typeof o=="string"||typeof o=="number"){this.addBehavior(q,o)}}}}if(r){f.common.dmp.send()}}},addGABehavior:function(q,r,p,v,u){var n=false;try{var s=f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.addDeviceSpecificGABehaviors=="function"&&f.common.dmp.behaviorTracker.addDeviceSpecificGABehaviors(q,r,p,v);if(s){return true}var o=m(null,q);if(q=="p13n_tag"&&r!=null){o=m(o,r.split(":",1)[0])}else{o=m(o,r)}if(!(q=="Attractions"&&p&&p.match(/^\d+$/))){o=m(o,p)}if(!(((q=="Meta_HAC_Filter"&&p=="neighborhood")||q=="FlashPhotoUploader")&&v&&v.match(/^\d+$/))){o=m(o,v)}if(o!=null&&o.length&&a(o)){f.common.dmp.addBehavior("GARecord",o);n=true}}catch(t){j("addGABehavior failed. "+t,"ERROR")}return n},sendGABehavior:function(o,s,n,r,q){var p=f.common.dmp.addGABehavior(o,s,n,r,q);if(p){try{f.common.dmp.send()}catch(t){j("Calling ta.common.dmp.send failed in sendGABehavior. "+t,"ERROR")}}},sendEventBehavior:function(q,s,p,r,o){if(f.common.dmp&&typeof f.common.dmp.behaviorTracker.addEventBehavior=="function"){var n=f.common.dmp.behaviorTracker.addEventBehavior(q,s,p,r,o);if(n){f.common.dmp.send()}}},send:function(){try{if(f.common.dmp.isEnabled()&&e&&d){j("send behaviors","DEBUG");d.send()}}catch(n){j("send failed. "+n,"ERROR")}},sendAjaxBehavior:function(n,o){if(typeof n=="string"&&n.length>0&&o!=null){f.common.dmp.addBehavior(n,o);f.common.dmp.send()}},log:j}}(document,window,ta);ta.common.dmp.bluekai=(function(r,n,o){var y="Bluekai",u=n.bluekaiClientId||17576,q=20645,h=4,g={},m=false,l=null,f=false,v=0,d=false,z=("https:"==r.location.protocol?"https":"http")+"://tags.bkrtx.com/js/bk-coretag.js",j=0,k=r.domain,A=false,b="",w=function(){var D=false;b="";for(var C in g){for(var B=0;B<g[C].length;B++){if(o.common.dmp.isValidBehavior(g[C][B])){p("adding behavior "+C+" = "+g[C][B],"DEBUG");l.bk_addPageCtx(C,g[C][B]);D=true;if(A){b+=(b.length>0?"::":"")+C+"="+g[C][B]}}}}return D},t=function(){if(o.common.dmp.store&&o.common.dmp.store.isMobileDevice()){return q}return u},i=function(){try{if(e("_addSendBehaviors")){var B=w();if(B){if("https:"==r.location.protocol){l.bk_pixel_url="https://tags.bluekai.com/"}l.bk_doJSTag(t(),h);s();if(A){A=false;o.trackEventOnPage("DMPBluekai","internal_tracking",b)}}}else{p("Bluekai._addSendBehaviors couldn't send. The API isn't accessible (_hasAPILoaded returned false) even though _loaded = "+d,"WARN")}}catch(C){p("Bluekai._addSendBehaviors general exception: "+C,"ERROR")}},c=function(){return m!==false},s=function(){g={}},p=function(C,D){try{if(typeof D=="undefined"){D="DEBUG"}if(console.log&&f){console.log("[ta.common.dmp.bluekai] ["+D+"] "+C)}if(D!="DEBUG"){o.common.dmp.errorRecord(null,C,null,null,D.toUpperCase())}}catch(B){}},e=function(C){if(!l){if(r.getElementById("BK_CONTAINER")&&r.getElementById("BK_CONTAINER").contentWindow){l=r.getElementById("BK_CONTAINER").contentWindow}}var B="";if(C&&typeof C=="string"){B=C+" -> "}B=B+"Bluekai._hasAPILoaded returned false ";if(!r.getElementById("BK_CONTAINER")){p(B+"- iframe element has not created","WARN");return false}else{if(!r.getElementById("BK_CONTAINER").contentWindow){p(B+"- the iframe contentWindow returned null","WARN");return false}else{if(!l){p(B+"- BK iframe container is not yet initialised","WARN");return false}else{if(typeof l.bk_addPageCtx!="function"){p(B+"- BK API bk_addPageCtx function is not found","WARN");return false}else{if(typeof l.bk_doJSTag!="function"){p(B+"- BK API bk_doJSTag function is not found","WARN");return false}else{return true}}}}}},x=function(){try{var C=false;if(n.ta&&o.common.dmp.store){C=o.common.dmp.store.getValue("dmpPerfLoggingEnabled")===true}if(C&&v>0){p("Bluekai loaded in "+(new Date().getTime()-v)+" ms.","INFO")}}catch(B){}},a=function(){return o.common.dmp.store&&o.common.dmp.store.getValue("dmpMeasureTest")};return{getName:function(){return y},load:function(){try{f=o.common.dmp.store&&o.common.dmp.store.getValue("dmpConsoleDebugEnabled");p("loading Bluekai API","DEBUG");var B='<script type="text/javascript" src="'+z+'"><\/script>';var F='<iframe name="__bkframe" height="0" width="0" frameborder="0" src="javascript:void(0)"></iframe>';var C='<script type="text/javascript"> function hasBluekai(win) { return ( win.ta && win.ta.common &&  win.ta.common.dmp && win.ta.common.dmp.bluekai) ? true : false; } var win = window; while(win.parent && win.parent != win && !hasBluekai(win)) { win = win.parent; } if(hasBluekai(win)) {  if(win.ta.common.dmp.bluekai.shouldIframeDomainBeSet()) {    document.domain = win.ta.common.dmp.bluekai.getParentPageDomain();  }  win.ta.common.dmp.bluekai.sendAfterLoad(); }<\/script>';var D=r.createElement("iframe");D.id="BK_CONTAINER";D.src="javascript:'<html><head>"+B+"</head><body>"+F+C+"</body></html>'";D.width=0;D.height=0;D.frameBorder=0;D.title="";D.role="presentation";v=new Date().getTime();r.body.appendChild(D);l=D.contentWindow}catch(E){p("Bluekai.load general exception. Failed to load API. "+E,"ERROR")}},shouldIframeDomainBeSet:function(){try{l.document&&typeof l.bk_addPageCtx=="function"}catch(B){return true}return false},getParentPageDomain:function(){return k},setUUID:function(B){m=B},setBehaviors:function(B){g=B||{}},addBehavior:function(B,C){if(!g[B]){g[B]=[C]}else{g[B].push(C)}},sendAfterLoad:function(){try{if(e("sendAfterLoad")){x();d=true;if(j>0){p("Bluekai API successfully loaded after "+j+" retries.","WARN")}p("sending initial behaviors","DEBUG");l.bk_addPageCtx("__bk_l",r.location.href);if(c()){p("sending UUID: "+m,"DEBUG");l.bk_addPageCtx("uuid",m)}l.bk_allow_multiple_calls=true;if(o.common.dmp.store&&o.common.dmp.store.getValue("dmpBlueKaiEnableMultipleIframes")){l.bk_use_multiple_iframes=true}l.bk_ignore_meta=true;A=a();i()}else{j++;if(j<=3){n.setTimeout(o.common.dmp.bluekai.sendAfterLoad,(200*j))}else{p("Bluekai API failed to load after 3 retries. Giving up.","WARN")}}}catch(B){p("Bluekai.sendAfterLoad general exception: "+B,"ERROR")}A=false},send:function(){if(d){i()}}}}(document,window,ta));ta.common.dmp.store=(function(){var a={};var b={};var d=null;var c=false;return{setBehaviors:function(e){a=e||{}},clearBehaviors:function(){a={}},getBehaviors:function(){return a},storeValue:function(e,f){b[e]=f},hasValue:function(e){return typeof b[e]!="undefined"},getValue:function(e){return b[e]},getActiveDMP:function(){return d},setMobileDevice:function(){c=true},isMobileDevice:function(){return c},setActiveDMP:function(e){d=e}}}());ta.common.dmp.behaviorTracker=(function(s,j,k){var h=[];var x=[];var y=/^(Meta_Homepage|meta_lightbox|Meta_VP|Meta_LP_CTA|Meta_Micro|Meta_State-Optimized|meta_best_price_cross_sell)/;var a=/^(modules|geo_specific|av_above_fold|hotels_placeholder|AttractionContact|LockUp_Hero|GeoDesc|grid_|photo_photosloaded|pinLander|sampleEmail)/;var t=/^(RestaurantListing|Restaurant_Links_Menu|Restaurant_Links_Update)/;var o=[/early_roy_batty/,/^ad_latency/,/^ab_chk/,/^Footer/,/^DATEPICKER_OPEN_DATES/,/^Meta_HAC_Loading/,/single_hotel_detail/,/^(BlueChevron_LP_|Mini_meta_LP)/,/^HAC_HACComplete_/,/^postLinks_/,/^open_info_window/,/^Popup_/,/^social/,/^CommercePopunder/,/^dynamic_large_map_sidebar/,y,a,/^(HoverSave_|Saves_Hover)/,t,/^(Reviews_BLSlideshow|BL_SO|BLSlideshow)/,/(switch_to_.*)+/,/^tourism_engagement_/i,/^tourism_modules_/i,/datepicker/i,/^reviews_(?!expand$)/i,/carousel/,/^price_saver_display_/i,/close/i,/hover/i,/^map_cataloging_map_initialized_unknow_/i,/photo_lb_traveler/i,/^qc_persist_meta_open/i,/impression/i,/smart_deals2013_sd_datebar_/i,/^hotel_review_low_price_message_display/i,/^tab_bar_tabs/i,/^photos_traveler_image/i,/^sur_scrolled_control/i,/^meta_on_photoviewer_isoverlap_true$/i,/screensizerecord_/i,/resize/i,/show_0/i,/^topnav_search_focus$/i,/^meta_on_photoviewer_placementshown$/i,/stinterrupter/i,/^.*-bing$/i,/^.*gmaps3$/i,/test/i,/^non-commerce_property_loaded_non-dated_0$/i,/^attraction_review_rhs_show_0$/i,/unknown/i,/^pypt_search_/i,/^noavailability_xsell_flyout$/i,/^hotelsmetafocuspredates_/i,/^.*hacpollingcomplete/i,/undated/i,/display_0/i,/fblb/i,/^fb_foaf_/i,/^autobroadenhotels_/i,/^rac_result_lafourchette_success_predates$/i,/interrupter/i,/has_dates/i,/no_availability/i,/shown_0/i,/click_0/i,/no_dates/i,/dates_0/i,/cancel/i,/^SortChanged$/,/FILTER_BEDROOM_MAP_VRAC/,/FILTER_PRICE_MAP_VRAC/,/FILTER_AMENITIES_MAP_VRAC/,/LRSuitability_pers_VRAC/,/BookOnline_VRAC/,/VR_PRICEHAT4_SRP/,/PersistInquiryImp_VRR/,/prodp13n/,/HISTORY_INJECT/,/lowest_price/,/leavebehind/i,/leave_behind/i,/owner_reg/,/Oyster/,/PhotosLB_n_more_sites/,/dynamic_large_map/,/list_view_card/,/MAPS_V2/,/float_map/,/Filters_Map/,/Search_Near_Map/,/neighborhood_widget/,/^DMPBluekai_internal_tracking/i];var g=[/^modules\.common\.CityPageRatings/,/^meta_lightbox_open_button/,/^Meta_VP_Submit_Hotels/,/^reviews_travelerphotos/i];var u=[/casino/i,/^ski$/i,/^last_minute$/i,/^biz$/i,/^fam$/i,/^romance$/i,/^golf$/i,/^spa$/i,/^beach$/i,/^natparks$/i,/^theme_park$/i,/^trendy_hotel$/i,/^vaca$/i,/^carrent$/i,/^cruise$/i,/^culture$/i,/^xtend$/i,/^thirty_days$/i,/^budget$/i,/^midlevel$/i,/^luxury$/i,/^suplux$/i,/^review$/i,/^vrpi$/i,/^attrpi$/i,/^hotelspi$/i,/^flightspi$/i,/^bookingpi$/i,/^travelocitypi$/i,/^expediapi$/i,/^hotelscompi$/i,/^pricelinepi$/i,/^cheaptixpi$/i,/^venerepi$/i,/^splendiapi$/i,/^agodapi$/i,/^olotelspi$/i,/^hrspi$/i,/^ebookerspi$/i,/^edreamspi$/i,/^hotelclubpi$/i,/^tcookukpi$/i,/^wotifaupi$/i,/^despegarpi$/i,/^beach_b$/i,/^budget_b$/i,/^luxury_b$/i,/^natparks_b$/i,/^romance_b$/i,/^spa_b$/i];var e=false,w=false;var p=/^\/((Hotel|Restaurant|Attraction)_Review|VacationRentalReview)/i,b=/reviews/i,q=null;var v=function(z){try{for(var A=0;A<g.length;A++){if(g[A].test(z)){return true}}for(A=0;A<o.length;A++){if(o[A].test(z)){n("Blacklisted behavior: "+z,"DEBUG");return false}}}catch(B){n("Error evaluating GARecord behavior blacklists","ERROR")}return true},c=function(){try{if(j.ta&&k.widgets&&k.widgets.calendar&&k.util&&k.util.date){var z=k.widgets.calendar.getPageInDate();if(z){var B=k.util.date.getDaysInRange(new Date(),z)-1;k.common.dmp.addBehavior("Calendar","days_to_trip_"+B);var G=m(z);if(G){k.common.dmp.addBehavior("Calendar","start_"+G)}var H=r(z);if(H){k.common.dmp.addBehavior("Calendar_Month",H)}var E=k.widgets.calendar.getPageOutDate();if(E){var A=k.util.date.getDaysInRange(z,E)-1;k.common.dmp.addBehavior("Calendar","stay_duration_"+A);var C=m(E);if(C){k.common.dmp.addBehavior("Calendar","end_"+C)}var F=r(E);if(F&&F!=H){k.common.dmp.addBehavior("Calendar_Month",F)}}}}}catch(D){n("Error adding calendar behaviors","ERROR")}},r=function(z){var A=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];try{if(z&&z.getMonth()>=0&&z.getMonth()<A.length){return A[z.getMonth()]}}catch(B){n("Error getting month from date "+z,"ERROR")}return"unknown"},m=function(z){var B=["sun","mon","tue","wed","thu","fri","sat"];try{if(z&&z.getDay()>=0&&z.getDay()<B.length){return B[z.getDay()]}}catch(A){n("Error getting day of week from date "+z,"ERROR")}return"unknown"},d=function(A,z){w=A||w;e=z||e;if(w&&e){k.common.dmp.addBehavior("Meta_Click",w+"_rank_"+e);w=false;e=false}},n=function(z,A){if(k.common.dmp&&typeof k.common.dmp.log=="function"){k.common.dmp.log(z,A)}},i=function(){var B=k.find("#REVIEWS .reviewSelector");if(B){var z=B.getCoordinates().top||0;var A=j.getScroll().y;var C=j.getHeight();if(z>0&&(A+(C/2))>=(z)){f("reviews_scrolled",true);clearInterval(q)}}},f=function(C,B){if(!C||!j.location){return}var A=p.exec(j.location.pathname);var z="";if(A&&A.length>=2){z=A[1]}if(z&&z.length>0){k.common.dmp.addBehavior(C,z)}if(B){k.common.dmp.send()}},l=function(){if(j.location){var z=j.location.pathname;var A=j.location.hash;if(z&&p.test(z)){if(A&&b.test(A)){f("reviews_viewed")}else{if(k.common.dmp.store&&k.common.dmp.store.getValue("dmpReviewReadTest")){q=i.periodical(30000)}}}}};return{init:function(){c();l();if(k.common.dmp.store&&k.common.dmp.store.getValue("dmpMetaExposedEnabled")){this.sendMetaExposedTags();j.addEvent("HRHacComplete",this.sendMetaExposedTags)}},isNewBehavior:function(z){try{if(z&&!h.contains(z)){h.push(z);return true}return false}catch(A){n("Error evaluating whether to send interval behavior to DMP","ERROR")}return true},isValidBehavior:function(z){try{for(var A=0;A<u.length;A++){if(u[A].test(z)){n("Blacklisted behavior: "+z,"DEBUG");return false}}}catch(B){n("Error evaluating behavior blacklists","ERROR")}return true},isValidGABehavior:function(z){return v(z)},addDeviceSpecificGABehaviors:function(A,C,z,B){if(C=="meta_click"){d(false,B);return true}if(A=="CheckRates"){d(z,false);return true}if(A=="DATEPICKER"&&C=="SELECT"){c();return true}return false},sendMetaExposedTags:function(){if(k.common.dmp.store&&k.common.dmp.store.getValue("dmpMetaExposedEnabled")){var A=/MainCommerce.*\\N:(\d+).*?\\PN:(BookingCom).*?\\F:(\w+)/;try{$$(".impressionTrackingTree").each(function(D){if(D){var C=D.innerHTML;var B=A.exec(C);if(B&&B.length>3){var G=B[2];var E=B[3];var F=B[1];var H=G+"_"+E+"_rank_"+F;if(!x.contains(H)){k.common.dmp.sendAjaxBehavior("Meta_Exposed",H);x.push(H)}}}})}catch(z){n("Error scraping meta exposed data for DMP. "+z,"ERROR")}}}}}(document,window,ta));ta.maps=ta.maps||{};ta.maps.trackpixel=(function(a,d,b,e){var c=[];return{storeTrackPixleSrc:function(f){if(f){c.push(f)}},loadSponsorTrackingPixel:function(f){c.each(function(g){var h=g.trim();var i=new Element("img",{"class":"tracking"});i.src=h});if(!f){c=[]}}}}(document,window,ta));linkMap.js_modifySub=function(a,b){modifySub.apply(a,[b])};rules["#NEWSLETTER_CALLOUT input.memberUpdateEmail[type=text]"]=function(a){$("memberUpdatesEmailDefault").hide();$(a.form).addEvent("submit",function(b){if(a.value==$("memberUpdatesEmailDefault").innerHTML){a.value=""}})};function alertIfEmpty(a){if(a&&a.value==""){if(msg=a.className.match(/\bmsg_([\w\d]+)\b/)){alert(window[msg[1]])}else{alert("The field can not be empty")}return false}return true}function addNonMember(c,b){if(!b){b=this}popupConfig.clickedElement=b;new Event(c).preventDefault();var a="/MemberBenefitsPopup";if(/pid(\d+)/.test(b.className)){a+="?pid="+RegExp.$1}showDHTMLPopup("MemberBenefitsPopup",a,true)}function clickNonMember(){setTimeout("window.lightbox.deactivate()",500);if(popupConfig.clickedElement==null){return}var a=popupConfig.clickedElement;popupConfig.clickedElement=null;$$("#TRAVEL_GUIDES_LANDER .clickNonMember").each(function(c,b){c.removeEvent("click",addNonMember)});$$("#TRAVEL_GUIDES_FLY .clickNonMember").each(function(c,b){c.removeEvent("click",addNonMember)});if(a.className.match(/\bclickPopDestMOGLink\b/)){processPopDestMOGLink(null,a)}else{if(a.get("tag")=="a"){window.location=a.getProperty("href")}else{a.click()}}}function processPopDestMOGLink(b,a){if(!a){a=this}if(!loggedIn){addNonMember(b,a)}else{processGuideLink(b,a)}}rules["#TRAVEL_GUIDES_LANDER .clickNonMember"]=rules["#TRAVEL_GUIDES_FLY .clickNonMember"]=function(a){if(a.get("tag")!="a"||!a.className.match(/\bskipATag\b/)){a.addEvent("click",addNonMember)}};rules["#TRAVEL_GUIDES_LANDER .clickPopDestMOGLink"]=function(a){a.addEvent("click",processPopDestMOGLink)};rules["#HELP_CENTER dl.js_toggleset"]=function(a){var c=0;var b=new ToggleSet(a.getElements("dt"),a.getElements("dd"));if(window.location.hash&&(hash=window.location.hash.match(/c(\d+)/))){b.display(parseInt(hash[1]))}};rules["#TAB_CONTAINER"]=ta.widgets.tabContainer;linkMap.js_replaceContentSet=function(c,f){var d=c.className.match(/set_([^\s"]*)?/);if(!d||d.length!=2){throw new Error("Links with behavior js_replaceContentSet must also have a style class set_??? to indicate the set of elements the contents of which should be replaced")}var a=c.className.match(/id_([^\s"]*)?/);if(!a||a.length!=2){throw new Error("Links with behavior js_replaceContentSet must also have a style class id_??? to indicate which element's contents should be replaced")}a=a[1];var b=$(a);if(!b){throw new Error("Element of id "+a+" does not exist.")}d=d[1];replaceContentSet(d,f,b.id)};var replaceContentSet=function(h,j,f){j=new Event(j);var b=$$("a.set_"+h);for(var c=0;c<b.length;c++){var k=b[c];var g=k.className.match(/id_([^\s"]*)?/);if(!g||g.length!=2){throw new Error("Links with behavior js_replaceContentSet must also have a style class id_??? to indicate which element's contents should be replaced")}g=g[1];var d=$(g);var a=k.href;if(c==b.length-1&&f){d.addEvent("onContentReplaced",function(){window.setTimeout(function(){window.location.hash=f},200)})}else{if(f){d.removeEvents("onContentReplaced")}}if(a){replaceContent(j,d,a)}}j.stop()};function vrCalculator(c,g){var f=g!=null?new Event(g):null;if(c&&/pid(\d+)/.test(c.className)){ta.util.cookie.setPIDCookie(RegExp.$1)}var b="";var a=$("homePageVRCalcPromo");if(!a){a=$("calculatorOverviewPromo")}if(!a){a=$("calculatorLanderPromo")}if(!a){a=$("expandedHomePageVRCalcPromo")}if(a&&$("vrCalculatorForm")){var d=a.getElement("#geoName");if(d.hasClass("focusClear")){d.value="";d.removeClass("focusClear")}b="&geoName="+a.getElement("#geoName").value;if(a.getElement("#adults")){b+="&adults="+a.getElement("#adults").value}if(a.getElement("#nights")){b+="&nights="+a.getElement("#nights").value}}new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,backdropClickClose:true,onReady:function(){this.inner.getElement("input").focus()}}).loadRemoteContent("/VacationRentalCalculator?restart=true"+b);if(f){f.stop()}return false}linkMap.js_submitVRCalculator=function(b,g){var d=g!=null?new Event(g):null;var h=$("vrCalculator");var c=h.getElement("form");var f=h.getElement(".serverErrorMsg");if(f){f.style.display="none"}if(c.geoName.value==""){h.getElement(".errorMsg").style.display=""}else{var a=c.action+"?"+c.toQueryString();replaceContent(g,h.getParent(),a)}if(d){d.stop()}return false};var SocialHistory=function(){var o={f:["http://www.facebook.com/","https://login.facebook.com/login.php","http://www.facebook.com/home.php"]};var l={};function m(s,r,i){if(s.currentStyle){var t=s.currentStyle[i]}else{if(window.getComputedStyle){var t=r.defaultView.getComputedStyle(s,null).getPropertyValue(i)}}return t}function j(i){i.parentNode.removeChild(i)}function p(){var i=document.createElement("iframe");i.style.position="absolute";i.style.visibility="hidden";document.body.appendChild(i);if(i.contentDocument){i.doc=i.contentDocument}else{if(i.contentWindow){i.doc=i.contentWindow.document}}i.doc.open();i.doc.write("<style>");i.doc.write("a{color: #000000; display:none;}");i.doc.write("a:visited {color: #FF0000; display:inline;}");i.doc.write("</style>");i.doc.close();return i}var g=p();function c(r,s){var i=g.doc.createElement("a");i.href=r;i.innerHTML=a;g.doc.body.appendChild(i)}for(var a in o){var n=o[a];for(var h=0;h<n.length;h++){c(n[h],a);if(n[h].match(/www\./)){var e=n[h].replace(/www\./,"");c(e,a)}else{var d=n[h].indexOf("//")+2;var f=n[h].substring(0,d)+"www."+n[h].substring(d);c(f,a)}}}var q=g.doc.body.childNodes;for(var h=0;h<q.length;h++){var k=m(q[h],g.doc,"display");var b=k!="none";if(b){l[q[h].innerHTML]=true}}j(g);return new (function(){var i=[];for(var r in l){i.push(r)}this.visitedSites=function(){return i};this.doesVisit=function(t){if(typeof(o[t])=="undefined"){return -1}return typeof(l[t])!="undefined"};var s=[];for(var r in o){s.push(r)}this.checkedSites=function(){return s}})()};function sniffFacebook(){var d=false;try{var a=SocialHistory();var b=a.visitedSites();if(b[0]=="f"){d=true}}catch(c){}return d};function registerOnLoad(b,a){if(ta&&ta.queueForLoad){ta.queueForLoad(b,a)}else{window.addEvent("load",b)}}function registerOnUnload(a){window.addEvent("unload",a)}function getScrollOffset(){return[window.getScrollLeft(),window.getScrollTop()]}function isIn(h,j,a){var d=getScrollOffset();j=$(j);var g=findPos(j);var e=g[0]-d[0];var i=g[1]-d[1];var c=e+j.clientWidth;var f=i+j.clientHeight;if(a){if(typeof(a)=="number"){e=e-a;i=i-a;c=c+a;f=f+a}else{if(a instanceof Array&&(a.length==2||a.length==4)){i=i-a[0];c=c+a[1];e=e-(a.length==4?a[3]:a[1]);f=f+(a.length==4?a[2]:a[0])}}}return(h[0]>=e&&h[0]<=c&&h[1]>=i&&h[1]<=f)}function setDetails(b,d,a,c){new Event(b).stop();$("title").value=d;$("category").value=a;$("space").value=c;$("newPage").submit()}function setOneTimeCookie(a,b){Cookie.write(a,b,{domain:cookieDomain,time:5});return true}function setOneTimeCookieOnFQDN(a,b){Cookie.write(a,b,{time:5});return true}var getChildByClass=function(e,d,c){if(!d||d.length==0){if(c==e.tagName){return e}}else{if(e.className&&(!c||c==e.tagName)){var f=-1;do{f=e.className.indexOf(d,f+1);if(f>=0&&(f==0||e.className.charCodeAt(f-1)==32)&&(f+d.length==e.className.length||e.className.charCodeAt(f+d.length)==32)){return e}}while(f>=0)}}for(var b=0;b<e.childNodes.length;b++){var a=getChildByClass(e.childNodes[b],d,c);if(a){return a}}return null};function showPrivacyPolicy(){window.open("/pages/privacy.html","PrivacyPolicy","toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars=3,width=800,height=600,screenX=30,screenY=25,left=30,top=25")};ta.servlet.Tourism=(function(){var e=window.modelGeoId||0;var k=1;var d=null;var c=200;var a=0;var n=[];var f=false;var g=function(o){var p="modules_visible_"+o;n.each(function(r,q){if(ta.util.element.isScrolledIntoView(r)){ta.trackEventOnPage("Tourism",p,r.getAttribute("data-module"),0,true);n.splice(q,1)}})};var h=function(){var o=Math.floor(window.getSize().y/c)*c;a=o;while(o>=c){j(o);o-=c}};var l=function(){var o=Math.floor(window.getScroll().y/c)*c;if(o>a){a=o;j(o)}};var j=function(o){ta.trackEventOnPage("Tourism","Engagement","scroll"+o,o,true)};var b=function(){if(!f){var o=ta.id("FORUM_CONTENT");if(o&&ta.util.element.isScrolledIntoView(o)){o.load("/TourismForumContentAjax?geo="+e);f=true}}};var i=function(){var p=ta.find(".highlightsSection .comparePrices");if(p){var q=function(){if(o()){r();window.removeEvent("scroll",q)}};var o=function(){return p.getCoordinates().top<window.getHeight()+window.getScroll().y};var r=function(){ta.trackEventOnPage("pcb_campaign","tourism_message_in_view","",0)};if(o()){r()}else{window.addEvent("scroll",q)}}};var m=(function(){var s;var y=false;var v;var p=false;var o={TABS_DMO:1};var q="TABS_DMO";var r=function(D,z,E){var B=ta.id("PAGE");var F=B.getElement(".tabsSpacer");if(F){var C=B.getHeight()-E.getPosition(B).y-F.getHeight();var A=0;if(C>=window.getHeight()){F.style.height=A+"px"}}};var u=function(A){var z=document.getElement("#TABS_MORE .tabs_more_content");if(z&&!z.isDisplayed()){z.show();A.stop();window.addEvent("click",t)}};var t=function(){var z=document.getElement("#TABS_MORE .tabs_more_content");if(z&&z.isDisplayed()){z.hide();window.removeEvent("click",t)}};var x=function(){var D=ta.id("PERSISTENT_TAB_HEADER");var G=D&&D.getElement(".tabs_pers_content");var A=ta.id("TABS_MORE");var C=A&&A.getElement(".tabs_more_content");if(!A||!G||!D||!C){return false}var K=G.getChildren("li:not(.tabs_more)");if(K.length<1){return false}var H=K[0];if(!A.hasClass("hidden")){var I=ta.id(q);if(I){}else{G.adopt(C.getChildren())}G.adopt(A)}A.removeClass("hidden");var J=H.getPosition().y+H.getSize().y/2;var F=A.getElements(".tabs_more_content li").length>0;var z=F;for(var E=K.length-1;E>=0;E--){var B=K[E];if(B.id!="TABS_MORE"&&!o[B.id]&&B.isVisible()){if(J>0&&(B.getPosition().y>J||A.getPosition().y>J)){C.grab(B,"top");z=true}else{break}}}if(!z){A.addClass("hidden")}K=G.getChildren("li:not(.hidden)");D.getElements(".lastTab").removeClass("lastTab");if(K.length>0){K[K.length-1].addClass("lastTab")}D.removeClass("invisible");if(!p){p=true;A.addEvent("click",u);window.addEvent("resize",x);if(window.isTabletOnFullSite){window.addEvent("orientationchange",function(){w()});window.addEvent("gesturestart",function(L){v=L.scale});window.addEvent("gestureend",function(L){if(v!==L.scale){v=L.scale;w()}})}}};var w=function(){var A=ta.find(".persistent_tabs_container"),C=ta.find(".persistent_tabs_header"),D=ta.id(window),z=150;var B=A.getTop()+A.getHeight();if(D.getScrollTop()<(B-A.getHeight())){if(C.hasClass("fixed")&&!y){setTimeout(function(){C.removeClass("fixed");A.removeClass("fixed");C.addClass("static");A.addClass("static");y=false;C.style.transition="none";C.style.top=0;x()},z);y=true;C.style.transition="";C.style.top="-52px"}}else{if(!C.hasClass("fixed")){C.style.transition="none";C.addClass("fixed");A.addClass("fixed");C.removeClass("static");A.removeClass("static");C.style.top="-52px";setTimeout(function(){C.style.transition="";C.style.top=0;x();window.fireEvent("scrollingTabs_updateTabBar",{height:C.offsetHeight})},1)}}};return{init:function(){var B=ta.find(".persistent_tabs_container"),D=ta.find(".persistent_tabs_header");if(!B||!D){return}var C=B.getHeight()+24;var A=B.getHeight()+28;s=new ta.widgets.ScrollingTabs(window,".scroll_tabs",true,C,A);s.init();s.setCallback("tabChangeOnScroll",function(F,E,G){ta.trackEventOnPage("Tab_Bar",(G.id+"_SCROLL"),G.id)});s.setCallback("afterScroll",function(F,E,G){r(F,E,G);if(Browser.name.toLowerCase()==="firefox"){s.init();s.show(ta.id(G.getAttribute("data-tab")),1);s.setCallback("afterScroll",null)}});if(window.addEventListener){window.addEvent("scroll",w)}else{window.attachEvent("onscroll",w)}x();w();var z=ta.id("PERSISTENT_TAB_HEADER");z&&z.removeClass("invisible")},clickTab:function(D){var C=s.getTabAnchor(D);var A=ta.id("PAGE");if(!C||!A){return}var F=A.getElement(".tabsSpacer");if(F){var E=A.getHeight()-C.getPosition(A).y-F.getHeight();if(E<window.getHeight()){var z=window.getHeight()-E;if(z>parseInt(F.style.height,10)){F.style.height=z+"px"}}}var B=80;var G=300;s.show(D,G,B);return false},update:w}})();return{tabs:m,init:function(p){if(p&&p>0){e=p}n=ta.select("[data-module]");var q=ta.find(".weatherUnits .selected");d=q&&q.getAttribute("data-unit");g("load");h();i();window.addEvent("scroll",function(){g("scroll");l();b()});var o=ta.find(".navLinks .guides");if(o){ta.trackEventOnPage("Tourism","Nav","guide-nav-show-"+o.getAttribute("data-label"),0)}m.init()},showNextChildPage:function(){k++;var o=ta.find(".popularCities");if(o&&e>0){var p={geo:e,offset:k-1,desktop:true};new Request({url:"/TourismChildrenAjax",data:p,method:"get",evalScripts:true,onSuccess:function(r){var q=o.innerHTML+r;o.innerHTML=q;if(k>=ta.retrieve("tourism.popularCitiesMaxPage")){ta.select(".morePopularCities").destroy()}}}).send()}},linkClick:function(p,q,o){var r=new Event(o||window.event);if(r.target){var s=r.target;if(!s.href){s=s.getElement("a")||s.getParent("a")}if(s&&s.getAttribute("data-trk")){q=s.getAttribute("data-trk")}if(s&&s.href){ta.setEvtCookie("Tourism",p,q,0,s.href)}}},nonLinkClick:function(q,r,p){var s=new Event(p||window.event);if(s.target){var o=s.target;if(o&&o.getAttribute("data-trk")){r=o.getAttribute("data-trk")}ta.trackEventOnPage("Tourism",q,r,0)}},noFriendTease:function(p){if(!p||(ta.retrieve("facebook.session.available"))==false){return}var o=p.toString();if(o!="not_authorized"){this.showNoFriendTease()}else{this.showFBConnectTease()}},showNoFriendTease:function(){this.showFirstOfSelect(".travelersReviewed","block");this.showFirstOfSelect(".geoBox.wrap","none");this.showFirstOfSelect(".FBCover","none");this.showFirstOfSelect(".downloadAppSection.wrap","none");this.showFirstOfSelect(".FBThumb","block");this.showFirstOfSelect(".firstOfFriends","block");this.showFirstOfSelect(".findAPlace","block")},showFBConnectTease:function(){this.showFirstOfSelect(".geoBox.wrap","block");this.showFirstOfSelect(".FBCover","block")},showFirstOfSelect:function(p,o){var q=ta.find(p);if(q){q.style.display=o}},friendsLoaded:function(){this.showFirstOfSelect(".travelersReviewed","none");this.showFirstOfSelect(".FBThumb","none");this.showFirstOfSelect(".firstOfFriends","none");this.showFirstOfSelect(".findAPlace","none");var s=ta.select(".highlight #FRIEND_GRID .item");if(s.length==0){return}var u=document.getElement(".downloadAppSection");if(u){u.destroy()}var t=6;var r=ta.select(".highlight .geoBox .item");var p=r.length;if(s.length<=t){p=t*2}else{if(s.length<=t*2){p=t}else{p=0}}if(p==0){var q=document.getElement(".highlight .geoBox");if(q){q.destroy()}}else{if(p<r.length){for(var o=r.length-1;o>=p;o--){r[o].destroy()}}}var q=ta.id("FRIEND_GRID");if(q){q.style.display="block"}},toggleWeatherUnit:function(q,o,p){if(p==d){return}d=p;o.getSiblings().toggleClass("selected");o.toggleClass("selected");ta.select(".weatherInfo .temps").toggleClass("hidden")},showGeoDescription:function(q,o){var p=ta.retrieve("tourism.fullDescription");if(p){new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 dg descriptionLB",content:"<p>"+p+"</p>"})}},trackTourismFollowEventOnPage:function(o){if(!ta.has("tourism_followed")){ta.store("tourism_followed",true);ta.trackEventOnPage("tourism_follow","click")}if(window.event){window.event.cancelBubble=true}else{o.stopPropagation()}},trackTourismFollowEventOnNextPage:function(o){ta.setEvtCookie("tourism_follow","click","",0,"/twsubscriptions");if(window.event){window.event.cancelBubble=true}else{o.stopPropagation()}},showTourismBrandBubble:function(){if(window.setTimeout){window.setTimeout(function(){ta.servlet.Tourism.showTourismBrandBubbleContent()},1000)}},showTourismBrandBubbleContent:function(){var p=ta.id("tourismBrandBubble");if(p&&p.getStyle("display")=="none"){p.setStyle("opacity",0);p.setStyle("display","block");var o=new Fx.Tween(p,{duration:1000,property:"opacity"});o.start(0,1)}},hideTourismBrandBubble:function(){if(window.setTimeout){window.setTimeout(function(){ta.servlet.Tourism.hideTourismBrandBubbleContent()},8000)}},hideTourismBrandBubbleContent:function(){var p=ta.id("tourismBrandBubble");if(p&&p.getStyle("display")=="block"){var o=new Fx.Tween(p,{duration:1000,property:"opacity"});o.start(1,0);if(window.setTimeout){window.setTimeout(function(){ta.id("tourismBrandBubble").setStyle("display","none")},1000)}}},clickTab:function(o){ta.trackEventOnPage("Tab_Bar",o.id);m.clickTab(o)},clickDmoTabPart:function(o){ta.trackEventOnPage("Tab_Bar","TABS_DMO",o)},clickDmoTab:function(o){m.clickTab(o)},clickDestinationResourceLink:function(o){this.clickTourismLink("destination_"+o.toLowerCase()+"_link")},clkDestRsrceLnkId:function(o,p){this.clickTourismLinkWithId("destination_"+o.toLowerCase()+"_link",p)},clickTourismLink:function(o){ta.trackEventOnPage("dmo_tourism_links",o)},clickTourismLinkWithId:function(o,p){ta.trackEventOnPage("dmo_tourism_links",o,p,p)},clickTrvlGuideLink:function(t,r,p,q,o,s,u){if(o=="TripList"){ta.trackEventOnPage("Tourism",p,q)}else{ta.trackEventOnPage("Traveler_Guide",p,q);ta.setEvtCookie("TravelGuides","guideClick",s,u,r.href)}},trkDmoClick:function(o){ta.trackEventOnPage("Tourism","DMO",o)},trkDmoDealClick:function(p,o){ta.trackEventOnPage("dmo_tourism_deals",p,o);this.trkDmoClick("dmo_deal")},trkDmoContentClick:function(r,p,o){var q=encodeURIComponent((p||""));ta.trackEventOnPage("DMO_content_click",q,o,r)}}})();ta.widgets.Weather={init:function(){var a=ta.retrieve("weather.system");if(a=="english"){ta.widgets.Weather.switchToEnglish()}else{if(a=="metric"){ta.widgets.Weather.switchToMetric()}}},_switch:function(b,a){b.each(function(c){if($(c)){$(c).setStyle("display","inline")}});a.each(function(c){if($(c)){$(c).hide()}})},_generateList:function(a,d){var b=[];for(var c=0;c<3;c++){b.push("weatherForecast"+c+"Hi"+a);b.push("weatherForecast"+c+"Lo"+a)}for(var c=0;c<6;c++){b.push("weatherHistory"+c+"Hi"+a);b.push("weatherHistory"+c+"Lo"+a);b.push("weatherHistory"+c+"Precip"+d)}return b},switchToMetric:function(b,a){ta.widgets.Weather._switch(ta.widgets.Weather._generateList("C","Cm"),ta.widgets.Weather._generateList("F","In"));$("weatherToggleMetric").removeClass("taLnk");$("weatherToggleMetric").set("text","C\u00B0");$("weatherToggleEnglish").addClass("taLnk");$("weatherToggleEnglish").addEvent("click",ta.widgets.Weather.switchToEnglish).set("text","F\u00B0");ta.trk("switch_to_C");return false},switchToEnglish:function(b,a){ta.widgets.Weather._switch(ta.widgets.Weather._generateList("F","In"),ta.widgets.Weather._generateList("C","Cm"));$("weatherToggleEnglish").removeClass("taLnk");$("weatherToggleEnglish").set("text","F\u00B0");$("weatherToggleMetric").addClass("taLnk");$("weatherToggleMetric").addEvent("click",ta.widgets.Weather.switchToMetric).set("text","C\u00B0");ta.trk("switch_to_F");return false},toggleDisplay:function(b,a,c){if(a.value=="0"){$("monthlyLabel").addClass("selected");$("extendedLabel").removeClass("selected");$("weatherHistory").setStyle("display","inline");$("weatherExtendedForecast").setStyle("display","none");$("weatherHistory").setStyle("height","180px")}else{$("monthlyLabel").removeClass("selected");$("extendedLabel").addClass("selected");$("weatherHistory").setStyle("display","none");if($("weatherExtendedForecast").innerHTML.length<=1){new Request({url:"/WeatherAjax?geo="+c,method:"get",evalScripts:true,onSuccess:function(d,e){$("weatherExtendedForecast").innerHTML=d;ta.widgets.Weather.init()}}).send()}else{$("weatherExtendedForecast").setStyle("display","inline")}$("weatherExtendedForecast").setStyle("height","180px")}}};(function(){Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:true},initialize:function(c,b){this.element=this.subject=document.id(c);this.parent(b);if(typeOf(this.element)!="element"){this.element=document.id(this.element.getDocument().body)}if(this.options.wheelStops){var d=this.element,e=this.cancel.pass(false,this);this.addEvent("start",function(){d.addEvent("mousewheel",e)},true);this.addEvent("complete",function(){d.removeEvent("mousewheel",e)},true)}},set:function(){var b=Array.flatten(arguments);if(Browser.firefox){b=[Math.round(b[0]),Math.round(b[1])]}this.element.scrollTo(b[0],b[1])},compute:function(d,c,b){return[0,1].map(function(e){return Fx.compute(d[e],c[e],b)})},start:function(c,d){if(!this.check(c,d)){return this}var b=this.element.getScroll();return this.parent([b.x,b.y],[c,d])},calculateScroll:function(g,f){var d=this.element,b=d.getScrollSize(),h=d.getScroll(),j=d.getSize(),c=this.options.offset,i={x:g,y:f};for(var e in i){if(!i[e]&&i[e]!==0){i[e]=h[e]}if(typeOf(i[e])!="number"){i[e]=b[e]-j[e]}i[e]+=c[e]}return[i.x,i.y]},toTop:function(){return this.start.apply(this,this.calculateScroll(false,0))},toLeft:function(){return this.start.apply(this,this.calculateScroll(0,false))},toRight:function(){return this.start.apply(this,this.calculateScroll("right",false))},toBottom:function(){return this.start.apply(this,this.calculateScroll(false,"bottom"))},toElement:function(d){var c=document.id(d).getPosition(this.element),b=a(this.element)?{x:0,y:0}:this.element.getScroll();return this.start.apply(this,this.calculateScroll(c.x+b.x,c.y+b.y))},scrollIntoView:function(d,g,e){g=g?Array.from(g):["x","y"];d=document.id(d);var i={},f=d.getPosition(this.element),j=d.getSize(),h=this.element.getScroll(),b=this.element.getSize(),c={x:f.x+j.x,y:f.y+j.y};["x","y"].each(function(k){if(g.contains(k)){if(c[k]>h[k]+b[k]){i[k]=c[k]-b[k]}if(f[k]<h[k]){i[k]=f[k]}}if(i[k]==null){i[k]=h[k]}if(e&&e[k]){i[k]=i[k]+e[k]}},this);if(i.x!=h.x||i.y!=h.y){this.start(i.x,i.y)}return this},scrollToCenter:function(e,f,h){f=f?Array.from(f):["x","y"];e=document.id(e);var i={},c=e.getPosition(this.element),d=e.getSize(),b=this.element.getScroll(),g=this.element.getSize();["x","y"].each(function(j){if(f.contains(j)){i[j]=c[j]-(g[j]-d[j])/2}if(i[j]==null){i[j]=b[j]}if(h&&h[j]){i[j]=i[j]+h[j]}},this);if(i.x!=b.x||i.y!=b.y){this.start(i.x,i.y)}return this}});function a(b){return(/^(?:body|html)$/i).test(b.tagName)}})();Fx.implement({getTransition:function(){var a=this.options.transition||Fx.Transitions.Sine.easeInOut;if(typeof a=="string"){var b=a.split(":");a=Fx.Transitions;a=a[b[0]]||a[b[0].capitalize()];if(b[1]){a=a["ease"+b[1].capitalize()+(b[2]?b[2].capitalize():"")]}}return a}});Fx.Transition=function(b,a){a=Array.from(a);return Object.append(b,{easeIn:function(c){return b(c,a)},easeOut:function(c){return 1-b(1-c,a)},easeInOut:function(c){return(c<=0.5)?b(2*c,a)/2:(2-b(2*(1-c),a))/2}})};Fx.Transitions={linear:function(a){return a}};Fx.Transitions.extend=function(a){for(var b in a){Fx.Transitions[b]=new Fx.Transition(a[b])}};Fx.Transitions.extend({Pow:function(b,a){return Math.pow(b,a&&a[0]||6)},Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(b,a){a=a&&a[0]||1.618;return Math.pow(b,2)*((a+1)*b-a)},Bounce:function(f){var e;for(var d=0,c=1;1;d+=c,c/=2){if(f>=(7-4*d)/11){e=c*c-Math.pow((11-6*d-11*f)/4,2);break}}return e},Elastic:function(b,a){return Math.pow(2,10*--b)*Math.cos(20*b*Math.PI*(a&&a[0]||1)/3)}});["Quad","Cubic","Quart","Quint"].each(function(b,a){Fx.Transitions[b]=new Fx.Transition(function(c){return Math.pow(c,[a+2])})});ta.widgets.ScrollingTabs=function(l,h,b,d,q){var o=l;var c=h;var j=b;var f=d;var n=q;var i=null;var p={};var a={};var g=false;var k=false;var e=true;this.init=function(){this.reset();var t=o&&o.substr?document.getElement(o):o;if(t){t.removeEvent("scroll",m);t.addEvent("scroll",m);this.test()}var s=document.getElements(h);for(var r=s.length-1;r>=0;r--){p[s[r].getAttribute("data-tab")]=s[r]}};this.test=function(){m()};this.setCallback=function(s,r){a[s]=r};this.reset=function(){i&&i.removeClass("current");i=null;p={};g=false};this.isScrolling=function(){return g};this.scrollToPosition=function(t,u){if(g){return}t=t||0;var s=u||300;g=true;var r=document.getElement(o);(new Fx.Scroll(r,{wait:false,duration:s,onComplete:function(){g=false;if(a.afterScroll){a.afterScroll(r)}}})).start(0,t)};this.show=function(v,r,y){if(!v||g){return}var w=r||300;g=true;var z=o&&o.substr?document.getElement(o):o;var u=0;if(j){u=isNaN(parseInt(y))?f:y}var x=p[v.id];if(x){if(!x.isVisible()){var A=document.getElements(c),t=A.indexOf(x);if(t>=0){for(;(t<A.length)&&!x.isVisible();t++){x=A[t]}}}if(e){if(window.location.hash&&v.id&&v.id.indexOf(window.location.hash.substring(1))>-1){var s=x.getCoordinates().top-u;ta.store("scrollingTabs.scrollOnPageLoad",s)}e=false}window.fireEvent("scrollingTabs_Start");(new Fx.Scroll(z||window,{wait:false,duration:w,offset:{x:0,y:-u},onComplete:function(){g=false;k=true;if(a.afterScroll){a.afterScroll(z,i,p[v.id])}window.fireEvent("scrollingTabs_End")}})).toElement(x)}};this.getTabAnchor=function(r){return p[r.id]};function m(){var y=null;var w=o&&o.substr?document.getElement(o):o;if(!w){return}var v=document.getElements(c);if(!v){return}for(var r=v.length-1;r>=0;r--){var u=false;var t=v[r];if(j){if(w==window){u=t.isDisplayed()&&((t.getPosition().y-n)<=w.getScroll().y)}else{u=(t.getPosition(w).y-n)<=w.getScroll().y}}else{u=t.getPosition(w).y<=0}if(u){y=ta.id(t.getAttribute("data-tab"));break}}var s=i?i.id:null;if(y&&y.id!=s){if(i){i.removeClass("current")}y.addClass("current");if(k){k=false}else{if(a.tabChangeOnScroll&&!g){a.tabChangeOnScroll(w,i,y)}}i=y}if(a.test){a.test(w)}}};function StringBuffer(a){this.strings=new Array;if(a){this.append(a)}}StringBuffer.prototype.append=function(a){this.strings.push(a);return this};StringBuffer.prototype.toString=function(){return this.strings.join("")};StringBuffer.prototype.isEmpty=function(){return this.strings.length==0};function UrlParams(){this.params=new StringBuffer()}UrlParams.prototype.add=function(a,b){if(!this.params.isEmpty()){this.params.append("&")}this.params.append(encodeURIComponent(a));this.params.append("=");this.params.append(encodeURIComponent(b))};UrlParams.prototype.toString=function(){return this.params.toString()};var ERROR_PREFIX="ERROR:";function HttpRpc(a,e,b,c,f,d){if(a.slice(0,4)=="http"){this.url=a}else{if(a.charAt(0)!="/"){a="/"+a}this.url="http://"+window.location.host+a}if(f){this.method=f}else{this.method="POST"}if(b){this.responseFunc=b}else{this.responseFunc=function(g){}}if(e){this.errorFunc=e}else{this.errorFunc=function(g){}}if(c){this.finalizerFunc=c}else{this.finalizerFunc=function(g){}}this.bSync=d}HttpRpc.prototype.getTransport=function(){var a=null;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}}}return a};HttpRpc.prototype.sendRequest=function(b){if(!b){b=""}this.req=this.getTransport();this.req.open(this.method,this.url,!this.bSync);this.req.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");var a=this;this.req.onreadystatechange=function(){a.handleAjaxResponse()};this.req.send(b)};HttpRpc.prototype.handleAjaxResponse=function(){try{if(this.req.readyState==4){if(this.isSuccess(this.req)){this.responseFunc(this.req)}else{this.errorFunc(this.req)}}}finally{if(this.req.readyState==4){this.finalizerFunc(this.req)}}if(this.req.readyState==4){delete this.req;return}};HttpRpc.prototype.isSuccess=function(b){try{if(b==null||b.status==undefined){return true}return((b.status>=200&&b.status<300))&&((b.responseText==null)||b.responseText.slice(0,ERROR_PREFIX.length)!=ERROR_PREFIX)}catch(a){return false}};function getIFrameHeight(b){var a=0;if(b.height){a=b.height-20}else{if(b.body.scrollHeight){a=Math.max(a,b.body.scrollHeight)}if(b.body.offsetHeight){a=Math.max(a,b.body.offsetHeight)}}return a}function getIFrameWidth(b){var a=0;if(b.width){a=b.width}else{if(b.body.scrollWidth){a=Math.max(a,b.body.scrollWidth)}if(b.body.offsetWidth){a=Math.max(a,b.body.offsetWidth)}}return a}function setIFrameHeight(c){var b=document.getElementById("loginframe");b.style.height="auto";var a=getIFrameHeight(c);b.style.height=a+"px";return a}function setIFrameWidth(c){var b=document.getElementById("loginframe");b.style.width="auto";var a=getIFrameWidth(c);b.style.width=a+"px";return a}function getIFrameDoc(){var a=document.getElementById("loginframe");var b;if(a.contentDocument){b=a.contentDocument}else{if(a.contentWindow){b=a.contentWindow.document}else{if(a.document){b=a.document}}}return b}function centerIFrame(b,e,i,c){var f=document.getElementById("loginframe");var g=getIFrameDoc();setIFrameHeight(g);setIFrameWidth(g);var a=f.style.width.replace(/px/,"");var d=f.style.height.replace(/px/,"");if(b&&a<b){a=b;f.style.width=a+"px"}if(e&&d<e){d=e;f.style.height=d+"px"}if(i&&a>i){a=i;f.style.width=a+"px"}if(c&&d>c){d=c;f.style.height=d+"px"}recenterIFrame()}function recenterIFrame(){var d=document.getElementById("loginframe");var g=getIFrameDoc();var b=getScrollOffset();var i=d.style.width.replace(/px/,"");var e=d.style.height.replace(/px/,"");var a=window.innerWidth?window.innerWidth:(document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.offsetWidth);var j=window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight);var c=Math.max(5,Math.round(a/2-i/2+b[0]));var f=Math.max(5,Math.round(j/2-e/2+b[1]));d.style.left=c+"px";d.style.top=f+"px"}function adjustIFrame(e,d,b,a){var c=document.getElementById("loginframe");c.style.top=e+"px";c.style.left=d+"px";c.style.width=b+"px";c.style.height=a+"px"}function centerAndDisplayIFrame(c,a,e,b){centerIFrame(c,a,e,b);var d=document.getElementById("loginframe");d.style.display="inline"}function loadIFrame(b,a){if(!b||b==""){b="/MemberSignIn"}var e=new UrlParams();e.add("skin","iframe");if(a){for(var c=0;c<a.length-1;c+=2){e.add(a[c],a[c+1])}}if(b.match(/\?/)){b+="&"}else{b+="?"}b=b+e.toString();var f=document.getElementById("iframediv");var d=document.getElementById("loginframe");if(d){d.src=b;d.style.display="inline"}else{f.innerHTML+='<iframe id="loginframe" name="loginframe" src="'+b+'" frameborder="0" scrolling="no" width="590" height="600" style="position: absolute; z-index: 130;"></iframe>'}window.onresize=recenterIFrame;if(f){f.style.display="block"}return false}function getLoginUrl(a){var b=getUrlPrefix()+"/MemberSignIn";var d=new UrlParams();if(a){for(var c=0;c<a.length-1;c+=2){d.add(a[c],a[c+1])}}if(b.match(/\?/)){b+="&"}else{b+="?"}b=b+d.toString();return b}function getUrlPrefix(){var b=document.location;var a=b.protocol+"//"+b.host;if(b.port){a+=":"+b.port}return a}function login(b){var a=getUrlPrefix();if(a.indexOf("https")==0){return loadIFrame(a+"/RegistrationPage",b)}else{window.location=getLoginUrl(b)}}function migrate(a){return loadIFrame(getUrlPrefix()+"/MemberScreenName",a)}function hideIFrame(){var a=parent.document.getElementById("loginframe");if(a){a.style.display="none";a.src=""}a=document.getElementById("iframediv");if(a){a.style.display="none"}if(parent.loginCancel){parent.loginCancel()}};ta.forums={showExpertOverlay:function(c,b,a){c.stop();b.onclick=null;ta.run("ta.overlays.Factory.relBelowClick",{},null,b,{style:"typeO expertOverlay",remoteLink:a})}};ta.tourism={addDefaultText:function(a){a=ta.id(a);if(a&&!a.value&&!a.hasClass("defaultText")){a.value=a.get("data-default");a.addClass("defaultText")}},clearDefaultText:function(a){a=ta.id(a);if(a&&a.hasClass("defaultText")){a.value="";a.removeClass("defaultText")}},presubmit:function(){ta.tourism.clearDefaultText(ta.id("subject"));ta.tourism.clearDefaultText(ta.id("message"))}};ta.popups.FlightSearch={popFlightSearch:function(c,b){var f=$("findFlights");var a=$("HAC_FORM");var g=$("pidTarget");if(f&&f.checked){try{setPID("3384");ta.popups.FlightSearch.openWindow()}catch(d){}}return true},openWindow:function(){var c=ta.popups.FlightSearch.getChpFltsUrl();var a=780;var b=580;if(window.screen){a=(screen.availWidth>1000)?1000:780;b=parseInt(0.8*screen.availHeight)}var e="width="+a+",height="+b+",screenX=25,screenY=25,left=25,top=25,toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1";var d=window.open(c,"FlightSearch",e);if(d!=null){d.opener=self;d.blur()}},flightsDate:function(d,b){var a=d.split("/");if(!a.length){return d}for(var c=0;c<a.length;c++){if(a[c].length<2){a[c]="0"+a[c]}}return(b)?a[2]+a[0]+a[1]:a[2]+a[1]+a[0]},getChpFltsUrl:function(){var c="CheapFlights?travelers=1&cos=0&nonstop=no&nearby0=no&nearby1=no&time0=anytime&time1=anytime&";var a="FareCalendar?adults=1&";var g=$("checkIn").value;var d=$("checkOut").value;var f=g+d;var e=[];e.push("date0="+ta.popups.FlightSearch.flightsDate(g,gIS_US));e.push("date1="+ta.popups.FlightSearch.flightsDate(d,gIS_US));e.push("airport0="+gHomeAirport);if(typeof(gAirportFromPageLoc)!="undefined"){e.push("airport1="+gAirportFromPageLoc)}else{var b=$("geoAirport");if(b){e.push("airport1="+b.value)}}if(parseInt(f)){return c+e.join("&")}else{return a+e.join("&")}}};(function(a,c,b,d){b.commerce.meta=(function(h){var g=function(){return typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates},f=function(q,n,r){var o="sprite-",m=o+n,p=o+r;if(q.hasClass(m)){q.removeClass(m);q.addClass(p)}},i=function(){var m=h.retrieve("meta.chevronTracking"),o=h.retrieve("meta.chevronAction"),n=h.retrieve("meta.chevronLabel");if(m&&o){if(!n){h.trackEventOnPage(m,o)}else{h.trackEventOnPage(m,o,n)}}h.remove("meta.chevronTracking");h.remove("meta.chevronAction");h.remove("meta.chevronLabel")},e=function(q,m){var n,p,o,r;if(m!==null&&q!==null){h.commerce.meta.suppressCRArea(q);n=q.getElement(".metaDatesNotChosen");p=q.getElement(".metaDatesChosen");if(p){if(n){n.addClass("miniMetaHideHdr");n.removeClass("miniMetaShowHdr")}p.addClass("miniMetaShowHdr");p.removeClass("miniMetaHideHdr")}q.getElements(".minimalist_datepicker_wrap.hidden").each(function(s){s.removeClass("hidden")});o=q.getElement(".postShowMetaCR");if(o!=null){o.destroy()}o=q.getElement(".postShowMetaCRLB");if(o!=null){o.destroy()}o=q.getElement(".postShowMetaCRLBPCR");if(o!=null){o.destroy()}r=q.getElement("fieldset");h.commerce.meta.adoptMiniMetaElem(r,m);h.fireEvent("refreshedDOMContent",q)}},k=function(m){if(!m){return}if(m.getElement(".hacMiniComplete")&&!m.getElement(".anyOfferCompletedSuccessfully")){m.getElements(".photos_lb_update_avail").each(function(n){n.addClass("hidden")});m.getElements(".photos_lb_update_no_avail").each(function(n){n.removeClass("hidden")})}else{m.getElements(".photos_lb_update_avail").each(function(n){n.removeClass("hidden")});m.getElements(".photos_lb_update_no_avail").each(function(n){n.addClass("hidden")})}},j=function(m){m.getElements(".textLinks").each(function(n){n.addClass("hidden")});m.getElements(".maybeCheck").each(function(n){n.addClass("hidden")});m.getElements(".disclaimer").each(function(n){n.addClass("hidden")});m.getElements(".photos_lb_update_links").each(function(n){n.removeClass("hidden")});m.getElements(".taxesAndFees").each(function(n){n.addClass("hidden")});k(m)},l=function(n,m,o){n=n?n:"";m=m?m:"";o=o?o:"";var p=[n,m,o].join("|").replace("||","|").replace(/(\|$)/g,"");h.commerce.meta.updateNavArea(p)};return{updateInlineMeta:function(o,n){if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.popInlineDatePicker(n,o);return}var m=h.id("CHECK_RATE");if(!m){return}},popInlineDatePicker:function(o,p){if(!p){return}var m;var n="_inm";if(o&&o.target&&o.target.getParent("#CHECK_RATES_CONT")){m=h.id("date_picker_"+p)}m=m||h.id("date_picker_"+p+n);if(m){var q=m.getParent(".date_picker_calendar_wrap");if(q&&q.onclick){q.onclick(o,q,p,n);q.fireEvent("click",o,q,p,n);(function(){try{h.retrieve("avail.data."+p+n).calendar.calendarOverlay.position()}catch(r){}}).delay(200)}}},clickMetaShowPrices:function(n){var m;n=new Event(n);if(h.page&&h.page.usingUnifiedDates){h.page.gatherDatesNear(n.target);n.stop();return}if(!h.widgets.calendar.hasPageDates()&&!(h.retrieve("datepicker_autoadvance")&&h.widgets.calendar.getPageInDate())){h.widgets.calendar.setErrorStyling(n.target);return}m=a.getElement(".cr_lb_overlay");if(m&&m.overlay){m.overlay.hide()}},showLowestPriceCTA:function(s){var n=(s)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";if(h.has(n)){var r=true;if(s){var v=a.getElement(".meta_rates_content");r=v&&v.style.display=="block"}if(r){var o=h.retrieve(n);if(o.hasOwnProperty("idx")){var t=(s)?"Meta_LP_CTA_Display_Inline":"Meta_LP_CTA_Display";var q=(o.idx===0)?"Not_Displayed":"Displayed";var u=o.idx+"";h.trackEventOnPage(t,q,u)}var p=(s)?"LP_CTA_INLINE":"LP_CTA";var m=h.id(p);if(m){(function(){m.fade("in")}).delay(1000)}}}},chevronHover:function(q,o,n,p){if(o&&n&&p){var m=h.id(o).getElement("."+p);if(m){m.removeClass(p);m.addClass(n)}}},chevronBlur:function(q,o,n,p){if(o&&n&&p){var m=h.id(o).getElement("."+n);if(m){m.removeClass(n);m.addClass(p)}}},hoverTopOffer:function(){var m=a.getElement(".rgba_gray_arrow_up");if(m){m.removeClass("rgba_gray_arrow_up");m.addClass("rgba_yellow_arrow_up")}},blurTopOffer:function(){var m=a.getElement(".rgba_yellow_arrow_up");if(m){m.removeClass("rgba_yellow_arrow_up");m.addClass("rgba_gray_arrow_up")}},hoverBookBtn:function(m){var n=h.id(m);f(n,"bookBtnOrangeIdle","bookBtnOrangeOver");f(n,"bookBtnGreyIdle","bookBtnGreyOver");f(n,"bookIdle","bookOver");f(n,"goIdle","goOver");f(n,"selectIdle","selectOver");f(n,"bookSmallIdle","bookSmallOver");f(n,"goSmallIdle","goSmallOver");f(n,"selectSmallIdle","selectSmallOver");f(n,"goBtnGrey","goBtnGreyOver");f(n,"goBtnOrange","goBtnOrangeOver");f(n,"chevronOrangeIdle35","chevronOrangeOver35");f(n,"chevronGreyIdle27","chevronGreyOver27");f(n,"chevronIdle_ylw","chevronHover_ylw")},blurBookBtn:function(m){var n=h.id(m);f(n,"bookBtnOrangeOver","bookBtnOrangeIdle");f(n,"bookBtnGreyOver","bookBtnGreyIdle");f(n,"bookOver","bookIdle");f(n,"goOver","goIdle");f(n,"selectOver","selectIdle");f(n,"bookSmallOver","bookSmallIdle");f(n,"goSmallOver","goSmallIdle");f(n,"selectSmallOver","selectSmallIdle");f(n,"goBtnGreyOver","goBtnGrey");f(n,"goBtnOrangeOver","goBtnOrange");f(n,"chevronOrangeOver35","chevronOrangeIdle35");f(n,"chevronGreyOver27","chevronGreyIdle27");f(n,"chevronHover_ylw","chevronIdle_ylw")},hoverSmallBookBtn:function(n){var m=h.id(n).getElement(".bookBtn");if(m==null){return}f(m,"bookBtnOrangeIdleSmall","bookBtnOrangeIdleSmallOver");f(m,"bookSmallIdle","bookSmallOver");f(m,"goSmallIdle","goSmallOver");f(m,"selectSmallIdle","selectSmallOver")},blurSmallBookBtn:function(n){var m=h.id(n).getElement(".bookBtn");if(m==null){return}f(m,"bookBtnOrangeIdleSmallOver","bookBtnOrangeIdleSmall");f(m,"bookSmallOver","bookSmallIdle");f(m,"goSmallOver","goSmallIdle");f(m,"selectSmallOver","selectSmallIdle")},providerHoverOn:function(n,t,s){var r=h.id(n);r.addClass("partnerHvr");var m=r.getElement(".price_overlay");if(m){var q=r.getElement(".perNight");var p=q.getCoordinates().width+29;m.addClass("show");if(h.util.i18n.isRtl()){m.setStyles({position:"absolute",left:p,zindex:"101"})}else{m.setStyles({position:"absolute",right:p,zindex:"101"})}}var o=n.getElement(".bookBtn");if(o){h.commerce.meta.hoverBookBtn(o)}h.store("meta.hoverProvider",t);h.store("meta.hoverProviderPosn",s)},providerHoverOff:function(n){var p=h.id(n);p.removeClass("partnerHvr");var m=p.getElement(".price_overlay");if(m){m.removeClass("show")}var o=n.getElement(".bookBtn");if(o){h.commerce.meta.blurBookBtn(o)}h.remove("meta.hoverProvider")},restoreProviderHover:function(){var m=h.retrieve("meta.hoverProvider");var q=h.retrieve("meta.hoverProviderPosn");if(m&&q){var p=h.id("PROVIDER_BLOCK");if(p){var o=p.getElements(".metaProvider");var n=p.getElement(".provider_"+m);if(o&&n&&n.hasClass("order_"+q)){o.each(function(r){h.commerce.meta.providerHoverOff(r)});h.commerce.meta.providerHoverOn(n,m,q)}}}},updateNavArea:function(m){var n=h.retrieve("ta.meta.navArea");if(!n||n.indexOf(m)<0){h.store("ta.meta.navArea",m)}},getNavAreaContextFromDom:function(n,m){n=h.id(n);if(n.getParent(".persistentCR")){return(m)?"|PCR":"PCR"}else{if(n.getParent(".photosOverlay")||n.getParent("#LOC_PHOTO_ALBUMS")){return(m)?"|Photo_Lightbox":"Photo_Lightbox"}else{if(n.getParent(".amenities_lightbox")){return(m)?"|Amenities_Lightbox":"Amenities_Lightbox"}else{if(n.getParent("#CHECK_RATES_LB")){return(m)?"|Photo_LB":"Photo_LB"}else{return}}}}},updateNavAreaMini:function(n,o,m){o=h.id(o);var p=h.commerce.meta.getNavAreaContextFromDom(o);p=p?"|"+p:"";l(n,p,m)},loadBestPriceXsell:function(C,F,q,p){try{if(h.retrieve("checkrates.one_second_xsell")!==true){return}var E=q&&q.isInline;var y="";var r="";var K=q&&q.isMetaLighboxV3;if(h.isHRTabs2014()&&E){return}if(K){y="meta_lightbox_v3"}var D=1000;var m="loadBestPriceXsell_numTries";var s="loadBestPriceXsell_curCancelKey";if(E){m="loadBestPriceXsellInline_numTries";s="loadBestPriceXsellInline_curCancelKey"}var J="meta.xsellTravelData";if(E){J="meta.xsellTravelDataInline"}var u=h.retrieve(J);if(p==null){p=new Date().getTime();h.store(m,0);u=h.widgets.calendar.getCheckRatesData();h.store(J,u);var v=h.id(F);if(v){v.innerHTML="";v.setStyle("height",0);v.setStyle("opacity","0");var A=h.retrieve("metaCheckRatesOverlay");A=h.id(A);if(!E&&A&&A.container&&A.container.getPosition){c.scrollTo(0,A.container.getPosition().y)}}if(E){h.commerce.meta.metaInYourMeta_resetInline()}else{h.commerce.meta.metaInYourMeta_resetLB()}}var t="loadBestPriceXsell_"+p+"_cancel";if(E){t="loadBestPriceXsellInline_"+p+"_cancel"}if(h.retrieve(t)){return}if(h.has(s)){var I=h.retrieve(s);if(I!=t){h.store(I,true)}}if(!h.has(t)){h.store(t,false);h.store(s,t)}var w=h.retrieve(m);var M=w+1;h.store(m,M);if(!u){return}var L="";if(typeof(pageServlet)!==d&&pageServlet){L=pageServlet}var B={};if(h.meta&&h.meta.update){B=h.commerce.meta.getMetaParams()}var x=Object.merge(u,{detail:C,"try":h.retrieve(m),reqNum:q.secondTry?"2":"1",type:y,isInlineRequest:E?"1":"0",openedVendors:r,origServlet:L},B);var o=Object.toQueryString(x);if(!o||!o.trim()){h.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell  - toQueryString failure",null,x);return}var n=h.retrieve("ta.meta.navArea");var z;try{z=h.commerce.meta.tracking.setTimingForNavArea(n)}catch(H){h.util.error.record(H,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}if(z){x.metaRequestTiming=z}if(h.commerce.meta.tracking.hasAnySuppressedAreas()){var G=h.commerce.meta.tracking.getSuppressedAreasAsString();if(G){x.suppressImpressionsOnComplete=G}}new Request({url:"/MetaBestPriceCrossSellAjax?"+o,evalScripts:true,onSuccess:function(O){if(h.retrieve(t)){return}var N=O.contains("xsellHacStatusReady")||O.contains("xsellHacStatusSOL")||q.secondTry;if(!N){setTimeout(function(){var Q={secondTry:true,xsell:true,isInline:E,isHrRedesignTest:false,openedVendors:r};h.commerce.meta.loadBestPriceXsell(C,F,Q,p)},D)}else{var P=h.id(F);if(P){P.setStyle("height",0);P.setStyle("opacity","0");P.setContent(O);h.commerce.meta.metaInYourMeta(F,{xsell:true,inline:E})}h.store(m,0)}},onFailure:function(){h.store(m,0);h.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(H){h.util.error.record(H,"ta.commerce.meta.loadBestPriceXsell")}},loadGeoCrAutoBroadenContents:function(r,t){var z=5;var p=1000;var o="QC_Meta_Mini|GeoCheckRatesLightBox";try{var m=function(){u=false};var x=function(){r.fireEvent("close",r);r.hide()};var u=true;var w=h.id(r.inner);if(!w){throw new Error("Cannot find parent: "+r)}var q=function(D){var C=0;D.each(function(F){var E=F.getHeight();if(E>C){C=E}});D.each(function(E){E.setStyle("height",C)})};var A=h.commerce.meta.tracking.setTimingForNavArea(o);r.addEvent("close",m);var y={d:t,area:o,metaRequestTiming:A};var B=h.widgets.calendar.getCheckRatesData();if(!B){throw new Error("Cannot find dates and/or adults")}Object.merge(y,B);if(h.meta&&h.meta.update){Object.merge(y,h.commerce.meta.getMetaParams())}var s=0;var n=function(){if(!u){return}++s;y.attempt=s;new Request({url:"/GeoCrAutoBroadenAjax",data:y,method:"get",evalScripts:true,onSuccess:function(C){try{if(!u){return}var E=Elements.from(C,true);var F=E.getElement(".progress").filter(function(I){return I})[0];if(!F){h.util.error.record(null,"geo check rate malform response missing progress",null,y);x()}else{if(/\bfallbackUrl-(\S+)\b/.exec(F.className)){var H=RegExp.$1;var D=h.util.URL.getServletNameFromUrl(H);if(!D){h.util.error.record(null,"geo check rate cannot get servlet name from "+H,null,y);D="UNKNOWN"}h.setEvtCookie("MetaGeoLightBox","unload","Redirect",0,"/"+D);a.location.href=H}else{w.setStyles({overflow:"hidden",height:"auto"});w.innerHTML="";w.adopt(E);q(w.getElements("#GEO_CR_AUTO_BROADEN .recs .rec .info .distance"));q(w.getElements("#GEO_CR_AUTO_BROADEN .recs .rec .info .amenity"));if(!F.hasClass("isHacComplete")&&s<z){setTimeout(n,p)}else{w.getElements(".showUntilLast").dispose();w.getElements(".hideUntilLast").removeClass("hidden")}}}}catch(G){h.util.error.record(G,"cannot process geo check rate response",null,y);x()}},onFailure:function(C){h.util.error.record(null,"geo check rate request failed: status="+(C&&C.status),null,y);x()}}).send()};n()}catch(v){h.util.error.record(v,"cannot send geo check rate initial request");if(x){x()}}},xSellResponses:{lb_hac:false,lb_xsell:false,inline_hac:false,inline_xsell:false},metaInYourMeta_resetLB:function(){h.commerce.meta.xSellResponses.lb_hac=false;h.commerce.meta.xSellResponses.lb_xsell=false},metaInYourMeta_resetInline:function(){h.commerce.meta.xSellResponses.inline_hac=false;h.commerce.meta.xSellResponses.inline_xsell=false},hacIsBlockingXSell:function(m){var n=h.commerce.meta.xSellResponses;if(m){return n.inline_xsell}else{return n.lb_xsell}},metaInYourMeta:function(p,x){var o=x&&x.inline;var n=x&&x.xsell;var s=h.commerce.meta.xSellResponses;if(o){if(n){s.inline_xsell=true}else{s.inline_hac=true}}else{if(n){s.lb_xsell=true}else{s.lb_hac=true}}if((o&&s.inline_xsell)||(!o&&s.lb_xsell&&s.lb_hac)){var v=h.id("META_PRICE_XSELL");var u=h.id("STATE_OPT_RESPONSE");if(o){v=h.id("META_PRICE_XSELL_INLINE");u=h.id("STATE_OPT_RESPONSE_INLINE")}if(v&&v.hasClass&&!v.hasClass("hidden")){return}if(u&&u.hasClass&&!u.hasClass("hidden")){return}var w=v;var r=0;if(h.meta&&h.meta.update){r=h.meta.update.getMetaPricesCount(o)}else{if(g()){r=dd.commerce.checkrates.getMetaPricesCount(o)}}if(r==null){r=0}if(r<1&&u){w=u}var t=h.id(p);if(t){if(w){h.commerce.meta.revealBestPriceXsell(t,w,o,false)}else{var m="lA";if(o){m=m+"_Inline"}var q=h.id(m);if(q&&q.removeClass){q.removeClass("hidden")}}}}},revealBestPriceXsell:function(s,x,n,A){if(s){s=h.id(s)}if(x){x=h.id(x)}if(!s||!x){h.util.error.record(null,"revealBestPriceXsell - required elements missing");return}if(x.removeClass){x.removeClass("hidden")}var r=new Fx.Tween(s,{property:"opacity"});if(A){var p=h.retrieve("metaLeaveBehindOverlay");if(p&&p.container){var m=p.container;if(m.hasClass&&m.hasClass("hidden")&&m.removeClass){m.removeClass("hidden")}if(h.meta&&h.meta.cr){h.meta.cr.removePCR()}else{if(g()){dd.commerce.checkrates.removePCR()}}}}else{var t="META_MINI_META_MAYBE";if(n){t="META_MINI_META_MAYBE_INLINE"}var z=h.id(t);var w=true;if(z){w=false}var v="Displayed_Lightbox";if(n){v="Displayed_Inline"}var u=x.getElements(".hotelListing").length;if(u===0){u="0";v="Not_"+v}h.trackEventOnPage("Meta_State-Optimized_XSell",v,u)}var q=x.getSize().y;var y=new Fx.Tween(s,{property:"height",onComplete:function(){if(!A){r.start(0,1)}}});y.start(q);var o=h.retrieve("metaCheckRatesOverlay");if(o&&o.container&&o.closeBtn&&h.id(c).getScroll().y>o.container.getPosition().y){h.util.element.scrollIntoView(o.closeBtn)}},hideBestPriceXsell:function(q){var p=h.id(q);var n=h.id("META_PRICE_XSELL");if(!p||!n){return}var m=new Fx.Tween(p,{property:"height"});var o=new Fx.Tween(p,{property:"opacity",onComplete:function(){m.start(0);if(n.addClass){n.addClass("hidden")}}});o.start(1,0)},loadMetaAF:function(q,r,s){try{if(h.retrieve("checkrates.meta_af")!==true||h.retrieve("ta.redirectingPage")){return}var o="meta_af_last_request";var n=new Date().getTime();h.store(o,n);var p=1000;var w=false;var u=false;if(h.page&&h.page.usingUnifiedDates&&!h.page.hasDates("STAYDATES")){return}if(h.meta&&h.meta.update){w=h.widgets.calendar.getCheckRatesData();if(!w){return}var v={};if(h.meta&&h.meta.update){v=h.commerce.meta.getMetaParams()}u=Object.merge(w,{detail:q,reqNum:s?"2":"1",type:"af"},v)}else{if(g()){return dd.commerce.checkrates.loadMetaAF(q,r,s)}else{return}}var m=Object.toQueryString(u);if(!m||!m.trim()){h.util.error.record(null,"ta.commerce.meta.loadMetaAF - toQueryString failure",null,u);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:u,evalScripts:true,onSuccess:function(C){if(h.retrieve(o)!=n){return}var D=C.contains("xsellHacStatusReady")||C.contains("xsellHacStatusSOL")||s;if(!D){setTimeout(function(){h.commerce.meta.loadMetaAF(q,r,true)},p)}else{var A=h.id(r);var x=a.getElement(".clearDates");if(A){A.show();A.setStyle("height",0);A.setStyle("opacity","0");A.setContent(C);h.prwidgets.initWidgets(A);var B=a.getElement(".tablet_desktop .mapsv2-more .clearDates");if(x&&x!=B){x.style.display="none"}var E=A.getElement(".mainList");if(E){var y=new Fx.Tween(A,{property:"opacity"});var z=E.getSize().y;var F=new Fx.Tween(A,{property:"height",onComplete:function(){A.setStyle("height","auto");y.start(0,1)}});F.start(0,z);h.fireEvent("avaf.loaded")}}}},onFailure:function(){if(h.retrieve("ta.redirectingPage")){return}h.util.error.record(null,"ta.commerce.meta.loadMetaAF - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(t){h.util.error.record(t,"ta.commerce.meta.loadMetaAF")}},updateProvAreaFromLightBox:function(q){var n=h.retrieve("meta.baseLocationId");if(n&&q==n){var p=h.retrieve("meta.postShowMetaCR");var o=h.retrieve("meta.postShowMetaCRLB");var m=h.retrieve("meta.postShowMetaCRLBPCR");if(p&&o&&m){h.commerce.meta.updateProvArea(p,o,m);return}}if(h.widgets.calendar.datesExist()){if(h.meta&&h.meta.update){h.meta.update.request(n)}else{if(g()){dd.commerce.checkrates.checkRatesMiniMeta(null,a.getElementById("CHECK_RATE"),n,"checkrates")}}}},updateProvArea:function(w){var q=a.getElement("#CHECK_RATES_CONT.chkRates");var y=a.getElement(".ShowUserReviews #CHECK_RATES_CONT.chkRates");var p=a.getElement("#LOC_PHOTO_ALBUMS.photos_lb_update .metaCrosssell .chkRates");var u=a.getElement("#LOC_PHOTO_ALBUMS.photos_lb_update .sidebar .chkRates");var r=a.getElement("#AMENITY_LIGHTBOX.photos_lb_update .chkRates");var A=a.getElement(".similarCarousel");var z=a.getElement(".premiumTimeout");if(A&&z){var m=q.getElement("div.bc_text_content");if(m){var n=w.getChildren()[1];if(n){var v=n.clone(false);v.innerHTML=n.innerHTML;m.innerHTML="";m.adopt(v)}}}else{e(y,w)}if(p){e(p,w);j(p);var x=a.getElement(".featuredImageWrap.metaCrosssell");if(x){var s=x.getElement(".premium_offers_area");if(s){var o=s.getElements(".offer.wrap.premium");var t=x.getElement(".chkRates");if(o&&t){t.toggleClass("noOffers",o.length===0)}}}}if(u){e(u,w);j(u)}if(r){e(r,w);k(r)}if(h.has("meta.isHackathonBC")){h.commerce.meta.alignPriceBlocks();if(h.has("meta.bc.isRevisedUnavailability")){h.commerce.meta.truncateProviderNames()}}c.fireEvent("postAjaxMetaUpdate");if(w&&w.getElement(".hacMiniComplete")){i(w)}},updatePCRAreaWithMiniMeta:function(o,m){if(m==null||o==null){return}var r=o.inner;if(!r){return}h.commerce.meta.suppressCRArea(r);var p=r.getElement(".postShowMetaCRLBPCR");if(p!=null){p.destroy()}var q=r.getElement("fieldset.miniMetaContainer");var n=m.getElement(".disclaimer");if(n!=null){n.destroy()}h.commerce.meta.adoptMiniMetaElem(q,m);if(!h.widgets.calendar.datesInRange()){h.commerce.meta.showCRArea(r)}},adoptMiniMetaElem:function(o,m){if(o!=null){var p=o.getElement(".disclaimer");if(p!=null&&!p.getParentBySelector("#hover_table_display_area")){p.destroy()}var n=m.clone(false);n.innerHTML=m.innerHTML;o.adopt(n)}},miniMetaAjax:function(m,n){if(g()){dd.commerce.checkrates.miniMetaAjax(m,n)}},suppressCRArea:function(m){var n=m.getElements(".miniMetaShow");Array.each(n,function(o){o.removeClass("miniMetaShow");o.addClass("miniMetaHide")})},showCRArea:function(m){var o=m.getElement(".postShowMetaCR");if(o!=null){o.destroy()}var n=m.getElements(".miniMetaHide");Array.each(n,function(p){p.removeClass("miniMetaHide");p.addClass("miniMetaShow")})},showCurrencyPicker:function(){},selectCurrency:function(){},clearStoredMiniData:function(){if(h.retrieve("checkrates.meta_ui_post_click_prices")){h.store("meta.postShowMetaCRLBPCR",null);h.store("meta.postShowMetaCR",null);h.store("meta.postShowMetaCRLB",null)}},storeMiniData:function(n){if(h.retrieve("checkrates.meta_ui_post_click_prices")){var p=n.getElement(".postShowMetaCR");var m=n.getElement(".postShowMetaCRLBPCR");var o=n.getElement(".postShowMetaCRLB");if(p&&o&&m){h.store("meta.postShowMetaCRLBPCR",m);h.store("meta.postShowMetaCR",p);h.store("meta.postShowMetaCRLB",o)}}},providerButtonClicked:function(n){if(n&&!h.has("hotels.hasTimeoutDates")){var m="CheckIn|provider_logo";h.trackEventOnPage("DATEPICKER","OPEN",m,n);h.store("meta.datepicker_tracked",true)}},moreSitesLinkClicked:function(m){if(m&&!h.has("hotels.hasTimeoutDates")){h.trackEventOnPage("DATEPICKER","OPEN","more_sites_link",m);h.store("meta.datepicker_tracked",true)}},buildMetaHacParamObj:function(){var n={};try{var m=a.getElement("#HAC_FORM input[name=geo]");if(m&&m.value){n.geo=m.value}if(!n.geo){var s=a.getElement("#SEARCH_LHN input[name=geo]");if(s){n.geo=s.value}}var t=a.getElementById("searchAll");if(t&&t.value!="true"){var q=h.widgets.calendar.getPageInDate();if(q){n.inDay=q.getDate();n.inMonth=(q.getMonth()+1)+"/"+q.getFullYear()}var p=h.widgets.calendar.getPageOutDate();if(p){n.outDay=p.getDate();n.outMonth=(p.getMonth()+1)+"/"+p.getFullYear()}var o=h.widgets.calendar.getPageAdultsCount();if(o!=2){n.adults=o}n.searchAll="false"}}catch(r){h.util.error.record(r,"buildHACUrlParams")}return Object.toQueryString(n)},getHACCategory:function(){var n=a.getElements(".tab.selected");var o="1";if(n&&n.length&&n.length>0){var m=n[0].className.match(/cat_(\d+)/);if(m){o=m[1]}}return o},buildHACSearchData:function(){var q=h.widgets.calendar.getPageInDate();var u=h.widgets.calendar.getPageOutDate();var v=h.widgets.calendar.getPageAdultsCount();var w=a.getElementById("geo");var n;if(w==null){n=a.getElementsByName("geo");if(n&&n.length>0){w=n[0]}}var t;if(w&&w.value){t=w.value}else{if(c.modelGeoId){t=c.modelGeoId}}var p=false;var x=h.commerce.meta._padZero;var s=q?x(q.getDate()):null;var o=u?x(u.getDate()):null;var r=q?x(q.getMonth()+1)+"/"+q.getFullYear():null;var y=u?x(u.getMonth()+1)+"/"+u.getFullYear():null;var m={};m.adults=v;m.geo=t;m.searchAll=p;m.inDateOfMonth=s;m.outDateOfMonth=o;m.inMonthYear=r;m.outMonthYear=y;m.category=h.commerce.meta.getHACCategory();return m},buildMetaHACUrl:function(){var m=h.commerce.meta.buildHACSearchData();var n="/HACSearch?adults="+m.adults+"&geo="+m.geo+"&searchAll="+m.searchAll;if(m.category){n=n+"&cat="+m.category}if(m.inDateOfMonth){n=n+"&inDay="+m.inDateOfMonth}if(m.outDateOfMonth){n=n+"&outDay="+m.outDateOfMonth}if(m.inMonthYear){n=n+"&inMonth="+m.inMonthYear}if(m.outMonthYear){n=n+"&outMonth="+m.outMonthYear}var o=n+c.location.hash;return o},redirectHACSearch:function(){h.setEvtCookie("Mini_meta_LP_chevron_display","Clicked","Unavailable","","/HACSearch");c.location=h.commerce.meta.buildMetaHACUrl()},_padZero:function(m){return String("0"+m).slice(-2)},anchorToOpenTab:function(){var n=h.id("ReviewsTab");var m=h.id("MetaPricesTab");if(n&&n.hasClass("selected")){h.commerce.meta.scrollToReviews()}else{if(m&&m.hasClass("selected")){n.click();h.commerce.meta.scrollToReviews()}}},scrollToReviews:function(){var m=h.id("REVIEWS");if(m!=null){h.util.element.scrollIntoView(m)}else{h.util.error.record(null,"couldn't find reviews element on page!")}},scrollToId:function(m){if(m&&h.id(m)){h.util.element.scrollIntoView(h.id(m))}},initNoAvailCarousel:function(){try{var m=h.id("ALSO_VIEWED_LIST"),t;if(!m){return}var q=m.getElement("ul");if(!q){return}var w=q.getElements("li").length;var u=new Fx.Tween(q,{property:"left"});var n=353;var r=1;var v=m.getElement(".prev");var o=m.getElement(".next");if(!o||!v){return}var s=function(x){var A,y,z,B;if((r===1&&x<0)||(r===w&&x>0)){return}if(x<0){h.trackEventOnPage("Pager_Arrows","Scroll_Left","Mini_Carousel_Xsell")}else{if(x>0){h.trackEventOnPage("Pager_Arrows","Scroll_Right","Mini_Carousel_Xsell")}}r+=x;A=parseInt(q.getStyle("left"),10);y=n*x*-1;z=A+y;u.start(z);B=m.getElement(".paginator");if(B){if(r===1&&x<0){t="front"}else{if(r===w&&x>0){t="end"}else{t="middle"}}B.className="paginator "+t}};v.addEvent("click",function(){s(-1)});o.addEvent("click",function(){s(1)})}catch(p){h.util.error.record(p,"ta.commerce.meta.initNoAvailCarousel")}},showRemainingProviders:function(n,m){m=h.id(m);if(m){m.destroy()}h.store("checkrates.hr_bc_see_all_click",true);if(h.retrieve("ibdm_impression_tracking")){h.trk("n_more_sites",false,a.getElement(".premium_offers_area"))}a.getElements(".remaining").removeClass("remaining");c.fireEvent("remainingMetaProvidersShown")},showRemainingProviders_Flyout:function(n,m){m=h.id(m);var p=h.id("SHOW_REMAINING_PROVIDERS_FLYOUT");var q=a.getElements(".remaining");try{if(p&&q){a.body.addEvent("click",function(r){if(m&&!r.target||!r.target.getParents().contains(m)||p.isDisplayed()){p.hide();a.body.removeEvents("click")}else{p.adopt(q);p.show()}})}}catch(o){h.util.error.record(o,"showRemainingProviders_Flyout")}},alignPriceBlocks:function(){h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceBlock .price",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceBlock .featuredText",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceOutsideChevron .price",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceOutsideChevron .featuredText",true);h.util.element.makeTextFitOneLine(".offer.premium .priceBlock.flag_bump .price",true);h.util.element.fitToContentsHorizontally(".offer.premium .lowest_price_folded .text",0,65);h.select(".chevron_redesign .offer.premium.unsized .loading").setStyle("display","none");h.select(".chevron_redesign .offer.premium.unsized").removeClass("unsized");h.util.element.makeSameWidth("#CHECK_RATES_CONT > #HotelDateSearch .postShowMetaCR .priceBlock");h.util.element.makeSameWidth("#HR_HACKATHON_CONTENT > #HotelDateSearch .postShowMetaCR .priceBlock")},toggleBlueChevronLowestPriceCTA:function(n){if(h.retrieve("meta_guests_field_v2.CTAActivated")&&!a.getElements(".overlay").length){if(h.has("meta_guests_field_v2.CTATimer")){clearTimeout(h.remove("meta_guests_field_v2.CTATimer"))}var m=h.id("BC_LP_CTA");if(m&&m.fade){if(n){m.fade("in")}else{m.fade("out")}}}},displayBlueChevronLowestPriceCTA:function(){var o="bcMetaLowestPriceCTA",w,u,y,n,v,t,m,x,r;if(h.has(o)&&!h.has("hr_chevron_redesign")){w=h.retrieve(o);if(w.hasOwnProperty("idx")){u=(w.idx===0)?"Not_Displayed":"Displayed";y=w.idx+"";h.trackEventOnPage("BlueChevron_LP_CTA_Display",u,y)}n=h.id("BC_LP_CTA");if(n&&n.fade){(function(){n.fade("in");if(h.retrieve("meta_guests_field_v2.enabled")){h.store("meta_guests_field_v2.CTATimer",(function(){n.fade("out")}).delay(5000));h.store("meta_guests_field_v2.CTAActivated",true)}}).delay(700)}v=h.id("bc_lp_cta_text");if(v){t=v.getSize().y;if(t==12){while(v.getSize().y<=t){v.style.width=""+(v.getSize().x-1)+"px"}v.style.width=""+(v.getSize().x+1)+"px"}if(w.displayTop){m=n.parentNode.getElement(".priceBlock");n.style.position="relative";n.style.left=(345-v.getSize().x)+"px";n.style.top=""+(-m.getSize().y-22)+"px"}else{x=n.getElement(".bc_lp_cta_triangle");n.style.left="-"+(v.getSize().x+20)+"px";x.style.left=""+(v.getSize().x+10)+"px"}v.style.marginTop=""+Math.round((25-v.getSize().y)/2)+"px"}r=5800;if(h.retrieve("check_width_for_CTA_fade")){var A=a.getElement(".bc_lp_cta");var p=a.getElement(".priceBlock");if(A&&p){var q=A.getSize().x+p.getSize().x;var s=250;if((q>s)&&!w.displayTop){(function(){n.fade("out")}).delay(r)}}}else{var z=h.retrieve("fadeBcLpCTAout");if(z&&z==1&&!w.displayTop){(function(){n.fade("out")}).delay(r)}}}},truncateProviderNames:function(){var p=a.getElement(".textLink");if(!p){return}var n=p.getSize().x;var o=Math.max.apply(null,a.getElements(".textLink .price").map(function(q){return q.getParent(".moreLink")?0:q.getSize().x}));var m=n-o-28;if(h.retrieve("meta.paymentsTipText")){m=m-20}if(m>0){$$(".textLinks .providerName").each(function(q){if(q.getNext(".price")){q.setStyle("width",m)}})}},expandProvidersInline:function(o){o=h.id(o);if(!o){return}var n=o.getParent(".metaPriceInfo");if(!n){return}var p=n.getElements(".provider");if(!p){return}p.show();o.hide();if(h.retrieve("assisted_booking_desktop_entry")){var m=o.getParents();m.forEach(function(q){if(q.hasClass("metaPriceInfo")){if(h.meta&&h.meta.treeTrack&&h.meta.treeTrack.hasTrackingTree(q)){h.trk("n_more_sites",false,q)}}})}},flipHoverClass:function(n,m){if(n){n=h.id(n);var o=m+"Idle";var p=m+"Over";n&&n.toggleClass(o).toggleClass(p)}},trackHotelRatingsInfoClickInHR:function(m){m.target=m.target||m.srcElement;if(m.target&&m.target.href){h.setEvtCookie("Ratings_Info","all_hotels","",0,m.target.href)}},cleanupForMapView:function(){var m=h.retrieve("maps.floaterDiv");if(m){m.hide()}},navigateToHotelDetail:function(p,o,n,m){var q=h.id(p.target);if(q&&!q.match("img")&&!q.match("a")&&!q.hasClass("taLnk")&&!q.hasClass("greenLeaderTaLnk")&&!q.getParent(".metaPriceInfo")&&!q.getParent("a")&&!q.getParent(".p13n_inline_info")){if(h.retrieve("open_hotels_in_new_tab.enabled")){h.util.cookie.openWindowWithPID(n,m)}else{if(m){h.util.cookie.setPIDCookie(m)}c.location.href=n}}},updateHeaderMsg:function(n,o){if(h.has("hr_ibex_emphasis.enabled")||h.has("hr_delineate_meta_ib.enabled")){return}var m=a.getElement(n);if(o&&m){m.innerHTML=o}},updateHeaderDates:function(){try{if(h.widgets.calendar.hasPageDates()){var o=$$(".dateHeader.inDate");var n=$$(".dateHeader.outDate");var m=h.widgets.calendar.getDatePickerFormat("short");var r=h.widgets.calendar.getDatePickerFormat("classic");if(o){var q=h.widgets.calendar.dateToString(h.widgets.calendar.getPageInDate(),m);Array.each(o,function(t){var u=h.id(t);if(u.getParent("#meta_on_photo_viewer")){return}if(u){u.innerHTML=q}})}if(n){var p=h.widgets.calendar.dateToString(h.widgets.calendar.getPageOutDate(),r);Array.each(n,function(t){var u=h.id(t);if(u){u.innerHTML=p}})}}}catch(s){h.util.error.record(s,"ta.commerce.meta.updateHeaderDates")}},enableAdultsPicker:function(){var p=a.getElement(".adultsText");if(p){p.addClass("hide")}var n=a.getElement(".changeAdults");if(n){n.addClass("hide")}var o=a.getElement(".overlay .date_picker_adults_wrap");if(o){o.removeClass("hide")}var m=a.getElement(".overlay .showPriceButtonHide");if(m){m.removeClass("showPriceButtonHide")}h.store("meta_guests_field_v2.originalAdults",h.retrieve("date.picker.adultsCount"))},disableAdultsPicker:function(n){if(!(n&&n.container)){return}var q=n.container.getElement(".adultsText");if(q){q.removeClass("hide")}var o=n.container.getElement(".changeAdults");if(o){o.removeClass("hide")}var p=n.container.getElement(".date_picker_adults_wrap");if(p){p.addClass("hide")}var m=n.container.getElement(".showPriceButton");if(m){m.addClass("showPriceButtonHide")}},adultsGoButtonClick:function(m,p,s,o,u){var q=h.widgets.calendar.getPageInDate();var v=h.widgets.calendar.getPageOutDate();var n=q&&q.getDate&&v&&v.getDate;if(n){var w=h.widgets.calendar.getCalendarObjectKey(s,o,"out");var t=h.retrieve(w);if(t){var r=t.calendar;if(r){r.onCalendarOverlayHide();r.fireEvent("onRangeSelect",[r.crId,r.options.ext]);r.fireEvent("onSelect",[r,m])}}}else{h.overlays.Factory.simulateDatePickerClick(m,p,s,o,u)}},updateAdultsText:function(){var m=a.getElement(".adultsText");if(m){h.widgets.calendar.updateAdultsDisplay(m)}},hhRedirectIfNoOffers:function(){var m=a.getElements("#HotelDateSearch .offer");if(m&&!h.commerce.meta._overlayOnPage()){h.store("ta.redirectingPage",true);h.setEvtCookie("NoOffersHH","redirect","",0,"/HotelHighlight");var n=/-r\d+-/;c.location.href=c.location.href.replace("Hotel_Review-","Hotel_Review-s1-").replace("ShowUserReviews-","Hotel_Review-s1-").replace(n,"-")}},getResponseAvailability:function(m){if(!m){return false}return{anyAvailable:!!m.match(/\shacComplete\s.*\sanyOfferCompletedSuccessfully\s/g),allUnavailable:!!m.match(/\shacComplete\s.*\shacMiniOfferNotAvailable\s/g),maybeAvailable:!!m.match(/\shacComplete\s.*\shasDisplayUnavailability\s/g)}},_overlayOnPage:function(){return h.overlays&&h.overlays.getCurrent&&h.overlays.getCurrent()},hhRemoveDatePickerForErrorMessaging:function(o){if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.clickMetaShowPrices(o);return}var n=h.id("GEO_CHECK_RATES_BALANCE");if(n){n.hide()}var m=a.getElement("#HLBASE .unavailHdr");if(m){m.removeClass("hidden")}},setupMiniMetaOnAccomPolling:function(m){if(!h.pages.hac.updateHACData||!h.hac.filters.updateResults){h.util.error.record(null,"setupMiniMetaOnAccomPolling bad linkage")}h.pages.hac.startHACUpdate();if(m){h.hac.filters.updateResults()}},checkRatesCreateGeoCrAutoBroadenLb:function(o,n,m){try{if(h.has("hr_to_hh_redirect_no_offers")&&c.pageServlet&&c.pageServlet!=="HotelHighlight"){if(h.widgets.calendar.hasPageDates()){h.widgets.calendar.justUpdateSessionDates(function(){h.commerce.meta.hhRedirectIfNoOffers&&h.commerce.meta.hhRedirectIfNoOffers.delay(300)})}else{h.widgets.calendar.setErrorStyling(new Event(o).target)}return}if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.clickMetaShowPrices(o);return}if(n.getParent(".meta_date_wrapper")){h.trackEventOnPage("MetaGeoLightBox","open","DatePicker",0,false)}else{h.trackEventOnPage("MetaGeoLightBox","open","ShowPrices",0,false)}h.run("ta.overlays.Factory.loadGeoCrAutoBroadenOverlay",{},n,m)}catch(p){h.util.error.record(p,"ta.commerce.meta.checkRatesCreateGeoCrAutoBroadenLb cannot track/create lightbox")}},metaListingClickReporting:function(m){if(!m||!m.target){return}if(m.target.hasClass("photo_image")){h.trackEventOnPage("PRICE_SAVER","CLICK","THUMBNAIL")}else{if(m.target.nodeName==="A"&&m.target.parentNode.hasClass("review_stubs_item")){h.trackEventOnPage("PRICE_SAVER","CLICK","REVIEW")}else{if(m.target.hasClass("property_title")){h.trackEventOnPage("PRICE_SAVER","CLICK","PROPERTY_TITLE")}else{if(m.target.getParent(".metaPriceInfo")!=null){h.trackEventOnPage("PRICE_SAVER","CLICK","META")}}}}},getMetaParams:function(){return{metaReferer:c.pageServlet}},trackAdBlock:function(){if(h.id(a.body)){var m=1;var n=new Element("div",{"class":"adInner",styles:{height:m,visibility:"hidden"}});h.id(a.body).adopt(n);if(n.getSize().y!=m){h.trackEventOnPage("ADBLOCK","ENABLED",null,null,true)}else{h.trackEventOnPage("ADBLOCK","DISABLED",null,null,true)}n.dispose()}},updateSessionDatesRedirect:function(m){if(h.widgets.calendar.hasPageDates()){h.widgets.calendar.justUpdateSessionDates(function(){c.location.href=m},false,true)}else{c.location.href=m}}}}(b))}(document,window,ta));ta.commerce.minimeta={ajax:{MAX_POLL_ATTEMPT:13,ALL_HAC_COMPLETE:"hotelsMeta.allHacComplete",LOCS_ON_PAGE:"hotelsMeta.locsOnPage",ATTEMPT_STORE_KEY:"hotelsMeta.ajaxNum",TIME_EXPIRED:"hotelsMeta.timeExpired",MINI_META_APPEAR_LOADING_TIMEOUT:5000,MINI_META_STOP_LOADING_TIMEOUT:60000,send:function(c,a){var b=ta.commerce.minimeta.ajax;setTimeout(function(){new Request({method:"post",url:b.getUrl(),data:b.buildPostData(a),onSuccess:function(d){var e=new Element("div",{html:d});b.updateDOM(e);if(!c&&b.shouldResubmit()){ta.commerce.minimeta.ajax.send()}b.updateAttemptNum()}}).send()},ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY)))},getUrl:function(){return"/BulkMiniMetaCRAjax"},buildPostData:function(b){var a={};a.area="QC_Meta_Mini";a.returnAllOffers=true;a.detail=ta.commerce.minimeta.ajax._getLocOnPageString(b);a.action="getMiniMetaForLocations";return a},updateDOM:function(d){var a=d.getElement(".isAllHacComplete");if(a||ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true);var c=$$(".metaDisclaimer");if(c&&c.hasClass("hidden")){c.removeClass("hidden")}}var b=document.getElements(".listing");b.each(function(j){var i=j.id;var h=i.substring(i.indexOf("_")+1);var g=d.getElement("."+h);ta.commerce.minimeta.ajax.updateLoadingState(d);if(g){var e=g.getElement(".metaPriceInfo");var f=j.getElement(".metaPriceInfo");ta.commerce.minimeta.ajax._setPrice(e,h);ta.commerce.minimeta.ajax._setAccomType(e,h);e.replaces(f)}})},resetAjaxCall:function(){ta.remove(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE);ta.remove(ta.commerce.minimeta.ajax.LOCS_ON_PAGE);ta.remove(ta.commerce.minimeta.ajax.ATTEMPT_STORE_KEY);ta.remove(ta.commerce.minimeta.ajax.TIME_EXPIRED)},shouldResubmit:function(){if(ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){return false}else{var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a||a<ta.commerce.minimeta.ajax.MAX_POLL_ATTEMPT-1){return true}else{return false}}},updateAttemptNum:function(){var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a){ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,1)}else{ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,a+1)}},_getLocOnPageString:function(b){var c=document.getElements(".listing");var a="";c.each(function(f){var d,e;if(ta.commerce.minimeta.ajax._isHacComplete(f)&&!b){return}e=f.id;d=e.substring(e.indexOf("_")+1);a=a+d+","});if(a===""){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true)}return a},_isHacComplete:function(a){return a.getElement(".metaPriceInfo.hacComplete")},_setPrice:function(b,f){var a=b.getElement(".classicPrice");if(a){var d="classicPrice_"+f;var c=ta.retrieve(d);if(ta.retrieve("hotels.shouldHideClassicPrices")){a.hide()}else{if(c&&c!==0){var e=a.getElement(".price");e.set("html",c);a.toggleClass("hidden",false)}else{a.hide()}}}},_setAccomType:function(a,d){var c=a.getElement(".contactStr");if(c){var b="accomType_"+d;var e=ta.retrieve(b);if(!e||e=="T_HOTEL"){c.set("html",ta.retrieve("hotels.contactHotel"))}else{c.set("html",ta.retrieve("hotels.contactAccom"))}}},updateLoadingState:function(b){if(ta.retrieve(ta.commerce.minimeta.ajax.TIME_EXPIRED)){var d=b.getElements(".loading_bubbles_gry");var c=new Element("span",{"class":"sprite-visitSite"});d.each(function(f){c.clone().replaces(f)});var a=b.getElements(".loadingHeader");var e=ta.retrieve("hotels.checkSites");a.each(function(f){f.set("html",e)})}}},storeAccomDetails:function(){var b=document.getElements(".classicPrices");b.each(function(d){ta.store(d.id,d.value)});var a=document.getElements(".accomTypes");a.each(function(d){ta.store(d.id,d.value)});var c=$$(".metaDisclaimer");if(c){c.addClass("hidden")}},doMetaDateSearch:function(){if(!ta.widgets.calendar.hasPageDates()){var c=document.getElement(".metaDatePicker .date_picker_calendar_wrap");c.fireEvent("click")}else{if(ta.has("hac.filter.changed")||ta.has("meta.mini_meta_on_accommodations")){ta.hac.filters.updateResults()}else{if(!ta.retrieve("hotels.datesChanged")){ta.hac.filters.updateResults();ta.servlet.HACSearch.destroyAnimatedDateCTA()}else{var b=ta.hac.filters.buildHACUrlParamString();var a="/HACSearch?"+b+window.location.hash;window.location=a}}}},lowestPriceBookBtnHover:function(b){try{var a=document.getElement(".LowestPrice .bookBtn");if(!a){ta.util.error.record(null,"lowestPriceBookBtnHover - no button for .LowestPrice .bookBtn",null,{out:b});return}if(b){a.className=a.className.replace(/Over\b/,"Idle")}else{a.className=a.className.replace(/Idle\b/,"Over")}}catch(c){ta.util.error.record(c,"lowestPriceBookBtnHover - cannot change button hover appearance",null,{out:b})}}};ta.commerce.AvailDataWidget=new Class({Implements:[Options],options:{calendarOptions:{},argArray:[]},initialize:function(h,d,c,b,e,k){this.setOptions(k);if(h||window.event){h=new Event(h||window.event);if(h){h.stop()}}this.locId=d;this.ext=b;var j=null;if(this.ext){j="date_picker_adults_"+this.locId+this.ext}else{j="date_picker_adults_"+this.locId}this.adultField=ta.id(j);this.options.calendarOptions=Object.merge(this.options.calendarOptions,{ext:this.ext?this.ext:"",creatorElem:h&&h.target});var i=true;if(h){var g=ta.id(h.target);if(g&&(g.hasClass("out_date")||(ta.has("guests_rooms_picker_3.enabled")&&g.hasClass("outDateTrigger")))){i=false}}if(!(ta.page&&ta.page.usingUnifiedDates&&c==="adults")){this.calendar=new ta.widgets.SingleDateCalendar(this.options.calendarOptions,this.locId,e,this.options.argArray,i)}var a=ta.retrieve("adultFieldsMap");if(!a){a={}}if(this.adultField){this.adultsField=a[j];var f=this.adultField.getParent(".overlay");if(!this.adultsField||(f&&this.adultsField.parentOverlay!=f.overlay)){this.adultsField=new ta.widgets.AdultsField(this.adultField,this.locId,e,h);a[j]=this.adultsField;ta.store("adultFieldsMap",a)}}this.show(c);if(ta.widgets.calendar.trackCalendarObject){ta.widgets.calendar.trackCalendarObject(this)}},show:function(a){if(a=="calendar"&&this.calendar&&this.calendar.calendarOverlay){this.calendar.showCalendarOverlay()}else{if(a=="adults"&&this.adultsField){this.adultsField.adultsOverlay.show()}}if(ta.has("persistentFilters.showing")&&tabletOnFullSite&&this.calendar.calendarOverlay.container){this.calendar.calendarOverlay.container.setStyle("position","fixed")}},clear:function(){if(this.adultField){if(!ta.retrieve("meta_guests_field_v2.enabled")){ta.widgets.calendar.setPageAdultsCount(2)}ta.widgets.calendar.syncAllDatePickers()}this.calendar.clear()},getState:function(d){var b=this.calendar.getState();var a={adults:"2"};if(this.adultsField){a=this.adultsField.getState()}else{if(ta.widgets.calendar.getPageAdultsCount()){a={adults:ta.widgets.calendar.getPageAdultsCount()+""}}}var c=Object.merge(b,a);if(d){return c}return Object.toQueryString(c)}});ta.widgets.AdultsField=new Class({adultsSelRegex:/.*_(\d)\s*$/,adultsExRegex:/.*_\d+_(.*)$/,initialize:function(j,c,f){this.adultsField=j;this.crId=c;this.selectionFunction=f;var k=this.adultsField.getParent(".overlay");if(k){this.parentOverlay=k.overlay}var g=ta.overlays.ACTIVATE_CLICK;if(this.parentOverlay&&this.parentOverlay.container&&ta.id(this.parentOverlay.container).hasClass("persistentCR")){g=ta.overlays.ACTIVATE_NEVER}this.guestFieldLabel=this.generateGuestFieldLabel(this.adultsField.id);this.adultsOverlay=new ta.overlays.RelativeOverlayBelow({style:"dp",showCloseButton:false,noPadding:true,autoShow:false,offsetLeft:1,activate:g,onShow:this.onAdultsShow.bind(this),onHide:this.onAdultsHide.bind(this)},this.adultsField);this.adultsField.onclick=function(){};ta.id(this.adultsField).addEvent("click",this.adultsOverlay.show);var i=ta.id(this.adultsOverlay.container).getElement(".adults_pre_selected");try{this.count=ta.retrieve("date.picker.adultsCount");if(!this.count){this.count=this.adultsSelRegex.exec(i.id)[1]}}catch(h){}if(!this.count){this.count="2"}ta.widgets.calendar.setPageAdultsCount(this.count);var a=ta.id(this.adultsOverlay.container).getElements(".option");var d=this.adultSelect.bind(this);a.each(function(m,e){var l=function(n){d.pass([e+1,m,n.event])()};ta.id(m).addEvent("click",l)});var b=this.adultsField.clientWidth;b=b+"px";ta.id(this.adultsOverlay.container).setStyles({width:b});this.optionElems=a},generateGuestFieldLabel:function(c){var b=this.adultsExRegex.exec(c);var a=ta.retrieve("open_guest_field.servletName");if(!a){a=window.pageServlet}if(!b){if(!a){return""}else{if(a=="Hotel_Review"){return"Guest_HR"}else{if(a=="Hotels"){return"Guest_Hotels"}else{if(a=="ShowUserReviews"){return"Guest_Hotels"}else{return""}}}}return"Guests"}else{if(b[1]=="pop"){return"Guest_Flyout"}else{if(b[1]=="met"){return"Guest_MetaLightbox"}else{if(b[1]=="pto"){return"Guest_HR_PhotoLightbox"}else{if(b[1]=="amo"){return"Guest_HR_AmenitiesLightbox"}else{return""}}}}}},trackGuestFieldEvent:function(b,a){try{ta.trackEventOnPage("GuestPicker",b,a)}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.trackGuestFieldEvent")}},onAdultsShow:function(){try{if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}if(ta.id("PERSISTENT_DATE_PICKER")&&this.optionElems[0]&&this.optionElems[0].getParent("div.relative")){this.optionElems[0].getParent("div.relative").setStyles({"z-index":10001})}this.keyEventListener=this.onAdultsOverlayKeyDown.bind(this);document.addEvent("keydown",this.keyEventListener);this.adultsField.blur();var a=document.getElements(".date_picker_adults_option");if(a){Array.each(a,function(d){ta.id(d).removeClass("adults_selected");ta.id(d).removeClass("adults_pre_selected")})}if(ta.id(this.adultsField).getParent("#PERSISTENT_CHECK_RATES")){var b=ta.id(this.adultsField).getCoordinates().top;if(typeof(isIPad)=="undefined"||!isIPad){b=b-window.getScrollTop()}ta.id(this.adultsOverlay.container).setStyles({position:"fixed",top:b+29,zindex:9997})}this.count=ta.retrieve("date.picker.adultsCount");if(ta.retrieve("meta_guests_field_v2.enabled")){this.optionElems[this.count-1].addClass("adults_pre_selected");this.preSelectElem=this.optionElems[this.count-1]}if(ta.retrieve("meta_guests_field_v2.trackingEnabled")){this.trackGuestFieldEvent("Open",this.guestFieldLabel)}}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.onAdultsShow")}},onAdultsHide:function(){try{if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}if(this.keyEventListener){document.removeEvent("keydown",this.keyEventListener)}}catch(a){}},onAdultsOverlayKeyDown:function(a){if(a.key=="esc"){this.adultsOverlay.hide()}},adultSelect:function(e,d,c){ta.commerce.meta.tracking.resetAllTimingLocks();ta.commerce.meta.tracking.clearSuppressedAreas();ta.commerce.meta.polling.clearAllPollingInfo();this.updateValue(e,d.innerHTML);this.adultsOverlay.hide();var b=this.guestFieldLabel+"|"+this.count;if(ta.retrieve("meta_guests_field_v2.trackingEnabled")){this.trackGuestFieldEvent("Select",b)}if(!ta.widgets.calendar.hasPageDates()){return}if(this.selectionFunction){if(this.selectionFunction===ta.widgets.calendar.launchInlineMeta){this.selectionFunction.call(this,c)}else{this.selectionFunction.call(this,this.crId,this.adultsField)}}if(ta.commerce.metajson){ta.commerce.metajson.refetchAll()}if(typeof oxapp!="undefined"&&oxapp&&oxapp.context){var a=oxapp.context.get("TravelDates");if(a){a.save()}}if(ta.has("checkrates.meta_af")){ta.commerce.meta.loadMetaAF(this.crId,"AV_ABOVE_FOLD_META",false)}ta.widgets.calendar.trackCalendarEvent("DATEPICKER","CHANGE","GUESTS",e)},updateValue:function(a,b){this.count=a;this.adultsField.innerHTML=b;ta.widgets.calendar.setPageAdultsCount(this.count);ta.widgets.calendar.syncAllDatePickers();ta.widgets.calendar.justUpdateSessionAdults();var c=document.getElements(".adults");c.each(function(d){d.innerHTML=b})},getAdultsCount:function(){return this.count},getState:function(){return{adults:this.count+""}}});ta.commerce.meta.tracking={getTimingForNavArea:function(a){if(!a){return}var b=ta.commerce.meta.tracking.processNavArea(a);return ta.retrieve(b)},setTimingLockForNavArea:function(b,a){ta.store(b+"-LOCK",a)},isTimingLocked:function(b){var c=ta.commerce.meta.tracking.processNavArea(b);var d=ta.retrieve(c);if(!d){return false}var a=Date.now();if(a-d>=2000){ta.commerce.meta.tracking.resetTimingLockForNavArea(c);return false}return true},resetTimingLockForNavArea:function(a){var b=ta.commerce.meta.tracking.processNavArea(a);if(ta.retrieve(b+"-LOCK")){ta.remove(b+"-LOCK")}},resetAllTimingLocks:function(){var a=["QC_Meta_Inline","QC_Meta_Mini","QC_Meta_Metro","QC_Meta_Micro","QC_Meta_Lightbox"];for(var b=0;b<a.length;b++){ta.commerce.meta.tracking.resetTimingLockForNavArea(a[b])}},processNavArea:function(a){if(!a){return}if(a.indexOf("QC_Meta_Inline")===0){return"QC_Meta_Inline"}if(a.indexOf("QC_Meta_Mini")===0){return"QC_Meta_Mini"}if(a.indexOf("QC_Meta_Metro")===0){return"QC_Meta_Metro"}if(a.indexOf("QC_Meta_Micro")===0){return"QC_Meta_Micro"}if(a.indexOf("QC_Meta_Lightbox")===0){return"QC_Meta_Lightbox"}},setTimingForNavArea:function(c,b){if(!c){return}if(!b){b=Date.now()}var a=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.isTimingLocked(a)){return ta.commerce.meta.tracking.getTimingForNavArea(a)}ta.store(a,b);ta.commerce.meta.tracking.setTimingLockForNavArea(a,b);if(a=="QC_Meta_Inline"&&!ta.commerce.meta.tracking.containsSuppressedArea("QC_Meta_Mini")){ta.commerce.meta.tracking.setTimingLockForNavArea("QC_Meta_Mini",b)}return b},updateUrlWithTiming:function(b,a){if(!b||!a){return b}var c=ta.commerce.meta.tracking.setTimingForNavArea(a);if(!c){return b}if(b.contains("&metaRequestTiming=")){var d=new RegExp("(&|\\?)metaRequestTiming=[^&]*");b=b.replace(d,"&metaRequestTiming="+c)}else{b+="&metaRequestTiming="+c}return b},suppressImpressionsForArea:function(c){if(!c){return}var b=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.containsSuppressedArea(b)){return}var a=ta.retrieve("suppressed.areas");a.push(b);ta.store("suppressed.areas",a)},getSuppressedAreas:function(){var a=ta.retrieve("suppressed.areas");if(!a){a=[];ta.store("suppressed.areas",a)}return a},getSuppressedAreasAsString:function(){var b=ta.commerce.meta.tracking.getSuppressedAreas();var a="";if(b.length>0){for(var c=0;c<b.length;c++){a+=b[c]+";"}}return a},hasAnySuppressedAreas:function(){var a=ta.commerce.meta.tracking.getSuppressedAreas();return a.length>0},containsSuppressedArea:function(d){if(!d){return false}var b=ta.commerce.meta.tracking.processNavArea(d);var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var c=0;c<a.length;c++){if(a[c]==b){return true}}return false},removeSuppressedArea:function(e){if(!e){return}var b=ta.commerce.meta.tracking.processNavArea(e);var f;var c;if(ta.commerce.meta.tracking.containsSuppressedArea(b)){var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var d=0;d<a.length;d++){if(a[d]==b){c=d;f=true}if(f){a=ta.commerce.meta.tracking.removeElementByIndex(a,c);ta.store("suppressed.areas",a)}}}},removeElementByIndex:function(b,a){if(b&&a>=0&&a<b.length){b.splice(a,1)}return b},clearSuppressedAreas:function(){ta.store("suppressed.areas",[])},getTrackFunctionForSuggestedAccommodations:function(){var a=function(){var g=ta.widgets.calendar.getPageOutDate();var c="hotelsAccommodationGroupTracking";var f=ta.id(c);if(f){var e=f.getBoundingClientRect();if(e&&e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)){var d="Hotels on Tourism";var h="Impression";var b="dated";if(g===false){b="undated"}var i=ta.has("suggestedAccommodationsIsDmoSponsored")?1:0;ta.trackEventOnPage(d,h,b,i);window.removeEvent("scroll",a)}}};return a},getTrackFunctionForSuggestedVRs:function(){var a=function(){var g=ta.widgets.calendar.getPageOutDate();var c="vrsAccommodationGroupTracking";var f=ta.id(c);if(f){var e=f.getBoundingClientRect();if(e&&e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)){var d="VRs on Tourism";var h="Impression";var b="dated";if(g===false){b="undated"}var i=ta.has("suggestedAccommodationsIsDmoSponsored")?1:0;ta.trackEventOnPage(d,h,b,i);window.removeEvent("scroll",a)}}};return a}};ta.commerce.meta.polling={setPollingAttemptForRequest:function(a,b){var c=ta.commerce.meta.polling.getPollingMap();if(!b){b=1}c[a]=b;ta.commerce.meta.polling.setPollingMap(c)},getPollingAttemptForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){return b}}},getPollingWaitTimeForRequest:function(a){var b=ta.commerce.meta.polling.getPollingAttemptForRequest(a);return ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(b)},isRequestBeingPolled:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=a&&c[a];if(b){return true}return false},incrementPollingAttemptForRequest:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){b=b+1;c[a]=b}ta.commerce.meta.polling.setPollingMap(c);return b},clearAllPollingInfo:function(){ta.store("ta.meta.polling.map")},removePollingInfoForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var b=ta.commerce.meta.polling.getPollingMap();delete b[a];ta.commerce.meta.polling.setPollingMap(b)}},getPollingMap:function(){var a=ta.retrieve("ta.meta.polling.map");if(!a){a={};ta.store("ta.meta.polling.map",a)}return a},setPollingMap:function(a){if(a){ta.store("ta.meta.polling.map",a)}},getPollWaitTimeForPollingAttempt:function(a){if(typeOf(a)!=="number"||a<0){return 1000}switch(a){case 1:case 2:case 3:case 4:return 1000;case 5:case 6:case 7:return 1500;case 8:case 9:case 10:return 2000;case 11:return 5000;case 12:return 15000;default:return 30000}},getMaxPollingAttemptNumber:function(){return 13}};ta.commerce.meta.horizontalXSell=(function(){var k=10;var g=1000;var h=false;var c=null;var n=null;var l=null;var p=0;var f=function(q){if(q.contains("hacComplete")&&(q.contains("hacMiniOfferNotAvailable")||q.contains("hacMiniOfferUnavailable"))){return true}return false};var j=function(q){if(!a()){return false}if(!q.contains("hacMiniOfferUnavailable")){return true}return false};var e=function(t,w){try{if(ta.retrieve("ta.redirectingPage")||ta.retrieve("non_comm_hr_xsell_2014")){return}if(!w){p=0}c=new Date().getTime();var v=c;var u=ta.widgets.calendar.getCheckRatesData();if(!u){return}var r={};if(ta.meta&&ta.meta.update){r=ta.commerce.meta.getMetaParams()}var q=Object.merge(u,{detail:t,reqNum:w?"2":"1",type:"horizontal_hr"},r);var x=Object.toQueryString(q);if(!x||!x.trim()){ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - toQueryString failure",null,q);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:q,evalScripts:true,onSuccess:function(D){if(v!=c){return}var A=new Element("div",{html:D});var C=A.getElement(".xsellHacStatusReady")||A.getElement(".xsellHacStatusSOL")||w;if(ta.has("meta.full_meta_photos_v3")){D+='<div class="gap_spacer"></div>'}if(!C&&p<k){setTimeout(function(){p=p+1;e(t,true)},g)}else{var F=ta.id("HORIZONTAL_CROSS_SELL");var z=A.getElement(".metaMicro");if(F&&z){if(F.getElement(".metaMicro")){F.setContent(D)}else{F.setStyle("opacity","0");var E=new Fx.Tween(F,{property:"opacity"});F.setStyle("height",0);var B=122;var y=new Fx.Tween(F,{property:"height",onComplete:function(){F.setStyle("height","auto");F.setContent(D);E.start(0,1)}});y.start(0,B)}if(n){n()}d(true)}}},onFailure:function(){if(ta.retrieve("ta.redirectingPage")){return}ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(s){ta.util.error.record(s,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell")}};var i=function(q,r){if(!q||!q.getElement(".bc_flags")){return}var s=q.getElement(".bc_flags").className;if(j(s)){m()}else{if(f(s)){e(r,false)}}};var m=function(){var q=ta.id("HORIZONTAL_CROSS_SELL");var s=ta.id("HORIZONTAL_CROSS_SELL_LIST");var t=document.getElement("#HORIZONTAL_CROSS_SELL_LIST .lodging");if(q&&s&&t){var u=s.getSize().y;q.setStyle("height",u);var v=new Fx.Tween(s,{duration:200,property:"opacity",onComplete:function(){s.addClass("hidden");r.start(u,0).chain(function(){q.setStyle("height",0);q.innerHTML=""})}});v.start(1,0);var r=new Fx.Tween(q,{duration:"long",property:"height"});if(l){l()}d(false)}};var a=function(){return h};var d=function(q){h=q};var o=function(q){n=q};var b=function(q){l=q};return{updateHorizontalXSell:i,removeHorizontalXSell:m,isLoaded:a,setLoaded:d,setOnloadFunction:o,setOnRemoveFunction:b}}());ta.commerce.meta.horizontalXSellExtensions={putAvafBelowMap:function(){if(ta.commerce.meta.horizontalXSell.isLoaded()){return}var d=ta.id("AV_ABOVE_FOLD_META");var c=ta.id("RHS_MAP");var b=d.parentNode;if(d&&c&&b){var a=b.getElement(".bxDivider.map");if(a){b.insertBefore(a,d);b.insertBefore(c,a)}else{b.insertBefore(c,d)}}},putAvafAboveMap:function(){if(!ta.commerce.meta.horizontalXSell.isLoaded()){return}var c=ta.id("AV_ABOVE_FOLD_META"),b=ta.id("RHS_MAP"),a=c.parentNode;if(c&&b&&a){a.insertBefore(c,b)}}};if(!ta.meta){ta.meta={}}if(!ta.meta.link){ta.meta.link={}}(function(b){b.OPEN_IN_NEW_TAB="new_tab";b.OPEN_IN_SAME_TAB="same_tab";b.OPEN_IN_NEW_WINDOW="new_window";b.getUrlFromClickElem=function(q){if(!q){return null}var s=q.get("data-commerceClickData");if(!s||!s.trim||s.trim()===""||typeof asdf!=="function"){return null}s=asdf(s).replace(/&amp;/g,"&");var r=ta.retrieve("tracking.impression.key");if(q.hasClass("inlineOffer")&&r){var p=/ik=[a-zA-Z0-9]*/;s=s.replace(p,"ik="+r)}return s};b.getPartnerFromClickElem=function(q){if(!q){return null}var p=q.get("data-offerauthor");if(!p||!p.trim||p.trim()===""){return null}return p.trim()};b.animateAndClick=function(r,p){var q=p.hasClass("bookableOffer"),s=function(){b.click(r,p);var t=function(){j();ta.off("commerceClickAnimated",t)};ta.on("commerceClickAnimated",t)};ta.CommerceClickAnimation.addAnimation(s,{animateOnFocus:!q,squelchAnimation:true})};b.addToCartAndClick=function(q,p){b.click(q,p);j()};b.click=function(q,w){var x=ta.id(w),t,u,B,v,z,p,E,D,s,y,r,C;try{x=h(x);t=b.getUrlFromClickElem(x);if(!t){return}u=x.get("data-vendorName");B=x.get("data-offerauthor");v=x.get("data-locationId");z=b.getNavAreaFromClickElem(x);p=x.get("data-contentId");E=x.get("data-openBehavior");D=x.get("data-imageUrl");s=x.get("data-mcid");C=x.get("data-pernight");if(t&&u&&v){i(t,z,u,v,E,x,D,s,C,B)}else{m(null,"Invalid commerce click",t,z)}}catch(A){m(A,"Invalid commerce click",t,z)}setTimeout(function(){try{window.fireEvent("metaLinkClick",[x,u,z,v,p,E,ta.popups.PopUtil.extractSlotFromCommerceUrl(t)])}catch(F){m(F,"Commerce click tracking failed",t,z)}},300)};b.getNavAreaFromClickElem=function(t){var s=ta.id(t),p=s.get("data-navArea"),u,q;if(!p){u=s.get("data-navAreaPre");q=s.get("data-navAreaPost");p=o(u,t,q)}if(p){p=p.replace("+","|")}if(ta.browser.isIE10Metro()){p="QC_Meta_Metro_Lightbox"}if(t.getParent("#LOC_PHOTO_ALBUMS")){if(t.getParent(".featuredImageWrap")){p=p+"|PHOTOS_LB|Featured_Reel"}else{p=p+"|PHOTOS_LB"}}else{if(t.getParent("#AMENITY_LIGHTBOX")){p=p+"|AMENITIES_LB"}}a(p);var r=p;p=k(s);if(p==null||p.indexOf("null")!=-1||p.indexOf("Unknown")!=-1){p=r}return p};b.extractPageLocId=function(p){return b.urlArgNumeric(p,"d","detail")||b.urlArgNumeric(p,"g","geo")};b.urlArgNumeric=function(r,p,s){var q=new RegExp("(-"+p+"([0-9]+))|([?&]"+s+"=([0-9]+))");var t=q.exec(r);if(t){if(typeof t[2]!="undefined"){return t[2]}if(typeof t[4]!="undefined"){return t[4]}}return null};b.photoClick=function(q,t,r,p,s){if(r.hasOwnProperty("area")){r.area=b.getPhotoNavArea(q)}ta.util.Doer.aimdoit(t,r,p,s)};b.getPhotoNavArea=function(p){return k(p,{"data-navArea-metaType":"Pro_Photo","data-navArea-availability":"NA"})};b.updateNavAreaInCommerceUrl=function(s,p){if(p){var q=b.getNavAreaFromClickElem(p);var r=new RegExp("(&|\\?)area=[^&]*");s=s.replace(r,"$1area="+q)}return s};function i(w,u,F,E,x,s,N,B,K,M){var P=w;var Q=new RegExp("(&|\\?)area=[^&]*");P=P.replace(Q,"$1area="+u);if(crPageServlet){var v=new RegExp("(&|\\?)from=[^&]*");P=P.replace(v,"$1from=HotelDateSearch_"+crPageServlet)}var r=ta.commerce.meta.tracking.setTimingForNavArea(u);if(r&&s&&!s.hasClass("bookableOffer")){if(P.contains("&metaRequestTiming=")){var t=new RegExp("(&|\\?)metaRequestTiming=[^&]*");P=P.replace(t,"&metaRequestTiming="+r)}else{P+="&metaRequestTiming="+r}}if(B){P+="&m="+B}if(K){P+="&priceShown="+K}if(M){P+="&cpn="+M}if(document.location&&document.location.href){var O=b.extractPageLocId(document.location.href);if(O){P+="&pageLocId="+O}}var y=ta.analytics.getCommentTrackingPath(s);if(y&&y.length>0){var A=y.getLast();if(A&&A.indexOf(":")===-1){P+="&tp="+A;var p=d(y,P,u);if(p){P+="&gn="+p}}else{m(null,"ibdm_cc: no placement found",P,u,"WARN")}}else{m(null,"ibdm_cc: no tracking path found",P,u,"WARN")}var L=P.indexOf("/StartBooking")>=0;if(L){l()}if(ta.retrieve("commerce_history_injection_v2")&&!L){P="/NewWindowRedirect?url="+encodeURIComponent(P)}if((L&&ta.retrieve("ib_tablet_no_new_tabs"))||(ta.has("assisted_booking_clicks_new_tab")&&x===b.OPEN_IN_NEW_TAB&&L&&ta.browser&&ta.browser.isIE10Metro())){x=b.OPEN_IN_SAME_TAB}var J=false;if(window.pageServlet==="Hotel_Review"){J=!ta.retrieve("persistent_meta_hr")}J=J&&!ta.has("reverse_test_flyouts");if(s.getAttribute("data-suppressFlyout")==="true"){J=false}var D=s.getParent("#CHECK_RATES_CONT")&&s.getParent("#CHECK_RATES_CONT").getParent("#MAIN.Hotel_Review")&&!s.getParentBySelector(".non_comm_xsell"),C=ta.retrieve("ibexFlyoutBookNowClick"),I=L&&D;if(!ta.retrieve("openIbFlyoutOnMetaBounce")&&I&&C&&(typeof C==="function")){C(s);return}var H=!!s.getParent(".phoneOrders");if(H&&L){window.fireEvent("phoneOrdersOfferClick",s);return}if(J){if(I&&ta.widgets.ChooseRoomFlyout){ta.widgets.ChooseRoomFlyout.expand(s)}else{if(ta.widgets.HotelsChooseRoomFlyout&&L&&s.getParent(".listing")&&s.getParent(".listing").getParent("#MAIN.Hotels")){ta.widgets.HotelsChooseRoomFlyout.expand(P,s)}else{if(ta.widgets.SDChooseRoomFlyout&&L&&s.getParent(".illisting")&&window.pageServlet=="SmartDeals"){ta.widgets.SDChooseRoomFlyout.expand(P,s)}else{if(ta.widgets.SDChooseRoomFlyout&&L&&(s.getParent(".baseHotel")||s.getParent(".illisting"))&&window.pageServlet=="HotelHighlight"&&!ta.retrieve("no_ib_flyout_for_short_cell.enabled")){ta.widgets.SDChooseRoomFlyout.expand(P,s)}else{if(x===b.OPEN_IN_NEW_TAB){e(P,N,F,s)}else{if(x===b.OPEN_IN_SAME_TAB){c(P,s)}else{n(F,P,N)}}}}}}}else{if(s.hasClass("exclDeal")&&!ta.retrieve("isUserLoggedIn")&&ta.widgets.HotelsChooseRoomFlyout){ta.widgets.HotelsChooseRoomFlyout.showMemberOnlyCTA(s)}else{if(ta.retrieve("ib_bot_redirect_hr_flyout")&&L&&E){var G=/ik=[a-zA-Z0-9]*/g;var z=P.match(G);var q=(z&&z[0])?z[0].substring("ik=".length):"";P=P.substring(0,P.indexOf("/StartBooking"))+"/Hotel_Review-d"+E+"?ibf=true&ik="+q}if(x===b.OPEN_IN_NEW_TAB){e(P,N,F,s)}else{if(x===b.OPEN_IN_SAME_TAB){c(P,s)}else{n(F,P,N)}}}}if(window.pageServlet==="Hotel_Review"&&ta.widgets.ChooseRoomFlyout&&!L&&s.getParent("#CHECK_RATES_CONT")&&s.getParent("#CHECK_RATES_CONT").getParent("#MAIN.Hotel_Review")&&!s.getParentBySelector(".non_comm_xsell")&&x!==b.OPEN_IN_SAME_TAB){ta.metaFocus.hr.onMetaOfferClick()}if(window.IS_DEBUG){ta.store("ta.lastCommerceClickUrl",P)}}function d(q,t,z){var p="groups";var D="_NavCart";var B="MyCartTab";var r="V:HG-1.1";var C=-1;var y=0;var s;var x;var v=q.getLast();var A=q[q.length-2];var u;var w;if(!q){return}if(q.length<5){return}if((v.indexOf(D)!==(v.length-D.length))&&v!==B){return}if(A.indexOf(r)!==0){return}for(x=q.length-1;x>=0;x--){if(!q[x]){continue}y=0;s=q[x];if(s===p&&C===-1){u=x;for(u=x-1;u>=0;u--){s=q[u];if(s.indexOf("N:")===0){y++;if(C===-1){C=u}}}}if(C!==-1){break}}if(y>=3&&C>0){s=q[C];w=s.split(":");if(w.length===2){return w[1]}else{m(null,"ibdm_cc: no group node found",t,z,"WARN")}}}function l(){if(!ta.has("ib_qualaroo_surveys")||(window.pageServlet!=="Hotels"&&window.pageServlet!=="Hotel_Review")||!ta.qualaroo){return}try{var p=window.pageServlet!=="Hotels"?"HOTEL_REVIEW":"HOTELS",q="IB_QUALAROO_SURVEYS_"+p;ta.qualaroo.forceDisplaySurvey("force",q,false)}catch(r){ta.util.error.record(r,"Unable to display Qualaroo survey")}}b.showQualarooSurvey=l;function e(t,q,s,r){var p=window.open("","_blank");if(!p&&typeof(Browser)!=="undefined"&&Browser.ie&&ta.has("ta.ie_commerce_popup_block_fix")&&ta.has("assisted_booking_clicks_new_tab")&&t.indexOf("/StartBooking")>=0){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38822)}c(t,r);return}ta.popups.PopUtil.redirectToUrl(p,t);ta.popups.PopUtil.pollForPartnerLoad(p,new Date(),s,ta.popups.PopUtil.extractSlotFromCommerceUrl(t))}function c(s,q){ta.meta.treeTrack.logTrackingTreeClickEvtCookie(s,q);if(ta.meta&&ta.meta.treeTrack){var r=function(){f(s)};if(q&&q.getParentBySelector(".metaCheckRatesOverlay")!=null){ta.meta.treeTrack.logLightboxTreeImpression(r)}else{if(ta.meta.treeTrack.isInitialized()){try{ta.meta.treeTrack.logTreeImpression(r)}catch(p){ta.util.error.record(p," Error in openMetaProviderSameTab");f(s)}}}}else{f(s)}}function f(p){if(ta.retrieve("ta.isIE11orHigher")){window.open(p,"_self",null,false)}else{window.location.href=p}}function n(v,u,r){var p=v,t=ta.popups.PopUtil.getProviderWindowDims(p,true),q=1,s;if(window&&window.chrome){q=0}s={customWidth:t.customWidth,customHeight:t.customHeight,widthOffset:t.widthOffset,heightOffset:t.heightOffset,name:p,url:u,scrollbars:q,providerLogo:r};ta.popups.PopUtil.createCheckRatesWindow(s)}function a(p){var q=ta.retrieve("ta.meta.navArea");if(!q||q.indexOf(p)<0){ta.store("ta.meta.navArea",p)}}function o(p,t,q,s){var u="";if(t.getParent(".persistentCR")){u=(s)?"|PCR":"PCR"}else{if(t.getParent(".photosOverlay")||t.getParent("#LOC_PHOTO_ALBUMS")){u=(s)?"|Photo_Lightbox":"Photo_Lightbox"}else{if(t.getParent(".amenities_lightbox")){u=(s)?"|Amenities_Lightbox":"Amenities_Lightbox"}else{if(t.getParent("#CHECK_RATES_LB")){u=(s)?"|Photo_LB":"Photo_LB"}}}}u=u?"|"+u:"";p=p?p:"";u=u?u:"";q=q?q:"";var r=[p,u,q].join("|").replace("||","|").replace(/(\|$)/g,"");return r}function m(s,r,t,q,p){ta.util.error.record(s,r,null,{servlet:window.pageServlet,url:t,area:q},p)}function k(q,r){var u;var t={"data-navArea-metaType":null,"data-navArea-linkType":null,"data-navArea-availability":null,"data-navArea-placement":null};var s=4;if(r){for(u in t){if(r.hasOwnProperty(u)){t[u]=r[u];s--}}}var v=null;while(q&&s>0){for(u in t){if(t[u]===null){t[u]=q.get(u);if(t[u]!==null){if(t[u]==="@trigger"){v=q}s--}}}q=q.getParent()}while(t["data-navArea-placement"]==="@trigger"&&v){while(v&&!v.overlay){v=v.getParent()}if(v&&v.overlay.options&&v.overlay.options.trigger){v=v.overlay.options.trigger}else{v=null;t["data-navArea-placement"]="null"}while(v){t["data-navArea-placement"]=v.get&&v.get("data-navArea-placement");if(t["data-navArea-placement"]!==null){break}v=v.getParent()}}var p=[];for(u in t){p.push(t[u]?t[u]:"null")}if(window.isTabletOnFullSite){p.push(g()?"Portrait":"Landscape")}else{p.push("Desktop")}return p.join("|")}function g(){if(ta.common&&ta.common.tablet){return ta.common.tablet.isPortrait()}return window.matchMedia&&window.matchMedia("(orientation: portrait)")&&window.matchMedia("(orientation: portrait)").matches}function h(q){if(!q||q.isVisible()){return q}var s=q.get("data-locationid");var t=q.get("data-contentid");var p=".offer";if(q.hasClass("bookableOffer")){p=p+'.bookableOffer[data-locationid="'+s+'"]'}else{p=p+'[data-locationid="'+s+'"][data-contentid="'+t+'"]'}var r=document.getElement(p);if(r){return r}return q}function j(){if(!ta.NavAbandonedCart){return}ta.NavAbandonedCart.udpate()}})(ta.meta.link);if(!ta.meta){ta.meta={}}if(!ta.meta.linkTracking){ta.meta.linkTracking={}}(function(e){e.setup=function(){try{ta.util.customEvent.addListener("metaLinkClick",window,j)}catch(k){ta.util.error.record(k,"trouble building event - metaLinkClick")}};e.actionRecord=function(k){new Request({url:"/ActionRecord?action="+k}).send()};e.restoreCRPageServlet=function(){var k=ta.retrieve("crPageServlet_orig");if(k){window.crPageServlet=k}};function j(l,r,k,p,q,o){g(r,k,p,o);ta.trackCommerceClickForInsight(l);b(l,q);d(l);i(l,q);if(!l.hasClass("bookableOffer")){var n=l.dataset?l.dataset.pernight:"";a(p,true,q,n)}if(l&&ta.retrieve("hotels_lists_engagement_tracking.enabled")){var m=l.hasClass("bookableOffer")?"Sherpa":"Meta";ta.fireEvent("hotels_lists_engagement_tracking.fired",{type:m,element:l})}if(o!=ta.meta.link.OPEN_IN_SAME_TAB){h(l)}}function h(k){if(ta.meta&&ta.meta.treeTrack){if(k&&k.getParentBySelector(".metaCheckRatesOverlay")!=null){ta.meta.treeTrack.logLightboxTreeImpression()}else{if(ta.meta.treeTrack.isInitialized()){ta.meta.treeTrack.logTreeImpression()}}ta.meta.treeTrack.logTrackingTreeClickTrk(k)}}function a(o,m,p,k){try{var l={locId:o,isMetaCheckRates:m,contentId:p,selectedPrice:k};ta.common.ads.loadClickoutMonikers(l)}catch(n){ta.util.error.record(n,"click out monikers failure (meta="+m+")")}}function g(p,l,o,n){var m="CheckRates";var q=1;ta.trackPhysicalCommerce(m,l,q,o);ta.trackAttemptedCommerce(m,l,p,q);var k=n?(n===ta.meta.link.OPEN_IN_NEW_TAB?"TAB_OPENED":(n===ta.meta.link.OPEN_IN_NEW_WINDOW?"WINDOW_OPENED":"SAME_TAB")):"";ta.trackEventOnPage("COMMERCE_CLICK",k,(p||""))}function i(m,n){var o=m.getParent("#HotelDateSearch");if(o){var l="bcMetaLowestPriceCTA";var p="BlueChevron_LP_CTA_Click";if(ta.has(l)){var t=ta.retrieve(l);if(t.hasOwnProperty("idx")&&t.hasOwnProperty("provider")){try{var r=f(o);var k=null;for(var q=0;q<r.length;q++){if(n==r[q]){k=q}}if(k){ta.trackEventOnPage(p,t.idx,k,0,false)}}catch(s){ta.util.error.record(s,"error logging blue chevron lowest price click info")}}}}}function b(l,m){var n=l.getParent("div#PROVIDER_BLOCK")||l.getParent("div#PROVIDER_BLOCK_INLINE");if(n){var u=(n.id=="PROVIDER_BLOCK_INLINE")?true:false;var q=(u)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";var o=(u)?"Meta_LP_CTA_Click_Inline":"Meta_LP_CTA_Click";if(ta.has(q)){var s=ta.retrieve(q);if(s.hasOwnProperty("idx")&&s.hasOwnProperty("provider")){try{var r=c(n);var k=null;for(var p=0;p<r.length;p++){if(m==r[p]){k=p}}if(k){ta.trackEventOnPage(o,s.idx,k,0,false)}}catch(t){ta.util.error.record(t,"error logging lowest price click info")}}}}}function c(p){var m=[];m[0]=-1;try{if(p){var l=p.getElements(".jsPrvdr");for(var k=0;k<l.length;k++){var o=l[k]&&ta.id(l[k]).get("data-contentid");if(o){m.push(o)}}}}catch(n){ta.util.error.record(n,"error scraping meta providers")}return m}function f(p){var m=[];m[0]=-1;try{if(p){var l=p.getElements(".offer");for(var k=0;k<l.length;k++){var o=l[k]&&ta.id(l[k]).get("data-contentid");if(o){m.push(o)}}}}catch(n){ta.util.error.record(n,"error scraping blue chevron providers")}return m}function d(l){var r=ta.id(l);try{var q=r.get("data-offer-author");if(!q){return}var t=null,k=null;var n=r.getParent(".overlay .skv3");var s=r.getParent(".mapsv2-listitem")||r.getParent(".mapsv2-dropdownlist");if(s&&s.get("data-sponsor")){t=s.get("data-sponsor");k=s.get("data-sponsor-provider")}else{if(n&&n.hasAttribute("data-sponsor")&&pageServlet){t=n.get("data-sponsor");k=n.get("data-sponsor-provider")}else{var m=ta.id("mapsv2-sponsordetail");if(m&&m.get("data-sponsor")){t=m.get("data-sponsor");k=m.get("data-sponsor-provider")}}}if(k&&q==k){var p=(pageServlet=="LocalMapsRedesign")?"LocalMap":(pageServlet=="HACSearch"||pageServlet=="Hotels")?"HACMap":"FloatingMap";ta.trackEventOnPage(p,"sponsor_cr_sent",t)}}catch(o){ta.util.error.record(o,"Error while trying to log map sponsored provider clicks")}}})(ta.meta.linkTracking);if(!ta.meta.treeTrack){ta.meta.treeTrack={}}(function(e){var d=false;var b={hotelListSelector:null,singleHotelSelector:null,placementName:null,getImpressionString:null};var c="ibdm_impression_tracking";e.init=function(h){if(d){ta.util.error.record(null,"ta.meta.treeTrack should be initialized only once");return false}b=h;d=true};e.isInitialized=function(){return d};e.hasTrackingTree=function(h){if(!h||typeof h.previousSibling==="undefined"){return false}var i=h.previousSibling||h.nextSibling;if(i){if(f(i)){return true}return f(i.previousSibling)}return false};var f=function(i){if(i){var h=i.nodeValue;return h&&(h.contains("trk")||h.contains("etk"))}return false};e.logImpressionTreeOnPageLoad=function(){if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&ta.widgets.calendar.hasPageDates()&&!ta.retrieve("vrTabOnHotels")){var i=1;var k=4;var h;if(!ta.retrieve("treeTrackImpressionInProgess")){ta.store("treeTrackImpressionInProgess",true);var j=setInterval(function(){if(ta.retrieve("isTrackTreeFresh")){h=e.logTreeImpression(null,(i<k))}if(!h&&i<k){i++}else{ta.store("isTrackTreeFresh",false);ta.store("treeTrackImpressionInProgess",false);clearInterval(j)}},2000)}}};e.logTreeImpression=function(k,j){if(!ta.retrieve(c)||ta.retrieve("vrTabOnHotels")){if(k){k()}return false}if(!d){ta.util.error.record(null,"ta.meta.treeTrack.logTreeImpression called before being initialized");if(k){k()}return false}var h=a();var i=b.getImpressionString(h);if(!i&&h<=0){if(k){k()}return false}if(i&&i.indexOf("I:IllegalContext")===-1){ta.recordImpression(i,k);return true}else{if(!j){ta.util.error.record(null,"ta.meta.treeTrack.logTreeImpression called but no tracking tree html found!",null,{},"WARN")}}if(k){k()}return false};e.logLightboxTreeImpression=function(i){if(!ta.retrieve(c)){if(i){i()}return false}var h=g();if(h){ta.recordImpression(h,i);return true}if(i){i()}};var g=function(){var h=$$(".metaCheckRatesOverlay .impressionTrackingTree");if(h){return h[0].innerHTML}};e.getElmtPriceData=function(h){var i=[];if(!h){return i}var j="PP:";if(h.getAttribute("data-pernight")){j+=h.getAttribute("data-pernight")}else{j+="-1"}i.push(j);var k="PN:";if(h.getAttribute("data-offer-author")){k+=h.getAttribute("data-offer-author")}else{k+="None"}i.push(k);return i};e.logTrackingTreeClickTrk=function(h){if(!ta.retrieve(c)){return}if(e.hasTrackingTree(h)){if(h.hasClass("bookableOffer")){ta.trk("sherpa_click",false,h)}else{var i=e.getElmtPriceData(h);ta.trk("meta_click",false,h,i)}}};e.logTrackingTreeClickEvtCookie=function(i,h){if(!ta.retrieve(c)){return}if(e.hasTrackingTree(h)){if(h.hasClass("bookableOffer")){ta.setEvtCookieAndPath("sherpa_click",i,h)}else{ta.setEvtCookieAndPath("meta_click",i,h)}}};e.getElmtHeight=function(h){if(h){return h.offsetHeight}};function a(){if(!b.hotelListSelector||!b.singleHotelSelector){return 0}var i=0;var h=0;var j=document.getElements(b.hotelListSelector);j.each(function(k){k.getElements(b.singleHotelSelector).each(function(l){if(l.match(b.singleHotelSelector)){i++;if(l.isFullyVisible()){h=i}}})});return h}})(ta.meta.treeTrack);if(!ta.meta.update){ta.meta.update={}}ta.util.customEvent.addListener("newInlinePageDates",window,function(b,a){ta.meta.update.request(b,a)});(function(n){var b="miniMetaHacRequest_longTimeoutKey";var f="miniMetaHacRequest_appearLoadedTimeoutKey";n.request=function(y,x){l(y);w(y,x)};n.completeOnInitialPage=function(x){a(true,"",x)};n.buildUrl=function(E,O,L,D,W,I,G,B,C,x){var y=e(W),H=ta.widgets.calendar.getCheckRatesData(),X="",N="",R="",K="",J="";if(H){X=Object.toQueryString(H)}if(D){N="&metaVersion="+D}if(ta.has("meta.baseLocationId")){R="&baseLocId="+ta.retrieve("meta.baseLocationId")}if(ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")||ta.retrieve("checkrates.hr_bc_see_all_click")||(ta.retrieve("checkrates.hr_bc_see_all_click.lb")&&E==="MetaCheckRatesAjax")){K="&seeAllClick=true"}if(window.pageServlet){J="&imp=true&metaReferer="+window.pageServlet}var S=ta.retrieve("meta.requestFromArea");if(!S){S="";if(document.getElement("#LOC_PHOTO_ALBUMS")){S="&requestFromArea=pal"}else{if(document.getElement("#AMENITY_LIGHTBOX")){S="&requestFromArea=amo"}}ta.store("meta.requestFromArea",S)}var A="/"+E+"?detail="+O+"&"+X+"&area="+y+"&returnAllOffers=true"+J+N+R+K+S,P=A;try{A=ta.commerce.meta.tracking.updateUrlWithTiming(A,y)}catch(V){ta.util.error.record(V,"problem updating url with timing in CheckRates.buildVarMetaHacUrl");A=P}if(ta.commerce.meta.tracking.hasAnySuppressedAreas()){var T=ta.commerce.meta.tracking.getSuppressedAreasAsString();if(T){A+="&suppressImpressionsOnComplete="+T}}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){P=A;try{A=m(A,C);if(!A){A=P}}catch(V){ta.util.error.record(V,"problem updating url with isFirstPageLoad in CheckRates.buildVarMetaHacUrl");A=P}}if(L){A+="&finalRequest=true"}if(I){A+="&numTries="+I}if(B){A+="&loadingTimeoutPassed="+B}if(x){A+="&isDateChangedRequest="+x}if(ta.maps&&ta.maps.mapsponsor){var z=ta.maps.mapsponsor.getSponsorForLocation(O);if(z){A+="&mapSponsorship="+z}}var F="meta.premiumIdsForNextPoll";if(B&&ta.has(F)){A+="&premiumContentId="+ta.retrieve(F)}else{if(G){var M=G[0];if(M){A+="&premiumContentId="+M;for(var Q=1;Q<G.length;Q++){M=G[Q];A+=","+M}}}}if(B&&ta.has("meta.displacedChevronOfferContentId")){A+="&displacedChevronOffer="+ta.retrieve("meta.displacedChevronOfferContentId")}var U="ta.commerce.MetaHacOverlay.currency";if(ta.has(U)){A+="&currency="+ta.retrieve(U);ta.remove(U)}return A};n.overlayRequest=function(R,T,Z,O,G){var Q,D="metaHacRequest_curCancelKey",I,L,E,X,A,P,M,V,y=13,U,x,C,K,F,N,H;try{if(!R){return}ta.commerce.meta.clearStoredMiniData();I=ta.widgets.calendar.getCheckRatesData();if(T==null){ta.store("meta.travelData",I);T=new Date().getTime();L=false;if(Z){if(ta.has("metaCheckRatesUpdateDivInline")){L=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}else{if(ta.has("metaCheckRatesUpdateDiv")){L=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}}if(L&&L.removeClass){L.removeClass("hidden")}}E="metaHacRequest_"+T+"_cancel";if(ta.has(D)){X=ta.retrieve(D);if(X!=E){ta.store(X,true);ta.commerce.meta.polling.removePollingInfoForRequest(X)}}if(Z){A=document.getElement(".meta_rates_content .postShowMetaCR");if(ta.has("checkrates.mini_meta_by_percent_cpc")&&ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")){P=A.getElement(".seeMore.threshold");if(P){M=A.getElements(".postClickPrice.hide");M.each(function(aa){aa.removeClass("hide")});P.hide()}}ta.commerce.meta.updateProvArea(A)}if(!ta.has(E)){ta.store(E,false);ta.store(D,E)}if(ta.retrieve(E)===true){return}V=ta.retrieve("metaCheckRatesOverlay");if(!V&&!Z){return}Q=false;if(V){Q=V.inner}if(ta.has("metaCheckRatesUpdateDiv")){Q=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(Z&&ta.has("metaCheckRatesUpdateDivInline")){Q=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}catch(W){ta.util.error.record(W,"overlayRequest setup")}if(!Q){return}try{if(ta.commerce.meta.polling.isRequestBeingPolled(E)){U=ta.commerce.meta.polling.getPollingAttemptForRequest(E);if(!U||U>y){ta.commerce.meta.polling.removePollingInfoForRequest(E);return}}else{U=1;ta.commerce.meta.polling.setPollingAttemptForRequest(E,U)}if(!Q.innerHTML.contains("hacComplete")){x=false;if(Z){x="QC_Meta_Inline"}if(!O){O=1}var J=ta.meta.update.buildUrl("MetaCheckRatesAjax",R,true,G,x,O);setTimeout(function(){new Request({url:J,onSuccess:function(aa){if(ta.retrieve(E)){return}if(ta.retrieve("metaCheckRatesOverlay")||ta.retrieve("metaCheckRatesUpdateDivInline")){Q.innerHTML=aa;ta.fireEvent("refreshedDOMContent",Q);if(ta.retrieve("checkrates.meta_ui_sk_box")){ta.commerce.meta.restoreProviderHover()}}if((ta.meta.update.getMetaPricesCount(Z)>0||U>9)&&ta.commerce.meta.hacIsBlockingXSell(Z)){if(Z){ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}ta.commerce.meta.polling.incrementPollingAttemptForRequest(E);ta.meta.update.overlayRequest(R,T,Z,O+1,G)},evalScripts:true}).send()},ta.commerce.meta.polling.getPollingWaitTimeForRequest(E))}else{try{ta.commerce.meta.polling.removePollingInfoForRequest(E);C=ta.id("META_HAC_DATE_HEADLINE");if(C){var Y=C.getElements(".headlineLegend");if(Y.length>=2){Y.forEach(function(aa){aa.addClass("hidden")});if(Q.getElement(".anyOfferCompletedSuccessfully")){Y[0].removeClass("hidden");if(ta.retrieve("lightbox_improvements")){ta.commerce.meta.hideBestPriceXsell("REC_CONT")}}else{if(Q.getElement(".partnersAllNotAvailable")&&ta.retrieve("lightbox_improvements")&&Y.length>2){Y[2].removeClass("hidden");if(Z){ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT_INLINE",{isInline:true});ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{var B={isMetaLighboxV3:ta.retrieve("meta_lightbox_v3.enabled")};if(!ta.id("META_PRICE_XSELL")){ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT",Object.merge(B,{isInline:false}))}ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}else{Y[1].removeClass("hidden");if(ta.retrieve("lightbox_improvements")){ta.commerce.meta.hideBestPriceXsell("REC_CONT")}}}}if(!ta.retrieve("lightbox_improvements")){if(Z){ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT_INLINE",{isInline:true});ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT",{isInline:false});ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}}if(V){ta.commerce.meta.storeMiniData(V.inner)}if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&Q){var S=Q.getElement(".impressionTrackingTree");if(S){ta.trkImpTree(S)}}K=i(Q);N="complete";if(Z){if(ta.id("COMHVY")){F="Mini-Meta";if(ta.find(".NotShowing .postClickPrice")){N+="_may_be_available"}else{if(ta.find("#HotelDateSearch .price .minCost")){if(ta.find(".strikeHigh")){N+="_available_lp_chevron"}else{N+="_available"}}else{N+="_unavailable"}}}else{F="Metainline"}}else{F="meta_lightbox"}if(Q.innerHTML.contains("doneNoAvailability")){ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_EMPTY",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount());if((ta.id("MAYBE_BUTTONS_INLINE")&&Z)||(ta.id("MAYBE_BUTTONS")&&!Z)&&F!="Mini-Meta"){N+="|may_be_availabile"}else{if(F!="Mini-Meta"){N+="|unavailable"}}}else{ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_PRESENT",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount())}ta.trackEventOnPage(F,N,K.toString());ta.commerce.meta.showLowestPriceCTA(Z);window.fireEvent("MetaLightboxHacComplete");H=ta.find(".overlay .skv3");if(H&&H.hasAttribute("data-sponsor")){var z=H.getAttribute("data-sponsor");ta.maps.ads.injectMetaLightBoxAd(z)}}catch(W){ta.util.error.record(W,"overlayRequest - failure in complete results block")}}}catch(W){ta.util.error.record(W,"meta HAC - ajax requests")}};n.displayRemainingProviders=function(A){try{var z=ta.id("CHECK_RATES_CONT");var y=z.getElements("li");for(var x=y.length;x--;){y[x].removeClass("hide")}A.hide();ta.store("checkrates.mini_meta_by_percent_cpc_see_all_click",true)}catch(B){ta.util.error.record(B,"displayRemainingProviders")}};n.updateCRForm=function(x){try{if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers();return}var J=ta.id("HotelDateSearch"+x);var I=ta.id("HotelDateSearch");var B=["select","input[type=checkbox]","input[type=hidden]","input[type=text]"];if(J&&I){for(var E=B.length;E--;){var z=B[E];var L=I.getElements(z);var A=J.getElements(z);for(var D=A.length;D--;){var K=A[D];var H=K.id.split("_")[0];for(var C=L.length;C--;){var G=L[C];if(G.id.contains(H)){if(z=="input[type=checkbox]"){var M=G.getParent("li");if(M&&!M.hasClass("unavailable")){var y=K.getParent("li");if(y){y.removeClass("unavailable")}}}if(z=="select"){K.selectedIndex=G.selectedIndex}else{if(z=="input[type=checkbox]"&&x!="_pop"){K.checked=G.checked}else{if(!K.id.contains("hacPid")){K.value=G.value}}}}}}}}}catch(F){ta.util.error.record(F,"updateCRForm")}};n.getMetaPricesCount=function(x){var z=0,B;var y=ta.retrieve("metaCheckRatesOverlay");var A=false;if(y){A=y.inner}if(ta.has("metaCheckRatesUpdateDiv")){A=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(x&&ta.has("metaCheckRatesUpdateDivInline")){A=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}if(!A){return}B=A.getChildren("#HR_HACKATHON_CONTENT .roomPrice");if(B){z=B.length}return z};function c(C){var B=ta.id("PROVIDER_BLOCK");if(!B){return}if(typeof CDNHOST!="undefined"){var A='<img class="provLoading" src="'+CDNHOST+'/img2/meta_sprites/loadingAnim.gif">';B.getElements(".rightBox").each(function(D){D.setContent(A)})}var y=B.get("html");var x=1000;var z="metaHacRequest_"+x+"_cancel";ta.remove(z);new Request({url:ta.meta.update.buildUrl("MetaCheckRatesAjax",C,true),onSuccess:function(D){B.setContent(D);ta.fireEvent("refreshedDOMContent",B);ta.meta.update.overlayRequest(C)},onFailure:function(){B.setContent(y)}}).send()}function w(y,x){if(x=="pop"){ta.store("ta.meta.request.locId",y);ta.store("ta.meta.request.placement",x);ta.run("ta.overlays.Factory.metaCheckRatesOverlay")}else{if(x=="met"||x=="solb"){if(!ta.has("meta.widget")){c(y)}}}}function i(z){var A;var B;var x=0;var y=0;z=ta.id(z);B=z.getChildren("#HR_HACKATHON_CONTENT .roomPrice");A=z.getChildren("#HR_HACKATHON_CONTENT .textLinks .offer .price");if(B){x=B.length}if(A){y=A.length}return x+y}function l(B,E,J,I){if(ta.retrieve("tablet_maps_v1")&&ta.retrieve("maps_v2_open")){return}if(!J){J=0}if(!I){I=false}var F="miniMetaHacRequest_curCancelKey";var D=13;if(E==null){E=new Date().getTime()}var C="miniMetaHacRequest_"+E+"_cancel";if(ta.retrieve(C)===true){return}if(ta.has(F)){var L=ta.retrieve(F);if(L!=C){ta.store(L,true);ta.commerce.meta.polling.removePollingInfoForRequest(L)}}if(!ta.has(C)){ta.store(C,false);ta.store(F,C)}var K;if(ta.commerce.meta.polling.isRequestBeingPolled(C)){K=ta.commerce.meta.polling.getPollingAttemptForRequest(C);if(!K||K>D){ta.commerce.meta.polling.removePollingInfoForRequest(C);return}}else{K=1;ta.commerce.meta.polling.setPollingAttemptForRequest(C,K)}var y=[];if(I){var H=$$("#CHECK_RATES_CONT div.premium:not(.tripConnectDemo)");for(var A=0;A<H.length;A++){var z=H[A].get("data-contentid");y.push(parseInt(z,10))}}if(J<1){var G;if(ta.has(b)){G=ta.retrieve(b);clearTimeout(Number.from(G))}if(ta.has(f)){G=ta.retrieve(f);clearTimeout(Number.from(G))}G=setTimeout(function(){u()},ta.commerce.minimeta.ajax.MINI_META_STOP_LOADING_TIMEOUT);ta.store(b,Number.from(G))}var x=ta.retrieve("hotels.datesChanged");if(x&&ta.has("hac_timezone_awareness")){n.clearDatesBumpedMessage()}new Request({url:ta.meta.update.buildUrl("MiniMetaCRAjax",B,true,null,"QC_Meta_Mini",J,y,I,C,x),onSuccess:function(M){a(false,M,B,E,J,I,C,x)},evalScripts:true}).send()}n.clearDatesBumpedMessage=function(){var y=ta.id("HAC_DATES_MOVED_FORWARD");var x=document.getElement("#CHECK_RATES_CONT .legend.metaDatesChosen");if(y&&x){y.dispose();x.removeClass("hidden")}};function d(x){x.getChildren().each(function(y){var z=y.getAttribute("data-targetEvent");if(z){ta.fireEvent(z,y)}})}function a(H,I,O,R,K,y,C,x){if(ta.retrieve(C)===true){return}var F,W,M,J;if(H){var U=ta.select("#CHECK_RATES_CONT fieldset")[0];I=U.get("html");F=new Element("div",{html:I});W=true;M=document.getElement(".similarCarousel");J=F.getChildren()}else{F=new Element("div",{html:I});d(F);W=I.contains("hacMiniComplete");M=document.getElement(".similarCarousel");J=Elements.from(I)}if(!M||K<1){ta.commerce.meta.updateProvArea(F.getElement(".postShowMetaCR"));window.fireEvent("miniMetaOnHRUpdate",I)}if(!document.getElement(".dropdownMiniMeta")){var A=document.getElement(".postShowMetaCR");if(A){h(I,A)}}v(I);if(ta.retrieve("hotel_review_low_price_message")&&F.getElement(".price_alert_update")){var X=document.getElement("#PRICE_ALERT_RIBBON_CONTAINER");if(X){var Z=X.getElementById("PRICE_ALERT_RIBBON");if(Z){Z.destroy()}Z=F.getElement(".price_alert_update").getElement(".price_alert_ribbon");if(Z){X.innerHTML=Z.outerHTML;ta.util.element.makeTextFitOneLine("#PRICE_ALERT_RIBBON",false);var L=Z.getElement(".priceAlertText b");if(W&&L&&L.innerHTML&&L.innerHTML.length>0){ta.trackEventOnPage("hotel_review_low_price_message","Display",L.innerHTML)}}}ta.fireEvent("priceAlertRibbonUpdated")}if(W&&!I.contains("bookableOffer")){window.fireEvent("hacComplete_noBookingOffersFound")}if(W||y){if(I.contains("bookableOffer")){window.fireEvent("hacComplete_bookingOffersFound")}}var N=ta.id("HR_META_INTERSTITIAL");if(N){var T=document.getElement("#HR_HACKATHON_CONTENT fieldset");if(T){if(K<1&&!H){ta.store("show_hr_meta_interstitial",true);window.setTimeout(function(){ta.store("show_hr_meta_interstitial",false);N.addClass("hidden");T.removeClass("hr_meta_loading_hidden")},2000);T.addClass("hr_meta_loading_hidden");var G=document.getElement("#HR_HACKATHON_CONTENT .metaExplanation");if(G){G.addClass("hidden")}N.removeClass("hidden")}else{if(!N.hasClass("hidden")&&(!ta.retrieve("show_hr_meta_interstitial")||W)){N.addClass("hidden");T.removeClass("hr_meta_loading_hidden")}}}}if(ta.has("meta.isHackathonBC")&&!ta.has("hr_unavail_xsell_flyout")){ta.commerce.meta.horizontalXSell.updateHorizontalXSell(F,O)}if(!W&&ta.has("meta.isHackathonBC")&&I.contains("firstRequest")){var D=setTimeout(function(){r(O,R,K)},ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT);ta.store(f,Number.from(D))}if(W&&ta.has(f)){var B=ta.retrieve(f);clearTimeout(Number.from(B))}var E=".metaDatesChosen",Y=".metaDatesChosen",V=ta.retrieve("meta.bc.bestPricesForYourStay");if(ta.retrieve("hr_pricefinder_datebar")){E=".rooms_guests_wrap";Y=".priceFinderDatebarWrap .metaBlockHeader";V=ta.retrieve("hr_pricefinder_datebar_header_text")}if(!W){if(ta.has("meta.isHackathonBC")&&I.contains("anyOfferCompletedSuccessfully")){ta.commerce.meta.updateHeaderMsg(Y,V);if(ta.has("guests_rooms_picker_3.enabled")){ta.commerce.meta.updateHeaderDates()}}if(ta.has("guests_rooms_picker_4.enabled")&&ta.overlays.NumberPickerOverlay){ta.overlays.NumberPickerOverlay.updateHeaderMsg(E)}ta.commerce.meta.polling.incrementPollingAttemptForRequest(C);setTimeout(function(){l(O,R,K+1,y)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(C))}else{if(ta.has("meta.isHackathonBC")){var S=V;if(I.contains("allNotAvailable")){var P=ta.id("priceNotAvailMsg");if(P){S=P.innerHTML}else{S=ta.retrieve("meta.bc.pricesTravelSitesNotAvailDates")}}ta.commerce.meta.updateHeaderMsg(Y,S);if(ta.has("guests_rooms_picker_3.enabled")){ta.commerce.meta.updateHeaderDates()}if(ta.has("guests_rooms_picker_4.enabled")&&ta.overlays.NumberPickerOverlay){ta.overlays.NumberPickerOverlay.updateHeaderMsg(E)}if(ta.retrieve("meta.full_meta_photos")){var z=document.getElement(".metaDatesChosen");if(z){if(I.contains("allNotAvailable")){if(ta.has("ibex_lead_with_supplier_direct_logo")){document.getElement(".headerWrapper").addClass("no_offers_available");document.getElement(".changeStayInfoButton").addClass("no_offers_available")}z.addClass("no_offers_available")}else{if(ta.has("ibex_lead_with_supplier_direct_logo")){document.getElement(".headerWrapper").removeClass("no_offers_available");document.getElement(".changeStayInfoButton").removeClass("no_offers_available")}z.removeClass("no_offers_available")}}}ta.commerce.meta.polling.removePollingInfoForRequest(C);ta.commerce.meta.displayBlueChevronLowestPriceCTA();window.fireEvent("HRHacComplete");if(!y){o(R,false)}var Q=document.getElement(".similarCarousel");if(y&&Q){g(I)}if(!H){setTimeout(function(){t()},1000)}}}ta.fireEvent("onHACUpdate",I);if(W&&!ta.retrieve("hotels_to_seo_hotels_redirect")&&x&&!y&&!ta.retrieve("meta.persist.visible")&&!(I.contains("cancelRedirect"))){if(I&&I.match(/\shacComplete\s.*\shacMiniOfferNotAvailable\s/g)){ta.trackEventOnPage("NoAvailability","redirect","",0,"/HotelHighlight")}if(I&&I.match(/\shacComplete\s.*\shasDisplayUnavailability\s/g)){ta.trackEventOnPage("MaybeAvailable","redirect","",0,"/HotelHighlight")}}if(W){ta.fireEvent("HRHacAvailabilityDetermined",{availability:ta.commerce.meta.getResponseAvailability(I),loadingTimeoutPassed:y,cancelRedirect:I.contains("cancelRedirect"),datesChanged:x,hasBookableOffer:I.contains("bookableOffer")})}k(W,F);s(R,W,y)}function h(z,x){var A=new Element("div",{html:z}),y=A.getElement(".dropdownMiniMeta");if(y){y.inject(x)}}function v(z){var x=document.getElement(".rgba_flyout.dropdownMiniMeta"),A,B,y;if(x){A=new Element("div",{html:z});y=A.getElement(".dropdownMiniMeta");if(y){B=x.getElement(".inner");B.innerHTML="";y.set("class","dropdownMiniMeta");B.adopt(y)}p()}}function p(){if(ta.retrieve("dropdownMiniMeta.hover")){ta.commerce.meta.hoverTopOffer()}else{if(ta.retrieve("dropdownMiniMeta.blur")){ta.commerce.meta.blurTopOffer()}}}function r(A,y,x){var z="miniMetaHacRequest_"+y+"_cancel";if(ta.retrieve("datepicker_autoadvance")&&ta.retrieve(z)){return}j();o(y,true);l(A,new Date().getTime(),x+1,true)}function e(x){var y="";if(ta.browser.isIE10Metro()){if(x=="QC_Meta_Book_Inline"){y="QC_Meta_Metro_Inline"}else{y="QC_Meta_Metro_Lightbox"}}else{if(!x){if(ta.has("ta.meta.navArea")){y=ta.retrieve("ta.meta.navArea")}else{ta.util.element.trackIfMapView();y="QC_Meta_Lightbox"}}else{y=x}}return y}function u(){var z=document.getElement("#CHECK_RATES_CONT div.hacMiniComplete");var x=document.getElement("#CHECK_RATES_CONT div.hacMiniCompleteTimeOut");if(z||x){return}var y=document.getElement("div.bc_flags");if(y){y.addClass("hacMiniCompleteTimeOut")}j();t()}function j(y){var x=y?"metaHacRequest_curCancelKey":"miniMetaHacRequest_curCancelKey";if(ta.has(x)){var z=ta.retrieve(x);ta.store(z,true);ta.commerce.meta.polling.removePollingInfoForRequest(z)}}n.cancelAllMetaCurrentQuery=function(){j(false);j(true)};function q(){var z=document.getElements("#CHECK_RATES_CONT span.textLinkLoading");var y=document.getElements("#CHECK_RATES_CONT div.loading");var x=0;if(z){x+=z.length}if(y){x+=y.length}return x}function m(x,A){var y,z;if(!x||!A){return}y=A+"_suppressCommerceImpressionState";z=ta.commerce.meta.polling.getPollingAttemptForRequest(A);if(z){if(z===1){if(ta.retrieve("meta.isFromDatesChange")){ta.remove("meta.isFromDatesChange");ta.store(y,true);x+="&isFirstPageLoad=false";return x}}else{if(ta.retrieve(y)){x+="&isFirstPageLoad=false";return x}}}return x}function o(D,G){var z=0;var E="unknown";if(G){z=ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT;var F=q();var y=document.getElements("#CHECK_RATES_CONT div.premium");var A=document.getElements("#CHECK_RATES_CONT span.textLink");var C=0;if(y){C+=y.length}if(A){C+=A.length}var x=C-F;if(C>0){var B=Math.round((x/C)*10)*10;if(B%10===0&&B>-1&&B<101){E=""+B+"percent"}}}else{z=new Date().getTime()-D;E="100percent"}ta.trackEventOnPage("HAC","HACComplete",E,z,true)}function g(B){var A=Elements.from(B)[0];if(!A){return}var z=A.getElementsByClassName("price");var y=A.getElementsByClassName("priceBlock");var x=0;if(z){x+=z.length}if(y){x+=y.length}ta.trackEventOnPage("HAC","StateCarouselDisplayed","",x,true)}function t(){var x=q();if(x>0){ta.trackEventOnPage("HAC","HACError","LoadingAfterHACComplete",x,true)}}function k(z,x){if(z&&ta.retrieve("ibdm_impression_tracking")){var A=x.getElements(".impressionTrackingTree");if(A){var y;for(y=0;y<A.length;++y){ta.trkImpTree(A[y])}}}}function s(A,z,x){if(z||x){var B="meta.lowestPricePromotionTracking.tracked"+A;if(ta.has("meta.lowestPricePromotionTracking")&&!ta.has(B)){var y=ta.retrieve("meta.lowestPricePromotionTracking");if(y&&y.bidDifference&&y.priceDifference&&y.bidDifference>=0.43&&y.priceDifference>=10){ta.store(B,true);ta.trackEventOnPage("lowest_price_promoted_impression",y.providers,y.bidDifference+"|"+y.priceDifference)}}}}})(ta.meta.update);if(!ta.meta){ta.meta={}}if(!ta.meta.cross_sell){ta.meta.cross_sell={}}(function(e){var f=0;var b=false;var c=0;e.relatedHoverOver=function(i,g){try{if(f!==0){return}if(g===0){a()}else{d((i)?(i.target||i.srcElement):null,g)}}catch(h){ta.util.error.record(h,"also viewed - avafIn")}};e.relatedHoverOut=function(j){try{if(f!=1||!b){return}if(!j){j=window.event}if(!j){return}var g=(j.relatedTarget)?j.relatedTarget:j.toElement;var i=ta.id("ALSO_VIEWED_LIST");while(g&&g!=i&&g.nodeName!="BODY"){g=g.parentNode}if(g==i){return}clearTimeout(b);b=false;f=0}catch(h){ta.util.error.record(h,"also viewed - avafOut")}};e.relatedExpand=function(g,i){var h,k;try{ta.trk("AVAF_EXPAND_"+(i?"MORE":"LESS"),false,(g)?(g.target||g.srcElement):null);if(i){h=ta.id("hideableMore");if(!h){return}h.addClass("hidden");h=ta.id("expand_av_on_more");if(!h){return}h.removeClass("hidden");if(c===0){h.addClass("expanding");c=h.getSize().y;h.removeClass("expanding")}h.addClass("show");new Fx.Tween(h,{duration:"long",property:"height"}).start(0,c)}else{h=ta.id("expand_av_on_more");if(!h){return}new Fx.Tween(h,{duration:"long",property:"height"}).start(h.getSize().y,0).chain(function(){h.removeClass("show");h.addClass("hidden");k=ta.id("hideableMore");if(!k){return}k.removeClass("hidden")})}}catch(j){ta.util.error.record(j,"also viewed - avafMore")}};e.relatedResetStateFlag=function(){f=0};function d(h,g){try{f=1;b=setTimeout(function(){a(h)},g)}catch(i){ta.util.error.record(i,"also viewed - avafWait")}}function a(h){try{ta.trk("AVAF_HOVER_EXPAND",false,h);f=2;var g=ta.id("expand_av_on_hover");if(!g){return}g.removeClass("hidden");g.addClass("expanding");var l=g.getSize().y;g.removeClass("expanding");g.addClass("show");var k=g.getParent("#AV_ABOVE_FOLD_META");if(k){k.setStyle("height","auto")}var j=new Fx.Tween(g,{duration:"long",property:"height"});j.start(0,l)}catch(i){ta.util.error.record(i,"also viewed - avafExpand")}}})(ta.meta.cross_sell);if(!ta.meta.cr){ta.meta.cr={}}(function(b){b.updateCRCalendar=function(c){if(c.form){a(c.form)}b.updateCRFormElement(this);if(ta.id("META_UI_INLINE")){ta.meta.update.updateCRForm("_imt")}};b.findInlineCRLocationId=function(){var g=null;var h=ta.id("HotelDateSearch");if(h){var c=h.getElements("input[type=text]");for(var f=c.length;f--;){var d=c[f];var e=d.id.match(/_(\d+)/);if(e.length){g=e[1];break}}}return g};b.updateCRFormElement=function(g){try{g=ta.id(g);var o=g.get("tag").toLowerCase();if(o=="li"){g=g.getElement("input[type=checkbox]")}var h=g.id.split("_")[0],k=this.findInlineCRLocationId(),n=h+"_"+k,f=g.id,c=f.substring(f.length-4),r=[n,n+"_icr",n+"_per",n+"_imt"],j,q,d,m,p;if(this.crSyncExtensions.contains(c)){for(j=r.length;j--;){n=r[j];if(n!=f){p=ta.id(n);if(p){if(o=="li"&&c!="_pop"){p.checked=g.checked;q=g.getParent("li");if(q&&!q.hasClass("unavailable")){d=p.getParent("li");if(d){d.removeClass("unavailable")}}}else{if(o=="select"){p.selectedIndex=g.selectedIndex}else{if(o=="input"){m=n.substring(n.length-4);if(!this.crSyncExtensions.contains(m)){m=""}this.updateCRFormElement_In(k,g,c,m)}}}}}}}}catch(l){ta.util.error.record(l,"updateCRFormElement")}};b.getPropIdFromCRElement=function(d){if(d){var c=null;if(c=d.className.match(/id_(\d+)/)){return c[1]}}return null};b.removePCR=function(){var c=ta.retrieve("pcr.overlay");if(c){c.hide()}};b.availCheck=function(d){var c=ta.id("availability")&&ta.id("availability").value=="1";var f=ta.id(d).getElement(".overlaySrc");if(c&&f){var e=f.innerHTML;f.innerHTML=e.replace(/cid=(\w+_)?&amp;/,"")}};b.crSyncExtensions=["_pop","_icr","_pto","_per","_amo","_cro","_met","_imt","_pal","_inm"];function a(c){if(ta.retrieve("checkrates.datesChanged")){return}try{var d=ta.id(c);d.getElements(".unavailable").each(function(e){e.removeClass("unavailable");if(e.hasClass("js_ua_checked")){e.getElements("input").set("checked",true)}ta.meta.update.updateCRFormElement(e)});ta.store("checkrates.datesChanged",true)}catch(g){ta.util.error.record(g,"_showSuppressedProviders")}}})(ta.meta.cr);(function(a){a.GoogleCSA={addCallback:function(c,b){b.adLoadedCallback=function(h,d){var f=ta.id(c);if(f&&!d){try{f.dispose()}catch(g){ta.util.error.record(g,"Google CSA")}}};return b}}}(ta.commerce));if(!ta.sales){ta.sales={}}ta.sales.metaImpressionTag=(function(g,f,d){var e=new Class({initialize:function(l,m,n){this.providerName=l;this.vendorName=m;this.trackingPixel=n;this.alreadyTracked=false}});var a=[],h=function(m){if(d.find(m)){var l=d.select(m);if(l&&l.length>0){l.each(function(n){a.each(function(o){j(n,o)})})}a=a.filter(function(n){return !n.alreadyTracked});if(!i()){b()}}return false},i=function(){return a.length>0},j=function(l,m){if(((l.get("data-provider")&&l.get("data-provider")===m.providerName)||(l.get("data-offer-author")&&l.get("data-offer-author")===m.providerName)||(l.get("data-vendorname")&&l.get("data-vendorname")===m.vendorName))&&!l.hasClass("hidden")){c(m.trackingPixel);m.alreadyTracked=true}},c=function(l){var m=l+Math.floor(Math.random()*100000);g.body.appendChild(new Element("img",{"class":"tracking",src:m,height:"0",width:"0"}))},k=function(){f.addEvent("HotelsHacComplete",d.sales.metaImpressionTag.chkHotels);f.addEvent("HRHacComplete",d.sales.metaImpressionTag.chkHR);f.addEvent("MicroMetaHacComplete",d.sales.metaImpressionTag.chkMicroMeta);f.addEvent("MetaLightboxHacComplete",d.sales.metaImpressionTag.chkLightbox);f.addEvent("MetaFetchComplete",d.sales.metaImpressionTag.chkMapDetailCard);f.addEvent("MetaFetchComplete",d.sales.metaImpressionTag.chkSmartDeals);f.addEvent("MapListMetaComplete",d.sales.metaImpressionTag.chkMapListCard)},b=function(){f.removeEvent("HotelsHacComplete",d.sales.metaImpressionTag.chkHotels);f.removeEvent("HRHacComplete",d.sales.metaImpressionTag.chkHR);f.removeEvent("MicroMetaHacComplete",d.sales.metaImpressionTag.chkMicroMeta);f.removeEvent("MetaLightboxHacComplete",d.sales.metaImpressionTag.chkLightbox);f.removeEvent("MetaFetchComplete",d.sales.metaImpressionTag.chkMapDetailCard);f.removeEvent("MetaFetchComplete",d.sales.metaImpressionTag.chkSmartDeals);f.removeEvent("MapListMetaComplete",d.sales.metaImpressionTag.chkMapListCard)};return{chkLightbox:function(){if(!i()){return}h(".overlay #PROVIDER_BLOCK .metaLbOffers .offer.premium")},chkMicroMeta:function(){if(!i()){return}h("#micro_meta_ajax .provider")},chkHotels:function(){if(!i()){return}h("#PAGE .metaPriceInfo .header")},chkMapDetailCard:function(){if(!i()){return}h(".mapsv2-detail-info .mapsv2-chevron")},chkMapListCard:function(){if(!i()){return}h(".mapsv2-listcard .mapsv2-listitem .mapsv2-dropdownfirstitem")},chkSmartDeals:function(){if(!i()){return}h("#AVAILABLEHOTELDEALS .lpContainer .offer")},chkHR:function(){if(!i()){return}h("#CHECK_RATES_CONT .offer.premium:not(.remaining):not(.noLink)")},addTrackingProvider:function(l,m,n){if(l&&l.length>0&&m&&m.length>0&&n&&n.length>0){a.push(new e(l,m,n))}},registerEvents:function(){if(a.length===0){return}k()}}}(document,window,ta));if(!ta.sales){ta.sales={}}ta.sales.bwIBImpressionComscoreTag=(function(l,k,i){var b="https://sb.scorecardresearch.com/",p="http://b.scorecardresearch.com/",a=(("https:"===l.location.protocol?b:p)+"p?c1=3&c2=6036461&c3=ALBwesternAgst15&c4=ibimpressions&c5=ibimpression&c6=&c10=1&c11=&c13=1x1&c16=gen&cj=1&ax_fwd=1&rn="),o="BestWestern",e="TripAdvisor",f=function(){var q=a+Math.floor(Math.random()*100000);l.body.appendChild(new Element("img",{"class":"tracking",src:q,height:"0",width:"0"}))},m=function(){f();h()},j=function(){var q=i.find(".hacComplete #META_SBS_TRACKING_DUMMY[data-provider="+o+"]");if(q){m()}},g=function(){var q=i.find(".metaContent .offer.bookableOffer[data-vendorname="+e+"][data-offer-author="+o+"]");if(q){m()}},d=function(){var q=i.select(".metaPriceInfo .header.bookableOffer[data-provider="+o+"]");if(q&&q.length>0){m()}},n=function(){var q=i.select("#AVAILABLEHOTELDEALS .sdBlueChevron:not(.hidden) .offer.bookableOffer[data-ibpartner="+o+"]");if(q&&q.length>0){m()}},c=function(){k.addEvent("hacComplete_bookingOffersFound",j);k.addEvent("hacComplete_bookingOffersFound",g);k.addEvent("HotelsHacComplete",d);k.addEvent("BlenderHacComplete",d);k.addEvent("MetaFetchComplete",n)},h=function(){k.removeEvent("hacComplete_bookingOffersFound",j);k.removeEvent("hacComplete_bookingOffersFound",g);k.removeEvent("HotelsHacComplete",d);k.removeEvent("BlenderHacComplete",d);k.removeEvent("MetaFetchComplete",n)};return{registerIBImpressionTrackingEvents:c}}(document,window,ta));if(!ta.sales){ta.sales={}}ta.sales.metaClickTag=(function(f,e,c){var d=new Class({initialize:function(j,k,l){this.providerName=j;this.vendorName=k;this.trackingPixel=l}});var a=[],g=function(k){if(k&&k.dataset){var j=a.filter(function(m){var l=k.dataset;if(((l.provider&&l.provider===m.providerName)||(l.offerauthor&&l.offerauthor===m.providerName)||(l.vendorname&&l.vendorname===m.vendorName))&&!k.hidden){return true}return false});if(j&&j.length){j.each(function(l){b(l.trackingPixel)})}}return false},h=function(){return a.length},b=function(j){f.body.appendChild(new Element("img",{"class":"tracking",src:j,height:"0",width:"0"}))},i=function(){e.addEvent("metaLinkClick",c.sales.metaClickTag.chkMetaClick)};return{chkMetaClick:function(j){if(!h()){return}console.log("Listener called.");g(j)},addTrackingProvider:function(j,k,l){if(j&&j.length&&k&&k.length&&l&&l.length){a.push(new d(j,k,l))}},registerEvents:function(){if(a.length===0){return}i()}}}(document,window,ta));ta.servlet.GeoCheckRates={checkBoxToggle:function(b,c){var a=$(c.parentNode);if(c.checked){a.addClass("checked")}else{a.removeClass("checked")}}};ta.overlays.BACKDROP_NEVER=0;ta.overlays.BACKDROP_ALWAYS=1;ta.overlays.Overlay=new Class({Implements:[Options,Events],Binds:["_hide","show","hide","destroy","hideByClickOnDocument"],options:{requestData:null,showCloseButton:false,noPadding:false,noCpu:false,closeButtonClass:"close",closeLink:"",showArrow:false,arrowClassLeft:null,arrowClassRight:null,arrowClass:"ttarrow",style:"typeO",innerDivClass:"inner",backdrop:ta.overlays.BACKDROP_NEVER,backdropZIndex:"default",permanent:false,permanent_except_same:false,type:"",isChild:false,remoteContent:null,maintainCrPageServlet:false,keepElementInDocument:false,requestMethod:"get",zIndex:1001,positionType:"absolute",draggable:false,draggingClass:"dragging",title:null,onscroll:null,noScroll:false,noScrollY:false,backdropClickClose:false,backdropColor:"#000",backdropOpacity:0.6,offsetRight:0,offsetLeft:0,offsetTop:0,offsetBottom:0,closeOnDocumentClick:false,track:false,positionByOffsets:false,useTransparentOverlayPadding:false,transparentOverlayPaddingValue:0},initialize:function(i,b){this.noScroll=i.noScroll||i.noScrollY;if(i.noScroll){this.overflowToHide="overflow"}else{if(i.noScrollY){this.overflowToHide="overflow-Y"}}if(this.noScroll){var a=i.onShow;i.onShow=function(){if(a){a()}ta.find("body").setStyle(this.overflowToHide,"hidden")};var h=i.onClose;i.onClose=function(){if(h){h()}ta.find("body").setStyle(this.overflowToHide,"")}}this.setOptions(i);this.source=ta.id(b);this.visible=false;this.backdropOn=false;this.closedByDocClick=false;var f=this.options.style+" overlay";if(this.options.backdrop==ta.overlays.BACKDROP_ALWAYS){f+=" withBackdrop"}else{f+=" noBackdrop"}this.container=new Element("div",{styles:{position:this.options.positionType,left:"-999em",top:"-999em",fontSize:this.options.fontSize||".75em",zIndex:this.options.zIndex},"class":f});if(i.blockSelect){this.container.onselectstart=function(){return false}}this.container.store("overlay",this);this.container.overlay=this;ta.store("overlays.current",this);this._useIframeShim=Browser.ie6;if(this.options.title){this.header=new Element("h1",{"class":"title",html:this.options.title}).inject(this.container);if(this.options.draggable){var g=this.options.draggingClass;var d=function(){};if(this._useIframeShim){d=this.positionShim.bind(this)}if(this.options.useTransparentOverlayPadding){d=this.transparentOverlayPadding.bind(this)}this.drag=new Drag(this.container,{handle:this.header,preventDefault:true,stopPropagation:true,onSnap:function(j){j.addClass(g)},onDrag:d,onComplete:function(j){j.removeClass(g)}})}}this.inner=new Element("div",{"class":this.options.innerDivClass}).inject(this.container);this.inner.id="overlayInnerDiv";var e=this;if(e.options.onscroll){e.inner.addEvent("scroll",function(){e.options.onscroll(e.inner)})}if(this._useIframeShim){this.shim=new IframeShim(this.container,{browsers:true})}if(this.options.useTransparentOverlayPadding){this.transparentOverlayPadding=new Element("div",{"class":"overlayPadding",styles:{position:"absolute","z-index":this.options.zIndex-1}});this.transparentOverlayPaddingValue=this.options.transparentOverlayPaddingValue}var c;if(this.options.content){this.inner.setContent(this.options.content)}else{if(this.options.remoteContent){this.loadRemoteContent(this.options.remoteContent)}else{if(this.source&&(c=this.source.getElement(".overlayContents"))){if(c){this.inner.set("html",c.innerHTML);c.dispose();this.runBehaviorOnFirstShow=true}}}}if(this.options.showCloseButton){this.addCloseButton()}else{if(this.options.setCloseButton){this.setCloseButton()}}if(this.options.showArrow){this.arrow=new Element("div",{styles:{position:"absolute"},"class":this.options.arrowClass}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}}if(this.options.noPadding){if(this.header){this.container.addClass("noPad")}else{this.inner.addClass("noPad")}}if(this.options.noCpu){if(this.header){this.container.addClass("no_cpu")}else{this.inner.addClass("no_cpu")}}this.container.addEvent("trash",this.destroy)},addCloseButton:function(){var a=this.options.closeButtonClass;if(ta.has("checkrates.add_holding_windows")){a+=" no_cpu"}this.closeBtn=new Element("div",{styles:{position:"absolute",fontSize:"92.5%",cursor:"pointer"},html:this.options.closeLink,"class":a,events:{click:(function(){this.fireEvent("onClose",this)}).bind(this)}}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}},setCloseButton:function(){if(this.options.closeButtonClass){this.closeBtn=this.container.getElement("."+this.options.closeButtonClass);if(this.closeBtn){this.closeBtn.addEvents({click:(function(){this.fireEvent("onClose",this);this.hide()}).bind(this)})}}},destroy:function(){this.container.overlay=null;if(this.shim){this.shim.destroy();this.shim=null}if(this.transparentOverlayPadding){this.transparentOverlayPadding.destroy();this.transparentOverlayPadding=null}},position:function(){if(this.shim){(function(){this.positionShim()}).delay(10,this)}if(this.transparentOverlayPadding){(function(){this.positionTransparentOverlayPadding()}).delay(10,this)}},positionTransparentOverlayPadding:function(){var b=this.container.getCoordinates();if(!b||!b.left){return}var a=this.transparentOverlayPaddingValue;this.transparentOverlayPadding.setStyles({left:b.left-a,top:b.top-a})},positionShim:function(){var a=this.container.getCoordinates();if(!a||!a.left){return}this.shim.shim.setStyles({left:a.left,top:a.top})},show:function(a){if(typeof(overlayCss)!="undefined"&&!ta.retrieve("ta.overlayCssAsset")){if(this.options.waitForCss){ta.store("ta.overlayCssAsset",ta.css(overlayCss,{onLoad:function(){this._show(a)}.bind(this)}))}else{ta.store("ta.overlayCssAsset",ta.css(overlayCss));this._show(a)}}else{this._show(a)}},_show:function(f){if(this.visible){return}if(f){new Event(f).preventDefault()}this.closedByDocClick=false;var a=ta.util.URL.parse(this.options.remoteContent);if(!this.options.maintainCrPageServlet&&typeof crPageServlet!=="undefined"&&a&&a.test(/\/{1}(\w*)$/)){ta.store("crPageServlet_orig",crPageServlet);crPageServlet=RegExp.$1}$$(".overlay").each(function(c){if(c.overlay){if(c.overlay==this){return}if(this.parentOverlay&&c.overlay==this.parentOverlay){return}if(c.overlay.options.permanent){return}if(c.overlay.options.permanent_except_same&&c.overlay.options.type!=this.options.type){return}c.overlay.hide(f)}},this);var d=ta.id(this.options.parentContainer||document.body);d.adopt(this.container);if(this.shim&&this.shim.shim){d.adopt(this.shim.shim);var e=this.container.getCoordinates();if(e){this.shim.shim.setStyles({display:"block",width:e.width,height:e.height})}}if(this.transparentOverlayPadding){d.adopt(this.transparentOverlayPadding);var e=this.container.getCoordinates();if(e){var b=this.transparentOverlayPaddingValue*2;this.transparentOverlayPadding.setStyles({display:"block",width:e.width+b,height:e.height+b})}}if(this.options.backdrop==ta.overlays.BACKDROP_ALWAYS){this.enableBackdrop()}this.position();if(this.options.closeOnDocumentClick){document.addEvent("click",this._hide.bind(this))}this.visible=true;this.fireEvent("onShow",this);window.fireEvent("onOverlayShow",this);if(ta.has("overlay.onShow")){ta.remove("overlay.onShow").each(function(c){c.call(this)},this)}return this},_setPosition:function(a){if(this.options.parentContainer){var c=Math.abs(this.container.getPosition().x-this.container.offsetLeft);var d=Math.abs(this.container.getPosition().y-this.container.offsetTop);var b={};if(a.left!==undefined){b.left=Math.abs(a.left-c)}if(a.top!==undefined){b.top=Math.abs(a.top-d)}if(a.bottom!==undefined){b.right=Math.abs(a.right-c)}if(a.right!==undefined){b.bottom=Math.abs(a.bottom-d)}this.container.setStyles(Object.merge(a,b))}else{this.container.setStyles(a)}},_hide:function(b){if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}if(!b||this.container.containsEvent(b)){return}if(this.options.pinnable==ta.overlays.PINNABLE_HOVER||this.options.pinnable==ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE){var a=b.target;while(a){if(a==this.source){return}else{a=a.parentElement}}}document.removeEvent("click",this._hide);this.hide(b)},hideByClickOnDocument:function(a){if(ta.retrieve("overlay.dontCloseOnClick")||this.options.dontCloseOnClick){return}this.closedByDocClick=true;this.hide(a)},hide:function(a){if(window.flyout){window.flyout.hide()}if(this.backdropOn){this.disableBackdrop()}if((this.options.keepElementInDocument&&this.container.style.left=="-999em")||(!this.options.keepElementInDocument&&!this.container.inDocument())){return this}if(this.shim){this.shim.hide().dispose()}if(this.transparentOverlayPadding){this.transparentOverlayPadding.hide().dispose()}this.container.setStyles({left:"-999em",top:"-999em"});if(!this.options.keepElementInDocument){this.container.dispose()}this.visible=false;this.fireEvent("onHide",!a);window.fireEvent("onOverlayClose",this);if(!this.options.maintainCrPageServlet&&ta.has("crPageServlet_orig")){ta.run("ta.meta.linkTracking.restoreCRPageServlet")}if(this.options.closeFunction&&typeof this.options.closeFunction==="function"){this.options.closeFunction(a)}if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}return this},calculateBackdropHeight:function(){return Math.max(window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),document.body.scrollHeight)},configureBackdrop:function(){var b={"class":"overlayBG"};var a;if(this.options.backdropZIndex==="behindOverlay"){a=this.options.zIndex-1}else{if(ta.retrieve("tablet_calendar_update.enabled")){b.events={click:function(d){this.fireEvent("backdropClick",d)}.bind(this)};if(document.getElement(".overlayBG")){this.options.backdropOpacity=0.01}var c=document.getElements(".overlay").length;a+=c*2}else{a=this.options.isChild?10000:9997}}this.backdrop=new Element("div",b);this.backdrop.setStyles({position:"fixed",left:0,top:0,width:"100%",height:this.calculateBackdropHeight(),backgroundColor:this.options.backdropColor,zIndex:a,opacity:this.options.backdropOpacity,filter:"alpha(opacity="+Math.floor(this.options.backdropOpacity*100)+")"});if(this.options.backdropClickClose){this.backdrop.addEvent("click",function(){this.fireEvent("onClose",this);this.hide()}.bind(this))}},updateBackdrop:function(){this.backdrop.setStyles({width:"100%",height:this.calculateBackdropHeight()})},enableBackdrop:function(){try{if(this.backdropOn){return}if(!this.backdrop){this.configureBackdrop()}if(Browser.ie6){var a=this.container;$$("select").each(function(d){if(!a.contains(d)){d.setStyle("visibility","hidden")}else{d.setStyle("visibility","visible")}})}ta.store("overlays.current",this);this.updateBackdrop();if(this.container.inDocument()){this.backdrop.inject(this.container,"before")}else{this.backdrop.inject(document.body)}this.backdropOn=true;if(this.options.backdropZIndex==="behindOverlay"){}else{if(ta.retrieve("tablet_calendar_update.enabled")){var b=document.getElements(".overlay").length;this.container.setStyle("z-index",parseInt(this.backdrop.getStyle("z-index"))+1)}else{this.container.setStyle("z-index",this.options.isChild?"10002":"9998")}}if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #424242")}else{this.container.setStyle("border","5px solid rgba(64,64,64,0.8)")}}}catch(c){ta.util.error.record(c,"Error setting the border property - enableBackdrop")}},disableBackdrop:function(){try{if(!this.backdropOn){return}this.backdrop.dispose();if(ta.retrieve("overlays.current")==this){ta.remove("overlays.current");if(Browser.ie6){$$("select").setStyle("visibility","visible")}}else{if(Browser.ie6&&ta.retrieve("overlays.current")&&!ta.retrieve("overlays.current").backdropOn){$$("select").setStyle("visibility","visible")}}this.backdropOn=false;this.container.setStyle("z-index","1001");if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #b2b2b2")}else{this.container.setStyle("border","5px solid rgba(128,128,128,0.6)")}}}catch(a){ta.util.error.record(a,"Error unsetting the border property - disableBackdrop")}},loadRemoteContent:function(c,a){var b={url:ta.util.URL.parse(c),method:this.options.requestMethod,data:this.options.requestData,onSuccess:this.loadRemoteSuccess.bind(this),onFailure:this.loadRemoteFailure.bind(this),evalScripts:true};this.options.track&&(b.trackEvent=this.options.track);if(!a&&!this.options.hideSpinner){new Asset.image(CDNHOST+"/img2/generic/site/loop.gif",{onload:this.position.bind(this),"class":"anim_loop"}).inject(this.inner)}new Request(b).send();return this},loadRemoteSuccess:function(b){if(typeof b==="string"){var a=document.head||ta.select("head")[0];b=b.replace(new RegExp("<style.*?>((.|\n)*?)</style.*?>","g"),function(c,d){var e=document.createElement("style");e.type="text/css";if(e.styleSheet){e.styleSheet.cssText=d}else{e.appendChild(document.createTextNode(d))}a.appendChild(e);return""})}this.cachedWidth=null;this.inner.setContent(b);this.position();if(typeof behavior!="undefined"&&behavior&&behavior.apply){behavior.apply(this.inner)}this.fireEvent("onLoad",this);this.cachedWidth=this.container.getSize().x;if(this.backdropOn){this.updateBackdrop()}return this},loadRemoteFailure:function(a){this.inner.addClass("ajax_failed");this.inner.setStyle("width","383px");this.inner.setStyle("padding","14px 24px 14px 14px");this.inner.set("text",JS_Ajax_failed);this.fireEvent("onLoadRemoteFailure",a)}});ta.overlays.getCurrent=function(){var a=$$(".overlay").shift();return a&&a.retrieve("overlay")};ta.overlays.safeCloseCurrent=function(){var a=ta.overlays.getCurrent();return a&&a.hide()};ta.overlays.safeCloseFromDom=function(c){c=ta.id(c);var a=c&&c.getParent(".overlay");var b=a&&a.retrieve("overlay");return b&&b.hide()};ta.overlays.AbsoluteOverlay=new Class({Extends:ta.overlays.Overlay,options:{xOffset:0,yOffset:0,toWindow:true,repositionOnScroll:false,autoShow:true,stayOpen:false,hideOnDocumentClick:false},initialize:function(a,b){a=a||{};a.showCloseButton=[a.showCloseButton,true].pick();this.parent(a,b);if(this.options.showCloseButton&&!this.options.stayOpen){this.closeBtn.addEvent("click",this.hide)}if(this.options.hideOnDocumentClick){document.addEvent("click",this.hideByClickOnDocument.bind(this))}if(this.options.autoShow){this.show()}},show:function(a){this.parent(a);if(this.options.repositionOnScroll){window.addEvent("scroll",this.delayedScroll.bind(this))}},hide:function(a){this.parent(a);if(this.options.repositionOnScroll){window.removeEvent("scroll",this.delayedScroll.bind(this))}if(this.options.hideOnDocumentClick){document.removeEvent("click",this.hideByClickOnDocument.bind(this))}},hideByClickOnDocument:function(d){if(!d||!d.page){return false}d=new Event(d);var c=d.page;var b=this.inner.getCoordinates();var a=c.y>=b.top&&c.y<=b.bottom&&c.x>=b.left&&c.x<=b.right;if(!a){this.parent(d)}},delayedScroll:function(){this.position.delay(500,this)},position:function(){this.container.setStyles({left:this.options.xOffset,top:this.options.yOffset+(this.options.toWindow?window.getScrollTop():0)});this.parent()}});ta.overlays.AbsoluteBottomOverlay=new Class({Extends:ta.overlays.Overlay,initialize:function(a,b){this.parent(Object.merge({positionType:"fixed"},a),b);if(this.options.showCloseButton&&!this.options.stayOpen){this.closeBtn.addEvent("click",this.hide)}thisOverlay=this;if(this.options.horizontalScroll){window.addEvent("scroll",function(){var c=window.getScroll().x*-1;thisOverlay.container.setStyle("left",(c))})}},position:function(){this.parent();this.reposition();this.flyIn()},reposition:function(){this.container.setStyles({top:null,left:null});if(!this.options.flyFromRight){if(this.options.horizontalScroll){leftValue=window.getScroll().x*-1}else{leftValue=window.getCoordinates().width/2-this.container.getWidth()/2}this.container.setStyles({bottom:0,left:leftValue})}else{this.container.setStyles({bottom:10,right:10})}},flyIn:function(){if(this.options.flyFromRight){this.container.setStyle("right",-window.getCoordinates().width)}else{this.container.setStyle("bottom",-this.container.getHeight())}var a=new Fx.Tween(this.container,{duration:"1000",transition:"quad:out"});if(this.options.flyFromRight){a.start("right",10)}else{a.start("bottom",0)}},show:function(a){this.parent(a);if(!this.options.flyFromRight){window.addEvent("resize",this.reposition.bind(this))}this.container.removeClass("overlay");this.reposition()}});ta.overlays.CenteredOverlay=new Class({Extends:ta.overlays.Overlay,Binds:["hideByClickOnDocument","position","hide","show"],options:{delayedPosition:false,autoShow:true,attachCloseEvent:true,xOffset:-1,yOffset:-1,absoluteOffset:false,fixed:false},initialize:function(b,c){b=b||{};b.showCloseButton=[b.showCloseButton,true].pick();b.fixed&&(this.options.positionType="fixed");this.parent(b,c);if(this.source){var a=this.source.getParentBySelector(".overlay");if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1);this.parentOverlay=a.overlay}}if(this.options.showCloseButton&&this.options.attachCloseEvent){this.closeBtn.addEvent("click",this.hide)}this.options.autoShow&&this.show()},position:function(d){var b=ta.retrieve("ta.overlays.CenteredOverlay.position.iters");if(!b){b=0}var f=this.container.getCoordinates();if(f.height<=14&&b<10){ta.store("ta.overlays.CenteredOverlay.position.iters",b+1);this.position.delay(100,this,true);return}var a=this.options.xOffset;var e=this.options.yOffset;if(a===-1){a=Math.max(5,(window.tabletOnFullSite?window.innerWidth:window.getWidth())-f.width)/2;!this.options.fixed&&(a+=window.getScrollLeft())}else{!this.options.absoluteOffset&&(a-=f.width/2)}if(e===-1){e=Math.max(20,(window.tabletOnFullSite?window.innerHeight:window.getHeight())-f.height)/2;!this.options.fixed&&(e+=window.getScrollTop())}else{!this.options.absoluteOffset&&(e-=f.height/2)}if(ta.util.i18n.isRtl()){this.container.setStyles({left:null,right:a,top:e})}else{this.container.setStyles({left:a,top:e})}this.parent()},positionShim:function(){var a=this.container.getCoordinates();if(!a||!a.left){return}this.shim.shim.setStyles({left:a.left,top:a.top,width:a.width,height:a.height})},positionTransparentOverlayPadding:function(){var d=this.container.getCoordinates();if(!d||((ta.util.i18n.isRtl()&&!d.right)||!d.left)){return}var b=this.transparentOverlayPaddingValue;var a=this.transparentOverlayPaddingValue*2;if(ta.util.i18n.isRtl()){this.transparentOverlayPadding.setStyles({left:null,right:d.right-b,top:d.top-b,width:d.width+a,height:d.height+a})}else{this.transparentOverlayPadding.setStyles({left:d.left-b,top:d.top-b,width:d.width+a,height:d.height+a})}}});ta.overlays.showInLightbox=function(a,b){return new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS},b)).loadRemoteSuccess(a)};ta.overlays.loadInLightbox=function(b,a){return new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS},a)).loadRemoteContent(b)};var lightbox={deactivate:function(){var a=ta.retrieve("overlays.current");a&&a.hide()}};ta.overlays.CouponOverlay=new Class({Extends:ta.overlays.CenteredOverlay,initialize:function(a,b){this.parent(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS,fixed:true,waitForCss:true,onClose:function(){ta.remove("suppressMetaFocus")}},a),b);this._opaqueBG=null;this._opaqueImg=null;if(Browser.name==="ie"){this._enableOpaqueBG()}window.addEvent("resize",this.position.bind(this))},hide:function(a){if(this._opaqueBG){this._opaqueBG.dispose();this._opaqueBG=null;this._opaqueImg=null}this.parent(a);return this},position:function(){this.parent();if(this._opaqueBG){var a=this.container.getCoordinates();this._opaqueBG.setStyles({top:Math.max(20,window.getHeight()-a.height)/2+window.getScrollTop(),left:Math.max(5,window.getWidth()-a.width)/2,width:a.width,height:a.height});this._opaqueImg.setStyles({width:a.width,height:a.height})}},_enableOpaqueBG:function(){if(this._opaqueBG){return}var a=this.options.isChild?9999:9996;this._opaqueBG=new Element("div",{"class":"printCouponBackground"});this._opaqueImg=new Element("img",{src:"/img2/generic/site/white_1x1.png"});var b=this.container.getCoordinates();this._opaqueBG.setStyles({top:Math.max(20,window.getHeight()-b.height)/2+window.getScrollTop(),left:Math.max(5,window.getWidth()-b.width)/2,width:b.width,height:b.height,zIndex:a,position:"fixed"});this._opaqueImg.setStyles({width:b.width,height:b.height});this._opaqueImg.inject(this._opaqueBG);if(this.container.inDocument()){this._opaqueBG.inject(this.container,"before")}else{this._opaqueBG.inject(document.body)}}});ta.overlays.showCouponInLightbox=function(b,d){var c=new ta.overlays.CouponOverlay(d);var a=c.loadRemoteSuccess(b);c.show();return a};ta.overlays.ACTIVATE_NEVER=0;ta.overlays.ACTIVATE_CLICK=1;ta.overlays.ACTIVATE_HOVER=2;ta.overlays.ACTIVATE_FOCUS=3;ta.overlays.ACTIVATE_HOVER_DELAY=4;ta.overlays.ACTIVATE_BOTH=5;ta.overlays.ACTIVATE_CLICK_ALTERNATE=6;ta.overlays.ACTIVATE_BOTH_DELAY=7;ta.overlays.ACTIVATE_CLICK_TOGGLE=8;ta.overlays.PINNABLE_NEVER=0;ta.overlays.PINNABLE_ALWAYS=1;ta.overlays.PINNABLE_CLICK=2;ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE=3;ta.overlays.PINNABLE_HOVER=4;ta.overlays.BACKDROP_PINNED=2;ta.overlays.RelativeOverlay=new Class({Extends:ta.overlays.Overlay,Binds:["overrideHoverDelayOnce","overridePinnableOption","_hide","show","hide","disable","destroy","hideNow","showWithDelay","hideWithDelay","_pin","prolongVisibility","showOrHide","_bothEnter","_bothEnterWithDelay","_bothClick"],options:{activate:ta.overlays.ACTIVATE_NEVER,pinnable:ta.overlays.PINNABLE_NEVER,activateHoverDelayTime:300,hoverDelayTime:250,pointArrowToSource:false,autoShow:true,ignoreFirstClickAfterHover:false,ignoreFirstClick:false,closeFunction:false,showFunction:false,closeButtonFunction:false},initialize:function(b,c){this.parent(b,c);this.debug_sticky=ta.retrieve("debug.stickyOverlays");this.container.addClass("relative");var a=this.source&&this.source.getParentBySelector(".overlay");if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1);this.parentOverlay=a.overlay}this.enabled=true;if(this.options.showCloseButton&&this.closeBtn){this.closeBtn.addEvent("click",(function(){try{if(this.options.closeButtonFunction&&typeof this.options.closeButtonFunction==="function"){this.options.closeButtonFunction()}}catch(f){}this.hideNow()}).bind(this));if(this.options.smartCloseButton){this.closeBtn.hide()}}switch(this.options.activate){case ta.overlays.ACTIVATE_CLICK:this.source.addEvent("click",this.show);break;case ta.overlays.ACTIVATE_CLICK_TOGGLE:this.source.addEvent("click",this.showOrHide);break;case ta.overlays.ACTIVATE_HOVER:this.source.addEvent("mouseenter",this.show);this.container.addEvent("mouseenter",this.show);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.addEvent("mouseenter",this.showWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);this.container.addEvent("mouseenter",this.show);this.container.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_FOCUS:this.source.addEvent("focus",this.show);break;case ta.overlays.ACTIVATE_CLICK_ALTERNATE:this.source.addEvent("mouseenter",this.prolongVisibility);this.container.addEvent("mouseenter",this.prolongVisibility);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this.showOrHide);break;case ta.overlays.ACTIVATE_BOTH:this.source.addEvent("mouseenter",this._bothEnter);this.container.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this._bothClick);this.ignoreNextClick=b.ignoreFirstClickAfterHover&&b.ignoreFirstClick;break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.addEvent("mouseenter",this._bothEnterWithDelay);this.container.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hideWithDelay);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this._bothClick);this.ignoreNextClick=b.ignoreFirstClickAfterHover&&b.ignoreFirstClick;break}switch(this.options.pinnable){case ta.overlays.PINNABLE_CLICK:case ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE:this.source.addEvent("click",this._pin);break}if(typeof this.options.remoteLink!="undefined"&&this.options.remoteLink!=null){this.loadRemoteContent(this.options.remoteLink)}else{if(this.source){var e=this.source.getElement(".overlaySrc");if(e){if(e.get("tag")=="a"){this.loadRemoteContent(e.href)}else{this.loadRemoteContent(e.get("text"));e.dispose()}}else{if(!this.options.content&&this.source.get("tag")=="a"){this.loadRemoteContent(this.source.href)}}}}var d=this.source&&ta.id(this.source.id+"_CONTENTS");if(d){this.inner.set("html",d.innerHTML);d.dispose();this.runBehaviorOnFirstShow=true}if(this.options.autoShow){this.show()}else{if(this.options.delayShow){this.showWithDelay()}}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},overrideHoverDelayOnce:function(a){this.overriddenHoverDelayTime=a},overridePinnableOption:function(a){if(a===true){this.source.addEvent("click",this._pin);this.container.addEvent("click",this._pin)}else{if(a===false){this.source.removeEvent("click",this._pin);this.container.removeEvent("click",this._pin);this.unpin()}}},show:function(b){b=b||window.event;if(b){new Event(b).stop()}if(!this.enabled){return}var a=this.visible;this.parent(b);clearTimeout(this.showTimeout);if((this.options.activate==ta.overlays.ACTIVATE_HOVER||this.options.activate==ta.overlays.ACTIVATE_HOVER_DELAY||this.options.activate==ta.overlays.ACTIVATE_BOTH||this.options.activate==ta.overlays.ACTIVATE_BOTH_DELAY)&&this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null}if(a){return}if(this.runBehaviorOnFirstShow){this.runBehaviorOnFirstShow=false;if(typeof behavior!="undefined"&&behavior&&behavior.apply){behavior.apply(this.inner)}}this.cachedWidth=this.container.getSize().x;switch(this.options.pinnable){case ta.overlays.PINNABLE_HOVER:this._pin();break}switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:case ta.overlays.ACTIVATE_HOVER_DELAY:break;case ta.overlays.ACTIVATE_CLICK:case ta.overlays.ACTIVATE_CLICK_TOGGLE:case ta.overlays.ACTIVATE_FOCUS:if(this.options.pinnable==ta.overlays.PINNABLE_NEVER){document.addEvent("click",this.hideByClickOnDocument.bind(this))}break}if(this.options.showFunction){this.options.showFunction()}return this},hide:function(c){if(this.debug_sticky){return this}c=c||window.event;if(!this.visible){return}if(window.flyout){window.flyout.hide()}if(c){var b=new Event(c);if(b.target&&b.target.tagName=="option"){return}if(Browser.ie&&b.target&&b.target.tagName=="select"&&this.container.getElements("select").contains(b.target)){return}}switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:case ta.overlays.ACTIVATE_HOVER_DELAY:case ta.overlays.ACTIVATE_CLICK_ALTERNATE:case ta.overlays.ACTIVATE_BOTH:case ta.overlays.ACTIVATE_BOTH_DELAY:if(!this.hideTimer){var a=this.options.hoverDelayTime;if(this.overriddenHoverDelayTime!==undefined){a=this.overriddenHoverDelayTime;delete this.overriddenHoverDelayTime}this.hideTimer=this.hide.delay(a,this);return}else{clearTimeout(this.hideTimer);this.hideTimer=null}break;case ta.overlays.ACTIVATE_CLICK:case ta.overlays.ACTIVATE_CLICK_TOGGLE:case ta.overlays.ACTIVATE_FOCUS:if(c&&this.container.containsEvent(c)){return}if(this.options.pinnable==ta.overlays.PINNABLE_NEVER){document.removeEvent("click",this.hide)}break}return this.hideNow()},hideNow:function(a){if(!this.visible){return this}if(this.backdropOn){this.disableBackdrop()}if(this.shim){this.shim.hide().dispose()}if(this.transparentOverlayPadding){this.transparentOverlayPadding.hide().dispose()}if(!this.options.positionByOffsets){this.container.setStyles({left:"-999em",top:"-999em"}).dispose()}else{this.container.dispose()}this.visible=false;if(this.options.pinnable==ta.overlays.PINNABLE_CLICK||this.options.pinnable==ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE||this.options.pinnable==ta.overlays.PINNABLE_HOVER){this.unpin()}this.fireEvent("onHide",!a);if(this.options.closeFunction){this.options.closeFunction()}return this},_pin:function(a){this.pin();this.toggleBackdrop(true)},pin:function(){this.source=ta.id(this.source);switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:this.source.removeEvent("mouseenter",this.show);this.source.removeEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_BOTH:this.source.removeEvent("mouseenter",this._bothEnter);this.source.removeEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.removeEvent("mouseenter",this.showWithDelay);this.source.removeEvent("mouseleave",this.hideWithDelay);break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.removeEvent("mouseenter",this._bothEnterWithDelay);this.source.removeEvent("mouseleave",this.hideWithDelay);break}this.container.removeEvent("mouseenter",this.show);this.container.removeEvent("mouseleave",this.hide);this.pinned=true;if(this.options.smartCloseButton&&this.closeBtn){this.closeBtn.show()}return this},toggleBackdrop:function(a){if(this.options.backdrop==ta.overlays.BACKDROP_PINNED){this.enableBackdrop()}},unpin:function(){this.source=ta.id(this.source);switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:this.source.addEvent("mouseenter",this.show);this.source.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_BOTH:this.source.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.addEvent("mouseenter",this.showWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.addEvent("mouseenter",this._bothEnterWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);break}this.container.addEvent("mouseenter",this.show);this.container.addEvent("mouseleave",this.hide);if(this.options.backdrop==ta.overlays.BACKDROP_PINNED){this.disableBackdrop()}this.pinned=false;if(this.options.smartCloseButton&&this.closeBtn){this.closeBtn.hide()}return this},showWithDelay:function(a){a=a||window.event;clearTimeout(this.showTimeout);if(this.visible){return this.show(a)}else{this.showTimeout=this.show.delay(this.options.activateHoverDelayTime,this)}},hideWithDelay:function(a){a=a||window.event;if(!this.visible){clearTimeout(this.showTimeout)}else{return this.hide(a)}},prolongVisibility:function(){if(this.visible&&this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null}},showOrHide:function(a){if(this.blockShowOrHide){return}if(this.visible){return this.hideNow(a)}else{return this.show(a)}},_bothEnter:function(a){this.ignoreNextClick=this.options.ignoreFirstClickAfterHover;return this.show(a)},_bothEnterWithDelay:function(a){this.ignoreNextClick=this.options.ignoreFirstClickAfterHover;return this.showWithDelay(a)},_bothClick:function(a){if(this.ignoreNextClick){a=a||window.event;if(a){new Event(a).stop()}this.ignoreNextClick=false;return this}else{return this.showOrHide(a)}}});ta.overlays.RelativeOverlayHorizontal=new Class({Extends:ta.overlays.RelativeOverlay,options:{arrowHeight:0,arrowLeftForce:0,arrowTopForce:0,allowRightArrowPos:false,allowBelowBottomEdge:false,mirrorIfRtl:false},initialize:function(a,b){if(a.onRight==null){if(IS_DEBUG){alert("ERROR: Attempting to create Horizontal Overlay without specifying direction.")}return}if(a.mirrorIfRtl&&ta.util.i18n.isRtl()){a.onRight=!a.onRight;if(a.offsetLeft){a.offsetRight=-a.offsetLeft;a.offsetLeft=0}else{if(a.offsetRight){a.offsetLeft=-a.offsetRight;a.offsetRight=0}}}this.parent(a,b)},position:function(){if(this.options.onRight){this.positionRight()}else{this.positionLeft()}this.parent()},adjustTop:function(f,i){try{this.source=ta.id(this.source);var k=f+this.options.offsetTop;if(!this.options.allowBelowBottomEdge){var g=window.getScrollTop()+window.getHeight();var j=document.getElementById("tamgFooter");if(j){if(j.offsetHeight){g=g-j.offsetHeight}else{if(j.clientHeight){g=g-j.clientHeight}}}if(k+i.height>=g){k=g-i.height-1;if((this.crDHTML_BASIC||this.crDHTML_PNG24)&&this.options.showArrow){var b=this.container.getElement(".check_availability");var d=this.container.getElement(".username");if(b||d){var a=b?b:d;var c=a.getCoordinates().height}k=g-i.height+c-9}}}return k}catch(h){ta.util.error.record(h,"adjustTop: RelativeOverlayHorizontal")}},positionLeft:function(){try{this.source=ta.id(this.source);var d=this.source.getCoordinates();var b=this.container.getStyle("margin-top").toInt();var a=ta.id("PAGE").getCoordinates();var h=this.container.getCoordinates();if(!this.flipped&&d.left-a.left-(this.cachedWidth||h.width)<0){this.flipped=true;this.options.onRight=true;if(this.arrow){this.arrow.className=this.options.arrowClassLeft}this.positionRight();return}if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){this.positionLeftOrRight(d,b,a,h,"left")}else{var f=this.adjustTop(d.top,h)-b;d.left=d.left-this.options.offsetLeft;this._setPosition({left:null,right:window.getWidth()-d.left+(this.options.xoffset||0),top:f});if(this.options.pointArrowToSource&&this.options.arrowHeight){this.setArrowPosition(d,b,a,h,"left",f)}}}catch(g){ta.util.error.record(g,"positionRight: RelativeOverlayHorizontal")}},positionRight:function(){try{this.source=ta.id(this.source);var d=this.source.getCoordinates();var b=this.container.getStyle("margin-top").toInt();var h=this.container.getStyle("margin-bottom").toInt();var a=ta.id("PAGE").getCoordinates();var i=this.container.getCoordinates();if(!this.flipped&&a.right-d.right-(this.cachedWidth||i.width)<0){this.flipped=true;this.options.onRight=false;if(this.arrow){this.arrow.className=this.options.arrowClassRight}this.positionLeft();return}d.right=d.right-this.options.offsetRight;if(ta.isDHTMLCRRedesign2012()&&(this.container.getElement(".check_availability")||this.container.getElement(".username"))){this.positionLeftOrRight(d,b,a,i,"right")}else{var f=this.adjustTop(d.top,i)-b;this.container.setStyles({right:null,left:d.right+(this.options.xoffset||0),top:f});if(this.options.pointArrowToSource&&this.options.arrowHeight){this.setArrowPosition(d,b+h,a,i,"right",f)}}}catch(g){ta.util.error.record(g,"positionRight: RelativeOverlayHorizontal")}},setArrowPosition:function(j,e,h,g,a,d){if(a==="left"){this.arrow.setStyle("left",this.options.arrowLeftForce);var i=(d<j.top?j.top-d:0);var b=Math.max(-1,i+(j.height/2).toInt()-(this.options.arrowHeight/2));var f=g.height-this.options.arrowHeight-e-3;this.arrow.setStyle("top",Math.min(b,f))}else{if((a==="right")&&(this.options.allowRightArrowPos)){if(this.options.arrowTopForce){this.arrow.setStyle("top",this.options.arrowTopForce)}else{if(this.options.arrowRightForce){this.arrow.setStyle("right",this.options.arrowRightForce)}var i=(d<j.top?j.top-d:0);var b=Math.max(-1,i+(j.height/2).toInt()-(this.options.arrowHeight/2));var f=g.height-this.options.arrowHeight-e-3;this.arrow.setStyle("top",Math.min(b,f))}}else{if(a==="right"){ta.util.error.record("setArrowPosition with dir === right is only supported with options.allowRightArrowPos set")}}}},positionLeftOrRight:function(q,l,y,x,r){try{var d=this.container.getElement(".check_availability");var g=this.container.getElement(".username");if(!ta.retrieve("isDaoDao")){var i=this.adjustTop(q.top,x)}else{var i=q.top}var v=d?d:g;var t=v.getCoordinates().height;var m=16;var k=i-t+m/2;var n=false;if(d){var f=window.getScrollTop();var h=ta.id("PERSISTENT_CHECK_RATES");if(h){f+=h.getCoordinates().height}if((i-0.5*x.height)<f){k=f;if((q.bottom-f)>32){k=f}else{if((q.bottom-f)<=32){k=q.bottom-32}}n=true}}var p=d?k:k+5;if(typeof(dhtml_cr_redesign_basic)!="undefined"&&!this.crDHTML_BASIC){this.crDHTML_BASIC=Asset.css(dhtml_cr_redesign_basic,{onLoad:function(){this.position()}.bind(this)})}if(typeof(dhtml_cr_redesign_png24)!="undefined"&&!this.crDHTML_PNG24){this.crDHTML_PNG24=Asset.css(dhtml_cr_redesign_png24,{onLoad:function(){this.position()}.bind(this)})}if(this.crDHTML_BASIC){var b=d?(q.right+13):(q.right-45);if(r=="left"){b=q.left+13}var a=-16}if(this.crDHTML_PNG24){var b=d?(q.right+20):(q.right-45);if(r=="left"){var b=window.getWidth()-q.left+20}var a=d?-21:-24}if(r=="left"){this._setPosition({right:b,left:null,top:p})}else{this._setPosition({right:null,left:b,top:p})}if(this.arrow){this.arrow.setStyle("display","block");var j=d?16:0;if(n){this.arrow.setStyle("top",(q.bottom-p-32))}else{this.arrow.setStyle("top",t-j)}if(r=="left"){this.arrow.setStyle("left",(x.width-13))}else{this.arrow.setStyle("left",a)}try{q=this.source.getCoordinates();x=this.container.getCoordinates();var u=window.getScrollTop()+window.getHeight();var o=q.top-x.top-m/2;var j=d?0:20;if(i+x.height>=u&&o>0){this.arrow.setStyle("top",o+j);if(q.bottom+m/2>=x.bottom){this.container.setStyle("top",p+m*2);this.arrow.setStyle("top",o-m*2+j)}}else{if(o<=0&&!n){this.container.setStyle("top",p-t+m)}}}catch(w){ta.util.error.record(w,"bottomEdge - Reposition arrow and container: RelativeOverlayHorizontal")}}}catch(w){ta.util.error.record(w,"positionLeftOrRight: RelativeOverlayHorizontal")}}});ta.overlays.RelativeOverlayRight=new Class({Extends:ta.overlays.RelativeOverlayHorizontal,initialize:function(a,b){this.parent(Object.merge({onRight:true},a),b)}});ta.overlays.RelativeOverlayLeft=new Class({Extends:ta.overlays.RelativeOverlayHorizontal,initialize:function(a,b){this.parent(Object.merge({onRight:false},a),b)}});ta.overlays.RelativeOverlayVertical=new Class({Extends:ta.overlays.RelativeOverlay,options:{flipPadding:0,allowFlip:true,arrowWidth:0},initialize:function(a,b){if(a.below==null){if(IS_DEBUG){alert("ERROR: Attempting to create Vertical Overlay without specifying direction.")}return}this.parent(a,b)},position:function(){this.options.below?this.positionBelow():this.positionAbove();this.parent()},positionBelow:function(){if(this.options.positionType=="fixed"){var p=this.source.getBoundingClientRect();var f=p.left;var q=p.bottom;if(this.options.positionAsPercent){f=(f/window.innerWidth*100)+"%";q=(q/window.innerHeight*100)+"%"}this._setPosition({left:f,top:q});return}var r=this.options.positionSource?this.options.positionSource.getCoordinates():this.source.getCoordinates();var m=this.container.getCoordinates();var n=this._styleValueToPixel(this.container.getStyle("margin-left"));var j=this._styleValueToPixel(this.container.getStyle("margin-right"));var d=this.container;var b;if(this.options.leftEdge){b=this.options.leftEdge}else{if(this.options.justify=="right"){b=r.left+r.width-m.width}else{b=this.options.centered?r.left+(r.width/2)-(m.width/2):r.left}}var k=window.getHeight()+window.getScrollTop();var i=r.bottom;if(this.options.offsetTop){i-=this.options.offsetTop}if(this.options.scrollContainer){i-=this.options.scrollContainer.scrollTop}if(this.options.allowFlip&&!this.flipped&&k-m.height-i<0&&r.top-m.height>0){this.options.below=false;this.flipped=true;d.addClass("relAbove").removeClass("relBelow");i=r.top-m.height-this.options.flipPadding;if(this.options.scrollContainer){i-=this.options.scrollContainer.scrollTop}}else{d.addClass("relBelow").removeClass("relAbove")}b-=this.options.offsetLeft;var e=this.adjustEdge(b-n,m.width);this._setPosition({left:e,top:i+(this.options.yoffset||0)});if(this.options.pointArrowToSource&&this.options.arrowWidth){var o=(e<r.left?r.left-e:0);var g=(r.width/2).toInt()-(this.options.arrowWidth/2);var h=o+g;var a=m.width-this.options.arrowWidth-n-j;this.arrow.setStyles({right:"",left:Math.min(h,a)})}},_styleValueToPixel:function(a){var b=a&&a.toInt();return !b?0:b},positionAbove:function(){var n=this.options.positionSource?this.options.positionSource.getCoordinates():this.source.getCoordinates();var j=this.container.getCoordinates();var k=this._styleValueToPixel(this.container.getStyle("margin-left"));var i=this._styleValueToPixel(this.container.getStyle("margin-right"));var d=this.container;var b;if(this.options.justify=="right"){b=n.left+n.width-j.width}else{b=this.options.centered?n.left+(n.width/2)-(j.width/2):n.left}var l=window.getScrollTop();var h=n.top-j.height-this.options.flipPadding;if(this.options.offsetTop){h-=this.options.offsetTop}if(this.options.scrollContainer){h-=this.options.scrollContainer.scrollTop}if(this.options.allowFlip&&!this.flipped&&h-l<0){this.options.below=true;this.flipped=true;d.addClass("relBelow").removeClass("relAbove");h=n.bottom;if(this.options.scrollContainer){h-=this.options.scrollContainer.scrollTop}}else{d.addClass("relAbove").removeClass("relBelow")}b-=this.options.offsetLeft;if(this.options.positionByOffsets){this._setPosition({position:this.options.positionType,top:this.options.offsetTop,right:this.options.offsetRight,bottom:this.options.offsetBottom,left:this.options.offsetLeft})}else{var e=this.adjustEdge(b-k,j.width);this._setPosition({left:e,top:h+(this.options.yoffset||0)});if(this.options.pointArrowToSource&&this.options.arrowWidth){var m=(e<n.left?n.left-e:0);var f=(n.width/2).toInt()-(this.options.arrowWidth/2);var g=m+f;var a=j.width-this.options.arrowWidth-k-i;this.arrow.setStyles({right:"",left:Math.min(g,a)})}}},adjustEdge:function(d,c){var a=ta.id("PAGE").getCoordinates();if(d+c>=a.right){var b=this._styleValueToPixel(this.container.getStyle("margin-right"));d=a.right-c-b-1}else{if(d<0){d=0}}return d},hideNow:function(a){this.parent(a);if(this.flipped){this.flipped=false;this.options.below=!this.options.below}}});ta.overlays.RelativeOverlayBelow=new Class({Extends:ta.overlays.RelativeOverlayVertical,initialize:function(a,b){this.parent(Object.merge({below:true},a),b)}});ta.overlays.RelativeOverlayAbove=new Class({Extends:ta.overlays.RelativeOverlayVertical,initialize:function(a,b){this.parent(Object.merge({below:false},a),b)}});ta.overlays.RelativeOverlayIn=(function(a){return new Class({Extends:a.overlays.RelativeOverlay,options:{xOffset:0,yOffset:0,center:false},initialize:function(b,c){this.parent(b,c)},position:function(){if(this.options.center){var d=this.source.getCoordinates();var e=this.container.getCoordinates();this._setPosition({left:d.left+(d.width/2)-(e.width/2)+this.options.xOffset,top:d.top+(d.height/2)-(e.height/2)+this.options.yOffset})}else{var b=this.source.getPosition();this._setPosition({left:b.x+this.options.xOffset,top:b.y+this.options.yOffset})}this.parent()}})}(ta));(function(){var b;function f(h){if(!h){return null}if(h.get("tag")=="a"){return h.href}var g=h.getElement("a");if(g){return g.href}g=h.getElement(".overlaySrc");if(g){return g.get("text")}return null}var e={left:ta.overlays.RelativeOverlayLeft,right:ta.overlays.RelativeOverlayRight,above:ta.overlays.RelativeOverlayAbove,below:ta.overlays.RelativeOverlayBelow};function d(n,q,j,r){if(q||window.event){new Event(q||window.event).preventDefault()}var p=n.hyphenate().split("-"),l=p.indexOf("h")>=0,i=p.indexOf("lb")>=0,g=p.indexOf("remote")>=0,o=p.indexOf("click")>=0,h=Object.merge({showCloseButton:true},r),m=null,k;switch(p.shift()){case"rel":m=e[p.shift().toLowerCase()];if(i){h.pinnable=ta.overlays.PINNABLE_ALWAYS}break;case"center":m=ta.overlays.CenteredOverlay;break}if(m===null){return null}if(l){h.activate=ta.overlays.ACTIVATE_HOVER}else{if(o){h.activate=ta.overlays.ACTIVATE_CLICK}}if(i){h.backdrop=ta.overlays.BACKDROP_ALWAYS}if(g){h.remoteContent=f(j)}k=new m(h,j);if(j){j.store("overlay",k)}return k}b=function(g){var m,q,j,l,n,o,h,k,i,p;m=g||window.event;if(!m){return}if(!m.origin||(0!==m.origin.indexOf("https"))||(-1===m.origin.indexOf("tripadvisor"))){return}if(!m.data||(-1===m.data.indexOf("action"))){return}try{q=JSON.parse(m.data)}catch(m){}j=q.hasOwnProperty("action")?q.action:null;if(!j){return}switch(j){case"successClose":ta.overlays.Factory.closeOverlayRegistration();k=ta.retrieve("overlay_registration_onsuccess");if(k&&"function"===typeof(k)){k();ta.remove("overlay_registration_onsuccess")}break;case"fwdToRegistration":l=q.hasOwnProperty("curUrl")?q.curUrl:null;n=q.hasOwnProperty("partnerKey")?q.partnerKey:null;o=q.hasOwnProperty("urlKey")?q.urlKey:null;h="/Register?product=MASTHEAD&flow=MASTHEAD&action=SIGNIN";if(l&&(0!==l.length)&&n&&(0!==n.length)&&o&&(0!==o.length)){h=h+"&url="+l+"&partnerKey="+n+"&urlKey="+o}window.location=ta.util.URL.https(h);break;case"resizeFrame":i=ta.id("overlayRegFrame");if(i){p=q.hasOwnProperty("height")?q.height:null;if(p){i.style.height=p+"px"}}break;default:return}};function a(){ta.store("member_gating_cta_shown",true)}function c(){return ta.retrieve("member_gating_cta_shown")}ta.overlays.Factory={_magic:d,relRightRemoteHLB:function(g,h){h=ta.id(h);if(h.get("tag")!="div"){h=h.getParent()}var i=f(h);if(i==null){return}new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:ta.overlays.BACKDROP_PINNED,style:"commerceOverlay rgba_flyout",showCloseButton:true},h)},relRightRemoteHLB_Commerce:function(i,g){if(i||window.event){new Event(i||window.event).preventDefault()}g=ta.id(g);var h=f(g);if(h==null){return}g.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},g)},relBelowRemoteHLB_Commerce:function(i,g){g=ta.id(g);if(i||window.event){new Event(i||window.event).preventDefault()}var h=f(g);if(h==null){return}g.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},g)},relBelowRemoteHLB_CommCopy:function(i,g){g=ta.id(g);if(i||window.event){new Event(i||window.event).preventDefault()}var h=f(g);if(h==null){return}g.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true,onLoad:function(){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},g)},relBelowS4Dg:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,style:"s4 dg",activate:ta.overlays.ACTIVATE_CLICK},g)},relBelowRGBA:function(k,h){if(k){k.stop()}var i="rgba_flyout";var j=true;var g="rgba_arrow";g=g+" rgba_arrow_png24";h.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:i,showArrow:j,arrowClass:g,showCloseButton:true},h)},relAboveH_Disclaimer:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,pointArrowToSource:true,centered:true,showArrow:true,style:"typeLD",arrowClass:"ldarrow",arrowWidth:15,flipPadding:5,waitForCss:true,fontSize:".7em"},g)},relBelow_Disclaimer:function(h,g){g=ta.id(g);h.stop();g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,pointArrowToSource:true,justify:"right",showArrow:true,style:"typeLD disclaimerBubbleOverlay",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relBelow_Disclaimer_left:function(h,g){g=ta.id(g);h.stop();g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,pointArrowToSource:true,justify:"left",showArrow:true,style:"typeLD disclaimerBubbleOverlay",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relAboveH_PriceSaverRibbon:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,showArrow:true,style:"typePS aboveRibbon",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relBelowH_PriceSaverRibbon:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,style:"typePS belowRibbon",yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relAboveH_PriceSaver:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,showArrow:true,style:"typePS",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relRight_SavingsAlert:function(i,h){h=ta.id(h);i.stop();h.onclick=null;var g={showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,showArrow:true,arrowClass:"arrow",style:"typeSA",waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(g,h)}else{new ta.overlays.RelativeOverlayRight(g,h)}},relRightH_SavingsAlert:function(k,h,j){h=ta.id(h);k.stop();h.onmouseover=null;var i="typeSA";if(j){i+=" ie8"}var g={showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,showArrow:true,arrowClass:"arrow",style:i,waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(g,h)}else{new ta.overlays.RelativeOverlayRight(g,h)}},relAboveH_SavingsAlert:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:false,style:"typeSA aboveRibbon",showArrow:true,arrowClass:"ldarrow",yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relBelowH_SavingsAlert:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:false,style:"typeSA belowRibbon",showArrow:true,arrowClass:"ldarrow",yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relRightH_AddCartInfo:function(i,h){h=ta.id(h);i.stop();h.onmouseover=null;var g={showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,showArrow:true,arrowClass:"arrow",style:"typeAC",waitForCss:true,fontSize:".8em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(g,h)}else{new ta.overlays.RelativeOverlayRight(g,h)}},relBelow:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relAbove:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relRight:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayRight({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relLeft:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayLeft({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relBelowH_Media:function(h,g){if(h){h.stop()}g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},g)},relAboveH_Media:function(h,g){if(h){h.stop()}g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},g)},relAboveH:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER},g)},relAboveTAMGFooter:function(i,g){g.onmouseover=null;var h=ta.id("PAGE");if(h){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"s3 vdg ovrFooter "+g.className},g)}},relRightH:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER},g)},relLeftH:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayLeft({activate:ta.overlays.ACTIVATE_HOVER},g)},imageLightbox:function(j,g){g.onclick=null;var h="<div><img src="+g.getAttribute("href")+"></div>";var i=new ta.overlays.CenteredOverlay({showCloseButton:true,backdrop:ta.overlays.BACKDROP_ALWAYS}).loadRemoteSuccess(h);g.addEvent("click",i.show)},pcbInterstitial:function(i,k){function g(){if(h.visible){ta.trackEventOnPage("pcb_campaign","booking_interstitial_in_view",k,null,true)}}function j(l){var m=l&&l.target;if(m&&m.hasClass("track_target_x")){ta.trackEventOnPage("pcb_campaign","booking_interstitial_exit_x",k,null,true)}else{if(m&&m.hasClass("track_target_ok")){ta.trackEventOnPage("pcb_campaign","booking_interstitial_exit_button",k,null,true)}else{ta.trackEventOnPage("pcb_campaign","booking_interstitial_exit_outside",k,null,true)}}}var h=new ta.overlays.CenteredOverlay({style:"ui_modal pcb",backdrop:ta.overlays.BACKDROP_ALWAYS,content:i,showCloseButton:true,closeOnDocumentClick:true,closeButtonClass:"xCloseGreen track_target_x",closeFunction:j});setTimeout(g,3000);ta.store("pcb_overlay",h)},microMetaOverlay:function(t,j,n,i,q,v,k,u){try{j.onmouseover=null;j.onclick=null;if(t){t.stop()}var g="";if(ta.meta&&ta.meta.update){g=ta.meta.update.buildUrl("MicroMetaAjax",n,true,false,"QC_Meta_Micro|Button")}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){g=dd.commerce.checkrates.getMicroMetaUrl(t,n)}else{ta.util.error.record(null,"microMetaOverlay : no meta js");return}}g+="&lowContentID="+i;if(k){g+="&xSellPlacement="+k}var p=j.className.match(/noDelayFirst/);var s=j.className.match(/delayOpen/);var o=ta.retrieve("delayedFirst");var h=!s||(p&&!o);var l="Above Fold Also Viewed";if(ta.id(j).getParent("#MMXS_LIST")){l="State Opt Also Viewed"}else{if(ta.id(j).getParent("#HORIZONTAL_CROSS_SELL_LIST")){l="HorizXSell"}else{if(ta.id(j).getParent("#hotel_flyout")){l="Scooter"}else{if(ta.id(j).getParent("#HSCS_ROW")){l="prodp13n_hr_similar_xsell"}else{if(window.mapDivId&&ta.id(j).getParent("#"+window.mapDivId)){l="Maps"}}}}}if(l=="Scooter"){g+="&from="+l}var w={activate:(v)?ta.overlays.ACTIVATE_CLICK:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:(v)?ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE:ta.overlays.PINNABLE_CLICK,backdrop:(v)?ta.overlays.BACKDROP_NEVER:ta.overlays.BACKDROP_PINNED,showCloseButton:!v,closeOnDocumentClick:v,positionByOffsets:false,positionType:"absolute",offsetTop:0,offsetRight:"",offsetBottom:"",offsetLeft:155};Object.merge(w,u);var m=new ta.overlays.RelativeOverlayBelow({style:"micro_meta_flyout gray",activate:w.activate,pinnable:w.pinnable,backdrop:w.backdrop,autoShow:h,delayShow:s,showCloseButton:w.showCloseButton,closeOnDocumentClick:w.closeOnDocumentClick,closeButtonClass:"roundOuterClose",onShow:function(){if(ta.util&&ta.util.element){ta.util.element.makeTextFitOneLine(".micro_meta_price_with_fee",true)}if(v){ta.trk("Meta_Micro_Providers_Displayed")}else{ta.trackEventOnPage("Meta_Micro_Providers_Displayed",l,q)}ta.overlays.Factory.logTrackingTree();if(w.onshow){w.onshow()}},onHide:w.onhide,positionByOffsets:w.positionByOffsets,positionType:w.positionType,offsetTop:w.offsetTop,offsetRight:w.offsetRight,offsetBottom:w.offsetBottom,offsetLeft:w.offsetLeft,trigger:j,onLoad:function(){window.fireEvent("MicroMetaHacComplete");if(w.onload){w.onload()}}},j);m.loadRemoteContent(g,false);ta.store("delayedFirst",true)}catch(r){ta.util.error.record(r,"micro meta overlay")}},microMetaExpandedSize:0,microMetaMore:function(l,m,h){try{var i=ta.id("micro_meta_remaining_"+m);if(!i){return}i.removeClass("hidden");function k(){var n=ta.id("micro_meta_more");if(!n){return}n.addClass("invisible")}if(h){k()}else{ta.meta.linkTracking.actionRecord("MICRO_META_EXPAND_MORE");if(i.getSize().y!=ta.overlays.Factory.microMetaExpandedSize){i.addClass("expanding");ta.overlays.Factory.microMetaExpandedSize=i.getSize().y;i.removeClass("expanding")}i.addClass("show");new Fx.Tween(i,{duration:"long",property:"height"}).start(0,ta.overlays.Factory.microMetaExpandedSize);window.setTimeout(k,1000);if(ta.retrieve("ibdm_impression_tracking")){var g=document.getElement(".micro_meta_first_block");if(g&&ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(g)){ta.trk("n_more_sites",false,g)}}}}catch(j){ta.util.error.record(j,"Micro meta expand failed.")}},isOverlayCreatedAlready:function(h,g){if(typeof g!="undefined"){var i=h.getElement(".overlaySrc");if(i){i.dispose();return false}else{return true}}return false},relRightRemoteHLB_optionalDelay_showArrow:function(s,q,w,v){try{q=ta.id(q);if(q.get("tag")!="div"){q=q.getParent()}var k=null;if(typeof w!="undefined"){k=w}if(null==k){k=f(q)}if(k==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();k=f(q)}if(k==null){return}var r=q.getElement(".overlaySrc");var u=k.match(/-d(\d+)\?/);if(u){u=u[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(s&&s.type=="mouseover"&&q){if(!q.hasClass("datedClickAdded")){q.addEvent("click",ta.overlays.Factory.relRightRemoteHLB_optionalDelay_showArrow.bind(this,null,q,k));q.addClass("datedClickAdded")}return}var n=ta.retrieve("scooterObj");if(n){n.slideOut()}if(u){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(u,q)}return}catch(A){ta.util.error.record(A,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(q,w)){return}var i=q.className.match(/noDelayFirst/),m=q.className.match(/delayOpen/),h=ta.retrieve("delayedFirst"),x=!m||(i&&!h),l="rgba_flyout",o=true,g="rgba_arrow",p="close",j;if(ta.has("hotels.redesignEnabled")&&(pageServlet==="Hotels"||pageServlet==="HACSearch")){l+=" gray";g="rgba_arrow_gray_lft_png24";p="roundOuterClose"}if(ta.has("daodao_noPop_single_cr_button")){l+=" no_cpu"}if(typeof(dhtml_cr_redesign_basic)!="undefined"&&!this.crDHTML_BASIC){this.crDHTML_BASIC=Asset.css(dhtml_cr_redesign_basic)}if(typeof(dhtml_cr_redesign_png24)!="undefined"&&!this.crDHTML_PNG24){this.crDHTML_PNG24=Asset.css(dhtml_cr_redesign_png24)}if(this.crDHTML_PNG24){j=g+" rgba_arrow_png24_right";g=g+" rgba_arrow_png24"}var y=ta.overlays.BACKDROP_PINNED;if(ta.has("daodao_ror_backdrop_type")){y=ta.retrieve("daodao_ror_backdrop_type")}var B=(m?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")){B=ta.overlays.ACTIVATE_CLICK}var t={};if(ta.meta&&ta.meta.update){t=ta.commerce.meta.getMetaParams()}var z=new ta.overlays.RelativeOverlayRight({activate:B,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:y,style:l,showArrow:o,arrowClass:g,arrowClassLeft:g,arrowClassRight:j,closeButtonClass:p,showCloseButton:true,autoShow:x,delayShow:!x,smartCloseButton:ta.isMetaHotels2013(),remoteLink:w,requestData:t,onLoad:function(){if(u&&v){var C=this.inner.getElementById("CHECK_RATE_FLYOUT");if(C){var D=C.get("onclick");C.set("onclick",v+";"+D)}}if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(z)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}ta.store("ta.hlb_el",q)},onHide:function(){ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}ta.store("ta.hlb_el",null)}},q);ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(q,z,r)}catch(A){ta.util.error.record(A,"relRightRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_helper:function(u,i,q,v){try{i=ta.id(i);if(i.get("tag")!="div"){i=i.getParent()}var j=null;if(typeof v!="undefined"){j=v}if(null==j){j=f(i)}if(j==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();j=f(i)}if(j==null){return}var t=i.getElement(".overlaySrc");var n=j.match(/-d(\d+)\?/);if(n){n=n[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(u&&u.type=="mouseover"){if(!i.hasClass("datedClickAdded")){i.addEvent("click",ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper.bind(this,null,i,q,j));i.addClass("datedClickAdded")}return}var h=ta.retrieve("scooterObj");if(h){h.slideOut()}if(n){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(n,i)}return}catch(r){ta.util.error.record(r,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(i,v)){return}var p=i.className.match(/noDelayFirst/);var s=i.className.match(/delayOpen/);var o=ta.retrieve("delayedFirst");var g=!s||(p&&!o);var l=ta.has("daodao_ror_backdrop_type")?ta.retrieve("daodao_ror_backdrop_type"):ta.overlays.BACKDROP_PINNED;var k=(s?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")){k=ta.overlays.ACTIVATE_CLICK}var m=new ta.overlays.RelativeOverlayLeft({activate:k,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:l,style:"rgba_flyout gray",showArrow:q,arrowClass:"rgba_arrow_gray_rgt_png24",arrowClassLeft:"rgba_arrow_gray_lft_png24",showCloseButton:true,closeButtonClass:"roundOuterClose",autoShow:g,delayShow:!g,smartCloseButton:ta.isMetaHotels2013(),remoteLink:v,onLoad:function(){if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){ta.store("overlay.lastElmt.className",i.className);if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(m)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}},onHide:function(){ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}}},i);ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(i,m,t)}catch(r){ta.util.error.record(r,"relLeftRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_showArrow:function(h,i,g){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(h,i,true,g)},hotelsMapCROverlay:function(h,i,g){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(h,i,false,g)},fbFriendOverlay:function(g){g.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,style:"s2 mg"},g)},albumsLB:function(q,i,n,g,h,k,o,j,m,p,l){ta.overlays.Factory.albumViewerOverlay(q,i,{detail:n,geo:g,filter:h,ff:k,albumId:o,evtDelegates:p,lbShowRac:l})},albumViewerOverlay:function(i,g,h){if(!h.geo||!h.detail){ta.util.error.record(null,"albumViewerOverlay missing required arguments",null,{geo:h.geo,detail:h.detail});return false}if(i||window.event){new Event(i||window.event).preventDefault()}if(ta.media&&ta.media.viewer){ta.media.viewer.load(h)}else{ta.util.error.record(null,"Missing ta.media.viewer for albumViewerOverlay")}return false},photosLB:function(g,k){try{if(g||window.event){new Event(g||window.event).preventDefault()}k=ta.id(k);if(k.get("tag")!="a"){if(k.hasClass("fkASDF")&&(k.get("tag")=="span"||k.get("tag")=="div"||k.get("tag")=="li")){k=ta.id(k)}else{k=k.getParent("a")}}var j="";if(k.className){j=k.className.match(/u_([^ ]*)/)[1]}else{if(k.href.match(/\/?LocationPhoto.*/)){j=k.href}}ta.overlays.Factory._mediaLBLoadAssets();var h="QC_Meta_Mini";if(ta.has("photo.viewer.jsAssetsLoaded")){j=j.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");j=j.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");j=j.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(j.match(/\?/)){j=j+"&small=true"}else{j=j+"?small=true"}}j=j+"&area="+h;var l=j;try{j=ta.commerce.meta.tracking.updateUrlWithTiming(j,h)}catch(m){ta.util.error.record(m,"problem updating url with timing in Factory.photosLB");j=l}if(ta.meta&&ta.meta.update&&window.pageServlet){j=j+"&metaReferer="+window.pageServlet}var i=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.photoLBHelper,k);i.loadRemoteContent(j);ta.store("photo.viewer.lightbox",i);ta.commerce.meta.tracking.resetTimingLockForNavArea(h)}else{ta.util.error.record(null,"photo gallery - no assets to load");ta.overlays.Factory.viewerFallback.delay(2000,this,[null,k])}}catch(m){ta.util.error.record(m,"photo gallery overlay",null,{photoUrl:j});ta.commerce.meta.tracking.resetTimingLockForNavArea(h)}return false},viewerFallback:function(h){var g=ta.remove("photo.viewer.lightbox");if(g){g.hide()}if(h&&h.href&&h.href.match(/LocationPhotos/)){window.location=h.href}else{return ta.servlet.Popup.photoGallery(null,h)}},photoLBCounter:1,photoLBHelper:function(h){var g=ta.retrieve("photo.viewer.initData");if(ta.overlays.Factory.photoLBCounter>16){ta.overlays.Factory.photoLBCounter=1;try{ta.overlays.Factory.viewerFallback.delay(2000,this,h)}catch(i){}return}if(!g||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.photoLBHelper.delay(500)}else{ta.overlays.Factory.photoLBCounter=1;if(ta.retrieve("ta.photos.viewer.initializeOnSecondTab")){ta.store("photo.viewer.secondaryView",true);ta.photos.viewer.photoViewerInit(ta.retrieve("photo.viewer.secondaryViewer.data"))}else{ta.photos.viewer.photoViewerInit(g)}}},mediaLBAutoOpen:function(h){try{ta.overlays.Factory._mediaLBLoadAssets();if(!ta.has("photo.viewer.jsAssetsLoaded")){ta.util.error.record(null,"auto-open media lightbox - no assets to load")}else{h=h.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");h=h.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");h=h.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(h.match(/\?/)){h=h+"&small=true"}else{h=h+"?small=true"}}var g=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.mediaLBAutoOpenHelper,h);g.loadRemoteContent(h);ta.store("photo.viewer.lightbox",g)}}catch(i){ta.util.error.record(i,"ta.overlays.factory.autoOpenMediaLB failed",null,{photoUrl:h})}return false},mediaLBAutoOpenHelper:function(i){var g=ta.retrieve("photo.viewer.initData");var h=16;if(ta.overlays.Factory.photoLBCounter>h){ta.overlays.Factory.photoLBCounter=1;ta.util.error.record(null,"ta.overlays.factory.autoOpenMediaLBHelper is giving up after "+h+" attempts.",null,{photoUrl:i});return}if(!g||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.mediaLBAutoOpenHelper.delay(500,this,i)}else{ta.overlays.Factory.photoLBCounter=1;ta.photos.viewer.photoViewerInit(g)}},_mediaLBLoadAssets:function(){if(!ta.has("photo.viewer.jsAssetsLoaded")&&typeof cssPhotoViewerAsset!="undefined"&&typeof jsPhotoViewerAsset!="undefined"){ta.store("photo.viewer.jsAssetsLoaded",true);Asset.css(cssPhotoViewerAsset,{media:"screen, print"});if(!ta.photos.viewer){Asset.javascript(jsPhotoViewerAsset)}if(typeof TALSO=="undefined"){Asset.javascript(jsPhotoViewerTALSOAsset)}if(typeof jsPhotosAsset!="undefined"&&!ta.servlet.Photos){Asset.javascript(jsPhotosAsset)}if(!ta.media.JWPlayer){Asset.javascript(jsJWPlayerHelperAsset)}}},_mediaLBCreateOverlay:function(h,j){var i={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg",backdropClickClose:true,onLoad:function(){this.position();if(h){h(j)}},onHide:function(){var k=ta.remove("photo.viewer.lightbox");if(k){k.hide()}ta.meta.linkTracking.restoreCRPageServlet();document.removeEvent("keydown",ta.remove("photo.viewer.keydownListener"));if(ta.retrieve("photo.viewer.refreshOnClose")){window.location=window.location}if(ta.has("translationOverlay")){ta.retrieve("translationOverlay").hide()}if(ta.retrieve("hotels.datesChanged")&&(ta.has("meta.mini_meta_on_accommodations")||(ta.retrieve("hotels.redesignEnabled")&&ta.isMetaHotelsRequest&&ta.isMetaHotelsRequest()))){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}else{if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.ajax.resetAjaxCall();ta.commerce.minimeta.ajax.send(false,true);ta.remove("hotels.datesChanged")}}ta.widgets.calendar.closeCalendarWidgets()},permanent:true};if(ta.retrieve("checkrates.meta_ui_post_click_prices")){i.onShow=function(){var k=ta.retrieve("meta.baseLocationId");if(k){ta.commerce.meta.updateProvAreaFromLightBox(k)}}}var g=new ta.overlays.CenteredOverlay(i);return g},AccDetail:function(m,j,g){if(m){m.stop()}j=j.getParent();var l=location.pathname;if(l.length>0){if(l.charAt(0)=="/"){l=l.substring(1)}var k=l.indexOf("-");if(k>=0){l=l.substring(0,k)}}var i=g;var h=function(){var n=ta.id("overlay_description").get("text");if(n.length>1000){ta.id("overlay_description").setStyle("height",210)}};if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.CoverOverlay({yOff:35,onLoad:h,style:"s3 dg rgba_gry",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showCloseButton:true,delayShow:true,requestData:{d:i,tab:"descript",from:l},remoteContent:"/LocationTab"},j);return false},memberOverlay:function(i,h,g){ta.overlays.Factory.memberOverlayWOffset(i,h,g,0,0);return false},memberOverlayWOffset:function(w,k,u,s,t){if(w){w.stop()}k.onclick=null;k.onmouseover=null;var r="";var g="";var o="";var p=false;var j=false;var h=true;var q="rgba_arrow_png24";if(k.id&&k.id!=""){var m=k.id.split("-");for(var n=0;n<m.length;n++){var l=m[n];if(l.match(/\bUID_([0-9A-F]+)\b/)){r=RegExp.$1}else{if(l.match(/\bSRC_(\d+)\b/)){g=RegExp.$1}else{if(l.match(/\bCATID_(\d+)\b/)){o=RegExp.$1}else{if(l.match("FUS")){p=true}else{if(l.match("PATT")){j=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(k)})}var v="";if(typeof(footprintGet)!="undefined"){v=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayRight({style:u||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:h,arrowClass:q,showCloseButton:true,autoShow:false,delayShow:true,offsetRight:t,offsetTop:s,remoteContent:"/MemberOverlay?uid="+r+"&c="+o+"&src="+g+"&fus="+p+"&partner="+j+"&LsoId="+v},k);return false},memberOverlayBelow:function(w,k,u,s,t){if(w){w.stop()}k.onclick=null;k.onmouseover=null;var r="";var g="";var o="";var p=false;var j=false;var h=true;var q="rgba_arrow_up_png24";if(k.id&&k.id!=""){var m=k.id.split("-");for(var n=0;n<m.length;n++){var l=m[n];if(l.match(/\bUID_([0-9A-F]+)\b/)){r=RegExp.$1}else{if(l.match(/\bSRC_(\d+)\b/)){g=RegExp.$1}else{if(l.match(/\bCATID_(\d+)\b/)){o=RegExp.$1}else{if(l.match("FUS")){p=true}else{if(l.match("PATT")){j=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(k)})}var v="";if(typeof(footprintGet)!="undefined"){v=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayBelow({style:u||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:h,arrowClass:q,allowFlip:false,showCloseButton:true,autoShow:false,delayShow:true,offsetRight:t,offsetTop:s,remoteContent:"/MemberOverlay?uid="+r+"&c="+o+"&src="+g+"&fus="+p+"&partner="+j+"&LsoId="+v},k);return false},dropdownMiniMetaOverlayHotel:function(g,i,o,k){var n="hotel_"+k;var j=ta.id(n);if(j){var l=j.getElement(".chevron");if(l){i=l}var m=j.getElement(".dropdownMiniMeta");if(m){m=m.clone();m.set("class","dropdownMiniMeta");var h={offsetLeft:260,trigger:i};if(ta.util.i18n.isRtl()){h={offsetLeft:4}}ta.store("meta.dropdownHotelsActive",n);ta.overlays.Factory.dropdownMiniMetaOverlay(g,i,o,m,h)}}},dropdownMiniMetaOverlayHotelReview:function(h,g,l,k){var m=document.getElement(".skv3 .dropdownMiniMeta");if(!m){m=document.getElement(".dropdownMiniMeta")}if(!m){ta.trackEventOnPage("LP_Chevron_Dropdown_No_Data","0");var j=document.getElement(".LowestPrice.minOffer");if(j){j.click();return false}}m=m.clone();m.set("class","dropdownMiniMeta");if(!k){k=22}var i={offsetLeft:k};ta.overlays.Factory.dropdownMiniMetaOverlay(h,g,l,m,i)},dropdownMiniMetaOverlay:function(h,g,j,k,i){if(dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}if(h){h.stop()}if(k){ta.overlays.Factory.createDropdownMiniMetaOverlay(h,g,j,k,i);ta.store("pcr.disabled",true);return true}return false},loadDropdownCSS:function(){if(window.dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}},createDropdownMiniMetaOverlay:function(g,k,o,n,i){var h="rgba_flyout gray dropdownMiniMeta";var m=true;var j=-5;switch(ta.commerce.meta.getNavAreaContextFromDom(k)){case"PCR":m=false;h+=" pcrLightBox";j=-45;break;case"Photo_Lightbox":m=false;h+=" photoAmenitiesLightBox";break;case"Amenities_Lightbox":m=false;break;default:h+=" miniMetaLightBox"}var l=0;if(i){if(i.offsetLeft){l=i.offsetLeft}if(i.offsetTop){j=i.offsetTop}}new ta.overlays.RelativeOverlayBelow(Object.merge(i,{style:h,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:m,showCloseButton:o,closeButtonClass:"roundOuterClose",arrowClass:"rgba_gray_arrow_up",offsetTop:j,offsetLeft:l,allowFlip:false,closeOnDocumentClick:true,content:n}),k)},createFacebookCTACallout:function(n,h,m,l,j,i){try{h.removePropertyEvent("mouseover","ta.overlays.Factory.createFacebookCTACallout")}catch(k){h.onmouseover=function(){}}var o=(Browser.ie7||Browser.ie8)?" ie78":"";var g={activate:ta.overlays.ACTIVATE_HOVER_DELAY,style:"s4 dg rgba_gry update2012 facebookCTAFlyout"+o,showArrow:true,centered:true,pointArrowToSource:true,showCloseButton:false,delayShow:true,innerDivClass:"inner",hoverDelayTime:0,noPadding:true,content:"<div class='onsite_cta_overlay_content'><b>"+m+"</b><br />"+j+"<br /><br /><b>"+l+"</b><br />"+i+"</div>"};new ta.overlays.RelativeOverlayBelow(g,h)},tcNavDetailOverlay:function(i,h,g){if(i){i.stop()}new ta.overlays.RelativeOverlayBelow({style:g||"typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:true,content:ta.id("INLINE_NAV_DETAIL").innerHTML},h);return false},amexHotSpotOverlay:function(l,k,g,h,j){if(l){l.stop()}var i;if(ta.has(j)){i=ta.retrieve(j);i.inner.setContent(ta.id(h).innerHTML);i.show()}else{i=new ta.overlays.RelativeOverlayBelow({style:g,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,content:ta.id(h).innerHTML},k);ta.store(j,i)}return false},amexSettingsOverlay:function(n,l,g,h,j,k,m){if(n){n.stop()}var i;if(ta.has(j)){i=ta.retrieve(j);i.inner.setContent(ta.id(h).innerHTML);i.show()}else{i=new ta.overlays.RelativeOverlayBelow({style:g,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,content:ta.id(h).innerHTML,offsetLeft:k,offsetTop:m,allowFlip:false},l);ta.store(j,i)}return false},menuBLimps:function(h,g){var l=$(h);if(l){if(!l.getAttribute("blimped")){var k=l.getChildren();if(k){for(var j=0;j<k.length;j++){var m=k[j].getAttribute("data-imp");if(m){ta.t4b.bl_imp_tracking.queueImpression(m,g)}}ta.t4b.bl_imp_tracking.flushImpressions();l.setAttribute("blimped",true)}}}},mcNavOverlay:function(o,h,n,m,g,p,k,j,l){var i;if(o){o.stop()}if(ta.has(g)){i=ta.retrieve(g);i.inner.setContent(ta.id(m).innerHTML);i.show()}else{if(!(ta.util.i18n.isRtl()^j)){i=new ta.overlays.RelativeOverlayLeft({style:n,activate:ta.overlays.ACTIVATE_BOTH,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,hoverDelayTime:250,content:ta.id(m).innerHTML,offsetLeft:-p,offsetTop:k,allowFlip:false,showFunction:function(){ta.overlays.Factory.menuBLimps(m,l)}},h);ta.store(g,i)}else{i=new ta.overlays.RelativeOverlayRight({style:n,activate:ta.overlays.ACTIVATE_BOTH,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,hoverDelayTime:250,content:ta.id(m).innerHTML,offsetRight:p,offsetTop:k,allowFlip:false,showFunction:function(){ta.overlays.Factory.menuBLimps(m,l)}},h);ta.store(g,i)}}return false},createPairedCalendar:function(i,h,g){return ta.overlays.createPairedCalendar(i,h,g)},createPairedCalendarGeo:function(){},_injectAd:function(g){if(ta.has("ads.gptEnabled")){return}var h=ta.id(g);try{if(h){injectAdsTargeted(h)}}catch(i){ta.util.error.record(i,"AlsoViewedLB: error injecting ad into elemId="+g)}},createDatedPairedCalendar:function(j,h,g){if(!g){g={}}if(j){new Event(j).preventDefault()}h=ta.id(h);var i=h.getParent("form");g.validate=true;g.overlayOptions={onShow:function(){ta.overlays.toggleOffSearchAll(i)}};new ta.overlays.PairedCalendar(h,g);ta.overlays.toggleOffSearchAll(i)},recordVRCrossSell:function(){try{var h=ta.id("VR_CROSS_SELL");if(h){var g=h.innerHTML.indexOf("setPID");var j=h.innerHTML.substr(g+7,5);new Request({url:"/ActionRecord?action=VR_CROSS_SELL_"+j}).send()}}catch(i){ta.util.error.record(i,"VR Cross Sell - ActionRecord failed")}},launchAVLBCompleteFn:function(h){ta.overlays.Factory._loadAVCSS();var g=function(){ta.overlays.Factory._injectAd("ALSO_VIEWED_AD")};var i=function(l){var j="alsoViewedTest avStandalone";if(ta.has("ta.avlb_hero_photos")){j="avlb_hero_photos"}var k;k=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:j,onShow:g.delay(100),onLoad:ta.overlays.Factory.recordVRCrossSell}).loadRemoteSuccess(l);var n=false;if(k.inner){var m=ta.id("emptyAlsoViewed");if(m){n=true}else{ta.store("alsoViewedLB",true)}}else{n=true}if(n){k.hide();ta.store("commerce.pwrOverlay",k)}if(ta.meta&&ta.meta.cr){ta.meta.cr.removePCR()}else{ta.commerce.checkrates.removePCR()}};new Request({url:h,onSuccess:i,evalScripts:true}).send()},_loadAVCSS:function(){if(typeof(avlbCss)!="undefined"&&!ta.retrieve("ta.avlbCss")){ta.store("ta.avlbCss",Asset.css(avlbCss))}if(typeof(avlbTestCss)!="undefined"&&!ta.retrieve("ta.avlbTestCss")){ta.store("ta.avlbTestCss",Asset.css(avlbTestCss))}if(typeof(VRCrossSellCss)!="undefined"&&!ta.retrieve("ta.VRCrossSellCss")){ta.store("ta.VRCrossSellCss",Asset.css(VRCrossSellCss))}if(typeof(avlb_hero_photos)!="undefined"&&!ta.retrieve("ta.avlb_hero_photos")){ta.store("ta.avlb_hero_photos",Asset.css(avlb_hero_photos))}},_loadChkMoreCSS:function(){ta.overlays.Factory._loadAVCSS();if(typeof(chkMoreCss)!="undefined"&&!ta.retrieve("ta.chkMoreCss")){ta.store("ta.chkMoreCss",Asset.css(chkMoreCss))}if(typeof(chkMoreSpritesCss)!="undefined"&&!ta.retrieve("ta.chkMoreSpriteCss")){ta.store("ta.chkMoreSpriteCss",Asset.css(chkMoreSpritesCss))}},loadGeoCrAutoBroadenOverlay:function(g,j){var i=ta.retrieve("gcrab.cssPath");if(i&&!ta.retrieve("gcrab.css")){ta.store("gcrab.css",Asset.css(i))}var h=new ta.overlays.CenteredOverlay({permanent:true,style:"gcrabLb",noPadding:true,absoluteOffset:true,yOffset:(Math.max(20,window.getHeight()-540)/2)+window.getScrollTop(),xOffset:Math.max(5,window.getWidth()-965)/2,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",content:'<div style="background-color:#EEE;"><img style="padding:150px;display:block;width:79px;margin:auto;" src="'+ta.util.imageServer("/img2/meta_sprites/loadingAnim.gif")+'"></div>',onClose:function(){ta.trackEventOnPage("MetaGeoLightBox","unload","CloseButton",0,false)}},g);ta.commerce.meta.loadGeoCrAutoBroadenContents(h,j)},loadCheckRatesLBOverlay:function(s,i,l){try{var o={};if(ta.meta&&ta.meta.update){o=ta.commerce.meta.getMetaParams()}var j=Object.merge({d:l.detail,s:crPageServlet,a:l.area},o);if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var m="QC_Meta_Mini|Photo_LB";var p;try{p=ta.commerce.meta.tracking.setTimingForNavArea(m);j.metaRequestTiming=p}catch(n){ta.util.error.record(n,"problem locking timing for QC_Meta_Mini|Photo_LB")}}var q="CalendarLightbox";if(l&&l.gaContext){q=l.gaContext}var g=ta.widgets.calendar.getCheckRatesData();if(g){j=Object.merge(j,g)}var r="s3 dg cr_lb_overlay lb_overlay_post_date_close";var h={backdrop:ta.overlays.BACKDROP_ALWAYS,style:r,requestData:j,remoteContent:"/CheckRatesLB",showCloseButton:true,permanent:true,onLoad:function(){if(!g){ta.overlays.Factory.loadDatePicker(s,this,l.detail,"_cro",ta.widgets.calendar.launchCRLBUpdate)}},onHide:function(){ta.remove("meta.prof_photo_lb.post_date_close.overlay")}};h.closeButtonClass="roundOuterClose";h.onClose=function(){ta.trackEventOnPage("CalendarLightbox","unload","CloseButton")};ta.store("meta.prof_photo_lb.post_date_close.overlay",new ta.overlays.CenteredOverlay(h,i));if(typeof(checkRatesLBCss)!="undefined"&&!ta.retrieve("ta.checkRatesLBCss")){ta.store("ta.checkRatesLBCss",Asset.css(checkRatesLBCss))}}catch(k){ta.util.error.record(k,"check rates leave behind")}},tryToHideCROverlayPostDatesClose:function(){var g=ta.retrieve("meta.prof_photo_lb.post_date_close.overlay");if(g){g.hide()}},tamgShowLightbox:function(i,h,j){var g="tripadvisor.com";if(typeof cookieDomain!="undefined"){g=cookieDomain.substring(1,cookieDomain.length)}new Asset.css(j);new Request({url:"/TAMGFooterAjax",onSuccess:function(k){ta.overlays.showInLightbox(k,{style:"s0 TAMG_All"})},data:{a:"SHOW_GROUP_OVERLAY",dom:g},evalScripts:true,method:"get"}).send()},currencyPickerPopup:function(j,h,g){if(j){j.stop()}h.onclick=null;var i="/StaticVelocityPage?t=currency_picker.vm";new Asset.css(globalCurrencyPickerCSS);if(ta.retrieve("currency_format_using_icu4j_cldr.featureEnabled")=="true"){new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:i,style:"global_currency_picker_overlay currency_format_using_icu4j_cldr dropMenu_refresh",onShow:function(){api.fireEvent(window,"mastheadFlyoutOpened")}},h)}else{new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:i,style:"global_currency_picker_overlay dropMenu_refresh",onShow:function(){api.fireEvent(window,"mastheadFlyoutOpened")}},h)}ta.trackEventOnPage("CurrencyPicker","Open",g);return false},intlPopup:function(j,h){if(j){j.stop()}h.onclick=null;flagsUrl=document.location.pathname;var i="/StaticVelocityPage?t=intSitesFly.vm&lt=evt&footerFlagFormat="+footerFlagFormat+"&flagsURL="+encodeURIComponent(flagsUrl);if(document.location.search!=""){i+=encodeURIComponent(document.location.search)}if(document.location.hash!=""){i+=encodeURIComponent(document.location.hash)}if(window.modelGeoId){i+="&geo="+modelGeoId}if(window.flagsSettings){for(var g=0;g<flagsSettings.length;g++){i+="&"+flagsSettings[g]+"=true"}}i+="&useHreflangs="+(ta.util.URL.getServletNameFromUrl(window.location.pathname)==="ShowTopic");if(window.pageFeature){i+="&pageFeature="+pageFeature}new Asset.css(flagsFlyoutCSS,{async:true,onLoad:function(){var k=ta.isFall2013MastheadRefresh()?"dropMenu_refresh":"typeO";var l=ta.overlays.ACTIVATE_CLICK;new Request({url:i,onSuccess:function(m){var n=new Element("div",{html:m});ta.overlays.Factory.fixFlagsFlyout(n);new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:l,content:n,style:k,onShow:function(){api.fireEvent(window,"mastheadFlyoutOpened")}},h)}}).send()}});return false},fixFlagsFlyout:function(h){if(ta.retrieve("flag_flyout_link_fixing.featureEnabled")=="true"){var g=h.getElements("a.flag_link");g.forEach(function(j){var l=document.getElement("link[hreflang="+(j.get("hreflang"))+"]");if(l!=null){var k=l.get("href");if(typeof(k)=="string"){j.href=k}else{j.parentNode.style.display="none"}}else{j.parentNode.style.display="none"}});var i=h.getElements("li.region");i.forEach(function(j){var k=j.getElements("li.flag_item");var l=j.style.display;j.style.display="none";k.forEach(function(m){if(m.style.display!="none"){j.style.display=l}})})}},showRecentLocationEmailOverlay:function(){setPID(3833);if(typeof(recentViewedCSS)!="undefined"&&!ta.retrieve("ta.recentViewedCssAsset")){ta.store("ta.recentViewedCssAsset",Asset.css(recentViewedCSS))}new Request({url:"/RecentlyViewedAjax",onSuccess:function(g){if(!g.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(g,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"share_overlay"},evalScripts:true,method:"get"}).send()},expandRecentlyViewed:function(){for(var g=4;g<7;g++){var j=ta.id("recently_viewed_"+g);if(j&&j.hasClass("hidden")){j.removeClass("hidden")}}var h=ta.id("RECENTLY_VIEWED_MORE");if(h){h.addClass("hidden")}},showRecentlyViewedCompareOverLay:function(){ta.util.cookie.setPIDCookie(4898);var h=window.location.protocol+"//"+window.location.hostname+"/CompareHotels?detail=",g=0,j;for(g=0;g<7;g++){j=ta.id("recently_viewed_"+g);if(j){h=h+j.get("locid");g+=1;break}}for(;g<7;g++){j=ta.id("recently_viewed_"+g);if(j){h=h+"&compareHotelId="+j.get("locid")}}if(typeof(compareHotelCSS)!="undefined"&&!ta.retrieve("ta.compareHotelCssAsset")){ta.store("ta.compareHotelCssAsset",Asset.css(compareHotelCSS))}new Request({url:h,onSuccess:function(i){new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"compareHotel",content:i})}}).send()},clearRecentLocations:function(){var h=ta.id("RECENTLY_VIEWED_LIST");if(h){var g=h.getNext(".bxDivider");h.dispose();if(g){g.dispose()}}new Request({url:"/RecentlyViewedAjax?a=clear"}).send()},removeParticularLocation:function(g,h,r){var k=ta.id("recently_viewed_"+r);if(k){var q=k.get("locid");k.dispose();new Request({url:"/RecentlyViewedAjax?a=remove&locID="+q}).send();for(;r<7;++r){k=ta.id("recently_viewed_"+r);if(k&&k.hasClass("hidden")){k.removeClass("hidden");break}}for(;r<7;++r){k=ta.id("recently_viewed_"+r);if(k&&k.hasClass("hidden")){return}}var l=ta.id("RECENTLY_VIEWED_MORE");if(l&&!l.hasClass("hidden")){l.addClass("hidden")}var p=$$("li.rv_item");var o=0;var j=false;if(p){o=p.length;for(var m=0;m<o;m++){if(!p[m].hasClass("geoItem")){j=true}}}if(!j){var n=ta.id("RV_SAVE");if(n){n.dispose()}}if(o===0){k=ta.id("RECENTLY_VIEWED_LIST");if(k){k.dispose()}}else{if(o===1){k=ta.id("COMPARE_HOTELS");if(k){k.getParent().addClass("hidden")}}}}},showSendMessage:function(m,h){var g;if(m){m.preventDefault()}if(h){h=ta.id(h)}if(h){if(ta.has("overlays.sendmessage.loading")){return}else{ta.store("overlays.sendmessage.loading",true);ta.remove.delay(500,null,"overlays.sendmessage.loading")}if(typeof(privateMsgCSS)!="undefined"&&!ta.retrieve("ta.privateMsgCssAsset")){ta.store("ta.privateMsgCssAsset",Asset.css(privateMsgCSS))}var i;if(h.get("tag")=="span"&&h.hasClass("fkASDF")){i=h.className.match(/u_([^ ]*)/)[1]}else{i=h.href}if(i){var j=ta.retrieve("overlays.sendmessage");if(j&&i.match(/notyou=1/)){window.location="/NewsletterSignOut-e__2F__MemberSignIn"}else{if(j){return}}var l=parseInt(g,10)==1?"cc":"cm";var n=l=="cm"&&typeof(footprintGet)!="undefined"?footprintGet():null;if(n){i+="&LsoId="+n}var o={popup:true,product:"SEND_MESSAGE"};g=h.get("id");if(g){o.successAction="ta.overlays.Factory.showSendMessage||"+g}if(ta.registration.register(o)){var k;if(h.hasClass("callback_ShowRecaptcha")){new Asset.javascript(window.location.protocol+"//www.google.com/recaptcha/api/js/recaptcha_ajax.js");k="callback_ShowRecaptcha"}ta.common.sendmessage.communityLightbox(i,k)}}}},showConnectOverlay:function(i,g,h,k,j){ta.overlays.registration.connect(h,k,j)},showLoginOverlay:function(i,h,j,k,g){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCssAsset")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}ta.overlays.registration.request(j,k,g)},showOverlayRegistration:function(h,i,p){var j,l,o,g,n,m;window.addEventListener("message",b,false);ta.on("metaFocusShow",ta.overlays.Factory.closeOverlayRegistration());ta.on("preMetaFocusShow",ta.overlays.Factory.closeOverlayRegistration());if(p&&p.hasOwnProperty("onSuccess")&&"function"===typeof(p.onSuccess)){ta.store("overlay_registration_onsuccess",p.onSuccess)}n={source:"OverlayRegistration",flow:p.flow,action:p.action,pid:p.pid,category:p.category,detail:p.locationId,geo:p.geoId,curUrl:p.curUrl};o=ta.util.URL.https("/Registration?"+Object.toQueryString(n));g=true;function k(){ta.store("ta.overlay.overlayRegistration",new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"wide",yoffset:320,showCloseButton:g,closeButtonClass:"xCloseGreen",noPadding:true,waitForCss:true,content:'<div id="overlayRegFrameWrap"></div>',onShow:function(){var r,q;r=ta.id("overlayRegFrameWrap");if(r){new Asset.image(CDNHOST+"/img2/generic/site/loop.gif",{onload:this.position.bind(this),style:"margin: 40px 0 40px 300px","class":"anim_loop"}).inject(r)}ta.trackEventOnPage(p.category,"show_overlay","",p.pid,false);ta.util.recordInterruption("gate",p.category);j=document.createElement("iframe");j.src=o;j.id="overlayRegFrame";j.className="overlayRegFrame";j.width="640";j.height="0";j.style.visibility="hidden";l=ta.id("overlayRegFrameWrap");if(!l){ta.util.error.record(null,"The registration iframe wrapper was missing.");return}l.appendChild(j);q=ta.id("overlayRegFrame");if(q){q.addEvent("load",function(){if(r&&r.getElement(".anim_loop")){r.getElement(".anim_loop").hide()}q.style.visibility="visible"})}},onClose:function(){ta.trackEventOnPage(p.category,"closed","",p.pid,false)},onHide:function(){ta.remove("ta.overlay.overlayRegistration")}}))}if(!c()){a();k()}else{m=ta.retrieve("overlay_registration_onsuccess");if(m&&"function"===typeof(m)){m();ta.remove("overlay_registration_onsuccess")}}},closeOverlayRegistration:function(){var g=ta.retrieve("ta.overlay.overlayRegistration");if(g){g.hide();ta.remove("ta.overlay.overlayRegistration")}ta.overlays.safeCloseCurrent()},_showTipsOverlay:function(k,j,n,h){try{var i;if(h){i="/AirlineTips?d="+modelLocId}else{i="/AccommodationTips?d="+modelLocId}if(n){i=i+"&filterLang="+n}var l=false;var g=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_NEVER,style:"s3 dg nopadding",permanent:true,zIndex:"9997",showCloseButton:true,remoteContent:i,onLoad:function(){if(g.inner){var o=ta.id("emptyTips");if(o){l=true}}else{l=true}if(l){g.hide()}}},j)}catch(m){ta.util.error.record(m,"showTipsOverlay")}},showAirlineTipsOverlay:function(h,g,i){ta.overlays.Factory._showTipsOverlay(h,g,i,true)},showRoomTipsOverlay:function(h,g,i){ta.overlays.Factory._showTipsOverlay(h,g,i,false)},_loadSummaryCss:function(){if(typeof(conceptsCss)!="undefined"&&!ta.retrieve("ta.conceptsCssAsset")){ta.store("ta.conceptsCssAsset",Asset.css(conceptsCss))}},showReviewSummary:function(m,j,l,h){if(l&&h){ta.overlays.Factory.showSummaryTranslation(m,j,l);return}var k=null;var i=null;var g=null;if(m){m.stop()}if(j.id&&j.id!=""){k=j.id.replace("concept_","").replace(/_/g," ");ta.store("topconcepts.lastconcept",k);g="/HotelSummary?d="+modelLocId+"&geo="+modelGeoId+"&concept="+k;if(l){g+="&autotrans=true"}}else{ta.util.error.record(null,"showReviewSummary - elmt.id check");return}ta.overlays.Factory._loadSummaryCss();i=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding",autoShow:false,permanent:true,showCloseButton:true,remoteContent:g,onLoad:function(){ta.store("topconcepts.overlay."+k,this);this.show()}},j);j.onclick=i.show;return false},showSummaryTranslation:function(n,j,m){ta.util.cookie.setPIDCookie(16007);if(n){n.stop()}var h="s3 dg nopadding";ta.overlays.Factory._loadSummaryCss();var l="/MachineTranslation?";var k;if(j.id&&j.id!=""){if(j.id.indexOf("trans_")!=-1){k=j.id.replace("trans_","").replace(/_/g," ")}else{k=j.id.replace("concept_","").replace(/_/g," ")}ta.store("topconcepts.lastconcept",k);l+="page=summary&";l+="d="+modelLocId+"&";l+="concept="+k;l+="&sl=en&tl="+m}var g="topconcepts.overlay."+k;var i=ta.retrieve(g);if(i){i.hide()}i=new ta.overlays.CenteredOverlay({style:h,showCloseButton:true,remoteContent:l,onLoad:function(){ta.store(g,this);this.show()}},j)},toggleConceptSnippetTranslation:function(o,j){var n=null;var l=null;var m=null;var k=null;var g=null;if(o){o.stop()}if(j){ta.util.cookie.setPIDCookie(4111);m=j.id.replace(/[^_]*_(.*)/,"$1");n=ta.id("SUMMARYOVERLAY_"+m);if(n){l=n.getElements(".snippetText");for(var h=0;h<l.length;h++){if(l[h].isDisplayed()){l[h].hide()}else{l[h].show("inline")}}}k=ta.id("trans_"+m);g=ta.id("en_"+m);if(k.hasClass("activeButton")){k.removeClass("activeButton");k.addClass("inactiveButton")}else{k.removeClass("inactiveButton");k.addClass("activeButton")}if(g.hasClass("activeButton")){g.removeClass("activeButton");g.addClass("inactiveButton")}else{g.removeClass("inactiveButton");g.addClass("activeButton")}if(ta.overlays.Factory.storeReviewSummaryContent){ta.overlays.Factory.storeReviewSummaryContent(m.replace(/_/g," "),n.getParent().get("html"))}}},confirmGetVerified:function(i,h,g){ta.load("travel-answers-unverified.js",null);ta.trackEventOnPage("answers_faq_owner_get_verified","answer_form_click",g);if(i){i.stop()}ta.load("travel-answers-unverified.js",null);new ta.overlays.CenteredOverlay({style:"typeO",isOverlay:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/AnswersAjax?act=sgv&detail="+g},h);return false},questionToolTip:function(i,h,g){if(i){i.stop()}if(ta.has("questionTTShown")){return false}ta.store("questionTTShown",true);new Request({url:"/AnswersAjax",data:{act:"sqtt"},onSuccess:function(j){if(j==="true"){h.onclick=null;h.onmouseover=null;var k={style:"s3 dg rgba_gry update2012",activate:ta.overlays.ACTIVATE_NEVER,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,allowRightArrowPos:true,pointArrowToSource:true,arrowHeight:32,arrowTopForce:40,arrowClass:"rgba_arrow_png24",showCloseButton:false,autoShow:false,delayShow:true,offsetRight:0,offsetTop:11,remoteContent:"/AnswersAjax?act=fqtt&geoId="+g};var l=new ta.overlays.RelativeOverlayRight(k,h);document.addEvent("click",l.hideByClickOnDocument.bind(l))}}}).send();return false},answersGuidelines:function(i,h,g){if(i){i.stop()}new ta.overlays.RelativeOverlayAbove({style:"typeO",isOverlay:true,showCloseButton:true,centered:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/AnswersAjax",requestData:{act:"sp",detail:g}},h);return false},questionForm:function(k,i,j,h){if(k){k.stop}if(!h){ta.util.error.record(new TypeError("pid required for questionForm overlay"),"Question and Answers - questionForm",null,null,"WARN")}ta.store("answers.pid.overlayType",h);var g=ta.overlays.getCurrent();if(g){g.hide()}new ta.overlays.CenteredOverlay({style:"answersOverlay verywide s7trans",closeButtonClass:"roundOuterClose",showCloseButton:true,remoteContent:"/AnswersAjax",requestData:{act:"saqo",lcid:j,altsessid:ta.retrieve("altsessid")||""},waitForCss:true,onLoad:function(){this.show()},onClose:function(){ta.remove("answers.pid.overlayType")}})},askReviewerIntercept:function(g,j,l,r,q,i,h,p,k){if(g){g.stop()}if(ta.registration.isAuthorized("SAVE_QUESTION")&&ta.registration.isAuthorized("SEND_MESSAGE")){ta.store("answers.pid.overlayType",k);new ta.overlays.CenteredOverlay({style:"answersOverlay verywide s7trans",closeButtonClass:"roundOuterClose",showCloseButton:true,remoteContent:"/AnswersAjax",requestData:{act:"ari",lcid:l,altsessid:ta.retrieve("altsessid")||"",screenname:r,reviewid:h,memberid:q,lang:i,subject:p},waitForCss:true,onLoad:function(){this.show()},onClose:function(){ta.remove("answers.messageTabLoaded");ta.remove("answers.pid.overlayType")}})}else{if(!j){ta.registration.getSuccessActionCookie();return false}var n=window.fullScreen||(window.screenTop===0&&window.screenY===0);if(ta.retrieve("registration_web_flow_answers")){var o={flow:"CORE_COMBINED",pid:k,userRequestedForce:true,onSuccess:function(){j.scrollIntoView();ta.overlays.Factory.askReviewerIntercept(null,null,l,r,q,i,h,p)}};ta.call("ta.registration.RegOverlay.show",g,j,o)}else{var m={popup:!n,product:"SAVE_QUESTION",successAction:["ta.overlays.Factory.askReviewerIntercept",null,null,l,r,q,i,h,p].join("|")}}ta.registration.register(m)}},showConfirmation:function(i){var g=ta.overlays.safeCloseCurrent();if(g){ta.store("confirmation.current",g)}var k=i.data;var j="answers."+k.type+".confirm";if(ta.has(j)){var h=ta.retrieve(j);h.onConfirm=i.onConfirm;h.onCancel=i.onCancel;h.show()}else{new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 dg confirmationPrompt medium",showCloseButton:false,remoteContent:"/AnswersAjax",requestData:k,onLoad:function(){var l=this;ta.retrieveOrStore(j,this);this.onConfirm=i.onConfirm;this.onCancel=i.onCancel;this.inner.getElement(".cancelBtn").addEvent("click",function(){if(l.onCancel&&typeof l.onCancel==="function"){l.onCancel()}ta.overlays.safeCloseFromDom(this);if(ta.has("confirmation.current")){ta.retrieve("confirmation.current").show();ta.remove("confirmation.current")}return false});this.inner.getElement(".confirmBtn").addEvent("click",function(){if(l.onConfirm&&typeof l.onConfirm==="function"){l.onConfirm()}ta.overlays.safeCloseFromDom(this);return true})},onHide:function(){this.onConfirm=null;this.onCancel=null}})}},reviewTranslate:function(l,j,h){ta.util.cookie.setPIDCookie(16009);ta.overlays.Factory._loadSummaryCss();var i=ta.has("photo.viewer.lightbox");var k=1001;if(i){k=10001}var g=new ta.overlays.CenteredOverlay({style:"dg cb_overlay withClose ui_modal flat_bottom",zIndex:k,noPadding:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"ui_close_x",centered:true,showCloseButton:true,remoteContent:h,onLoad:function(){this.show()}});ta.store("translationOverlay",g)},reviewTranslateEdit:function(j,h,i){var g=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"mtedit_overlay",fontSize:".9em",noPadding:true,showCloseButton:true,closeButtonClass:"roundOuterClose",remoteContent:"/MachineTranslationEdit?r="+i,onLoad:function(){try{var k=ta.id("mtedit_mt").getElements(".mtedit_text")[0];k.style.height=ta.id("mtedit_english").clientHeight+ta.id("mtedit_mt").offsetTop-k.offsetTop+"px"}catch(l){ta.util.error.record(l,"reviewTranslateEdit:onLoad")}}});ta.store("translationEditOverlay",g)},reviewTranslateEditGuidelines:function(h,g){new ta.overlays.RelativeOverlayAbove({content:g.getParent().getElement(".overlayContents").innerHTML,activate:ta.overlays.ACTIVATE_HOVER,style:"mtedit_guidelines_overlay"},g)},showRecentLocationSaveOverlay:function(){setPID(3832);if(typeof(recentViewedCSS)!="undefined"&&!ta.retrieve("ta.recentViewedCssAsset")){ta.store("ta.recentViewedCssAsset",Asset.css(recentViewedCSS))}new Request({url:"/RecentlyViewedAjax",onSuccess:function(g){if(!g.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(g,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"save_overlay"},evalScripts:true,method:"get"}).send()},createIPPinOverlay:function(h,j){var g;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 mg",onShow:function(){if(typeof(friendStripMouseoverPageAction)=="undefined"||!friendStripMouseoverPageAction){return}g=setTimeout(function(){new Request({url:"/ActionRecord?action="+friendStripMouseoverPageAction}).send();friendStripMouseoverPageAction=null},400)},onHide:function(){clearTimeout(g)},content:j},h)},createFriendActivityOverlay:function(h,j,k){var g;return new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 mg",onShow:function(){k&&ta.util.pending.lock("friendActivityOverlay.pageAction",function(){g=setTimeout(function(){new Request({url:"/ActionRecord?action="+k}).send()},400)})},onHide:function(){clearTimeout(g)},content:j},h)},createFriendActivityLightbox:function(g){return new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 mg friendActivity",content:g})},createCouponAnnouncementOverlayRedirect:function(h,m,g,o,l,i,j,n,k){ta.overlays.Factory.createCouponAnnouncementOverlay(null,null,h,m,g,o,l,i,j,n,k)},createCouponAnnouncementOverlay:function(h,k,l,s,i,u,r,o,n,t,q,j){ta.util.cookie.setPIDCookie(o);ta.css(r);var g={};g.act=l;if(n){g.act+="-"+n}else{if(window.pageServlet){g.act+="-"+pageServlet}}var p;if(q&&q!="false"){p="amex"}else{p="couponDetail"}ta.trackEventOnPage("SpecialOffer","click",window.pageServlet);var m="/CouponAjax?"+(s?"couponId="+s+"&":"")+(i?"announcementId="+i+"&":"")+(t?"locale="+t+"&":"")+(q?"isAmex="+q+"&":"")+(j?"showLocs="+j+"&":"")+"locationId="+u+"&listing=true";new Request({url:m,data:g,onSuccess:function(w){var v=ta.overlays.showCouponInLightbox(w,{closeButtonClass:"roundOuterClose",style:p,delayedPosition:true});v.closeBtn.addEvent("click",ta.servlet.blcoupons.closeHandler)},evalScripts:true}).send()},newCreateCouponAnnouncementOverlay:function(m,l,g,j,i){ta.util.cookie.setPIDCookie(j);ta.css(g);var h="couponDetail";var n=ta.id(i);var k=ta.overlays.showCouponInLightbox(n.innerHTML,{closeButtonClass:"roundOuterClose",style:h,delayedPosition:true});k.closeBtn.addEvent("click",ta.servlet.blcoupons.closeHandler)},postVideoLogin:function(h,g,i){if(i){ta.util.cookie.setPIDCookie(i)}ta.overlays.registration.connect({flow:"POST_VIDEO"},"SIGNIN")},fbLogin:function(){ta.support.Facebook.login()},createAmenitiesLightbox:function(i){var l=location.pathname;if(l.length>0){if(l.charAt(0)=="/"){l=l.substring(1)}var k=l.indexOf("-");if(k>=0){l=l.substring(0,k)}}var g=i.id,h;if(g.indexOf("amenity_")==0){h=g.substring(8)}var j=false;if(ta.remove("amenities.suppressLinks")){j=true}new ta.overlays.RelativeOverlayBelow({autoShow:true,style:"s3 dg",showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,requestData:{d:h,tab:"amenities",from:l,suppressLinks:j},remoteContent:"/LocationTab"},i)},createAmenitiesLightboxFull:function(s,h,l,i){var r,m;if(s){s.stop()}if(typeof(amenityLightboxCss)!="undefined"&&!ta.retrieve("ta.amenityLightboxCss")){ta.store("ta.amenityLightboxCss",Asset.css(amenityLightboxCss))}if(l&&l>0){setPID(l)}var k=h.id;if(k.indexOf("amenity_")==0){r=k.substring(8)}ta.setEvtCookie("HotelContactInfo","Amenities",r,1,"/LocationTab");var q={};if(ta.meta&&ta.meta.update){q=ta.commerce.meta.getMetaParams()}var o=Object.merge({d:r,tab:"amenities_lightbox",from:window.pageServlet},q);var g={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg",onLoad:function(){this.position();if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_amo")}else{ta.commerce.checkrates.updateCRForm("_amo")}if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("locationtab","#gpt-ad-728x90-locationtab",true)}else{injectAdsTargeted(ta.id("AMENITY_LIGHTBOX"))}var t=ta.id("AMENITY_LIGHTBOX");if(i){var u=ta.select(".amenities_balance")[0];var v=ta.select(t,".bottom_margin")[1];var x=ta.select(".amenitiesRDV1")[0];if(u&&v&&x){var w=x.cloneNode(true);u.insertBefore(w,v)}}this.position()},showCloseButton:true,permanent:!ta.has("isDaoDao"),requestData:o,remoteContent:"/LocationTab",maintainCrPageServlet:true,onClose:function(){ta.remove("meta.requestFromArea")}};if(ta.retrieve("checkrates.meta_ui_post_click_prices")){m="QC_Meta_Mini|Amenities_Lightbox";var p;try{p=ta.commerce.meta.tracking.setTimingForNavArea(m)}catch(n){ta.util.error.record(n,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}g.onShow=function(){var t=ta.retrieve("meta.baseLocationId");if(t){try{ta.commerce.meta.tracking.setTimingForNavArea(m)}catch(u){ta.util.error.record(u,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}ta.commerce.meta.updateProvAreaFromLightBox(t)}};if(p){g.requestData=Object.merge(g.requestData,{area:m,metaRequestTiming:p})}else{g.requestData=Object.merge(g.requestData,{area:m})}}var j=new ta.overlays.CenteredOverlay(g,h);j.show();h.onclick=function(){j.show();if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("locationtab","#gpt-ad-728x90-locationtab",true)}else{ta.common.ads.injectAdsTargeted(ta.id("AMENITY_LIGHTBOX"))}if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_amo")}else{ta.commerce.checkrates.updateCRForm("_amo")}};ta.commerce.meta.tracking.resetTimingLockForNavArea(m);ta.store("ta.amenityLightboxOverlay",j);return false},iapFlyout:function(j,i,h){h.elmt=i;ta.store("iapFlyoutOptions",h);var g=i.get("id")+","+h.contentId+","+h.voteContentType;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapFlyoutHelper|"+g})){ta.overlays.Factory.iapFlyoutHelper(g)}},iapTooltip:function(h,g){new ta.overlays.RelativeOverlayAbove({style:"tooltip ttWhite",showArrow:true,arrowClass:"arrow arrowDown",reverseIfRtl:true,showCloseButton:false,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_NEVER,content:g.getElement(".ulBlueLinks").innerHTML,offsetTop:10,offsetLeft:80,activate:ta.overlays.ACTIVATE_HOVER,permanent:false,waitForCss:true},g.getElement(".reportTxt"))},rtrTooltip:function(h,g){new ta.overlays.RelativeOverlayAbove({style:"tooltip ttWhite",showArrow:true,arrowClass:"arrow arrowDown",reverseIfRtl:true,showCloseButton:false,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_NEVER,content:g.getElement(".ulBlueLinks").innerHTML,offsetTop:10,offsetLeft:140,activate:ta.overlays.ACTIVATE_HOVER,permanent:false,waitForCss:true},g.getElement(".respondTxt"))},clTooltip:function(h,g){new ta.overlays.RelativeOverlayRight({style:"tooltip ttWhite",showArrow:true,arrowClass:"arrow arrowLeft",reverseIfRtl:true,showCloseButton:false,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_NEVER,content:g.getElement(".ulBlueLinks").innerHTML,offsetTop:-20,offsetRight:-10,activate:ta.overlays.ACTIVATE_HOVER,permanent:false,waitForCss:true},g.getElement(".claimListingTxt"))},ownerFavTooltip:function(j,i,h){var g=new ta.overlays.RelativeOverlayRight({style:"tooltip ttWhite ownerFavTooltip",showArrow:true,arrowClass:"arrow "+(ta.util.i18n.isRtl()?"arrowRight":"arrowLeft"),arrowClassRight:"arrow "+(ta.util.i18n.isRtl()?"arrowLeft":"arrowRight"),showCloseButton:false,backdrop:ta.overlays.BACKDROP_NEVER,content:i.getElement(".tooltipTxt").innerHTML,pointArrowToSource:true,offsetTop:-30,offsetRight:-10,activate:h?ta.overlays.ACTIVATE_BOTH:ta.overlays.ACTIVATE_HOVER,closeOnDocumentClick:h,permanent:false,waitForCss:true},i);if(h){ta.id("PAGE").addEvent("click",g.hide)}},iapAlbumFlyout:function(j,i,h){h.elmt=i;ta.store("iapFlyoutOptions",h);var g=i.get("id")+","+h.contentId+","+h.voteContentType;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapAlbumFlyoutHelper|"+g})){ta.overlays.Factory.iapAlbumFlyoutHelper(g)}},iapAlbumFlyoutHelper:function(k,o){var j=k.split(",");var n=j[0];var g=parseInt(j[1],10);var i=j[2];var l=ta.retrieve("iapFlyout");if(l){l.hide()}var h=ta.id(n);if(h){if(o){window.scrollTo(0,h.getPosition().y)}var m=new ta.overlays.CenteredOverlay({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=reportIAP&step=START&contentId="+g+"&voteContentType="+i,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg iapFlyout"});ta.store("iapFlyout",m);m.container.style.zIndex=100001}},iapFlyoutHelper:function(k,o){var j=k.split(",");var n=j[0];var g=parseInt(j[1],10);var i=j[2];var l=ta.retrieve("iapFlyout");if(l){l.hide()}var h=ta.id(n);if(h){if(o){window.scrollTo(0,h.getPosition().y)}var m=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=reportIAP&step=START&contentId="+g+"&voteContentType="+i,style:"s3 dg iapFlyout"},h);ta.store("iapFlyout",m)}},iapOwnerFlyout:function(j,i,h){var g=i.get("id")+","+h.reviewid+","+h.isGeo+","+h.locationid;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapOwnerFlyoutHelper|"+g})){ta.overlays.Factory.iapOwnerFlyoutHelper(g)}},iapOwnerFlyoutHelper:function(j,o){var h=j.split(",");var m=h[0];var p=parseInt(h[1],10);var i=h[2];var n=parseInt(h[3],10);var k=ta.retrieve("iapOwnerFlyout");if(k){k.hide()}var g=ta.id(m);if(g){if(o){window.scrollTo(0,g.getPosition().y)}var l=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=explain&reason=21&reviewid="+p+"&isGeo="+i+"&locationid="+n,style:"s3 dg iapFlyout"},g);ta.store("iapOwnerFlyout",l)}},openSavesRegflow:function(){ta.widgets.Saves.openSavesRegflow()},openSavesHoverRegflow:function(){ta.widgets.Saves.openSavesHoverRegflow()},openMastheadRegflow:function(){ta.widgets.Saves.openMastheadRegflow()},createGuideOverlay:function(){ta.overlays.registration.connect({flow:"DESTINATION_GUIDE"},"SIGNUP")},createPostPhotosOverlay:function(){ta.overlays.registration.connect({flow:"POST_PHOTOS"},"SIGNUP")},relBelowOverlaySolidGreenBorder:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s3 dg"},g)},createDropDown:function(o,h,k){h=ta.id(h);h.onmouseover=null;var g=ta.isFall2013MastheadRefresh()?"dropMenu_refresh":"dropMenu";var l=ta.isFall2013MastheadRefresh()?"sprite-arrow_dropdown_wht_refresh_show":"sprite-arrow_dropdown_wht_show";var i,n,m=ta.id("HEAD");if(m){n=m.getStyle("z-index")||204}else{n=204}try{i=new ta.overlays.RelativeOverlayBelow({content:k,style:g,fontSize:"12px",zIndex:n,activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,noPadding:ta.isFall2013MastheadRefresh(),onShow:function(){h.addClass("tabLinkShown");h.addClass("arwLinkShown");h.getParent().addClass("tabItemShown");h.getElement("img").addClass(l)},onHide:function(){h.removeClass("tabLinkShown");h.removeClass("arwLinkShown");h.getParent().removeClass("tabItemShown");h.getElement("img").removeClass(l);var p=k.getElements(".text");Array.each(p,function(q){var r=q.retrieve("typeAhead");if(r){r.hideChoices()}})}},h)}catch(j){return}i.pinAndSetUnpin=function(){i.pin();document.addEvent("click",i.unpinAndSetPin)};i.unpinAndSetPin=function(p){p=new Event(p);if(!i.container.containsEvent(p)&&!p.target.hasClass("dropSelect")){i.hide();i.unpin();document.removeEvent("click",i.unpinAndSetPin);i.container.addEvent("click",i.pinAndSetUnpin)}};i.container.addEvent("click",function(p){i.pinAndSetUnpin(p)})},createEmptyOverlay:function(k,h,j){h=ta.id(h);var g="";if(j){g="typeO"}try{new ta.overlays.RelativeOverlayBelow({noPadding:true,style:g,activate:ta.overlays.ACTIVATE_HOVER},h)}catch(i){return}},popConditionsOverlay:function(){var g=ta.id("CONDITIONS");if(g){ta.overlays.showInLightbox(g.innerHTML)}},cancelCreateWARList:function(h){h.stopPropagation();var g=ta.retrieve("war.todolist.showOverlay");if(g){window.clearTimeout(g);ta.store("war.todolist.showOverlay",false)}},createWARToDoListOverlay:function(h){ta.trackEventOnPageOnce("WAR","GLOBAL_NAV_WAR_HOVER");var j=ta.id("WAR_TODO_LOADING");if(j){var i=h?{d:h}:{};var g=ta.id("WAR_NOTIFICATION_FLAG")||ta.id("NO_WAR_NOTIFICATION_FLAG");j.removeClass("hidden");new Request({url:"/UserReviewToDoListAjax",data:i,method:"get",onSuccess:function(n){var m=new Element("div",{html:n});var k=m.getElement("#WAR_NOTIFICATION_FLAG_NEW");var o=m.getElement("#WAR_MORE_TO_DO_ITEMS");if(o){o.replaces(j)}if(g){if(k){k.replaces(g);k.setProperty("id","WAR_NOTIFICATION_FLAG")}else{var l=m.getElement("#NO_WAR_NOTIFICATION_FLAG");if(l){g.dispose()}}}}}).send()}},showCompareOverLay:function(g,l,h){var k="/CompareHotels?detail="+h;for(var j=0;j<3;j++){var m=ta.id("compare_hotels_"+j);if(m&&m.checked==true){k=k+"&compareHotelId="+m.value}}new Asset.css(compareHotelCSS);new Request({url:k,onSuccess:function(i){new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"compareHotel",content:i})}}).send()},createNeighborhoodOverlay:function(l,j,g){if(ta.has("nbhdOverlay")){if(j){j.onclick=null}ta.retrieve("nbhdOverlay").show();return}var h=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,zIndex:"997",style:"nbhdOverlay typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,onShow:function(){if(g){ta.servlet.HACSearch.filter.update()}},onHide:function(){if(g){ta.servlet.HACSearch.filter.update()}}},"NEIGHBORHOOD_OVERLAY");var i=h.inner;var k=ta.id("NEIGHBORHOOD_FORM");if(i&&k){k.inject(i,"top");k.removeClass("hidden");ta.store("neighborhoodOverlayForm",k)}ta.store("nbhdOverlay",h)},createHACProgressOverlay:function(){try{if(ta.has("ta.hac.progress.overlay")){return ta.retrieve("ta.hac.progress.overlay")}var j=ta.id("HAC_PROGRESS_CONTAINER").dispose();var g=j.get("html");var i=new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",showCloseButton:false,permanent:true,content:g});ta.store("ta.hac.progress.overlay",i);return i}catch(h){ta.util.error.record(h,"createHACProgressOverlay")}},getFilterWaitOverlay:function(){var h=ta.retrieve("filters.waitDialog");if(!h){var g="mg s1 fatNotice";if(ta.isHotelsRedesign2011()||ta.has("hotels.redesignEnabled")){g=g+" fatNotice_2011"}h=new ta.overlays.CenteredOverlay({style:g,showCloseButton:false,autoShow:false,delayedPosition:true});h.inner.set("html","<b>"+JS_UpdatingYourResults+"</b>");ta.store("filters.waitDialog",h)}return h},showFilterWaitOverlay:function(h){var g=ta.overlays.Factory.getFilterWaitOverlay();if(g){if(h){g.show();g.position(false)}else{g.hide()}}},showUpdatingMessage:function(){var h=ta.overlays.Factory.getFilterWaitOverlay();h.show();if(ta.remove("filter.map")){h.container.setStyles({left:-9999,top:-9999});var i=ta.id(ta.retrieve("maps.container")).getCoordinates();var g=h.container.getCoordinates();h.container.setStyles({left:i.left+(i.width-g.width)/2,top:i.top+(i.height-g.height)/2})}if(ta.remove("filter.lockout")){h.enableBackdrop()}},createIpDeauthOverlay:function(h,g){new Request({url:"/ActionRecordPlus?action=DEAUTH_IP&id="+h,onSuccess:function(i){new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:false}).loadRemoteSuccess(i);if(g){ta.support.Facebook.ipRevoke(10000)}},onFailure:ta.util.error.ajaxFailure.partial("partials:ip_disable")}).send()},createHotelStyleCategoryDescriptionOverlayAbove:function(j,h,g){var i=ta.id(g);h.onmouseover=null;if(i){new ta.overlays.RelativeOverlayRight({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,style:"ryokanOverlay",showArrow:true,pointArrowToSource:true,allowRightArrowPos:true,arrowHeight:29,arrowClass:"ryokanArrow",fontSize:".7em",offsetRight:-14,offsetTop:-10,waitForCss:true,content:new Element("div",{style:"width:300px; padding:12px;",html:i.getChildren()[0].get("html")})},h)}},updateAllGuestsRoomsButtons:function(){var i=ta.widgets.calendar.getGuestsRoomsPickerData(),h=$$(".roomsButton .grp-rooms-value"),g=$$(".guestsButton .grp-guests-value");if(h&&h.length>0){h.each(function(j){j.set("html",i.rooms)})}if(g&&g.length>0){g.each(function(j){j.set("html",i.guests)})}},kinderOverlay:function(j,h){try{h.onclick=null;var i={style:"s4 dg kinder",showCloseButton:true,isChild:true,activate:ta.overlays.ACTIVATE_CLICK};var g=document.getElement(".overlay");if(g){i.onShow=function(){var l=g.overlay;if(!l.pinned){l.unpinOnHide=true;l.pin()}},i.onHide=function(){var l=g.overlay;if(l.unpinOnHide){l.unpinOnHide=false;l.unpin()}}}new ta.overlays.RelativeOverlayBelow(i,h)}catch(k){ta.util.error.record(k,"Error: kinderOverlay")}},loadBLSlideshowOverlay:function(j,i,h,g){if(window.t4bSlideshowCSS&&!ta.retrieve("ta.t4bSlideshowCSS")){ta.store("ta.t4bSlideshowCSS",new Asset.css(t4bSlideshowCSS))}new Request({url:"/BusinessListingsAjax",onSuccess:function(k){ta.overlays.showInLightbox(k,{backdrop:ta.overlays.BACKDROP_ALWAYS,style:"g s10px np"})},data:{act:"slideshow",detail:h,pid:g,servletName:pageServlet,flash:(Browser.Plugins.Flash.version>=10)},evalScripts:true,method:"get"}).send()},showPartnerAttributionTip:function(i,g,h){new ta.overlays.RelativeOverlayBelow({showCloseButton:true,style:"s3 dg update2012 rgba_gry partner_attrib",content:h},g)},accountMenuFlyout:function(h,g){g.onclick=null;h.stop();ta.trackEventOnPage("TopNav","open","Signed_in_profile_dropdown");new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"dropMenu dropMenu_refresh accountMenuFlyout",noPadding:true,offsetTop:5,onShow:function(){ta.store("disableBehindAccountMenu",1);api.fireEvent(window,"mastheadFlyoutOpened")},onHide:function(){ta.remove("disableBehindAccountMenu")}},g)},messageMenuFlyout:function(i,g){if(i){i.stop()}try{new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"messageMenuOverlay",innerDivClass:"",content:ta.id("MESSAGE_MENU").innerHTML,offsetLeft:23,offsetTop:2,showCloseButton:false},g)}catch(h){ta.util.error.record(h,"Error: ta.overlays.Factor.messageMenuFlyout")}},ratingMenuFlyout:function(j,g){g.onmouseover=null;try{var i=new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"dropMenu ja_ratingMenuFlyout"},g);ta.store("ratingMenuFlyout",i)}catch(h){ta.util.error.record(h,"Error: ta.overlays.Factory.ratingMenuFlyout")}},bizListingsMenuFlyout:function(k,h){h.onmouseover=null;try{var i=h.getNext("div");if(i){i=i.get("html")}var g=ta.isFall2013MastheadRefresh()?"dropMenu dropMenu_refresh bizListingsMenuFlyout":"dropMenu bizListingsMenuFlyout";new ta.overlays.RelativeOverlayRight({content:i,zIndex:2000,style:g,offsetTop:ta.isFall2013MastheadRefresh()?-6:0,activate:ta.overlays.ACTIVATE_HOVER},h)}catch(j){ta.util.error.record(j,"Error: ta.overlays.Factory.bizListingsMenuFlyout")}},createDrop:function(j,g){g.onmouseover=null;try{var h=g.getNext().getElement(".subNav");ta.run("ta.overlays.Factory.createDropDown",{},j,g,h)}catch(i){ta.util.error.record(i,"Error: ta.overlays.Factory.createDrop")}},createFriendOfFriendOverlay:function(g,h){g.onclick=null;if(h){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_CLICK,style:"s2 mg",showCloseButton:true,content:h},g)}if(lazyImgs!=null){window.setupLazyLoad()}},CLOSE_BTN_RIGHT_OFFSET:15,ratingsFlyout:function(p,g,i,l){if(p){p.stop()}try{var k=g.get("class").match("rating(\\d)")[1];var m=ta.id("ratingsFlyout"+k).get("html");var o=null;var h="";if(i){o=ta.servlet.Reviews.ratingFlyoutScroll}var j="ratingOverlay dg s3 rgba_gry";if(l){h=" fixedHeight";j=j+" overlayWithScroll"}new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,content:m,innerDivClass:"ratingFlyout inner"+h,style:j,onscroll:o},g);new Request({url:"/ActionRecord?action=ratingsFlyout&pid=4304"}).send()}catch(n){ta.util.error.record(n,"showRatingsFlyout")}},getWhiteFlyout:function(o,i,l,m,h){if(o){o.stop()}if(!i||!l){return}var j="whiteFlyOut";var g=true;var k="flyout_white_arrow";var n="flyout_icon_close";new ta.overlays.RelativeOverlayRight({style:j,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:g,arrowClass:k,pointArrowToSource:true,showCloseButton:true,closeButtonClass:n,content:l,offsetRight:m,offsetLeft:-m,onRight:ta.util.i18n.isRtl()?false:true,offsetTop:h},i)},firstToReviewFlyout:function(m,g,l){try{var h=ta.id("locationId"+l);var i=h.getElement(".firstToReviewFlyout").innerHTML;var j=h.getElement(".propName");ta.overlays.Factory.getWhiteFlyout(m,j,i,-12,-20)}catch(k){ta.util.error.record(k,"ta.overlays.factory.firstToReviewFlyout")}},openTourismDescription:function(g){ta.servlet.Tourism.showGeoDescription(g)},memberPassportStampOverlay:function(i,g,h){if(!ta.has("passportStampsCSS")){ta.store("passportStampsCSS",new Asset.css(passportStampsCSS))}h.geos=h.geos.join(",");new ta.overlays.RelativeOverlayRight({style:"s3 dg rgba_gry memberPassportStamps",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,onLoad:function(){this.show()},remoteContent:"/MemberPassportStamps",requestData:h},g);ta.trackEventOnPage("Reviews","reviews_in_cities");new Request({url:"/ActionRecord?action="+h.actionRecord}).send()},relRightLocalContent:function(i,g,h){g.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 og",content:ta.id(h).innerHTML},g)},relRightLocalContentSimple:function(n,h,l,i,k){var m=true;var g="flyout_arrow";var j="flyout_icon_close";new ta.overlays.RelativeOverlayRight({pinnable:ta.overlays.PINNABLE_CLICK,noPadding:false,style:"s5",offsetRight:-8,innerDivClass:"balloon_holder",showArrow:m,arrowClass:g,arrowClassRight:g,showCloseButton:true,closeButtonClass:j,content:ta.id(l).innerHTML,onClose:function(){i(k)}},h)},centerLocalAddress:function(i,g,h){new ta.overlays.CenteredOverlay({style:"s3 dg help_center",showCloseButton:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,content:ta.id(h).innerHTML},g)},cookieSettingsPanel:function(j,g){if(j){j.stop()}if(g&&g.onclick){g.onclick=null}var h={};h.en=451;h.en_UK=834;h.en_IE=835;h.en_ZA=2635;h.sv=720;h.no=721;h.da=1199;h.fr=1197;h.fr_BE=6409;h.fr_CH=6410;h.de=1201;h.de_AT=2719;h.de_CH=6431;h.el=1198;h.it=1202;h.it_CH=6432;h.es=1200;h.pl=1208;h.nl=1209;h.nl_BE=6411;h.fi=2968;h.hu=3049;h.cs=3128;h.sk=3233;h["default"]=451;var i;if(posLocale in h){i="//info.evidon.com/pub_info/"+h[posLocale]+"?v=1&nt=0"}else{i="//info.evidon.com/pub_info/"+h["default"]+"?v=1&nt=0"}new ta.overlays.RelativeOverlayBelow({showCloseButton:true,noPadding:true,activate:ta.overlays.ACTIVATE_CLICK,content:new Element("iframe",{src:i,height:562,width:731,styles:{margin:"0"}})},g)},loadJFYHotelsFilter:function(s,z,q){if(s){s.stop()}var x=ta.retrieve("ta.p13n.filterOnHover");var K=ta.retrieve("ta.p13n.prodp13nIsTablet");if(typeof(x)!=="boolean"||typeof(K)!=="boolean"){return}function B(){var i;if(document.getElement(".horizontal_filters_wrap")){var P=document.getElement(".jfy_filter_bar_top");if(P){i=P.getElement(".options_size_limiter");if(i&&i.scrollHeight>95){var R=P.getElement(".resizer_footer.hidden");if(R){R.removeClass("hidden")}}}}else{if(q==="neighborhood"){ta.overlays.Factory.fixLocationFilterFooter()}else{i=$$(".jfy_filter_bar .jfy_filter_bar_"+q+"_inner");if(i.length>0&&i[0].scrollHeight>95){var Q=$$(".jfy_filter_bar .jfy_filter_"+q+"_footer.hidden");if(Q.length>0){Q[0].removeClass("hidden")}}}}}var u={};if(ta.retrieve("ta.p13n.jfyFilterSet")&&typeof ta.retrieve("ta.p13n.jfyFilterSet")==="object"){u=ta.retrieve("ta.p13n.jfyFilterSet")}var H=null;var N=(q==="price"&&!ta.widgets.calendar.hasPageDates()&&(pageServlet!="Restaurants"));var k;if(N){k=ta.retrieve("ta.p13n.priceFilterWithCalender.content");if(!k){k=$("jfy_filter_bar_price_predates");ta.store("ta.p13n.priceFilterWithCalender.content",k);k.parentNode.removeChild(k)}}else{k=ta.id("jfy_filter_bar_"+q)}if(!k){return}var y=undefined;var F=ta.id("EATERY_FILTERS_CONT");if(F||q!=="sort"){var m=document.createElement("div");m.className="jfy_filter_bar_top_arrow";y=document.createElement("div");y.className="jfy_filter_bar_top_spacer";y.insertBefore(m,null)}var A=document.createElement("div");var t="jfy_filter_bar jfy_filter_bar_"+q;A.className=t;var v=k.getElements(".all");if(v&&v.length>0){v.removeClass("hidden")}var L=k.getElements(".less");if(L&&L.length>0){L.removeClass("hidden");L.addClass("hidden")}var D=k.getElements(".sprite-tag_list_expand");if(D&&D.length>0){D.removeClass("hidden")}var p=k.getElements(".sprite-tag_list_compress");if(p&&p.length>0){p.removeClass("hidden");p.addClass("hidden")}if(q!=="price"&&q!=="hotel_class"){var O=k.getElementsByTagName("DIV")[0];O=ta.id(O);if(q==="neighborhood"){O=k.getElements(".jfy_filter_bar_neighborhood_inner")[0]}var o=false;var w=false;var n=[];var j=0;var I;if(O){var l=O.getElements(".jfy_tag_style");if(l){for(I=0;I<l.length;I++){if(l[I].hasClass("selected")){if(w){o=true;break}}else{w=true}}if(o){for(I=0;I<l.length;I++){if(l[I].hasClass("selected")){l[I].dispose();n[j]=l[I];j++}}for(I=n.length;I>0;I--){O.insertBefore(n[I-1],O.firstChild)}}}}}A.innerHTML=k.get("html");var C=document.createElement("div");if(y){C.insertBefore(y,null)}C.insertBefore(A,null);if(!u[q]){var J=ta.overlays.ACTIVATE_CLICK_ALTERNATE;var G=true;var M=1500;if(x){J=ta.overlays.ACTIVATE_BOTH_DELAY;if(!K){G=false;M=250}else{if(q==="sort"){G=false}}}var E=(q==="price")?ta.overlays.PINNABLE_CLICK:ta.overlays.PINNABLE_NEVER;var g=function(){B();if(q==="price"){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}else{if(q==="sort"){if(ta&&ta.p13n&&ta.p13n.wizard&&typeof(ta.p13n.wizard.justifyRightSortOption)=="function"){ta.p13n.wizard.justifyRightSortOption()}}}};var r=ta.retrieve("ta.p13n.header_placement_overlay_class")||"";var h="jfy_filter_bar_top dg jfy_filter_bar_top_"+q+" "+r;if(F){h=h+" restaurants_filter_overlay"}if(ta.retrieve("left_hotels_filters")){h=h+" left_hotels_filters"}H=new ta.overlays.RelativeOverlayBelow({pinnable:E,style:h,activate:J,showCloseButton:G,noPadding:true,content:C.innerHTML,centered:true,allowFlip:false,closeOnDocumentClick:true,activateHoverDelayTime:150,hoverDelayTime:M,autoShow:false,ignoreFirstClickAfterHover:x,ignoreFirstClick:x,onShow:g},z);H.adjustEdge=function(T,Q){var S=ta.id("JFY_hotel_filters")||ta.id("EATERY_FILTERS_CONT");if(S&&S.getCoordinates){var R=S.getCoordinates();var P=T;if(T<R.left){P=R.left}else{if(T+Q>=R.right){var i=this._styleValueToPixel(this.container.getStyle("margin-right"));P=R.right-Q-i-1}}var U=T-P;this.setJfyArrowOffset=function(){this.inner.getElements(".jfy_filter_bar_top_arrow").setStyle("left",U+"px")};this.setJfyArrowOffset();return P}};if(x){H.showWithDelay()}else{H.show()}u[q]=H}else{H=u[q];H.inner.innerHTML=C.innerHTML;H.container.removeClass("expanded");if(H.visible){B();H.setJfyArrowOffset()}if(N){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}H.enable()}if(K){ta.id("PAGE").addEvent("click",H.hide)}ta.store("ta.p13n.jfyFilterSet",u);if(!ta.retrieve("ta.p13n.filterOnHover")){ta.trk(q,false,s.target?s.target:s.srcElement)}},fixLocationFilterFooter:function(){var l=$$(".jfy_filter_bar .location_popular .jfy_filter_bar_neighborhood_inner");if(l.length>0&&l[0].scrollHeight>95){var i=$$(".jfy_filter_bar .location_popular .jfy_filter_neighborhood_footer.hidden");if(i.length>0){i[0].removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_popular .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}var j=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_bar_neighborhood_inner");if(j.length>0){if(j[0].scrollHeight>95){var h=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_neighborhood_footer.hidden");if(h.length>0){h.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_neighborhood .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(l.length>0){$$(".jfy_filter_bar .location_neighborhood").addClass("hidden")}}var g=$$(".jfy_filter_bar .location_attraction .jfy_filter_bar_neighborhood_inner");if(g.length>0){if(g[0].scrollHeight>95){var k=$$(".jfy_filter_bar .location_attraction .jfy_filter_neighborhood_footer.hidden");if(k.length>0){k.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_attraction .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(l.length>0&&j.length>0){$$(".jfy_filter_bar .location_attraction").addClass("hidden")}}},loadJFYFilterPulldown:function(j,h){if(!ta.retrieve("ta.p13n.jfyFilterPulldown")){var i="p13n_filter_pulldown";var g=new ta.overlays.RelativeOverlayBelow({content:ta.id(i).innerHTML,activate:ta.overlays.ACTIVATE_CLICK_ALTERNATE,closeOnDocumentClick:true,style:"",noPadding:true},h);ta.store("ta.p13n.jfyFilterPulldown",g)}},adjustJFYOverlayPositions:function(){var h=ta.retrieve("ta.p13n.jfyFilterSet");var g=Object.values(h||{});Object.each(g,function(i){if(i.visible){i.hideNow();i.show()}})},loadMetaHotelsFilter:function(j,g,h,i){ta.hac.filters.loadMetaHotelsFilter(j,g,h,i)},loadGuestsRoomsOverlay:function(k,i,j,l){var h=ta.retrieve("ta.overlay.guests_rooms_overlay");if(ta.has("guests_rooms_picker_3.enabled")){l.input=document.getElement(".calendar_wrapper .guests_rooms_picker_container")}else{l.input=document.getElement(".guests_rooms_picker_container")}l.findTargetFunction=function(m){if(ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")){return document.getElement(".date_picker_calendar.overlay .wrapper_header .roomsGuests")}else{if(m&&m.target){return ta.id(m.target).getParent(".roomsGuests")}}};var g={style:"date_picker_calendar guests_rooms_overlay",moreOptions:l};if(!h){h=new ta.overlays.GuestsRoomsOverlay(g,i);ta.store("ta.overlay.guests_rooms_overlay",h)}h.show(k)},updateMetaHotelsFiltersFromBreadcrumbs:function(j,h,g,i){ta.hac.filters.updateMetaHotelsFiltersFromBreadcrumbs(g,i)},closeAllActiveFilters:function(){ta.hac.filters.closeAllActiveFilters()},hideFilterOverlay:function(k,g,h){var i=ta.retrieve("ta.filters.overlaySet");if(i&&i[h]){var j=i[h];if(j.visible){j.hide()}}},simulateDatePickerClick:function(l,h,k,i,j,g){if(ta.retrieve("datepicker_autoadvance")&&document.getElement(".date_picker_calendar.overlay")){return false}ta.overlays.Factory.loadDatePicker(l,h,k,i,j,g);l.stopPropagation();l.preventDefault();return false},loadVRDatePicker:function(m,h,k,i,j,g){if(!g){g={}}var l=Object.merge({calendarOptions:{isVR:true}},g);ta.overlays.Factory.loadDatePicker(m,h,k,i,j,l)},loadDatePicker:function(q,h,j,g,l,r){if(!r){r={}}new Asset.image(CDNHOST+"/img2/generic/site/loading_anim_gry_sml.gif");if(ta.has("isHotelsLander")||ta.isMetaHomepageIntegration2013()||ta.has("widget.customHotel")||ta.has("isDaoDaoHomePageUnforkCalendar")){if(ta.has("isHotelsLander")||j==1||ta.has("isDaoDaoHomePageUnforkCalendar")){r=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end",postContent:function(){var s=Elements.from('<div id="SKIP_DATES"><span class="skip_dates_text"><span class="taLnk">'+ta.retrieve("multiDP.skipDates")+"</span></span></div>")[0];s.getElement(".taLnk").addEvent("click",function(){var u=ta.overlays.getCurrent(),v=u&&u.calendar;v&&v.clear();var t=ta.id("SUBMIT_HOTELS");if(t){t.focus()}ta.widgets.calendar.clearSessionDates(null,function(){if(ta.has("widget.customHotel")){ta.widget.hotels.changeDates()}});if(ta.has("isHotelsLander")){ta.overlays.Factory.trackSkipDatesEvent("Hotels_Lander","Calendar","Skip dates",0)}else{ta.overlays.Factory.trackSkipDatesEvent("Meta_Homepage","Calendar","Skip dates",0)}});return s},onSelect:function(t){if(!t.oneSelected){var s=ta.id("SUBMIT_HOTELS");s&&s.focus()}}}},r)}if(j==1&&ta.has("widget.customHotel")){r.calendarOptions=r.calendarOptions||{};r.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+ta.retrieve("multiDP.header")+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+ta.retrieve("multiDP.footer")+"</div>")[0]}if(j==1||j=="vr"){r.calendarOptions=r.calendarOptions||{};r.calendarOptions.submitOnEnter=ta.retrieve("widget.customHotel")?ta.widget.CustomHotelsWidget.validate:ta.pages.home.validate}}else{if(ta.retrieve("checkrates.meta_ui_sk_box_v3")){r=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end"}},r)}}h=ta.id(h);if((ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")&&!ta.has("hotels_left_filters_redesign"))&&h&&!h.getParent(".geoChkRates")&&(h.getParent(".jfy_header_dates_holder")||h.getParent(".filterControls")||h.getParent(".meta_chevron_module_2014")||h.getParent("#HotelDateSearch")||h.getParent(".HotelHighlight"))){try{ta.meta.update.clearDatesBumpedMessage();r.calendarOptions=r.calendarOptions||{};var n,k,i;if(ta.has("guests_rooms_picker_3.enabled")){k=ta.id(document.getElement(".guestsRoomsDatePickerHeaderForInject.hidden"));n=k?new Element("div").adopt(k.clone()).get("html"):""}k=ta.id(document.getElement(".showPricesForInject.hidden"));i=k?new Element("div").adopt(k.clone()).get("html"):"";r.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+n+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+i+"</div>")[0];r.calendarOptions.isGuestsRoomsCalendar=true}catch(m){ta.util.error.record(m,"error building content for guests rooms datepicker wrapper")}}if(!r.calendarOptions){r.calendarOptions={}}if(ta.has("calendar.default.postcontent")&&!r.calendarOptions.postContent){r.calendarOptions.postContent=ta.retrieve("calendar.default.postcontent")}if(r.calendarOptions.isholidayEnable){r.calendarOptions.holidaysOnCalendar=ta.retrieve("calendar.holidays")}r.calendarOptions.classicStyling=true;r.calendarOptions.flights=r.flights;r.calendarOptions.oneWayFlight=r.oneWayFlight;r.calendarOptions.multiCityFlight=r.multiCityFlight;if(r.oneWayFlight||r.multiCityFlight){r.calendarOptions.onSelect="ta.overlays.calendar.select";r.calendarOptions.oneWayStyling=true}if(r.flights){var p=new Date();p.setDate(p.getDate()+ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);r.calendarOptions.lastDate=p}window.fireEvent("onCalendarSelect",h);r.calendarOptions.onChangeDates=ta.widgets.calendar.onCalendarChangeDates;r.calendarOptions.onRangeSelect=ta.widgets.calendar.onCalendarRangeSelect;if(j=="vr"){var o=new Date();o.setMonth(o.getMonth()+18);o.setDate(1);r.calendarOptions.lastDate=o}ta.overlays.Factory.destroyAnimatedDateCTA();ta.overlays.Factory._loadAvailDateWidget(q,j,"calendar",g,l,r);if(ta.retrieve("load_date_picker_buttons")){return false}},destroyAnimatedDateCTA:function(){if(ta.isMetaHotels2013()||(ta.retrieve("hh_short_cell.enabled")&&ta.widgets.calendar.hasPageDates())){var g;if(ta.retrieve("animate_date_reformat")){g=ta.id("ANIMATED_DATE_CTA_REFORMAT")}else{g=ta.id("ANIMATED_DATE_CTA")}if(g){ta.servlet.HACSearch.destroyAnimatedDateCTA()}}},trackSkipDatesEvent:function(h,i,g,k){try{ta.trackEventOnPage(h,i,g,k,false)}catch(j){}},loadAdultsField:function(l,h,k,i,j,g){if(!g){g={}}if(!g.calendarOptions){g.calendarOptions={}}ta.overlays.Factory._loadAvailDateWidget(l,k,"adults",i,j,g)},_loadAvailDateWidget:function(o,i,h,g,k,p){var m="in",j,n;if(o){o=new Event(o)}if(o&&o.target&&ta.id(o.target).hasClass&&(ta.id(o.target).hasClass("out_date")||(ta.has("guests_rooms_picker_3.enabled")&&ta.id(o.target).hasClass("outDateTrigger")))){m="out"}p.calendarOptions.pickerOption=m;n=ta.widgets.calendar.getCalendarObjectKey(i,g,m);j=ta.retrieve(n);if(j&&j.calendar.positionElement&&ta.id(j.calendar.positionElement).getParent("#PAGE")){j.show(h)}else{try{j=new ta.commerce.AvailDataWidget(o,i,h,g,k,p)}catch(l){ta.util.error.record(l,"load availDateWidget init error")}}},onClickMetaCheckRatesOverlay_allProviders:function(j,h,i,g){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(i,g)},metaCheckRatesOverlay_allProviders:function(m,h){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&ta.id(h).getParents){var q=ta.id(h).getParents();q.each(function(r){if(r.hasClass("premium_offers_area")){if(ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(r)){ta.trk("n_more_sites",false,r)}}else{if(r.hasClass("metaPriceInfo")||(r.hasClass("illisting")&&ta.retrieve("servlet.smartdeals"))){if(ta.meta&&ta.meta.treeTrack){ta.meta.treeTrack.logTreeImpression();ta.trk("n_more_sites",false,r)}}}})}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").hide()}ta.remove("metaCheckRatesOverlay");if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var o=ta.retrieve("pcr.overlay");if(o&&o.visible){o.hide()}var g="";if(ta.meta&&ta.meta.update){g=ta.meta.update.buildUrl("MetaCheckRatesAjax",m,false)}else{g=ta.commerce.checkrates.buildMetaHacUrl_allProviders(m,false,"lb_allProviders",true)}var p="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){p+=" meta_lightbox_v3"}p+=" metaLightBoxChevron marketingTextLightBox";var j=window.location.hash==="#MAPVIEW"||(ta.id("map0Div")&&ta.id("map0Div").innerHTML!=="");if(j&&ta.retrieve("meta_lightbox_v3.enabled")){p+=" wide"}var k={style:p,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:g,onLoad:function(){var w=false,s,v;ta.store("isLightboxOpen",true);try{if(!ta.meta||!ta.meta.update){var t="meta_lb_checkrates";w=new ta.commerce.CheckRatesData({type:t,evnt:null},m,m,true);ta.store("ta.commerce.MetaHacOverlay.crData."+w.vendorSetId,w);v=w.getVendorSet().getAllVendorIds();s=w.getVendorSet().getCheckedVendor();ta.commerce.checkrates.updateMetaProviders(w)}var r=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(r&&!r.hasClass("no_cpu")){r.className+=" no_cpu"}if(this.inner){ta.fireEvent("refreshedDOMContent",this.inner)}}catch(u){ta.util.error.record(u,"meta all providers overlay load issue")}if(ta.meta&&ta.meta.update){ta.meta.update.overlayRequest(m)}else{ta.commerce.checkrates.metaHacRequest(w,v,s)}},evalScripts:true,onClose:function(){ta.store("isLightboxOpen",false);var x="meta_lightbox",w,t;x="meta_lightbox_chevron";ta.trackEventOnPage(x,"close","");if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var A=ta.retrieve("meta.baseLocationId");if(A&&m==A){if(ta.meta&&ta.meta.update){ta.meta.update.request(m)}else{if(t){ta.commerce.meta.updateProvAreaFromLightBox(t.vendorSetId)}}if(ta.has("metaCheckRatesUpdateDivInline")){ta.commerce.meta.updateInlineMeta(m)}}else{if(A){if(ta.has("ta.meta.navArea")){w=ta.retrieve("ta.meta.navArea")}var s=ta.id("MetaPricesTab");var u=false;if(s!=null&&s.hasClass("sprite-tab-active")){u=true}var C=ta.id("LOC_PHOTOS"),B=ta.id("AMENITY_LIGHTBOX"),r=false;if(C||B){r=true}var z=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(u){if(!r){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(A);z=true}else{try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(y){ta.util.error.record(y,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(y){ta.util.error.record(y,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(m)}else{t=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+A);if(t){ta.commerce.meta.miniMetaAjax(null,t,1000)}}z=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(A);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(y){ta.util.error.record(y,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(y){ta.util.error.record(y,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}}else{if(ta.meta&&ta.meta.update){ta.meta.update.request(A)}else{t=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+A);if(t!=null){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,t,1000);z=true}}}}if(!ta.meta||!ta.meta.update){t=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+A);if(t!=null&&!z){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,t,1000)}}ta.commerce.meta.updateNavArea(w)}}}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").destroy()}ta.remove("metaCheckRatesOverlay");ta.widgets.calendar.removeMetaCalendarFromSync(m);ta.widgets.calendar.closeCalendarWidgets();if(!ta.retrieve("meta.isDeals")&&(!ta.servlet.hotelsMap||!ta.servlet.hotelsMap.isMapOpen())){if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.doMetaDateSearch()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var v=document.getElements(".classicPrice");v.each(function(D){D.hide()})}}}};if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){k.absoluteOffset=true;if(ta.retrieve("tablet_maps_v1")&&(window.innerHeight>window.innerWidth)){var n=72;var i=ta.find(".flexCard");if(i){n=i.clientHeight+80}k.yOffset=n+window.getScrollTop()}else{k.yOffset=72+window.getScrollTop()}}k.trigger=h;var l=new ta.overlays.CenteredOverlay(k,null);ta.store("metaCheckRatesOverlay",l);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},metaCheckRatesOverlay:function(h,g,q,l){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();ta.store("metaCheckRatesOverlay",null);if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var n=ta.retrieve("pcr.overlay");if(n&&n.visible){n.hide()}var p="";if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}p=ta.meta.update.buildUrl("MetaCheckRatesAjax",ta.retrieve("ta.meta.request.locId"),false)}else{p=ta.commerce.checkrates.buildMetaHacUrl(h,g,q,false)}var o="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){o+=" meta_lightbox_v3"}o+=" metaLightBoxChevron";var i=window.location.hash==="#MAPVIEW"||(ta.id("map0Div")&&ta.id("map0Div").innerHTML!=="");if(i&&ta.retrieve("meta_lightbox_v3.enabled")){o+=" wide"}var j={style:o,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:p,onLoad:function(){if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.meta.update.overlayRequest(ta.retrieve("ta.meta.request.locId"))}else{ta.commerce.checkrates.updateMetaProviders(h);ta.commerce.checkrates.metaHacRequest(h,g,q)}var r=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(r){r.className+=" no_cpu"}},evalScripts:true,onClose:function(){var s=this.source&&this.source.getParent(".gcrabLb");var r="meta_lightbox_chevron";ta.trackEventOnPage(r,"close","");if(!s){ta.overlays.Factory.updateMiniMetaPlacements(h)}k.destroy();if(!s){ta.store("metaCheckRatesOverlay",null);if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.widgets.calendar.removeMetaCalendarFromSync(ta.retrieve("ta.meta.request.locId"))}else{ta.widgets.calendar.removeMetaCalendarFromSync(h.vendorSetId)}ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")&&!ta.id("LOC_PHOTOS")&&pageServlet!="SmartDeals"){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var t=document.getElements(".classicPrice");t.each(function(u){u.hide()})}}}};if(!j.trigger){var m=ta.retrieve("ta.hlb_el");if(m){j.trigger=m}}if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){j.absoluteOffset=true;j.yOffset=72+window.getScrollTop()}var k=new ta.overlays.CenteredOverlay(j,l);ta.store("metaCheckRatesOverlay",k);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},updateMiniMetaPlacements:function(j){var o=ta.retrieve("meta.baseLocationId"),l;if(!o&&ta.id("LOC_PHOTOS")){var s=ta.id("LOC_PHOTOS").getElement("#CHECK_RATE");if(s&&/id_(\d+)/.test(s.className)){o=RegExp.$1}}if(ta.has("ta.meta.navArea")){l=ta.retrieve("ta.meta.navArea")}if(o){var i=ta.id("MetaPricesTab");var k=false;if(i!=null&&i.hasClass("sprite-tab-active")){k=true}var t=ta.id("LOC_PHOTOS");var q=ta.id("AMENITY_LIGHTBOX");var h=ta.id("CHECK_RATES_LB");var g=false;if(t||q||h){g=true}var n=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(k){if(g){try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(m){ta.util.error.record(m,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(m){ta.util.error.record(m,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),o,"checkrates")}}n=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(o);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(m){ta.util.error.record(m,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(m){ta.util.error.record(m,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(o);n=true}}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),o,"checkrates")}}n=true}}}if((ta.retrieve("checkrates.meta_ui_post_click_prices")||t)&&ta.widgets.calendar.datesExist()&&!n){ta.commerce.meta.updateNavArea("QC_Meta_Mini");var p=document.getElementById("CHECK_RATE");if(!ta.retrieve("checkrates.meta_ui_post_click_prices")&&t){p=t.getElement("#CHECK_RATE");if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){var r=t.getParent(".overlay");if(r&&r.overlay){r.overlay.addEvent("onHide",function(){ta.commerce.minimeta.doMetaDateSearch()})}}}if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,p,o,"checkrates",true)}}}}else{if(j){ta.commerce.meta.updateInlineMeta(j.vendorSetId)}}ta.commerce.meta.updateNavArea(l)},createPersistentFilterOverlay:function(){var h=document.getElement(".filterControls");if(!h){return}var g={toWindow:false,autoShow:false,yOffset:-60,permanent:true,showCloseButton:false,style:"persistentFilterOverlay",positionType:"fixed",innerDivClass:h.className,onShow:function(){ta.util.element.moveContent(h,this.inner)},onHide:function(){ta.util.element.moveContent(this.inner,h)}};ta.store("persistentFiltersOverlay",new ta.overlays.AbsoluteOverlay(g));window.addEvent("scroll",ta.servlet.HACSearch.showPersistentFilters)},_recordLBOpen:function(){if(!ta.remove("skipLBGARecord")){var g=ta.remove("meta.lightboxOpener")||(ta.retrieve("meta.calendarCR")?"calendar":"button");var h="meta_lightbox_chevron";ta.trackEventOnPage(h,"open",g)}},createTAListingPolicyOverlay:function(h,g,j,i){var k=ta.id(j);if(k!=null){new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",backdrop:ta.overlays.BACKDROP_ALWAYS,content:k.get("html"),isChild:i},null)}},greenLeaderTrack:function(m){var l=window.location.href.match(/\/\/.*?\/([^-?]+)/)[1];var k=m.target.className;var g=m.target.id;if(l){var i="GreenLeaders";var j;var h;if(l==="Hotels"||l==="HACSearch"){j="HOTELS"}else{if(l==="Hotel_Review"||l==="ShowUserReviews"){j="HR"}else{if(l==="UserReviewEdit"){j="REVIEW_FORM"}}}if(k.match("seeFullLnk")){h="SEE_ALL"}else{if(k.match("greenLeaderLabelLnk")){h="GREEN_LEADERS_BADGE"}else{if(g.match("ReportIAP")){h="REPORT_PROBLEM"}}}if(i&&j&&h){ta.trackEventOnPage(i,j,h)}}},greenLeaderOverlay:function(l,j,i,k){if(l||window.event){new Event(l||window.event).preventDefault()}ta.overlays.Factory.greenLeaderTrack(new Event(l));var g="/GreenLeaderAjax?locationId="+i+"&showSummary="+k;if(ta.retrieve("greenLeaderOverlay")){ta.retrieve("greenLeaderOverlay").loadRemoteContent(g,true)}else{var h=new ta.overlays.CenteredOverlay({style:"tooltip ttWhite big",autoShow:false,delayedPosition:true,backdrop:ta.overlays.BACKDROP_ALWAYS,permanent:true,showCloseButton:true,backdropClickClose:true,zIndex:2001,onLoad:function(){if(ta.retrieve("greenLeaderOverlay")){this.show()}else{this.show.delay(200,this);ta.store("greenLeaderOverlay",this)}}},j);h.loadRemoteContent(g,true)}},certificateOfExcellenceOverlay:function(j,h,g){if(j||window.event){new Event(j||window.event).preventDefault()}ta.trackEventOnPage("CertificatOfExcellence",g,"Certificate_Of_Excellence_Badge");var i=ta.id("COE_OVERLAY_CONTENTS");if(i){return new ta.overlays.CenteredOverlay({style:"tooltip ttWhite big coeOverlay",backdrop:ta.overlays.BACKDROP_ALWAYS,delayedPosition:true,showCloseButton:true,backdropClickClose:true,zIndex:2001},h).loadRemoteSuccess(i.innerHTML)}return null},miniMetaCrossSellMicroOverlay:function(s,j,n,i){try{j.onmouseover=null;j.onclick=null;var g;if(ta.meta&&ta.meta.update){g=ta.meta.update.buildUrl("MicroMetaAjax",n,true,false,"QC_Meta_Mini|Related_XSell")}else{var l=new ta.commerce.CheckRatesData({type:"checkrates",evnt:s},j,n,true);var k=l.getVendorSet().getCheckedContentID();var u=l.getVendorSet().getCheckedVendor();var t=ta.retrieve("meta.travelData");t=ta.commerce.checkrates.getTravelDataFromDOM();g=ta.commerce.checkrates.buildVarMetaHacUrl("MicroMetaAjax",l,k,u,true,null,"QC_Meta_Mini|Related_XSell",t)}g+="&lowContentID="+i;g+="&drop=true";var p=j.className.match(/noDelayFirst/);var r=j.className.match(/delayOpen/);var o=ta.retrieve("delayedFirst");var h=!r||(p&&!o);var m=new ta.overlays.RelativeOverlayBelow({style:"",allowFlip:false,activate:ta.overlays.ACTIVATE_HOVER_DELAY,autoShow:h,delayShow:r,offsetLeft:0,offsetTop:-20,showCloseButton:false},j);m.loadRemoteContent(g,false);ta.store("delayedFirst",true)}catch(q){ta.util.error.record(q,"ta.overlays.factory.miniMetaCrossSellMicroOverlay")}},helpCenterLB:function(g,h){try{if(g||window.event){new Event(g||window.event).preventDefault()}new ta.overlays.CenteredOverlay({style:"s3 dg help_center",showCloseButton:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/uvpages/helpCenterOverlay.html"},h)}catch(i){ta.util.error.record(i,"ta.overlays.factory.helpCenterLB")}return false},installmentRateTip:function(h,g){g=ta.id(g);new ta.overlays.RelativeOverlayAbove({style:"",innerDivClass:"installmentRateTipOverlay",activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,allowFlip:true,content:"<span>"+ta.retrieve("meta.paymentsTipText")+"</span>"},g)},jfyMoreTagOverlay:function(h,g,j){if(h){new Event(h).stop()}var i=ta.id(j);i=i.clone();new ta.overlays.RelativeOverlayAbove({style:"moreTagOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:i.innerHTML},g)},starAttributionOverlay:function(h,g){ta.common.flyout.starAttribution(h,g)},tripTypeSelectOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();ta.trackEventOnPage("Reviews_Controls","filter_dropdown","");var h=document.getElement(".tripTypeOverlayContents");if(!h){return}h.show();new ta.overlays.RelativeOverlayBelow({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:h,offsetTop:3},g)},languageFilterSelectOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".languageList");if(!h){return}h.show();new ta.overlays.RelativeOverlayRight({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:h,offsetLeft:-13},g)},reviewLanguageOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".languageList");if(!h){return}var j=g.getSize().x-16;new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:h,offsetTop:1,offsetLeft:j},g)},reviewSeasonOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".seasonList");if(!h){return}new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:h,offsetTop:1},g)},topDestinationsOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".topDestinationsList");if(!h){return}new ta.overlays.RelativeOverlayBelow({style:"topDestinationsOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:h,offsetTop:1},g)},translationRatingsOverlay:function(j,g){if(!g||!j){return}g.onclick=null;j.stop();var i=g.getParent("form");if(i){var h=i.getElement(".ratingList");if(!h){return}new ta.overlays.RelativeOverlayBelow({style:"mtRatingOverlay",noPadding:true,activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:h},g)}},installExitInterrupter:function(){ta.servlet.HotelReview.installExitInterrupter()},ipLearnMoreMenu:function(h,g){if(!g||!h){return}g.onclick=null;h.stop();new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"dropMenu dropMenu_refresh"},g);new Request({url:"/ActionRecord?action=FBIP-PersistentHeader-Flyout"}).send()},logTrackingTree:function(){var g=document.getElement(".micro_meta_flyout");if(g){var h=g.getElement(".impressionTrackingTree");if(h){ta.trkImpTree(h)}}},loadDatePickerOverlay:function(i,h,g){ta.call("ta.p13n.wizard.loadDatePickerOverlay",i,h,g)},racLBDelegates:function(){function g(){}function h(){}return{onLoad:g,onClose:h}},racGeoSearchDelegates:function(g){return{onLoad:function(){ta.restaurantAvailabilitySearch.init(g)}}},createSearchPageScopeSelect:function(g,h){if(!g||!h){return}return new ta.overlays.RelativeOverlayBelow({style:"geo_select_flyout",closeOnDocumentClick:true,content:h},g)},loadingMostRecentDraftOverlay:function(h,i){if(h){var g=new ta.overlays.CenteredOverlay({showCloseButton:false,backdrop:ta.overlays.BACKDROP_ALWAYS,content:h.innerHTML,backdropColor:"#FFF",backdropOpacity:0.8,style:"loadingMostRecentDraftOverlay"});i();setTimeout(function(){g.hide()},3000)}},taSupportOverlay:function(g){if(!g){return}new ta.overlays.CenteredOverlay({showCloseButton:true,content:g.innerHTML,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"taSupportOverlay",closeButtonClass:"xCloseGreen"})},restaurantFiltersOverlay:function(g){return new ta.overlays.CenteredOverlay({showCloseButton:true,innerDivClass:"filtersOverlay",style:"filtersOverlayContainer",closeButtonClass:"filtersOverlayClose",content:g,backdrop:ta.overlays.BACKDROP_ALWAYS,fixed:false,noScrollY:true})}}})();(function(a){Object.append(a,{injectReviewSummaryContentFromConcept:function(c){try{var b=ta.retrieve("topconcepts.rsContent")[c];if(!b){ta.util.error.record(null,"injectReviewSummaryContentFromConcept - no content")}ta.overlays.Factory.injectReviewSummaryContent(b)}catch(d){ta.util.error.record(d,"injectReviewSummaryContentFromConcept")}},injectReviewSummaryContent:function(c){try{var b=ta.retrieve("reviewSummaryOverlay");if(b){b.inner.setContent(c);b.show()}else{ta.util.error.record(null,"injectReviewSummaryContent - no overlay")}}catch(d){ta.util.error.record(d,"injectReviewSummaryContent")}},storeReviewSummaryContent:function(d,c){var b=ta.retrieve("topconcepts.rsContent");if(!b){b={}}b[d]=c;ta.store("topconcepts.rsContent",b)},addSummaryBoxContentAndShow:function(d,g){try{var h=ta.retrieve("reviewSummaryOverlay");ta.overlays.Factory.injectReviewSummaryContent(g);var c=null;var k=ta.id("TRAV_SAY_TERMS");if(typeof(k)!=undefined&&k!=null){var b=k.clone(true,false);b.addClass("col1of2");c=new Element("div",{"class":"wrap bx02 rd_concepts"});c.adopt(b)}else{c=ta.id("SUMMARYBOX").clone(true,false)}var j=h.inner;j.getElement(".title").adopt(c);var l="concept_"+d.replace(/ /g,"_");var i=document.getElement(".overlay .rd_concepts ."+l);if(i){i.removeClass("taLnk").removeClass("hvrIE6").addClass("conceptSelected").onClick=""}Array.each(j.getElements(".rd_concepts .snippetText"),function(e){var n=ta.id(e);n.removeClass("snippetText");n.removeClass("sprite-middot");n.removeClass("trip_type_snippet");n.addClass("conceptBullet");var m=n.getElement(".taLnk");if(m){m.setProperty("onclick","ta.util.cookie.setPIDCookie(25223);ta.call('ta.overlays.Factory.showReviewSummaryV2',event, this);")}});ta.overlays.Factory.storeReviewSummaryContent(d,j.get("html"));ta.overlays.Factory.injectReviewSummaryContentFromConcept(d)}catch(f){ta.util.error.record(f,"updateReviewSummaryContent - request.onSuccess")}},updateReviewSummaryContent:function(c,b){try{if(ta.has("reviewSummaryOverlay")&&ta.has("topconcepts.rsContent")&&ta.retrieve("topconcepts.rsContent")[c]){ta.overlays.Factory.injectReviewSummaryContentFromConcept(c);return}if(ta.has("reviewSummaryOverlay")){new Request({url:b,onSuccess:function(e){ta.overlays.Factory.addSummaryBoxContentAndShow(c,e)},evalScripts:true,method:"get"}).send();return}else{ta.util.error.record(null,"updateReviewSummaryContent - no overlay")}}catch(d){ta.util.error.record(d,"updateReviewSummaryContent")}},getReviewSummaryUrl:function(f,e,i,c){ta.store("topconcepts.lastconcept",f);if(typeof modelLocId=="undefined"||typeof modelGeoId=="undefined"){var h=(typeof modelLocId=="undefined")?"undefined":modelLocId;var d=(typeof modelGeoId=="undefined")?"undefined":modelGeoId;ta.util.error.record(null,"getReviewSummaryUrl",null,{locId:h,geoId:d})}if(i&&c){ta.util.cookie.setPIDCookie(16007);var g="/MachineTranslation?";if(e.id){var f;if(e.id.indexOf("trans_")!=-1){f=e.id.replace("trans_","").replace(/_/g," ")}else{f=e.id.replace("concept_","").replace(/_/g," ")}ta.store("topconcepts.lastconcept",f);g+="page=summary&";g+="d="+modelLocId+"&";g+="concept="+f;g+="&sl=en&tl="+i}return g}var b="/HotelSummary?d="+modelLocId+"&geo="+modelGeoId+"&concept="+f;if(i){b+="&autotrans=true"}return b},getReviewSummaryConcept:function(b){try{var c=b.id?b.id:b.className.match("(concept_[a-zA-Z0-9-_]+)")[1];return c.replace("concept_","").replace(/_/g," ")}catch(d){ta.util.error.record(d,"getReviewSummaryConcept",null,{id:b.id,"class":b.className})}return""},showReviewSummaryV2:function(h,e,g,c){if(h){h.stop()}var f=ta.overlays.Factory.getReviewSummaryConcept(e);var b=ta.overlays.Factory.getReviewSummaryUrl(f,e,g,c);if(ta.has("reviewSummaryOverlay")){ta.overlays.Factory.updateReviewSummaryContent(f,b);return}ta.overlays.Factory._loadSummaryCss();var d=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding rgba_gry",autoShow:false,permanent:true,showCloseButton:true,remoteContent:b,onLoad:function(i){try{ta.store("topconcepts.overlay."+f,this);ta.overlays.Factory.addSummaryBoxContentAndShow(f,this.inner.innerHTML);this.show()}catch(j){ta.util.error.record(j,"showReviewSummary - overlay onload")}}},e);ta.store("reviewSummaryOverlay",d)}})})(ta.overlays.Factory);ta.overlays.CalendarOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,options:{showCloseButton:true,activate:ta.overlays.ACTIVATE_FOCUS,style:"typeO ocal",autoShow:false,autoShowCal:false,calendarOptions:null,flipPadding:25,zIndex:999,extraShow:null},initialize:function(a,b){this.input=a.getElement("input[type=text]");this.parent(b,this.input);this.input.overlay=this;this.dayField=a.getElement("input.day");this.monthField=a.getElement("input.month");this.source.addEvent("click",this.show);this.icn=a.getElement("span.icn");if(this.icn){this.icn.onclick="";this.icn.addEvent("click",this.show)}var c=a.className.search("first")>=0;this.calendar=new ta.widgets.Calendar(Object.merge({dualCalendar:true,choiceLink:"ta.overlays.calendarSelect",prevAction:"ta.overlays.calendarPrev",nextAction:"ta.overlays.calendarNext",onSelect:this.select.bind(this),onClear:this.clear.bind(this),isFirstCal:c},this.options.calendarOptions));this.inner.adopt(this.calendar.container);this.parentOverlay=a.getParent(".overlay");if(this.parentOverlay){this.parentOverlay=this.parentOverlay.overlay;this.options.isChild=true}if(this.options.autoShowCal){this.show()}},destroy:function(){this.parent();this.input.overlay=null},show:function(c,a){if(this.options.extraShow){this.options.extraShow(this)}this.input.addClass("selected");var b=this.visible;this.parent(c);if(b&&!a){return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.loadFields();this.calendar.update();this.calendar.reposition();return this},hide:function(a){if(!this.visible){return}this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}},hideNow:function(a){this.input.removeClass("selected");if(!this.visible){return this}this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}},select:function(a,b){if(b){new Event(b).preventDefault()}this.updateFields();if(!a.options.dontHideOnSelect){this.hide()}this.fireEvent("onSelect",[this,b])},hover:function(b,a){this.fireEvent("onHover",[b,this,a])},mouseout:function(a){this.fireEvent("onMouseOutOnDate",[this,a])},clear:function(a,b){b&&new Event(b).preventDefault();this.clearFields();this.hide();this.fireEvent("onClear",this)},loadFields:function(){var b=parseInt(this.dayField.value.replace(/^0/,""));var a=this.monthField.value.split(/\//);if(a.length!=2){return}var c=parseInt(a[1]);if(ta.retrieve("thai_buddhist_era_year")&&c>=(new Date().getFullYear()+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)){c-=ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}a=parseInt(a[0].replace(/^0/,""));this.calendar.selectedDate=ta.util.date.create(c,a-1,b);return this},updateFields:function(){if(!this.calendar.selectedDate){this.loadFields()}if(!this.calendar.selectedDate){return}var a=this.calendar.selectedDate.getMonth()+1;if(a<10){a="0"+a}this.dayField.value=this.calendar.selectedDate.getDate();this.monthField.value=a+"/"+this.calendar.selectedDate.getFullYear();var b=this.calendar.selectedDate.getFullYear();if(ta.retrieve("thai_buddhist_era_year")){b=b+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}this.input.value=formatDate(this.calendar.selectedDate.getDate(),this.calendar.selectedDate.getMonth(),b);this.input.removeClass&&this.input.removeClass("placeholder")},clearFields:function(){if(this.options.calendarOptions&&!this.options.calendarOptions.clearToBlank){this.input.value=this.input.getAttribute("placeholderValue")||JS_DateFormat}else{if(this.input.value==this.input.defaultValue){this.input.value=""}}},clearDateFields:function(){this.calendar.selectedDate=null;this.dayField.value="";this.monthField.value="";this.clearFields()},resetFieldsIfBlank:function(){if(this.input.value==""){this.input.value=this.input.defaultValue}},validate:function(){var b=this.input.value.match(DATE_FORMAT.pattern);if(b){var c=parseInt(b[DATE_FORMAT.date].replace(/^0/,""));var a=parseInt(b[DATE_FORMAT.month].replace(/^0/,""));var d=parseInt(b[DATE_FORMAT.year].replace(/^0/,""));if(c>0&&c<32&&a>0&&a<13){if(c<10){c="0"+c}if(a<10){a="0"+a}if(d<100){d+=2000}this.dayField.value=c;this.monthField.value=a+"/"+d;this.loadFields();if(!this.calendar.isValid()){return sInvalidDates}}else{return sInvalidDates}}else{return sInvalidDates}return null}});ta.overlays.createCalendar=function(b,a){new Event(b).preventDefault();a.onfocus="";new ta.overlays.CalendarOverlay($(a).getParent(".cal"),{autoShowCal:true})};ta.overlays.createCustomCalendar=function(c,b,a){new Event(c).preventDefault();b.onfocus="";new ta.overlays.CalendarOverlay($(b).getParent(".cal"),{autoShowCal:true,calendarOptions:a})};ta.overlays.calendarSelect=function(f,e,a,c,b){if(ta.has("checkrates.calendarActionRecord")){ta.util.cookie.removePIDCookie();ta.meta.linkTracking.actionRecord(ta.retrieve("checkrates.calendarActionRecord"))}ta.id(b).getParent(".overlay").overlay.calendar.select(f,ta.util.date.create(e,a,c));if(ta.has("checkrates.meta_calendar_style_on_classic")&&(Browser.ie||Browser.chrome)){ta.popups.PopUtil.attemptHoldingWindow(ta.meta.cr.getPropIdFromCRElement(ta.id(b).getParent(".overlay").overlay.input))}};ta.overlays.calendarPrev=function(b,a){ta.id(a).getParent(".overlay").overlay.calendar.prev()};ta.overlays.calendarNext=function(b,a){ta.id(a).getParent(".overlay").overlay.calendar.next()};ta.overlays.PairedCalendar=new Class({Implements:[Options,Events],options:{validate:false,validateFun:function(){},allowSameDay:false,calendarOptions:null,defaultSpan:1,keepDelta:false,clearDatesId:"clearDates",overlayOptions:{},overlayFirstOptions:null,disallowChars:false,disableInvalidEndDates:false,showCalIfInvalid:false,clearOnRestart:false,allowReverse:false},initialize:function(b,a){this.setOptions(a);b=ta.id(b);this.form=b.get("tag")=="form"?b:b.getParent("form");var c=Object.merge({onSelect:this.adjustRange.bind(this)},this.options.overlayOptions);if(this.options.calendarOptions){c.calendarOptions=this.options.calendarOptions}this.form.getElements(".cal").each(function(d){var f;if(d.hasClass("first")&&this.options.overlayFirstOptions){f=new ta.overlays.CalendarOverlay(d,Object.merge(Object.clone(c),this.options.overlayFirstOptions))}else{f=new ta.overlays.CalendarOverlay(d,c)}f.input.onfocus="";if(this.options.disallowChars){f.input.addEvent("keypress",this.validateInput.bind(this))}if(d.hasClass("first")){this.before=f}else{this.after=f;if(ta.has("isDaoDaoCRRedesign")){var e=this.form.get("qc_area");this.after.qcArea=e;this.before.qcArea=e}}},this);if(ta.retrieve("isDaoDao")){ta.store("cal_in",this.before);ta.store("cal_out",this.after)}this.after.theOtherCal=this.before;this.before.theOtherCal=this.after;this.after.calendar.theOtherCal=this.before.calendar;this.before.calendar.theOtherCal=this.after.calendar;if(b===this.before.input||b===this.before.icn){this.after.loadFields();if(this.before.options.autoShowCal){this.before.show()}}else{if(b===this.after.input||b===this.after.icn){this.before.loadFields();if(this.after.options.autoShowCal){this.after.show()}}}if(this.form){this.form.calendar=this;if(this.options.validate){this.form.addEvent("submit",this.validate.bind(this));this.errorDiv=this.form.getElement(".error_msg")}}},getOverlayForCalendar:function(a){if(this.before.calendar==a){return this.before}if(this.after.calendar==a){return this.after}return null},adjustRange:function(c){this.requireFullLoad();if(this.form.searchAll){if(this.form.searchAll.type=="checkbox"){this.form.searchAll.checked=false}else{if(this.form.searchAll.type=="hidden"){this.form.searchAll.value="false"}}}var b=ta.id(this.options.clearDatesId);if(b){b.style.visibility="visible"}var h=false;if(this.options.clearOnRestart&&c===this.before){this.after.clearDateFields()}else{if(this.options.allowReverse&&c===this.after&&this.before.calendar.selectedDate&&this.after.calendar.selectedDate.getTime()<this.before.calendar.selectedDate.getTime()){var k=this.before.calendar.selectedDate;this.before.calendar.selectedDate=this.after.calendar.selectedDate;this.after.calendar.selectedDate=k;this.before.updateFields();this.after.updateFields()}else{if(!this.sameDayEnabled()&&!this.options.disableInvalidEndDates&&this.after.calendar.selectedDate&&this.after.calendar.selectedDate.getTime()==this.after.calendar.options.firstDate.getTime()){this.before.calendar.selectedDate=new Date(this.before.calendar.options.firstDate);if(this.options.keepDelta){this.options.defaultSpan=1}var k=new Date(this.after.calendar.options.firstDate);k.setDate(k.getDate()+this.options.defaultSpan);this.after.calendar.selectedDate=k;this.before.updateFields();this.after.updateFields()}else{if(c==this.before){if(this.options.keepDelta||!this.isBeforeValid()){var k=new Date(this.before.calendar.selectedDate);k.setDate(k.getDate()+this.options.defaultSpan);this.after.calendar.selectedDate=k;h=true}this.after.updateFields()}else{if(c==this.after){if(!this.isAfterValid()){var k=new Date(this.after.calendar.selectedDate);k.setDate(k.getDate()-this.options.defaultSpan);if(k.getTime()<this.before.calendar.options.firstDate.getTime()){k=new Date(this.before.calendar.options.firstDate.getTime())}this.before.calendar.selectedDate=k}this.before.updateFields()}}}if(this.options.keepDelta&&this.before.calendar.selectedDate){this.options.defaultSpan=ta.util.date.getDaysInRange(this.before.calendar.selectedDate,this.after.calendar.selectedDate)-1;if(this.sameDayEnabled()){if(this.options.defaultSpan<0){this.options.defaultSpan=0}}else{if(this.options.defaultSpan<1){this.options.defaultSpan=1}}}}}this.fireEvent("onUpdate",this);var g=ta.retrieve("calendar.onUpdateCallback");if(g){for(var f=0;f<g.length;f++){if(window[g[f]]){window[g[f]](this,c)}}}this.updateMinStay(this.before.calendar.selectedDate,this.after.calendar.selectedDate);try{var a="before";if(c==this.after){a="after"}}catch(j){ta.util.error.record(j,"availability check - paired cal")}if(this.options.disableInvalidEndDates){if(c==this.before){var k=new Date(this.before.calendar.selectedDate);k.setDate(k.getDate()+1);this.after.calendar.options.firstDate=k;if(h){this.after.show()}}}},updateMinStay:function(a,c){var b=ta.id("minStay");if(b&&a&&c){b.disabled=true;b.selectedIndex=this.getMinStayIndex(a,c)}},getMinStayIndex:function(a,c){var b=ta.util.date.getDaysInRange(a,c)-1;if(b<7){return b}else{if(b<28){return 7}else{return 8}}},isOneWay:function(){return this.form.oneWay&&this.form.oneWay.checked},sameDayEnabled:function(){return this.options.allowSameDay||this.isOneWay()},searchAllEnabled:function(){return this.form.searchAll&&(this.form.searchAll.checked||(this.form.searchAll.type=="hidden"&&this.form.searchAll.value=="true"))},updateFields:function(){this.before.updateFields();this.after.updateFields()},clearFields:function(){this.before.clearDateFields();this.after.clearDateFields()},resetFieldsIfBlank:function(){this.before.resetFieldsIfBlank();this.after.resetFieldsIfBlank()},requireFullLoad:function(){if(!this.before.calendar.selectedDate){this.before.loadFields()}if(!this.after.calendar.selectedDate){this.after.loadFields()}},isBeforeValid:function(){this.requireFullLoad();if(!this.after.calendar.selectedDate){return true}return(this.before.calendar.selectedDate<this.after.calendar.selectedDate)||(this.sameDayEnabled()&&this.before.calendar.selectedDate.getTime()<=this.after.calendar.selectedDate.getTime())},isAfterValid:function(){this.requireFullLoad();if(!this.before.calendar.selectedDate){return true}return(this.after.calendar.selectedDate>this.before.calendar.selectedDate)||(this.sameDayEnabled()&&this.after.calendar.selectedDate.getTime()>=this.before.calendar.selectedDate.getTime())},validateInput:function(a){if(a.key.match(/^[a-zA-Z]$/)){a.preventDefault()}},validate:function(g){if(this.searchAllEnabled()){return true}var a=this.before.validate();var b=this.after.validate();var d=true;if(this.isOneWay()){if(a!=null){d=false;this.setError(a)}}else{if(a!=null||b!=null){d=false;this.setError(a||b)}else{if(!this.isAfterValid()){d=false;this.setError(sInvalidDates)}}}if(!d&&g){new Event(g).stop()}if(this.options.showCalIfInvalid){var f;if(a!=null){f=this.before}else{if(b!=null||!d){f=this.after}}if(f){f.input.value="";f.selectedDate=new Date();f.updateFields();f.show()}}if(d&&this.options.validateFun&&typeof this.options.validateFun==="function"){try{return this.options.validateFun(g)}catch(c){ta.util.error.record(c,"post-validation callback function failed in PairedCalendar",g);return d}}else{return d}},setError:function(a){if(!this.errorDiv){return}this.errorDiv.setContent(a).show()},toggleSearchAll:function(){if(this.searchAllEnabled()){this.before.clearFields();this.after.clearFields()}else{this.requireFullLoad();this.before.updateFields();this.after.updateFields()}}});ta.overlays.createSimplePairedCalendar=function(b,a){new Event(b).stop();new ta.overlays.PairedCalendar(a)};ta.overlays.createPairedCalendar=function(f,c,b){if(!b){b={validate:true}}new Event(f).preventDefault();var e;if(ta.isMetaHomepageIntegration2013()||ta.isMetaHotel2013()||ta.isMetaHotels2013()||ta.isAirport()){var d=b.inline;var a=typeof b.skipHAC!=="undefined"&&b.skipHAC!=null&&b.skipHAC;b.clearOnRestart=true;b.allowReverse=true;b.overlayOptions={showCloseButton:false,style:"date_picker_calendar paired",noPadding:true,noCpu:true};b.calendarOptions={prevStyle:"sprite-date_picker-btnLeftIdle",nextStyle:"sprite-date_picker-btnRightIdle",showRange:true};b.onUpdate=function(g){ta.widgets.calendar.setPageInDate(g.before.calendar.selectedDate);ta.widgets.calendar.setPageOutDate(g.after.calendar.selectedDate);if(g.before.calendar.selectedDate&&g.after.calendar.selectedDate){if(ta.isMetaHotels2013()&&!a){ta.servlet.HACSearch.doMetaDateSearch()}else{if(d){ta.widgets.calendar.launchInlineMeta(f)}}}};if(b.clearDates){delete b.clearDates;b.calendarOptions.postContent=function(){var g=Elements.from('<div id="SKIP_DATES"><span class="skip_dates_text"><span class="taLnk">'+ta.retrieve("multiDP.skipDates")+"</span></span></div>")[0];g.getElement(".taLnk").addEvent("click",function(){var i=ta.overlays.getCurrent();if(i){i.clearDateFields();i.theOtherCal&&i.theOtherCal.clearDateFields();i.hide()}var h=ta.id("SUBMIT_HOTELS");if(h){h.focus()}ta.widgets.calendar.clearPageDates();ta.widgets.calendar.clearSessionDates();ta.overlays.Factory.trackSkipDatesEvent("Meta_Homepage","Calendar","Skip dates",0)});return g}}e=new ta.overlays.PairedCalendar(c,b);e.before.addEvent("onSelect",function(h,g){e.after.input.focus()})}else{e=new ta.overlays.PairedCalendar(c,b)}return e};ta.overlays.clearFields=function(a){if(a.calendar){a.calendar.clearFields()}};ta.overlays.resetFieldsIfBlank=function(a){if(a.calendar){a.calendar.resetFieldsIfBlank()}};ta.overlays.toggleOffSearchAll=function(a){if(a.calendar&&a.searchAll){if(a.searchAll.type=="checkbox"){a.searchAll.checked=false}else{if(a.searchAll.type=="hidden"){a.searchAll.value="false"}}a.calendar.toggleSearchAll()}};ta.overlays.toggleOnSearchAll=function(a){a=ta.id(a);var b=a.getParent("form");if(!b.calendar){new ta.overlays.PairedCalendar(a,{validate:true,clearDatesId:a})}if(b.calendar&&b.searchAll){if(b.searchAll.type=="checkbox"){b.searchAll.checked=true}else{if(b.searchAll.type=="hidden"){b.searchAll.value="true"}}b.calendar.toggleSearchAll()}};ta.overlays.toggleSearchAll=function(d,b,a){b=ta.id(b);b.onclick="";var c=b.getParent("form");if(!a){a={validate:true}}if(!c.calendar){new ta.overlays.PairedCalendar(b,a)}c.calendar.toggleSearchAll(b);b.addEvent("click",c.calendar.toggleSearchAll.bind(c.calendar))};ta.overlays.clearDates=function(c,a){ta.overlays.toggleOnSearchAll(a);ta.id(a).style.visibility="hidden";var b=ta.id("minStay");if(b!==null){b.disabled=false;b.selectedIndex=0;filtersChanged(c)}};ta.overlays.PermanentOverlay=new Class({Extends:ta.overlays.AbsoluteOverlay,initialize:function(a,b){this.parent(Object.merge({permanent:true},a),b)}});ta.overlays.SkinnyOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,initialize:function(a,b){this.parent(a,b);this.container.setStyle("max-width","120px");if(Browser.ie6){this.shim.setStyle("max-width","120px")}if(this.transparentOverlayPadding){this.transparentOverlayPadding.setStyle("max-width","120px")}}});ta.overlays.Registration=new Class({Implements:[Options,Events],Binds:["response","failure"],options:{flow:null,url:"/Registration",isOverlay:true,pageTarget:null,responseCallback:null,completeCallback:null,customOverlayOptions:{},noreload:false,failureCloseHandler:null},initialize:function(a){this.setOptions(a);if(this.options.isOverlay){this.overlay=new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS,autoShow:false,style:"s4 dg",attachCloseEvent:false},this.options.customOverlayOptions));if(this.overlay.closeBtn){this.overlay.closeBtn.addEvent("click",this.cancel.bind(this))}}},getRequestData:function(){var c={flow:this.options.flow};this.options.pid&&Object.merge(c,{pid:this.options.pid});if(ta.has("registration.data")){c=Object.merge(c,ta.retrieve("registration.data"))}if(ta.has("page.geo")){c.geo=ta.retrieve("page.geo")}c.source=pageServlet;c=[c];Array.from(arguments).each(function(d){c.push(d)});var a=ta.id("token");if(a&&a.hasOwnProperty("value")){c.securityToken=a.value}if(ta.has("rsa")){c.push({encrypted:ta.retrieve("rsaVersion")});var b=ta.retrieve("rsa");c.forEach(function(d){if(d.pass){try{c.push({epass:b.encrypt(d.pass.value)})}catch(f){ta.util.error.record(f,"Encrypted Signin - encrypting sign-in/sign-up form parameters")}}})}return c},_getUrl:function(){var a=ta.util.URL.https(this.options.url);if(0!==a.indexOf("https:")){ta.util.error.record(null,"Post URL must have https protocol.");return""}return a},request:function(c,b){ta.store("registration.method","request");var a={url:this._getUrl(),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:this.getRequestData(b,{action:c}),onSuccess:this.response,onFailure:this.failure};if(ta.has("registration.ga_module")){a.trackEvent={module:ta.retrieve("registration.ga_module"),action:c+"_Show",context:this.options.flow}}new Request(a).send();return this},post:function(b){var a=this;if(ta.has("registration.ga_module")){ta.trackEventOnPage(ta.retrieve("registration.ga_module"),b.action.value+"_Submit",a.options.flow,1,false)}ta.util.pending.waitFor(function(){return !ta.has("rsaLoading")},function(){if(ta.has("facebook.authcode.param")){b=Object.merge(b,{FBAuthCode:ta.remove("facebook.authcode.param")})}ta.store("registration.method","post");new Request({url:a._getUrl(),method:"post",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:a.getRequestData(b,{noreload:a.options.noreload}),onSuccess:a.response,onFailure:a.failure}).send()},100);return this},cancel:function(){ta.store("registration.method","cancel");new Request({url:this._getUrl(),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:this.getRequestData({CANCEL:"y",action:ta.retrieve("registration.action"),noreload:this.options.noreload}),onSuccess:this.response,onFailure:this.failure}).send();return this},log:function(a){new Request({url:this._getUrl(),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:false,data:this.getRequestData({action:"LOG",pageAction:a})}).send();return this},response:function(a){if(!ta.remove("registration.noop")){if(this.options.isOverlay){this.overlay.loadRemoteSuccess(a);if(this.overlay.visible){this.overlay.position()}else{this.overlay.show()}}else{if(this.options.pageTarget){this.options.pageTarget.setContent(a)}}}if(this.options.responseCallback){setTimeout(this.options.responseCallback,1)}if(ta.has("registration.afterUpdate")){ta.remove("registration.afterUpdate").each(function(b){setTimeout(b,1)})}},close:function(){if(this.options.isOverlay){this.overlay.hide()}this.fireEvent("onComplete");if(this.options.completeCallback){this.options.completeCallback()}},failure:function(c){var a=0;var d=ta.remove("registration.method");try{a=c.status}catch(b){}if(a==503){this.overlay.loadRemoteSuccess('<div style="padding:6px;">'+JS_maintenance+"</div>");if(!this.overlay.closeBtn&&this.options.failureCloseHandler){this.overlay.addCloseButton()}if(this.overlay.closeBtn){this.overlay.closeBtn.removeEvents("click");this.overlay.closeBtn.addEvent("click",this.options.failureCloseHandler||ta.overlays.registration.close)}if(this.overlay.visible){this.overlay.position()}else{this.overlay.show()}}else{if(d=="cancel"){ta.overlays.registration.close()}ta.util.error.ajaxFailure.partial("Registration:"+d)}}});ta.overlays.registration={getInstance:function(a){var b=ta.retrieve("registration.instance");if(!b){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCss")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}b=new ta.overlays.Registration(a);ta.store("registration.instance",b)}return b},connect:function(a,d,c){ta.queueForReady(function(){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCss")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}},0,"Pre-redesigned Registration CSS");if(ta.has("facebook.available")&&ta.retrieve("facebook.available")){var e={fbAvailable:true}}else{if(ta.has("registration.forceFBAvailable")){var e={fbAvailableForce:ta.remove("registration.forceFBAvailable")}}}var b="SIGNIN";ta.remove("registration.data");if(typeof(a)=="undefined"){a={}}ta.overlays.registration.addLoadingGeeTestCaptchaOnCallBack(a);ta.overlays.registration.getInstance(a).request(d||b,Object.merge({},c,e))},post:function(b,a){var c=a||window.event;if(c){new Event(c).stop()}ta.overlays.registration.getInstance().post(b)},request:function(c,b,a){if(c=="SIGNUP"||c=="SIGNIN"){b=Object.merge({fbAvailable:ta.has("facebook.available")&&ta.retrieve("facebook.available")},b)}if(typeof(a)=="undefined"){a={}}ta.overlays.registration.addLoadingGeeTestCaptchaOnCallBack(a);ta.overlays.registration.getInstance(a).request(c,b)},deferredRequest:function(d,b,e,c,a){ta.overlays.registration.getInstance(a).request(e,c,a)},cancel:function(a){ta.overlays.registration.getInstance(a).cancel(false)},log:function(a){ta.overlays.registration.getInstance().log(a)},close:function(){var a=ta.remove("registration.instance");if(a){a.close()}},switchFlow:function(a){ta.overlays.registration.getInstance().options.flow=a},logAndPost:function(c,b,a){ta.overlays.registration.getInstance(c).log(b).post(a)},postSignupForm:function(b,a){var c=a||window.event;if(c){new Event(c).stop()}ta.overlays.registration.getInstance().post(b)},addLoadingGeeTestCaptchaOnCallBack:function(b){if(typeof(b.responseCallback)=="function"){var a=b.responseCallback;b.responseCallback=function(){ta.overlays.registration.loadGeeTestCaptcha();a()}}else{b.responseCallback=ta.overlays.registration.loadGeeTestCaptcha}},loadGeeTestCaptcha:function(){if(ta.retrieve("geetest_captcha")){var e=ta.id("geetest_recaptcha_widget");if(e){var c=e.getAttribute("data-captcha-id");var d=e.getAttribute("data-captcha-type");var b=ta.select("#geetest_recaptcha_widget .gt_holder");if(window.Geetest&&b.length==0){var a=new Geetest({gt:c,product:d,https:true}).onReady(function(){var f=ta.select("#geetest_recaptcha_widget .gt_guide_tip");if(f.length>0){f[0].innerHTML=ta.retrieve("geetest_captcha.str_slide_to_verify")}}).appendTo(e);if(ta.trackEventOnPage){ta.trackEventOnPage("reg_captcha","GEETEST","displayed")}}}}}};ta.servlet.Registration={realNameDone:function(a){if(ta.id("use_real_name")&&ta.id("use_real_name").getProperty("checked")||ta.id("chooseNameFB")||ta.id("chooseNameGoogle")){ta.overlays.registration.post(ta.id("RealName"),a)}else{ta.overlays.registration.cancel()}},screenEdit:function(a){ta.id("screen").set("value","");ta.id("screen").focus();ta.id(a).hide()},displayLoading:function(){if(window.CDNHOST!=null){ta.id("buttonArea").innerHTML='<img class="loadingGif" src="'+CDNHOST+'/img2/generic/site/loading_anim_gry_sml.gif" />'}else{ta.id("submitButton").set("disabled",true)}},trackEmailOpt:function(a,b){if(a){if(!a.checked){ta.trackEventOnPage("register","sign_up_"+b,"email_opt_out")}}},toggleProgressCircle:function(b){var a=ta.id("circleContainer_"+b);if(a){if(a.hasClass("progressCircleChecked")){a.removeClass("progressCircleChecked");a.addClass("progressCircle");a.innerHTML=b}else{a.removeClass("progressCircle");a.addClass("progressCircleChecked")}}},toggleProgressBar:function(a){var b=ta.id("barContainer_"+a);if(b){if(b.hasClass("filled")){b.removeClass("filled")}else{b.addClass("filled")}}},toggleProgressElement:function(a,b,c){if(a&&a<=b){if(c=="Bar"){this.toggleProgressBar(a)}else{if(c=="Circle"){this.toggleProgressCircle(a)}}}},toggleTagged:function(c,b,f,e){if(c&&ta.id("tagContainer_"+c)){var a=ta.select(".tagSelection:checked").length;var d=ta.id("tagContainer_"+c);if(d.hasClass("tagged")){d.removeClass("tagged");this.toggleProgressElement(a,b,e);if(ta.id("tag_"+c).checked){ta.id("tag_"+c).checked=false;this.activateMemberTagSubmit(f)}}else{d.addClass("tagged");this.toggleProgressElement(a+1,b,e);if(!ta.id("tag_"+c).checked){ta.id("tag_"+c).checked=true;this.activateMemberTagSubmit(f)}}}},activateMemberTagSubmit:function(c){var b=1;var a=ta.id("submitBtn");if(c){b=0}if(a&&ta.select(".tagSelection:checked").length>=b){a.addClass("active")}else{if(a){a.removeClass("active")}}},submitMemberTags:function(s,j){var c;var i=(c=ta.select(".tagSelection:checked"))?c.length:0;var n=(c=ta.id("memberTagsPlacementPid"))?c.value:0;var a=(c=ta.id("memberTagsIsSecure"))&&(c.value=="true");var o=(c=ta.id("memberTagsIsEditFlow"))&&(c.value=="true");var l=(c=ta.id("memberTagsForceAjax"))&&(c.value=="true");var g=(c=ta.id("memberTagsOnSuccess"))?c.value:"";var f=ta.servlet.Registration[g];var b=$(s);if(!b||!b.hasClass("active")){return}var r=b.hasClass("skipBtn");var m=ta.id("submitBtn");if(m){m.removeClass("active")}var p=ta.id("skipBtn");if(p){p.removeClass("active")}ta.trackEventOnPage("self_tags",j,n,i);if(o&&r&&("undefined"!==typeof(oxapp))&&oxapp.getSubview("modules.membercenter.MemberTag")){if(m){m.addClass("active")}if(p){p.addClass("active")}var h=oxapp.getSubview("modules.membercenter.MemberTag");if(h.context&&h.context.get("MemberCenter_MemberTags")&&h.context.get("MemberCenter_MemberTags")._items&&h.context.get("MemberCenter_MemberTags")._items.length==0){h.taggedItems=[]}h.taggingOverlay.hide();return}if(o&&r&&("undefined"!==typeof(bbapp))&&bbapp.getView("modules.membercenter.MemberTag")){if(m){m.addClass("active")}if(p){p.addClass("active")}var h=bbapp.getView("modules.membercenter.MemberTag");if(h.context&&h.context.get("MemberCenter_MemberTags")&&h.context.get("MemberCenter_MemberTags").length==0){h.taggedItems=[]}h.taggingOverlay.hide();return}if(r){var d=ta.id("tagCancel");if(d){d.value=true}var k=ta.find(".overlayBG"),t=ta.find(".withBackdrop"),q=ta.id("tagPrompt");if(q&&k&&t&&t.hasClass("taggingOverlay")){q.hide();k.hide();t.hide()}}if(a&&!l){ta.overlays.registration.getInstance().post(ta.id("SELF_TAG_FORM")).response(function(){if(m){m.addClass("active")}if(p){p.addClass("active")}})}else{new Request({url:"/MemberTagsAjax",method:"post",data:ta.id("SELF_TAG_FORM"),onSuccess:function(e){if(m){m.addClass("active")}if(p){p.addClass("active")}if("function"===typeof(f)){f(e)}},onFailure:function(e){if(m){m.addClass("active")}if(p){p.addClass("active")}if(("undefined"!==typeof(oxapp))&&oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").taggingOverlay.hide()}if(("undefined"!==typeof(bbapp))&&bbapp.getView("modules.membercenter.MemberTag")){bbapp.getView("modules.membercenter.MemberTag").taggingOverlay.hide()}}}).send()}var d=ta.id("tagCancel");if(d){d.value=""}},memberTagsSuccessMemberCenter:function(c){if((typeof oxapp==="undefined"&&typeof bbapp==="undefined")||!c){return}var a,b=(a=ta.id("memberTagsIsEditFlow"))&&(a.value=="true");if(b&&typeof oxapp!=="undefined"&&oxapp.context.get("MemberCenter_MemberTags")){oxapp.context.get("MemberCenter_MemberTags").fetch().always(function(){if(oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").render()}});if(oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").taggingOverlay.hide()}}if(b&&typeof bbapp!=="undefined"&&bbapp.context.get("MemberCenter_MemberTags")){bbapp.context.get("MemberCenter_MemberTags").fetch().always(function(){if(bbapp.getView("modules.membercenter.MemberTag")){bbapp.getView("modules.membercenter.MemberTag").render()}});if(bbapp.getView("modules.membercenter.MemberTag")){bbapp.getView("modules.membercenter.MemberTag").taggingOverlay.hide()}}},memberTagsRedirectCompletionUrl:function(b){var a=ta.id("memberTagsCompletionUrl");if(a&&a.value){window.location.href=a.value}}};ta.overlays.PopoutOverlay=new Class({Extends:ta.overlays.Overlay,options:{backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true},initialize:function(a,b){this.parent(a,b);this.placeholder=new Element("div").inject(this.source,"before").adopt(this.source);this.placeholder.setStyles({marginBottom:this.source.style.marginBottom,marginTop:this.source.style.marginTop});this.source.setStyles({marginBottom:0,marginTop:0});if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}this.show()},show:function(a){this.sourceCoords=this.source.getCoordinates();this.placeholder.setStyles({width:this.sourceCoords.width,height:this.sourceCoords.height});this.inner.adopt(this.source);this.parent(a)},hide:function(a){this.parent(a);this.placeholder.adopt(this.source).setStyles({width:"auto",height:"auto"})},position:function(){var b=parseInt(this.container.getStyle("borderTopWidth").replace(/px/,""));var a=parseInt(this.container.getStyle("borderLeftWidth").replace(/px/,""));this.container.setStyles({left:this.sourceCoords.left-a,top:this.sourceCoords.top-b,width:this.sourceCoords.width,display:"block"});this.parent()}});ta.overlays.PopoutWithOverlay=new Class({Extends:ta.overlays.Overlay,options:{position:"topleft",edge:"topright",offset:{x:-10,y:0},scrollOffset:-20,backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true},initialize:function(a,b){this.parent(a,b);this.placeholder=new Element("div").inject(this.source,"before").adopt(this.source);this.popout=new Element("div",{styles:{position:"absolute",zIndex:"10002",fontSize:"0.75em",display:"none"}}).inject(document.body);if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}this.show()},show:function(b){this.parent(b);var a=this.source.getCoordinates();this.placeholder.setStyles({width:a.width,height:a.height,marginBottom:this.source.style.marginBottom,marginTop:this.source.style.marginTop});this.popout.setStyles({left:a.left,top:a.top,width:a.width,display:"block"}).adopt(this.source)},hide:function(a){this.parent(a);this.placeholder.adopt(this.source).setStyles({width:"auto",height:"auto"});this.popout.setStyle("display","none")},position:function(){var a=this.source.getCoordinates();this.container.setStyles({left:null,top:a.top+this.options.offset.y,right:window.getWidth()-(a.left+this.options.offset.x)});this.parent();window.scrollTo(0,a.top+this.options.offset.y+this.options.scrollOffset)}});ta.overlays.CoverOverlay=new Class({Extends:ta.overlays.Overlay,options:{autoShow:true,xOff:0,yOff:0},initialize:function(a,b){this.parent(a,b);if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}if(this.options.autoShow){this.show()}},position:function(){var b=this.source.getCoordinates();var a=this.container.getCoordinates();this.container.setStyles({left:b.left+(b.width/2-a.width/2)+this.options.xOff,top:b.top+(b.height/2-a.height/2)+this.options.yOff})},updateBackdrop:function(){var a=this.source.getCoordinates();this.backdrop.setStyles({left:a.left,top:a.top,width:a.width,height:a.height})}});ta.overlays.SpecialDropDownWithRangeOverLay=new Class({Extends:ta.overlays.RelativeOverlayBelow,options:{onClose:false,onShow:false},initialize:function(a,b){var d=["vrPriceMinDropDown","vrPriceMaxDropDown","vrPricePeriodDropDown"];var c="";if(b.id&&d.contains(b.id)){c="vrPriceDropDown"}this.parent(Object.merge({below:true,innerDivClass:"",style:c,autoShow:false},a),b);this.container.removeClass("relative");if(a.onClose){this.options.onClose=a.onClose}if(a.onShow){this.options.onShow=a.onShow}},show:function(h){if(this.visible){this.hide();return}try{this.options.onShow()}catch(g){}var b=h.srcElement?h.srcElement:h.target;if(b){this.source=b}if(this.options.sourceId){this.source=ta.id(this.options.sourceId);this.source.addClass("selected")}var d=ta.select(".overlay");for(var f=0;f<d.length;f++){var c=d[f];if(c.contains(this.source)){var a=c}}if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1)}document.addEvent("click",this.hide);this.parent(h)},hide:function(b){if(this.options.onClose){try{this.options.onClose()}catch(a){}}if(this.options.rangeInputClass){try{if(this.options.closeOnlyIfClick&&!b){return}if(this.container.getElements("."+this.options.rangeInputClass)[0].contains(b.target)){return}}catch(a){}}this.hideNow()},hideNow:function(a){if(this.options.sourceId){this.source.removeClass("selected")}document.removeEvent("click",this.hide);this.parent()},position:function(){var a=this.source.getPosition();this.container.setStyles({left:a.x+this.options.xOffset?this.options.xOffset:0,top:a.y+this.options.yOffset?this.options.yOffset:0});this.parent()}});ta.overlays.FooterPocketWithInsertOverlay=new Class({Extends:ta.overlays.PermanentOverlay,Binds:["_handleResize","_hide","show","hide","destroy"],_closeButtonClass:"closeOverlayLarge",_hideOverflow:true,initialize:function(d,e,f){var c="np footerPocketWithInsert";if(ta.retrieve("mapsv2.abg_map_view")){c=c+" abg_map_view zoom_open"}if(d.style){c=c+" "+d.style}if(d.dontHideOverflow){this._hideOverflow=false}var a=Object.merge({draggable:false,permanent:true,toWindow:false,xOffset:f,yOffset:f,closeButtonClass:this._closeButtonClass,backdrop:d.tabletFullScreen?ta.overlays.BACKDROP_NEVER:ta.overlays.BACKDROP_ALWAYS},d);a.style=c;this.parent(a,e);var b=this;this.addEvent("onClose",function(){b._removeEvents()})},_loadEvents:function(){window.addEvent("resize",this._handleResize);window.addEvent("load",this._handleResize)},_removeEvents:function(){window.removeEvent("resize",this._handleResize);window.removeEvent("load",this._handleResize)},hide:function(){this._removeEvents();this.parent();if(this._hideOverflow){document.body.style.overflow="auto"}},show:function(){if(this._hideOverflow){document.body.style.overflow="hidden"}this.parent();this._loadEvents();this.footerPocket=this.container.getElement(".js_footerPocket");this._handleResize()},toggleCloseButton:function(a){var b=this.container.getElement("."+this._closeButtonClass);if(b){b.setStyle("visibility",a?"visible":"hidden")}},_handleResize:function(){var b,c;if(this.options.tabletFullScreen){b="100%";c="100%"}else{b=window.getSize().x;var e=this.options.xOffset*2;c=b-e;var a=parseInt(this.footerPocket.getStyle("min-width"))||0;var d=a-e;if(c<d){c=d}}this.container.setStyle("width",c);this.container.setStyle("top",this.options.yOffset);if(this.backdrop){this.backdrop.setStyle("width",b);this.backdrop.setStyle("min-width",a+3)}this.footerPocket.setStyle("width",b)}});ta.overlays.StaticOverlay=new Class({Extends:ta.overlays.RelativeOverlay,initialize:function(a,b){this.parent(Object.merge({autoShow:false},a),b);this.container.removeClass("relative")},position:function(a){this.container.position({position:"center",offset:{x:this.options.offsetX||0,y:this.options.offsetY||0}});this.parent()},hide:function(d){if(d==null){return}var a=d.srcElement?d.srcElement:d.target;if(this.container.contains(a)){return}if(this.options.childrenOverlays){for(var c=0;c<this.options.childrenOverlays.length;c++){var b=this.options.childrenOverlays[c];if(b.container.contains(a)){return}}}this.parent()}});if(!ta.overlays.filters){ta.overlays.filters={}}ta.overlays.filters.CheckboxOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","doOnInit","buildContent"],options:{showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,style:"date_picker_calendar",multiSelect:true,autoShow:false,delayShow:true,noPadding:true,keepElementInDocument:true,filterType:"",closeOnSelect:true},initialize:function(c,b){var a=Object.merge(this.options,c);this.input=document.getElement(".hotel_filter_wrap ."+a.filterType);this.parent(a,this.input);this.source.removeEvent("click",this.show);this.setupStandardBehavior();this.doOnInit()},setupStandardBehavior:function(){this.input.overlay=this;if(this.container){this.parentOverlay=this.container.getParent(".overlay");if(this.parentOverlay){this.parentOverlay=this.parentOverlay.overlay;this.options.isChild=true}}},doOnInit:function(){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType)},buildContent:function(b,e){var a=ta.retrieve("hac.data.object");var h=document.createDocumentFragment();if(a&&a.filters){var d=a.filters[e];if(d){var f=document.createElement("ul");var g=d.options.length;f.className="hacFilterItems "+d.hacName;if(g>8){f.className=f.className+" manyItems"}h.appendChild(f);var c=this;Array.each(d.options,function(i){c.addCheckboxItem(d,e,i,f,c,a)})}b.empty().appendChild(h)}},addCheckboxItem:function(g,b,c,e,h,d){var n="";if(h.isItemDisabled(c)){n="disabled"}var p="";if(n!=""){p="disabled=''"}var l=new Element("li");l.className="hacFilterItem";var j="";var a=b=="showUnavailable";if(a){j="showUnavailable"}if(n||a){l.className=l.className+" "+n+" "+j}if(c.value==0&&!a){l.className=l.className+" default"}var i=b;if(!h.isItemDisabled(c)){l.addEvent("click",function(r){(function(){h.dataItemClick.call(h,l,g.hacName,i,ta.hac.filters.getItemValue(c,b))}).delay(10);return false})}if(a){var k=new Element("hr");e.appendChild(k)}e.appendChild(l);var f="";if(a){if(c.value==1){f="checked=checked"}}else{if(h.isCheckboxItemSelected(d.selected,g.hacName,c.value)){f="checked=checked"}}var m=h.getItemDisplayFragment(c,b);var q=g.hacName+"_"+c.value;var o="";if(!a){o="<span class='itemCount'>("+c.count+")</span>"}else{q=g.hacName}l.innerHTML="<input type='checkbox' id='"+q+"' class='"+q+" "+n+"' "+f+" "+n+" /><span class='dataItem "+n+"'>"+m+o+"</span>"},dataItemClick:function(g,b,a,f){var h;if(ta.has("hac.filter.click.timeout")){ta.remove(ta.hac.filters.getHacFilterTimeoutKey());clearTimeout(ta.remove("hac.filter.click.timeout"))}this.fixCheckboxesInFilter(g);h=ta.hac.filters.updateFilterHash(b,this.getFilterSelections(b));var c=ta.has("persistentFilters.showing")?a+"|persistent_bar":a;if(h){try{var d="click";if(g&&g.getElement("input")&&!g.getElement("input").checked){d="unclick"}if(typeof pageServlet!="undefined"&&pageServlet=="Hotels"&&!ta.isMetaHotelsRequest()){ta.setEvtCookie(ta.hac.filters.getModuleString(this.options.filterType),d,c,f,"/HACSearch")}else{ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),d,c,f)}}catch(j){}var i=this;ta.store("hac.filter.click.timeout",setTimeout(function(){ta.remove("hac.updates.running");if(window.pageServlet=="Hotels"){ta.hac.filters.closeAllActiveFilters()}i.updateHACResults.call(i);ta.remove(ta.hac.filters.getHacFilterTimeoutKey())},2000));ta.store(ta.hac.filters.getHacFilterTimeoutKey(),ta.retrieve("hac.filter.changed"))}},updateHACResults:function(){if(this.options&&this.options.closeOnSelect){this.hide()}ta.hac.filters.updateResultsFromFilters()},setCloseOnSelect:function(a){if(this.options&&this.options.closeOnSelect){this.options.closeOnSelect=a}},fixCheckboxesInFilter:function(d){var d=ta.id(d);if(!d||d.hasClass("disabled")){return}if(d.hasClass("hacFilterItem")){d.getElement("input").checked=!d.getElement("input").checked}if(d.hasClass("default")){var e=d.getParent(".hacFilterItems");if(e){Array.each(e.getElements(".hacFilterItem"),function(f){f=ta.id(f);if(!f.hasClass("default")){f.getElement("input").checked=false}else{f.getElement("input").checked=true}})}}else{var b=false;var e=d.getParent(".hacFilterItems");if(!d.getElement("input").checked){var a=e&&document.getElements(".hacFilterItems input:checked");if(!a||!a.length){b=true}}if(e){var c=e.getElement(".default");if(c){c.getElement("input").checked=b}}}},getFilterSelections:function(c){var a=[];if(c=="showUnavailable"){a=document.getElements(".hacFilterItem."+c+" input:checked")}else{if(c){a=document.getElements(".hacFilterItems."+c+" input:checked")}else{a=document.getElements(".hacFilterItems input:checked")}}var b=[];Array.each(a,function(d){if(d.id!=c+"_0"){b.push(d.id)}else{if(c=="showUnavailable"){b.push("showUnavailable")}}});return b},addExpandableItem:function(c,d){var g=document.createDocumentFragment();var e=new Element("li");e.className=c+" expandFilterItem";g.appendChild(e);var f=document.createElement("div");f.className="nameItem sprite-filter-expand";if(ta.has("filterNames."+c)){f.innerHTML=ta.retrieve("filterNames."+c)}else{if(ta.has("hotels.currencies")&&"currencies"==c){f.innerHTML=ta.retrieve("hotels.currencies")[0]}else{f.innerHTML=c}}var b=new Element("div");b.className="toggleItem";e.appendChild(f);e.appendChild(b);var a=this;e.addEvent("click",function(){a.expandableClick.call(a,c,e)});d.appendChild(g)},expandableClick:function(){return},getItemDisplayFragment:function(a,b){return ta.hac.filters.getItemDisplayFragment(a,b,this.isItemDisabled(a))},isCheckboxItemSelected:function(c,a,f){if(!c){return false}var d=a+"_"+f;var b=c.cb;if(f!=0){if(b&&b.contains(d)){return true}}else{var e=false;if(b){Array.each(b,function(g){if(g.indexOf(a)!=-1){e=true}})}if(!e){return true}}return false},isItemDisabled:function(a){if(a&&a.count>0){return false}return true},destroy:function(){this.parent();this.input.overlay=null},nonSourceHide:function(a){if(!this.source.containsEvent(a)){this.hide()}},show:function(g){var d=this.visible;this.parent(g);document.removeEvent("click",this.hide);document.addEvent("click",this.nonSourceHide);if(this.options.filterType!="more"){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType)}if(d){return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}if(ta.has("persistentFilters.showing")&&tabletOnFullSite&&this.container){this.container.setStyle("position","fixed")}var c=document.getElement(".hotel_filter."+this.options.filterType);var f=document.getElement(".date_picker_calendar."+this.options.filterType);if(ta.util.i18n.isRtl()){var b=c.getCoordinates().width;var a=f.getCoordinates().width;this.options.offsetLeft=a-b}else{this.options.offsetLeft=0}this.position();return this},hide:function(a){if(!this.visible){return}document.removeEvent("click",this.nonSourceHide);this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}}});ta.overlays.filters.ClassOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"hotel_class"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.RatingOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"traveler_rating"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.PriceOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"price"},initialize:function(b,a){this.parent(b,a)},doOnInit:function(){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType);if(ta.has("hotels.currencies")){this.addExpandableItem("currencies",this.inner.getElement(".hotelFilterContent"))}this.addShowUnavailableCheckbox(this.inner.getElement(".hotelFilterContent"))},expandableClick:function(b,c){var a=c.getElement(".toggleItem");if(a&&a.innerHTML!=""){a.innerHTML="";if(ta.id(c).getElement(".nameItem")){ta.id(c).getElement(".nameItem").removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}}else{this.buildCurrencyContent(c.getElement(".toggleItem"),"currencies");var d=ta.id(c).getParent(".expandFilterItems");if(d){var e=d.getElements("li");if(e){Array.each(e,function(g){g=ta.id(g);var f=g.getElement(".nameItem");if(!g.hasClass("currencies")&&f&&f.hasClass("sprite-filter-collapse")){var h=g.getElement(".toggleItem");if(h){h.innerHTML=""}f.removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}})}}if(ta.id(c).getElement(".nameItem")){ta.id(c).getElement(".nameItem").removeClass("sprite-filter-expand").addClass("sprite-filter-collapse")}}},show:function(){if(ta.has("ta.calendar.isPriceOverlayCalendar")){return}this.parent();if(ta.has("hotels.currencies")){this.addExpandableItem("currencies",this.inner.getElement(".hotelFilterContent"))}this.addShowUnavailableCheckbox(this.inner.getElement(".hotelFilterContent"))},nonSourceHide:function(a){if(!this.source.containsEvent(a)&&!this.inner.containsEvent(a)){this.hide()}},addShowUnavailableCheckbox:function(d){var a=ta.retrieve("hac.data.object");if(a&&a.filters){var f={hacName:"showUnavailable"};var e=this;var g=a.selected.showUnavailable;var c=ta.retrieve("filterNames.showUnavailable");var b={label:c,count:1,value:g?1:0};e.addCheckboxItem(f,"showUnavailable",b,d,e,a)}},buildCurrencyContent:function(a){var d="";var g=document.createDocumentFragment();var e=document.createElement("ul");var c=ta.retrieve("hotels.currencies");if(c){var f=c.length;e.className="hacFilterItems currency";if(f>8){e.className=e.className+" manyItems"}g.appendChild(e);var b=this;Array.each(c,function(j,i){var m=new Element("li");m.className="hacFilterItem";m.addEvent("click",function(n){(function(){b.currencyItemClick.call(b,j)}).delay(10);return false});e.appendChild(m);var l="";var k=b.getItemDisplayFragment(j,"currencies");var h="currency_"+j;m.innerHTML="<span class='dataItem'>"+k+"</span>"})}a.innerHTML="";a.appendChild(g)},currencyItemClick:function(a){ta.commerce.meta.clearStoredMiniData();if(a.test(/[A-Z]{3}/)){ta.store("ta.commerce.MetaHacOverlay.currency",a);new Request({url:"/ActionRecord?action=MetaCurrencyPicker"}).send();ta.trackEventOnPage("MetaCurrencyPicker","selected",a,1);ta.hac.filters.changeCurrency()}if(this.hide){this.hide()}},showCalendarLightbox:function(d){var c=ta.hac.filters.getModuleString(this.options.filterType);var e="open_calendar";var b="price";ta.trackEventOnPage(c,e,b,0,false);var a=ta.retrieve("ta.overlays.filters.PriceOverlay.showCalendarLightbox");if(typeof(a)=="function"){a()}else{this.buildCalendarLightbox(d)}},calendarLightBoxOverlay:null,buildCalendarLightbox:function(e,a){var d;d=ta.id("PriceFilterCalendarOverlayContent");if(!d){return}d.show();var c={style:"priceFilterCalendarOverlay",innerDiv:"skv3",content:d,autoShow:false,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",onShow:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.store("ta.calendar.isPriceOverlayCalendar",true);var h=null;var g=document.getElement("date_picker_in_PriceFilterCalendar");setTimeout(function(){ta.overlays.Factory.loadDatePicker(h,g,"PriceFilterCalendar","",ta.servlet.HACSearch.doMetaDateSearch)},100);if(this.calendar){this.calendar.reposition()}},onClose:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.remove("ta.calendar.isPriceOverlayCalendar")},onHide:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.remove("ta.calendar.isPriceOverlayCalendar")}};var f=ta.id("HEADING");var b=new ta.overlays.CenteredOverlay(c,f);ta.store("ta.overlays.filters.PriceOverlay.showCalendarLightbox",function(){b.show()})},buildContent:function(a,b){if(ta.retrieve("meta.hotels_no_prices")&&!ta.widgets.calendar.hasPageDates()){this.showCalendarLightbox(a)}else{this.parent(a,b)}}});ta.overlays.filters.NeighborhoodOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"neighborhood"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.AmenitiesOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"amenities"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.BrandOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"hotel_brand"},initialize:function(b,a){this.parent(b,a)},getItemDisplayFragment:function(a){if(typeof brandMappings!="undefined"){return"<span class='itemLabel'>"+brandMappings[a.value]+"</span>"}return""}});ta.overlays.filters.MoreOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"more",moreOptions:""},initialize:function(b,a){if(b.moreOptions){this.displayFilters=b.moreOptions.split(" ")}this.parent(b,a)},doOnInit:function(){var b=document.createDocumentFragment();var a=new Element("ul");a.className="expandFilterItems more";b.appendChild(a);this.inner.getElement(".hotelFilterContent").innerHTML="";this.inner.getElement(".hotelFilterContent").appendChild(b);moreOvly=this;Array.each(this.displayFilters,function(c){var d=ta.retrieve("hac.data.object");if(d&&d.filters){var e=d.filters[c];if(e&&e.options.length>0){moreOvly.addExpandableItem.call(moreOvly,c,a)}}})},nonSourceHide:function(a){if(!this.source.containsEvent(a)&&!this.inner.containsEvent(a)){this.hide()}},expandableClick:function(c,b){var f=ta.has("persistentFilters.showing")?c+"|persistent_bar":c;var a=b.getElement(".toggleItem");if(a&&a.innerHTML!=""){a.innerHTML="";if(ta.id(b).getElement(".nameItem")){ta.id(b).getElement(".nameItem").removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),"close",f)}else{this.buildContent(b.getElement(".toggleItem"),c);var d=ta.id(b).getParent(".expandFilterItems");if(d){var e=d.getElements("li");if(e){Array.each(e,function(h){h=ta.id(h);var g=h.getElement(".nameItem");if(!h.hasClass(c)&&g&&g.hasClass("sprite-filter-collapse")){var i=h.getElement(".toggleItem");if(i){i.innerHTML=""}g.removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}})}}if(ta.id(b).getElement(".nameItem")){ta.id(b).getElement(".nameItem").removeClass("sprite-filter-expand").addClass("sprite-filter-collapse")}ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),"open",f)}}});ta.overlays.filters.SortOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"sort"},initialize:function(b,a){this.parent(b,a)},addCheckboxItem:function(e,a,b,d,f,c){var h=new Element("li");h.className="hacFilterItem";if(b.value==0){h.className=h.className+" default"}var g=this;h.addEvent("click",function(k){if(window.pageServlet=="WidgetEmbed"){ta.hac.filters.changeSort(b.value);ta.trackEventOnPage(ta.hac.filters.getModuleString(g.options.filterType),"click",b.value)}else{ta.pages.hac.hacSortChangedToValue(b.value)}g.hide();return false});d.appendChild(h);var i=f.getItemDisplayFragment(b,a);var j=b.value;h.innerHTML="<span class='dataItem'>"+i+"</span>"}});(function(j,h,d,b){var f="GuestRoomSelector",i="grp-rooms",e="grp-guests",q="grp-update",c="-value",p="singular_room_da",l="plural_rooms_da",g="singular_guest_da",k="plural_guests_da",o="rooms_guests_picker_update_da",a=function(s,r,v){var u=s.replace("grp-",""),t=r+"_"+u;d.trackEventOnPage(f,t,null,v)},n=function(){d.trackEventOnPage(f,"update_click")},m=function(r){var s=r&&r.target&&$(r.target).getParent(".date_picker_calendar");return(s!=null)};d.overlays.GuestsRoomsOverlay=new Class({Extends:d.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","hideByClickOnDocument"],options:{showCloseButton:false,activate:d.overlays.ACTIVATE_CLICK,multiSelect:true,autoShow:false,delayShow:true,noPadding:true,keepElementInDocument:true,closeOnSelect:false},callback:null,selectionModified:false,findTargetFunction:false,initialize:function(t,s){this.callback=t.moreOptions.callback;if(t.guestsRoomsData){this.saveData(t.guestsRoomsData)}this.buildContent(t);this.input=t.moreOptions.input;this.findTargetFunction=t.moreOptions.findTargetFunction;var r=Object.merge(this.options,t);this.parent(r,this.input);this.source.removeEvent("click",this.show);this.setupStandardBehavior()},setupStandardBehavior:function(){if(this.input.getParent(".overlay")){this.parentOverlay=this.input.getParent(".overlay").overlay;this.options.isChild=true}},getData:function(){return d.widgets.calendar.getGuestsRoomsPickerData()},saveData:function(r){d.store("guests.rooms.object",r)},resetData:function(){var r={rooms:1,guests:2};this.saveData(r);return r},updateSessionGuestsRooms:function(t){var s;if(d.widgets.calendar.hasPageDates()){s=d.widgets.calendar.getCheckRatesData()}else{var u=this.getData();s={rooms:u.rooms,adults:u.guests}}var r=this;new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(s),method:"post",onSuccess:function(){r.runCallback(t)}}).send()},runCallback:function(r){if(this.callback&&typeof(this.callback)==="function"&&d.widgets.calendar.hasPageDates()){this.callback(r)}},resetOverlay:function(){this.resetData();this.updateOverlay(i);this.updateOverlay(e)},getTranslationString:function(s){var t=this.getData();var r;if(s===i){r=t.rooms;if(r===1){return d.retrieve(p)}else{return d.retrieve(l)}}else{if(s===e){r=t.guests;if(r===1){return d.retrieve(g)}else{return d.retrieve(k)}}else{if(s===q){return d.retrieve(o)}}}},getCounter:function(s){var t=this.getData();var r;if(s==i){r=t.rooms}else{if(s===e){r=t.guests}}return r},buildContent:function(s){var t=new Element("ul");t.className="guests_rooms_overlay";var v=this.buildButtonLine(i);t.appendChild(v);var u=this.buildButtonLine(e);t.appendChild(u);var r=this.buildUpdateLine();t.appendChild(r);s.content=t},buildButtonLine:function(x){var t=this.getCounter(x);var v=this.getTranslationString(x);var s=new Element("li");s.className="line";s.id=x;var y=new Element("div");y.className="signButton minusButton";if(t===1){y.className+=" disabled"}y.setContent("-");var u=this;y.addEvent("click",function(z){u.processDecrementCounter(x,true)});var r=new Element("div");r.className="numberLabelText";r.setContent(t+" "+v);var w=new Element("div");w.className="signButton plusButton";if(x===i&&t>7){w.className+=" disabled"}else{if(x===e&&t>31){w.className+=" disabled"}}w.setContent("+");w.addEvent("click",function(z){u.processIncrementCounter(x,true);z.stopPropagation()});s.appendChild(y);s.appendChild(r);s.appendChild(w);return s},processDecrementCounter:function(t,r){var u=this.getData(),v;if(t===i){if(u.rooms<=1){return}u.rooms-=1;v=u.rooms;this.saveData(u);this.updateOverlay(t);while((u.guests/4)>u.rooms){this.processDecrementCounter(e)}}else{if(t===e){if(u.guests<=1){return}u.guests-=1;v=u.guests;this.saveData(u);this.updateOverlay(t);var s=(u.guests<u.rooms);if(s){this.processDecrementCounter(i)}}}if(r){a(t,"subtract",v)}},processIncrementCounter:function(s,r){var u=this.getData(),v;if(s===i){if(u.rooms>7){return}u.rooms+=1;v=u.rooms;this.saveData(u);this.updateOverlay(s);var t=(u.rooms>u.guests);if(t){this.processIncrementCounter(e)}}else{if(s===e){if(u.guests>31){return}u.guests+=1;v=u.guests;this.saveData(u);this.updateOverlay(s);var t=((u.guests/4)>u.rooms);if(t){this.processIncrementCounter(i)}}}if(r){a(s,"add",v)}},updateOverlay:function(r){var t=this.buildButtonLine(r);var s=d.id(r);s.parentNode.replaceChild(t,s);this.selectionModified=true;this.updateCounterElement(r)},updateCounterElement:function(s){var t=this.getCounter(s);var r=$$("."+s+c);r.each(function(u){u.innerHTML=t});if(s===i){d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".roomsGuestsButton.roomsButton",t);d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.rooms",t)}else{if(s===e){d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".roomsGuestsButton.guestsButton",t);d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.guests",t)}}},buildUpdateLine:function(){var v=this.getTranslationString(q);var r=new Element("li");r.className="line update";r.id=q;var t=new Element("div");t.className="updateButton rndBtn rndBtnGreen";var s=this;t.addEvent("click",function(x){s.processUpdate(x);s.hide();n()});var u=new Element("div");u.className="ui-btn-inner";var w=new Element("div");w.className="ui-btn-text";w.setContent(v);u.setContent(w);t.setContent(u);r.setContent(t);return r},processUpdate:function(r){if(!this.selectionModified){if(this&&this.parentOverlay&&this.parentOverlay.visible&&d.widgets.calendar.hasPageDates()){this.parentOverlay.hide()}return}this.selectionModified=false;this.updateSessionGuestsRooms(r)},destroy:function(){this.parent();this.input.overlay=null},nonSourceHide:function(r){if(!this.source.containsEvent(r)&&!(r.target.className.contains("signButton"))){this.hide(r)}},hideByClickOnDocument:function(r){if(this.parentOverlay&&this.parentOverlay.visible){return}else{this.hide(r)}},show:function(s){var t=this.visible,u;this.parent(s);j.removeEvent("click",this.hide);j.addEvent("click",this.nonSourceHide);j.removeEvent("click",this.hideByClickOnDocument);$$(".date_picker_calendar").addEvent("click",this.nonSourceHide);u=this.findTargetFunction(s);if(u){this.source=u}d.widgets.calendar.syncAllDatePickers();if(t){this.hide(s);return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==d.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.position();var r=$$(".roomsGuestsButtonWrap .roomsGuests");if(r){r.addClass("disabled")}return this},hide:function(s){if(!this.visible){return}j.removeEvent("click",this.nonSourceHide);$$(".date_picker_calendar").removeEvent("click",this.nonSourceHide);this.parent(s);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}var r=$$(".roomsGuestsButtonWrap .roomsGuests");if(r){r.removeClass("disabled")}this.processUpdate(s)}});d.overlays.GuestsRoomsOverlay.closeModalAndUpdateCount=function(s){d.trackEventOnPage("PriceFinder_PromptChange",s?"revert":"update");var r=d.find(".ui_modal.increase_rooms_modal");var t=d.find(".ui_backdrop.increase_rooms_modal_backdrop");if(!s){var v={rooms:1,guests:2};v.rooms=d.overlays.GuestsRoomsOverlay.roomsNew;v.guests=d.overlays.GuestsRoomsOverlay.guestsNew;d.store("guests.rooms.object",v);d.overlays.NumberPickerOverlay.updateHeaderMsg(".metaDatePicker",r);var u=d.find(".change_dates_button");u&&d.servlet.HACSearch.doMetaDateSearch(null,u)}};d.overlays.GuestsRoomsOverlay.trackPickerClick=function(r){if(m(r)){d.trackEventOnPage(f,"select_guest_room_calendar")}else{d.trackEventOnPage(f,"select_guest_room")}}})(document,window,ta);(function(k,i,h,d){var e={rooms:{max:8,singularKey:"rgPicker.1Room",pluralKey:"rgPicker.nRooms",tracking:"RoomSelector"},guests:{max:32,singularKey:"rgPicker.1Guest",pluralKey:"rgPicker.nGuests",tracking:"GuestSelector"}},a=4,j=function(n,p){p=h.id(p);if(p){var o=p.getWidth();if(n&&n.container&&o>n.container.getWidth()){n.container.setStyle("width",o-2)}}},c=function(s,t,o){var r=e[o],q={type:o,singular:h.retrieve(r.singularKey),plural:h.retrieve(r.pluralKey),maxValue:r.max,target:t,tracking:r.tracking},n=l(o),p=h.retrieve(n)||new h.overlays.NumberPickerOverlay(q,t);h.store(n,p);if(t&&t.getParent("#hotels_lf_header_bar")&&p){p.addEvent("onShow",j.bind(this,p,t))}p.show(s);h.fireEvent("showRoomGuestPicker");return p},l=function(n){return"numberPickerOverlay_"+n},m=function(p,o,n){return p>1?n.replace("123",p):o},g=function(){return h.widgets.calendar.getGuestsRoomsPickerData()},f=function(n){h.store("guests.rooms.object",n)},b=function(p,r){var q=g(),n=function(v){var x=v.guests/Math.max(v.rooms,1);if(x>a){h.trackEventOnPage("PriceFinder","guest_per_room_exceeded",v.guests,v.rooms);var u=Math.ceil(v.guests/a);if(h.retrieve("priceFinder.noAutoRefresh")){h.overlays.GuestsRoomsOverlay.roomsNew=u;h.overlays.GuestsRoomsOverlay.guestsNew=v.guests;var s=h.find(".roomsAdultsModalLnk");var z=s.getAttribute("data-subheader");var w="";z&&(w=z.replace(/%ROOMS%/g,u));s.setAttribute("data-subheader",w);s.click();var A=h.find(".increase_rooms_modal .yesUpdate");var y=h.find("#STATIC_DATE_PICKER_BAR .yesTxt");A&&y&&(A.innerHTML=y.innerHTML.replace(/%ROOM%/g,u));var t=h.find(".increase_rooms_modal .subheader_text");t&&(t.innerHTML=(s.getAttribute("data-subheader")));s.setAttribute("data-subheader",z);v.rooms=h.overlays.GuestsRoomsOverlay.roomsOld;v.guests=h.overlays.GuestsRoomsOverlay.guestsOld;h.store("guests.rooms.object",v);h.overlays.NumberPickerOverlay.updateHeaderMsg(".metaDatePicker");return}v.rooms=u}else{if(v.rooms>v.guests){v.rooms=v.guests}}},o=function(t){var s=t.guests/Math.max(t.rooms,1);if(s>a){t.guests=t.rooms*a}else{if(t.rooms>t.guests){t.guests=t.rooms}}};if(q[p]===r){return false}q[p]=r;if(p==="rooms"){o(q)}else{if(p==="guests"){n(q)}}f(q);return true};h.overlays.NumberPickerOverlay=new Class({Extends:h.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","hideByClickOnDocument"],options:{activate:h.overlays.ACTIVATE_CLICK,style:"numberPickerOverlay",multiSelect:false,autoShow:false,delayShow:false,noPadding:true,keepElementInDocument:true,closeOnSelect:true,waitForCss:true},callback:function(){if(h.retrieve("hh_short_cell.enabled")||h.retrieve("hh_two_view_deal_chevrons.enabled")){if(this.source&&this.source.className&&this.source.className.indexOf("placement_hh")!=-1&&h.commerce.metajson){h.commerce.metajson.refetchAll()}}else{if(i.pageServlet=="Hotels"){h.widgets.calendar.checkDatesMakeHacCallHotels()}else{var n=h.retrieve("meta.baseLocationId");h.widgets.calendar.checkDatesMakeHacCallHR(n)}}h.retrieve("priceFinder.noAutoRefresh")&&this.source&&this.source.addClass("ready_for_update")},initialize:function(o,p){this.input=o.target;this.buildContent(o);if(p.getParent("#hotels_lf_header_bar")){this.options.style+=" hotels_lf"}if(p.getParent(".ibex_emphasis")){this.options.style+=" ibex_emphasis"}if(p.getParent(".delineate_meta_ib.vertical")){this.options.style+=" delineate_meta_ib vertical"}var n=Object.merge(this.options,o);this.parent(n,this.input);i.addEvent("date_bar_docked",this.position.bind(this));i.addEvent("date_bar_undocked",this.position.bind(this));i.addEvent("resize",this.position.bind(this))},buildContent:function(n){var o=new Element("div");o.appendChild(this.buildSelectorRows(n));n.content=o},buildSelectorRows:function(o){var n=this,p=new Element("ul"),r,q,s=function(u,t){u.addEvent("click",function(w){if(h.retrieve("priceFinder.noAutoRefresh")){var x=g();h.overlays.GuestsRoomsOverlay.roomsOld=x.rooms;h.overlays.GuestsRoomsOverlay.guestsOld=x.guests}var v=b(o.type,t);n.hide();h.trackEventOnPage(o.tracking,"Select",null,t);if(v){n.callback()}})};p.className="list";for(q=1;q<=o.maxValue;q++){r=new Element("li");r.setContent(m(q,o.singular,o.plural));r.className="item";s(r,q);p.appendChild(r)}return p},resetOverlays:function(){h.remove(l("rooms"));h.remove(l("guests"))},show:function(n){if(this.visible){this.hide(n)}else{if(this.parent){this.parent(n);this.position();h.trackEventOnPage(this.options.tracking,"Open")}}return this},position:function(){var q=h.id(this.source);var n=q.getParent("#hotels_lf_header_bar_wrap");if(q&&(q.getParent("#PERSISTENT_DATE_PICKER")||(n&&n.hasClass("fixed")))){var p=q.getCoordinates().left-i.getScrollLeft()-3;var o=q.getCoordinates().top-i.getScrollTop()+33;if(n){var p=q.getCoordinates().left-(i.isTabletOnFullSite?0:i.getScrollLeft());var o=q.getCoordinates().bottom-(i.isTabletOnFullSite?0:i.getScrollTop())}h.id(this.container).setStyles({position:"fixed",left:p+"px",top:o+"px","z-index":9991})}else{if(n){h.id(this.container).setStyle("position","absolute")}this.parent()}},hide:function(n){this.resetOverlays();this.parent(n)}});h.overlays.NumberPickerOverlay.roomsPicker=function(n,o){return c(n,o,"rooms")};h.overlays.NumberPickerOverlay.guestsPicker=function(n,o){return c(n,o,"guests")};h.overlays.NumberPickerOverlay.updateHeaderMsg=function(n){var s=g(),u=$$(n+" .roomsChange"),p=m(s.rooms,h.retrieve("rgPicker.1Room"),h.retrieve("rgPicker.nRooms")),t=$$(n+" .guestsChange"),r=m(s.guests,h.retrieve("rgPicker.1Guest"),h.retrieve("rgPicker.nGuests")),o=u.getElement("img"),q=(o&&o[0]&&o[0].outerHTML)||"";u.set("html",p+" "+q);t.set("html",r+" "+q)};h.overlays.NumberPickerOverlay.unhideDropdowns=function(n){var o=$$(n);if(o&&h.widgets.calendar.hasPageDates()){o.removeClass("hidden")}}})(document,window,ta);(function(h){h.registration=h.registration||{};var i=null;var e=null;var c=function(s){var q=0;var r=0;while(null!=s){q+=s.offsetLeft;r+=s.offsetTop;s=s.offsetParent}return{x:q,y:r}};var d=function(q){for(;(null!=q)&&!q.hasClass("overlay");q=q.parentElement){}return q};var n=function(t,q){var w=h.id("overlayRegFrame");if(!w){return}var s=d(w);if(!s){h.util.error.record(null,"No overlay parent element found.");return}var v=document.documentElement?document.documentElement.clientWidth:981;var r=document.documentElement?document.documentElement.clientHeight:600;var u=c(w);t=t?t:0;t=t>v?v-20:t;q=q?q:0;if(t>100){w.style.width=t+"px";s.style.left=(v/2)-(t/2)+"px";s.style.width=t+"px"}if(q>100){w.style.height=q+"px";s.style.top=((r/2)-(q/2))/3+"px";s.style.height=q+"px"}};var l=function(){if(e&&"function"===typeof(e)){e();e=null}};var f=function(r){h.registration.RegOverlay.close();l();if(r.jsCallback){p(r.jsCallback)}var q=r.fireEvent||"";if(q){h.fireEvent(q)}try{if(!h.util||!h.util.partials||("function"!==typeof h.util.partials.requestPartials)){return}h.util.partials.requestPartials(["IP_HEADER"],{ifb:true},"facebook",null)}catch(s){h.util.error.record(s,"Could not request IP partial.")}};var p=function(r){if(!r){return}if("string"===typeof r){if(0===r.indexOf("function")){r=j(r)}else{r=b(r)}}if("function"===typeof r){try{r()}catch(q){h.util.error.record(q,"Unable to trigger js callback from registration overlay.")}}};var b=function(r){var v=r.split(".");var u;for(var t=0,q=v.length;t<q;t++){var s=v[t];if(0===t){u=window[s];continue}if(u&&(s in u)){u=u[s]}else{return null}}return u};var j=function(r){var q=/^function\s*\(\s*\)\s*{(.*)}/.exec(r);if(q&&q[1]){try{return new Function(q[1])}catch(s){h.util.error.record(s,"RegOverlay failed to parse js callback: "+q[1])}}};var m=function(s){var u=s||window.event;if(!u){return}if(!u.origin||(0!==u.origin.indexOf("https"))||(-1===u.origin.indexOf("tripadvisor"))){return}if(!u.data||(-1===u.data.indexOf("action"))){return}var r;try{r=JSON.parse(u.data)}catch(u){return}var t=r.hasOwnProperty("action")?r.action:null;if(!t){return}switch(t){case"successClose":f(r);break;case"reloadWindow":location.reload(true);break;case"fwdToRelativeUrl":var q=r.url?r.url:"";if(!q){h.util.error.record(null,"No url specified to forward to.")}if(0!==q.indexOf("/")){h.util.error.record(null,"Cannot forward to absolute url: "+q)}window.location=q;break;case"resizeFrame":n(r.width,r.height);break;default:return}};var k=function(){h.store("member_gating_cta_shown",true)};var g=function(){return h.retrieve("member_gating_cta_shown")};var o=function(r,q){var t="760px";var s="auto";i=new h.overlays.CenteredOverlay({backdrop:h.overlays.BACKDROP_ALWAYS,style:"wide registrationOverlay",showCloseButton:true,closeButtonClass:"xCloseGreen",closeFunction:function(){h.registration.RegOverlay.close()},noPadding:true,waitForCss:true,yOffset:-10000,content:'<div id="overlayRegFrameWrap"></div>',onShow:function(){h.trackEventOnPage("regoverlay","show_overlay","",q,false);var v=document.createElement("iframe");v.src=r;v.id="overlayRegFrame";v.className="overlayRegFrame";v.scrolling="no";v.style.width=t;v.style.height=s;var u=h.id("overlayRegFrameWrap");if(!u){h.util.error.record(null,"The registration iframe wrapper was missing.");return}if(this.backdrop){this.backdrop.addEvent("click",h.registration.RegOverlay.close)}u.appendChild(v);window.scrollTo(0,0)},onClose:function(){h.trackEventOnPage("regoverlay","closed","",q,false)},onHide:function(){i=null}})};var a=function(q){if(!q||"object"!==typeof q){h.util.error.record(null,"Options object is invalid.");return false}if(!q.hasOwnProperty("flow")||!q.flow){h.util.error.record(null,"Options object missing required flow field.");return false}if(!q.hasOwnProperty("pid")||!q.pid){h.util.error.record(null,"Options object missing required pid field.");return false}return true};h.registration.RegOverlay={attachListener:function(){if(window.addEventListener){window.addEventListener("message",m,false)}else{window.attachEvent("onmessage",m)}},show:function(u,t,r){a(r);h.registration.RegOverlay.attachListener();if(!r.userRequestedForce){h.on("metaFocusShow",h.registration.RegOverlay.close());h.on("preMetaFocusShow",h.registration.RegOverlay.close())}if(r&&r.hasOwnProperty("onSuccess")&&"function"===typeof(r.onSuccess)){e=r.onSuccess}var q={flow:r.flow,pid:r.pid,mcid:r.mcid,locationId:r.locationId,stateToken:r.stateToken,jsCallback:r.jsCallback,requireSecure:r.requireSecure,returnTo:""};var s=h.util.URL.https("/RegistrationController?"+Object.toQueryString(q));if(r.userRequestedForce){o(s,r.pid);return}if(!g()){k();o(s,r.pid)}else{l()}},close:function(){if(i){i.hide();i=null}h.overlays.safeCloseCurrent()},showFullScreen:function(t,s,r){a(r);if(!r.hasOwnProperty("returnTo")||!r.returnTo){h.util.error.record(null,"Options object missing required returnTo field.");return}var q={flow:r.flow,pid:r.pid,mcid:r.mcid,locationId:r.locationId,stateToken:r.stateToken,jsCallback:r.jsCallback,returnTo:r.returnTo};window.location=h.util.URL.https("/RegistrationController?"+Object.toQueryString(q))}}}(ta));(function(a){a.util||(a.util={});a.util.typeOf=function(b){return Object.prototype.toString.call(b).match(/(\w+)\]$/)[1].toLowerCase()};a.util.merge=function(g){for(var c=1;c<arguments.length;c++){var e=arguments[c];if(!e){continue}g||(g=(a.util.typeOf(e)==="array")?[]:{});for(var b in e){var f=e[b];if(e.hasOwnProperty(b)&&a.util.typeOf(f)!=="undefined"){var d=a.util.typeOf(f);if(d==="string"||d==="number"||d==="boolean"||d==="function"||f===null){g[b]=f;continue}g[b]=a.util.merge(g[b],f)}}}return g}}(ta));(function(a,b){var c=function(e){var d=false;new Request({url:"/AuthCheck",data:{product:e},async:false,method:"get",onSuccess:function(f){if("true"===f.trim()){d=true}}}).send();return d};b.isAuthorized=function(d){return c(d)};b.register=function(f,e){if(f.popup){return a.registration.popup.open(f,e)}var g={servlet:"Register",action:"SIGNIN",data:function(){return{}}};var d=a.retrieve("ta.registration.currentUrlDefaults");f=a.util.merge(g,d,f||{},e||{});if(!f.product){return false}if(c(f.product)){return true}if(f.successAction){a.registration.setSuccessActionCookie(f.successAction)}a.util.post({url:"/"+f.servlet,https:true,data:{product:f.product,action:f.action,url:f.url,urlKey:f.urlKey,partnerKey:f.partnerKey,data:JSON.encode(f.data())}});return false};b.popup={defaultWidth:547,defaultHeight:435,options:null,urloptions:null,isPopup:null,open:function(o,p){a.registration.popup.options=o;a.registration.popup.urloptions=p;var i={servlet:"Register",action:"SIGNIN",data:function(){return{}}};var f=a.retrieve("ta.registration.currentUrlDefaults");o=a.util.merge(i,f,o||{},p||{});if(!o.product){return false}if(c(o.product)){return true}var l=document.location;var k=l.protocol+"//"+l.host;if(l.port){k+=":"+l.port}var e=k.replace("http://","https://")+"/"+o.servlet;var m=[];m.push("popup=true");m.push("product="+o.product);m.push("action="+o.action);m.push("url="+o.url);m.push("urlKey="+o.urlKey);m.push("partnerKey="+o.partnerKey);m.push("data="+JSON.encode(o.data()));e=e+"?"+m.join("&");var g=a.registration.popup.defaultWidth;var n=a.registration.popup.defaultHeight;var h=(screen.width-g)/2;var j=(screen.height-n)/2;var d=window.open(e.toString(),"registration","width="+g+", height="+n+", top="+j+", left="+h+", resizable=yes, scrollbars=yes");if(!d&&!isTabletOnFullSite){a.registration.popup.fallback()}return false},init:function(){if(a.registration.popup.isPopup==null){a.registration.popup.isPopup=isTabletOnFullSite||(window.opener&&window.getSize().x<(a.registration.popup.defaultWidth+150))}if(a.registration.popup.isPopup){var f=a.id("REG_CON");if(f){var e=f.getElement("div.regDlg");if(!e){e=f.getElement("div.whyDlg")}if(e){a.registration.popup.resize(e)}}var d=a.id("SS_SSO");if(d){var g=d.getElement("input[type=button]");if(g){g.addEvent("click",function(){a.registration.popup.resizeTo(980,560,true)})}}}else{window.location="/RegisterDone?fallback=true"}},done:function(e,g){if(window.opener){var f=window.opener;if(f.ta){if(g){a.registration.popup.fallback(true)}else{var d;if(f.ta.registration&&f.ta.registration.popup.options){d=f.ta.registration.popup.options.successAction}if(d){f.ta.registration.runSuccessAction(d)}else{if(e){f.location=e}}a.registration.popup.updateMasthead(a.registration.popup.close)}}else{a.registration.popup.close()}}else{if(e){a.registration.returnTo(e)}}},close:function(){if(window.opener&&window.opener!=window){window.opener=window;window.close()}},updateMasthead:function(i){var f=0;var h=setInterval(function(){f++;var j=a.id("avatarImage");if(h>20||!j||j.get("src")){clearInterval(h);try{if(window.opener&&window.opener.ta){e();g()}}catch(k){a.util.error.record(k,"secure popup - unable to update masthead",null,{},"WARN")}if(i){i()}}},250);var d=function(k){if(k&&window.opener){var j=new Element("div").adopt(k).innerHTML;if(j){k=window.opener.Elements.from(j)}}return k};var e=function(){var k=window.opener.document.getElement("head");var j=a.id("IP_HEADER_CSS");if(k&&j){j=d(j);if(j){k.adopt(j)}}};var g=function(){var j=a.id("USER_PREFS");var k=window.opener.ta.id("USER_PREFS");if(j&&k){j=d(j);if(j){j.replaces(k)}}}},fallback:function(e){var f=window;if(e&&window.opener){f=window.opener}f.focus();if(f.ta&&f.ta.registration){var d=f.ta.registration.popup;if(d.options){d.options.popup=false;f.ta.registration.register(d.options,d.urloptions)}}if(e){a.registration.popup.close()}},resize:function(f){if(f){a.registration.popup.disableScrollBars();var e=f.getScrollSize().x;var d=f.getScrollSize().y;window.onresize=function(){window.onresize=null;var h=e-window.getSize().x+1;var g=d-window.getSize().y+1;if(h!=0||g!=0){window.onresize=function(){window.onresize=null;a.registration.popup.center(e+h,d+g);a.registration.popup.enableScrollBars()};a.registration.popup.resizeBy(h,g)}else{a.registration.popup.enableScrollBars();a.registration.popup.center()}};a.registration.popup.resizeTo(e,d)}},resizeTo:function(f,e,d){if(d){window.onresize=function(){window.onresize=null;a.registration.popup.center()}}window.resizeTo(f,e)},resizeBy:function(f,e,d){if(d){window.onresize=function(){window.onresize=null;a.registration.popup.center()}}window.resizeBy(f,e)},center:function(g,d){if(!g){g=window.getSize().x}if(!d){window.getSize().y}var f=(screen.width-g)/2;var e=(screen.height-d)/2;window.moveTo(f,e);window.focus()},disableScrollBars:function(){window.document.getElement("body").setStyle("overflow","hidden")},enableScrollBars:function(){window.document.getElement("body").setStyle("overflow")}};(function(e,g){var j="1070328450902.apps.googleusercontent.com";var d={cookiepolicy:"single_host_origin",requestvisibleactions:"http://schemas.google.com/AddActivity",clientid:j,client_id:j,immediate:false,apppackagename:"com.tripadvisor.tripadvisor"};var f=0;function i(){e.store("registration.google.avail",true);var k=e.remove("registration.google.onAvail");k&&k.each(function(l){l()})}function h(){if(typeof d.scope==="undefined"){var k=["https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/userinfo.email"];if(e.retrieve("google_wallet_permission_desktop_signin.enabled")){k.push("https://www.googleapis.com/auth/payments.make_payments")}d.scope=k.join(" ")}return d}g.google={init:function(k){if(k){g.google.onAvail(k)}new Asset.javascript("https://plus.google.com/js/client:plusone.js",{onLoad:function(){if(gapi&&gapi.auth){gapi.auth.init(i)}else{var l=setInterval(function(){if(gapi&&gapi.auth){clearInterval(l);gapi.auth.init(i)}},100)}}})},onAvail:function(k){if(e.retrieve("registration.google.avail")){k()}else{e.keep("registration.google.onAvail",k)}},connect:function(l,k,n){k=k||"MASTHEAD";var m={flow:k};if(0===k.indexOf("EMAIL_ONLY_SIGNUP")){Object.merge(m,{isOverlay:false});if(typeof n==="function"){Object.merge(m,{responseCallback:n})}}if(l){f=l}if(typeof gapi=="undefined"){e.registration.google.init(e.registration.google.connect)}else{if(!e.has("google.sso.sending")){e.store("google.sso.sending",true);gapi.auth.signIn(Object.merge({callback:function(p){if(p&&p.status&&p.status.signed_in&&p.access_token){if(!e.has("google.sso.receiving")){e.remove("google.sso.sending");e.store("google.sso.receiving",true);var o="/GoogleRegistration?google_token="+p.access_token+"&pid="+f;new Request.JSON({url:o,method:"get",onSuccess:function(q){e.remove("google.sso.receiving");if(q.success){if(q.created){e.overlays.registration.connect(m,"GOOGLE_SIGNUP")}else{if(q.connected){e.overlays.registration.request("GOOGLE_THANKS",{google_token:p.access_token},m)}else{e.overlays.registration.cancel(m)}}}},onError:function(){e.remove("google.sso.receiving")},onFailure:function(){e.remove("google.sso.receiving")}}).send()}}}},h()))}}},ifConnected:function(l,k){if(gapi&&gapi.auth){gapi.auth.authorize({client_id:j,immediate:true,scope:h().scope.split(" ")},function(n){if(n&&n.status&&n.status.signed_in){var m="/GoogleRegistration?google_token="+n.access_token+"&verify=true";var o=e.retrieve("google.sso.returnTo");if(o){m+="&returnTo="+o}new Request.JSON({url:m,method:"get",onSuccess:function(p){if(p.success&&l){l()}else{if(k){k()}}},onFailure:k}).send()}else{if(k){k()}}})}else{k()}},ifLoggedIn:function(m,k){if(typeof gapi!="undefined"&&gapi.auth){var l={client_id:j,session_state:null};gapi.auth.checkSessionState(l,function(n){if(n===false){m()}else{if(k){k()}}})}},disconnect:function(){if(typeof gapi=="undefined"){e.registration.google.init(e.registration.google.disconnect)}else{gapi.auth.authorize(h(),function(k){if(k&&k.access_token){new Request.JSONP({url:"https://accounts.google.com/o/oauth2/revoke?token="+k.access_token,method:"get",onSuccess:function(){e.overlays.registration.post({action:"GOOGLE_DISCONNECT"})}}).send()}})}}}})(a,b);(function(f,h){var e=4194307;var i=656;var g=382;var d=null;h.vkontakte={connect:function(k,p,l){if(k){new Request({url:"/ActionRecord?action=vkAuthAttempt&pid="+k}).send()}if(f.retrieve("vk.sso.clicked")&&d&&d.window){d.window.close();f.store("vk.sso.clicked",false)}if(!f.retrieve("vk.sso.clicked")){f.store("vk.sso.clicked",true);var o=(screen.height-g)/2;var j=(screen.width-i)/2;var n="https://oauth.vk.com/authorize?client_id="+l+"&scope="+e+"&redirect_uri=https%3A%2F%2F"+location.hostname+"%2FVKRegistration";if(p){n+="Masthead"}d=window.open(n,"registration","width="+i+", height="+g+", top="+o+", left="+j+", resizable=yes, scrollbars=yes");if(!d){f.store("vk.sso.clicked",false);new Request({url:"/Actionrecord?action=vkAuthPopupBlocked&pid=39094"}).send();if(!p){this.showSSOError(f.retrieve("popupBlockerSSOError"))}}else{var m=setInterval(function(){if(d.closed){clearInterval(m);if(p){document.window.location.reload()}f.store("vk.sso.clicked",false)}},500)}}},registrationSuccess:function(){f.overlays.registration.connect({flow:"MASTHEAD"},"VK_SIGNUP")},loginSuccess:function(){f.overlays.registration.request("SIGNIN")},showSSOError:function(j){f.store("vk.sso.clicked",false);var k=f.id("ssoErrorMessage");if(k){k.removeClass("hidden");k.set("html",j)}},done:function(k,j){try{if(window.opener.ta&&window.opener.ta.retrieve("vk.sso.clicked")){this.performPostAuthAction(k,j)}}catch(l){window.close()}window.close()},doneMasthead:function(){window.close()},performPostAuthAction:function(j,k){var l=window.opener;l.ta.store("vk.sso.clicked",false);if(j){if(l.ta.registration.vkontakte){if(j==="vkLogin"){l.ta.registration.vkontakte.loginSuccess()}else{if(j==="vkSignup"){l.ta.registration.vkontakte.registrationSuccess()}else{if(j==="error"){if(k){l.ta.registration.vkontakte.showSSOError(k)}}}}}}},disconnect:function(){f.overlays.registration.post({action:"VK_DISCONNECT"})}}})(a,b);b.done=function(d,e){if(window.opener){a.registration.popup.done(d,e)}else{a.registration.returnTo(d)}};b.returnTo=function(d){if(window.opener){window.opener.location=d;a.registration.popup.close()}else{window.location=d}};b.runSuccessAction=function(f,h){var i=f.split("|");try{var d=i.slice(1);d.unshift({});d.unshift(i[0]);if(h){d.push(h)}a.run.apply(null,d)}catch(g){a.util.error.record(g,"successAction",null,{funcName:i[0]})}};b.runSuccessActionCookie=function(){var d=a.registration.getSuccessActionCookie();if(d){a.registration.runSuccessAction(d,true)}};b.setSuccessActionCookie=function(d){Cookie.write("successAction",window.pageServlet+"|"+d,{domain:cookieDomain,path:"/"})};b.getSuccessActionCookie=function(){if(window==window.top){var f=Cookie.read("successAction");if(f){var d=f.split("|");var e=d[0];d=d.slice(1);if(window.pageServlet==e){Cookie.dispose("successAction",{domain:cookieDomain,path:"/"});return d.join("|")}}}return};a.queueForLoad(function(){a.registration.runSuccessActionCookie()})}(ta,ta.registration));(function(a){a.util||(a.util={});a.util.post=function(c){if(!c||!c.url||!c.data){return false}c.url=a.util.URL.getAbsoluteUrl(c.url);if(!!c.https){if(c.url.indexOf("http:")===0){c.url=c.url.substring(4,c.url.length);c.url="https"+c.url}}var e=document.createElement("form");e.setAttribute("method","post");e.setAttribute("action",c.url);if(c.url&&c.url.indexOf("https")===0){a.store("httpsDestination",true)}for(var d in c.data){if(c.data.hasOwnProperty(d)){var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name",d);b.setAttribute("value",c.data[d]);e.appendChild(b)}}document.body.appendChild(e);e.submit()}}(ta));ta.util.keys={onEnterKey:function(d,b,c){var a;if(window.event){a=window.event.keyCode}else{if(d){a=d.which}}if(a==13){if(typeof(b)==="function"){b()}return false}else{if(typeof(c)==="function"){c()}return true}},onEnterKeyClickSibling:function(b,a){return ta.util.keys.onEnterKey(b,function(){var c=b.target&&ta.id(b.target);if(c){var d=c.getSiblings(a);if(d&&d.length){d[0].click()}}})}};(function(a){var b,c;a.servlet=a.servlet||{};b=function(e,f,d){new Request({method:"POST",url:a.util.URL.https("/Registration"),onSuccess:f,onFailure:d,data:e,withCredentials:a.retrieve("access_control_headers")}).send()};c=function(d){if(!d||"object"!==typeof d){a.util.error.record(null,"Options object is invalid.");return false}if(!d.hasOwnProperty("flow")||!d.flow){a.util.error.record(null,"Options object missing required flow field.");return false}if(!d.hasOwnProperty("action")||!d.action){a.util.error.record(null,"Options object missing required action field.");return false}if(!d.hasOwnProperty("pid")||!d.pid){a.util.error.record(null,"Options object missing required pid field.");return false}if(!d.hasOwnProperty("token")||!d.token){a.util.error.record(null,"Options object missing required token field.");return false}if(!d.hasOwnProperty("category")||!d.category){a.util.error.record(null,"Options object missing required category field.");return false}return true};a.servlet.OverlayRegistration={submitEmailOnlySignup:function(d,p,t){var h,n,s,q,g,o,l,j,k,i,r,f,m;m=d||window.event;if(m){new Event(m).preventDefault()}if(!p){a.util.error.record(null,"Invalid form element.");return}if(!c(t)){return}h=p.getElement(".emailAddr");n=p.getElement(".g-recaptcha-response");s=p.getElement(".emailOptIn input");q=p.getElement(".submitBtn");g=p.getElement(".signupError");o=h?h.value:"";l=n?n.value:"";j=s&&s.checked;if(q){q.set("disabled","disabled")}else{a.util.error.record(null,"Form missing submit element.");return}if(!g){a.util.error.record(null,"Form missing error element.");return}i=(t.additional&&("object"===typeof t.additional))?t.additional:{};k=Object.merge(i,{flow:t.flow,action:t.action,pid:t.pid,category:t.category,token:t.token,email:o,"g-recaptcha-response":l,opt_in:j});r=function(u){var x;try{x=JSON.decode(u);if(x.error){g.setContent(x.error).show();var v={height:document.body.getScrollHeight()};a.servlet.OverlayRegistration.resizeFrame(v);q.set("disabled","");return}else{g.setContent("").hide()}a.trackEventOnPage(t.category,x.isLogin?"signup_success_logged_in":"signup_success","",t.pid,false);if(!t.keepOverlay){a.servlet.OverlayRegistration.closeOverlayRegistration()}if(t.hasOwnProperty("onSuccess")&&"function"===typeof t.onSuccess){t.onSuccess(x)}}catch(w){a.util.error.record(w,"Ajax request handling error");q.set("disabled","");if(t.hasOwnProperty("onFailure")&&"function"===typeof t.onFailure){t.onFailure()}}};f=function(e){a.util.error.record(null,"Ajax signup request failure: "+e.status);q.set("disabled","");if(t.hasOwnProperty("onFailure")&&"function"===typeof t.onFailure){t.onFailure(e)}};b(k,r,f)},closeOverlayRegistration:function(){var d,e;d=window.parent;if(d){e='{ "action": "successClose" }';d.postMessage(e,"*")}},fwdToRegistration:function(g){var e,i,d,j,h,f;a.trackEventOnPage(g.category,"already_member","",g.pid,false);e=window.parent;if(e){setTimeout(function(){d=(g.additional&&("object"===typeof g.additional))?g.additional:{};j=d.hasOwnProperty("curUrl")?d.curUrl:"";h=d.hasOwnProperty("partnerKey")?d.partnerKey:"";f=d.hasOwnProperty("urlKey")?d.urlKey:"";i='{ "action": "fwdToRegistration", "curUrl": "'+d.curUrl+'", "partnerKey": "'+d.partnerKey+'", "urlKey": "'+d.urlKey+'" }';e.postMessage(i,"*")},100)}},resizeFrame:function(f){if(!f||"object"!==typeof f){return}var d=f.hasOwnProperty("height")?f.height:null;if(+d!==parseInt(d)){d=340}var e=window.parent;if(e&&d){var g='{ "action": "resizeFrame", "height": "'+d+'" }';e.postMessage(g,"*")}},renderThanks:function(e){var d={source:"OverlayRegistration",flow:e,action:"GET_OVERLAY_REGISTRATION_THANKS"};window.location="https://"+window.location.hostname+"/Registration?"+Object.toQueryString(d)},cancelRegistration:function(h,f){var j,i,d,g;j=h||window.event;if(j){new Event(j).preventDefault()}if(!c(f)){return}i={flow:f.flow,action:f.action,pid:f.pid,category:f.category,token:f.token};d=function(k){var m;try{m=JSON.decode(k);a.trackEventOnPage(f.category,"signup_cancel",f.pid,0,false);if(f.hasOwnProperty("onSuccess")&&"function"===typeof f.onSuccess){f.onSuccess(m)}}catch(l){a.util.error.record(l,"Ajax request handling error");if(f.hasOwnProperty("onFailure")&&"function"===typeof f.onFailure){f.onFailure(m)}}};g=function(e){a.util.error.record(null,"Ajax cancel request failure: "+e.status);if(f.hasOwnProperty("onFailure")&&"function"===typeof f.onFailure){f.onFailure(e)}};b(i,d,g)}}}(ta));if("undefined"===typeof userLoggedIn){var userLoggedIn=false};(function(a){a.queueForReady(function(){var d=a.select(".triplist-cta")||[];d.each(function(e){a.trackEventOnPage(e.getAttribute("data-category"),"show","",0,true);var f=e.getElements("a")||[];f.each(function(i){var g=i.getAttribute("data-category");var j=i.getAttribute("data-event");var h=i.getAttribute("data-label");var k=i.getAttribute("data-value");i.addEvent("click",function(){a.setEvtCookie(g,j,h,k,i.href)})})});var c=a.select(".triplist-featured-in-cta")||[];var b=[];c.each(function(f){var e=f.getAttribute("data-category");if(e&&!b.contains(e)){a.trackEventOnPage(e,"show","",0,true);b.push(e)}})})}(ta));if(!ta.p13n){ta.p13n={}}ta.p13n.placements=(function(){var k={};var b={};var h={};var e={};function f(n,o,m,p){o=o.replace(/\.js$/i,"");k[n+":"+o]={reqs:m,inifunc:p}}function d(m,n,t,u){t=t.replace(/\.js$/i,"");var r=m[t];if(r){return r}var p=n+":"+t;if(u[t]){throw p+" depends on itself recursively"}var q=k[n+":"+t];if(!q){return window.require(t)}u[t]=true;var v=q.reqs;var s=[];for(var o=0;o<v.length;o++){s.push(d(m,n,v[o],u))}r=q.inifunc.apply({},s);u[t]=false;m[t]=r;return r}function j(p,q,o){q=q.replace(/\.js$/i,"");var m=o.id;var n=b[m];if(!n){n={placement:o};b[m]=n;o.prepareRequestData=function(){return{detail:""+o.location_id,placementName:o.name,servletClass:o.servletClass,servletName:o.servletName}};o.requestAJAXPlacement=function(u,r,t){var s=o.prepareRequestData();if(typeof Request!=="undefined"&&Request.prototype.send){if(t){s=Object.merge(s,t)}new Request({url:"/MetaPlacementAjax",data:s,evalScripts:true,onSuccess:u,onFailure:function(){ta.util.error.record(null,o.name+" load - MetaPlacementAjax request failed");if(r){r()}}}).send()}else{if(typeof z!=="undefined"&&z.ajax){if(t){s=z.extend(s,t)}z.ajax({url:"/MetaPlacementAjax",data:s,success:u,error:function(){ta.util.error.record(null,o.name+" load - MetaPlacementAjax request failed");if(r){r()}}})}}}}return d(n,p,q,{})}function l(p,s,q){var r,o,n={},m;if(!p){return}e[p]=e[p]||1000;q=q||{};r={};if(ta.widgets&&ta.widgets.calendar){o=ta.widgets.calendar.getCheckRatesData();if(o){r=o}}n={};if(ta.meta){n=ta.commerce.meta.getMetaParams()}m=ta.util.merge(r,q,{placementName:p,assets:!a(p),wrap:true,occ:e[p]},n);new Request({url:"/MetaPlacementAjax",data:m,evalScripts:true,onSuccess:function(t){e[p]++;t=g(p,t);s&&s(t)},onFailure:function(){ta.util.error.record(null,p+" load - MetaPlacementAjax request failed")}}).send()}function c(p,r,v){if(ta.retrieve("ta.redirectingPage")){return}var o=false;var u=ta.widgets.calendar.getCheckRatesData();if(!u){u={}}else{o=true}var q={};if(ta.meta){q=ta.commerce.meta.getMetaParams()}var n=Object.merge(u,q,{reqNum:r});if(v.customRequestParams){n=Object.merge(n,v.customRequestParams)}var s=v.displayableRequestNumber||1;var m=v.maxRequestNumber||5;var t=v.pollWaitTime||2000;p.requestAJAXPlacement(function(y){p.latestCrossSellResponseText=y;var C=v.readyStrings||["xsellHacStatusReady","xsellHacStatusSOL"];var x=r>=m||C.some(function(D){return y.contains(D)})||!o;var w=r>=s||x;var B=ta.id(p.id);if(!B){return}function A(E){if(E&&E.target){E.target.removeEvent("mouseout",A);E.target.removeEvent("blur",A)}var D=B.querySelector&&B.querySelector(":hover");if(D){D.addEvent("mouseout",A);return}var F=B.querySelector&&B.querySelector(":focus");if(F){F.addEvent("blur",A);return}B.setContent(p.latestCrossSellResponseText);delete p.latestCrossSellResponseText;ta.prwidgets.initWidgets(B);if(v.onSuccess){v.onSuccess()}}if(w){A()}if(!x){setTimeout(c.pass([p,r+1,v]),t)}},v.onFailure,n)}function i(n,m){if(n.autoRefreshEnabled){return}m=m||{};ta.queueForLoad(function(){var p=m.customRequestParams||{};if(m.includePackagePrivateAssetsOnDateChange){p=Object.merge(Object.clone(p),{packagePrivateAssets:true})}var s=Object.merge(Object.clone(m),{displayableRequestNumber:(m.onCalendarRangeSelectDisplayableRequestNumber||2),customRequestParams:p});ta.on("onCalendarRangeSelect",c.pass([n,1,s]));var r=Object.merge(Object.clone(m),{customRequestParams:p});ta.on("clearDates",c.pass([n,1,r]));var q=m.initialRequestNumber||1;var o=m.pollWaitTime||2000;if(ta.widgets.calendar.hasPageDates()){setTimeout(c.pass([n,q,m]),o)}},"initialize "+n.id);n.autoRefreshEnabled=true}function g(q,p){var r=document.createElement("div"),o,m,n;r.innerHTML=p;o=r.getElementsByTagName("style");while(o.length>0){n=r.removeChild(o[0]);if(!a(q)){document.head.appendChild(n)}}h[q]=true;return r.innerHTML}function a(m){return !!h[m]}return{define:f,load:j,loadDynamicPlacement:l,enableAutoRefresh:i}})();(function(b){var a={ALL:"sprite-typeahead-all",GEO:"sprite-typeahead-destination",HOTELOVERVIEW:"sprite-typeahead-destination",HOTEL:"sprite-typeahead-hotel",ATTRACTION:"sprite-typeahead-attraction",EATERY:"sprite-typeahead-restaurant",VACATION_RENTAL:"sprite-typeahead-vr",FLIGHTS_TO:"sprite-typeahead-flight",AIRPORT:"sprite-typeahead-flight",THEME_PARK:"sprite-typeahead-themepark",VACATION_PACKAGE:"sprite-typeahead-hotel",SMART_DEAL:"sprite-typeahead-hotel",CHILD_TOP:"sprite-typeahead-connector-top",CHILD_BOTTOM:"sprite-typeahead-connector-bottom",NEIGHBORHOOD:"sprite-typeahead-neighborhood",TRAVEL_GUIDE:"sprite-typeahead-travel-guide"};var f={ALL:"ui_icon globe-world",GEO:"ui_icon map-pin-fill",HOTELOVERVIEW:"ui_icon map-pin-fill",HOTEL:"ui_icon hotels",ATTRACTION:"ui_icon attractions",EATERY:"ui_icon restaurants",VACATION_RENTAL:"ui_icon vacation-rentals",FLIGHTS_TO:"ui_icon flights",AIRPORT:"ui_icon flights",THEME_PARK:"ui_icon amusement-parks",VACATION_PACKAGE:"ui_icon hotels",SMART_DEAL:"ui_icon hotels",CHILD_TOP:"sprite-typeahead-connector-top",CHILD_BOTTOM:"sprite-typeahead-connector-bottom",NEIGHBORHOOD:"ui_icon neighborhoods",TRAVEL_GUIDE:"ui_icon guides"};var e={PAGE:true,BLENDER_PAGE:true,NEAR_POI:true,VACATION_PACKAGE:true,SMART_DEAL:true,FLIGHTS_TO:true};var d={FLIGHTS_TO:true,VACATION_PACKAGE:true};function h(j){return j.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00A0/g,"&nbsp;").replace(/"/g,"&quot;")}b.views||(b.views={});b.views.iconMap=a;b.views.iconFontMap=f;b.views.escapeHTML=function(j){return h(j)};var i=function(l,k){var j={};var m=[];Array.each(l,function(n){var o=n.type;j[o]=j[o]||[];j[o].push(n)});Array.each(k,function(o){var p=j[o];if(p){for(var n=0;n<p.length;n++){m.push(p[n])}}});return m};b.views.configTypeAheadOptionsForSortingByPOIType=function(l,k){var j=l.postResultsFnList||[];j.push(function(n){var m=ta.util.Deferred();n.results=i(n.results,k);m.resolve(n);return m.promise()});l.postResultsFnList=j;l.listTemplate=function(o){var n=o.results;var m=[];if(n.length>0){m.push("<ul>");Array.each(n,(function(){var q="";return function(s){if(q!=s.type){q=s.type;var r=[s.rendered];r.push('<span class="label">');r.push(s.title);r.push('<img src="/img2/x.gif" class="icon hidden" alt="">');r.push("</span>");s.rendered=r.join("")}}})());var p=(function(){var q="";var r=document.createElement("div");return function(t){var s='<li class="typeahead-choice '+h(t.title.toLowerCase())+'">'+t.rendered+"</li>";if(q!=t.type){q=t.type;r.innerHTML=s;r.firstChild.addClass("first");s=r.innerHTML}return s}})();m.push(n.map(p).join(""));m.push("</ul>")}return m.join("")}};var c={showChildren:false,tagLabels:null,poiClasses:"",geoClasses:""};b.views.itemTemplate=function(k){k=ta.extend(c,k);var l=k.useIconFont;var j=this.iconMap;if(l){j=this.iconFontMap}return function(t,s){var v=[];var x;if(t.no_icon){x=null}else{if(t.isNeighborhood){x=j.NEIGHBORHOOD}else{x=j[t.type]}}s=s||{};var q=t.icon_type||t.data_type;if(q&&d[q.toUpperCase()]){x=j[q.toUpperCase()]}if(!l&&x&&q&&e[q]){x+="-list"}if(x){var y=(l?"":"sprite-image ")+"leftIcon "+x;v.push('<div class="'+y+'"></div>')}var A;if(k.tagLabels){var r=k.tagLabels;if(t.isChild&&t.parent&&t.parent.moved){A=r.newLocation}else{if(t.moved===true){A=r.moved}else{if(t.closed===true){A=r.closed}}}if(A){v.push('<span class="search-tagged-poi" >'+A+"</span>")}}var o=t.details||t;var p=o.highlighted_name||o.name||"";var u=o.geo_name||"";if(s.HTMLEscape){p=h(p);u=h(u)}var n="poi-name "+k.poiClasses;if(!u){n+=" no-geo"}var z="geo-name "+k.geoClasses;v.push('<span class="'+n+'">'+p+"</span>");v.push('<span class="'+z+'">'+u+"</span>");v.push();if(k.showChildren&&t.isChild){v.unshift('<div class="child">');v.push("</div>");var w=t.lastChild?j.CHILD_BOTTOM:j.CHILD_TOP;var m="sprite-image childIcon leftIcon "+w;v.unshift('<div class="'+m+'"></div>')}return v.join("")}};b.views.configureTypeAheadForSegmentedResults=function(j,m){var v=m||{};var n=v.groupByPlacetype;var q=v.boldSearchQuery;var p=j.postResultsFnList||[];var r="search";var s="history";var u="suggested";var o="overview";var t="global";var l="local";var k=function(x){var w={};var y=function(z){if(z.type&&z.type.toUpperCase()==="SEARCH"&&z.name){return r}else{if(z.scope=="history"){return s}else{if(z.scope=="suggested"){return u}else{if(z.scope=="overview"){return o}else{if(n||(z.scope&&z.scope.lastIndexOf("local",0)===0)){return l}else{return t}}}}}};Array.each(x,function(A){var B=y(A);var z=w[B]=w[B]||[];z.push(A)});return w};p.push(function(x){var w=ta.util.Deferred();x.results=(function(C){var D=[];Array.each(C,function(G){D.push(G);if(G.children){var I=G.children.length;for(var H=0;H<I;H++){var J=G.children[H];J.scope=G.scope;J.parent=G;D.push(J)}}});var z=k(D);var A=[];var F=[o,s,u,l,t,r];for(var B=0;B<F.length;B++){var E=F[B];var y;if(E==l&&n){y=z[E]?[].concat.apply([],g(z[E])):[]}else{y=z[E]}if(y){A=A.concat(y)}}return A})(x.results);w.resolve(x);return w.promise()});j.postResultsFnList=p;j.listTemplate=function(C){var F=[];var D=C.results;var A=k(D);var K=false;var L=false;var y=false;var G=D.length==0;var J=!(C.query&&C.query.query)&&(!A[l]||A[l].length===0)&&(!A[t]||A[t].length===0);var E=(!J||v.historyOnEmpty);var x=!(C.query&&C.query.query);var w=function(O,S){var Q="resultContainer"+(S?" "+S:"");F.push('<ul class="'+Q+'">');for(var P=0;P<O.length;P++){var N=O[P];if(!N){continue}var R=(N.scope==="local_tag"||N.scope==="local_keyword")&&P+1<O.length&&O[P+1]&&O[P+1].scope!=="local_tag"&&O[P+1].scope!=="local_keyword";F.push('<li class="'+(N.wrapperCSS||"")+(R?" with_separator":"")+'">');F.push(N.rendered);if(R){F.push('<div class="tags-separator"><div class="line"></div></div>')}F.push("</li>")}F.push("</ul>")};if(A[o]&&A[o].length>0&&E){y=true;if(v.overviewLabel){F.push('<div class="title overview">'+v.overviewLabel+"</div>")}w(A[o])}if(A[s]&&A[s].length>0&&E){K=true;if(v.historyLabel){F.push('<div class="title history">'+v.historyLabel+"</div>")}w(A[s],C.query?null:"bold_names")}if(A[u]&&A[u].length>0&&x){F.push('<div class="title history">'+v.suggestedLabel+"</div>");w(A[u])}if(!J&&v.localLabel&&(A[l]&&A[l].length>0||(v.noResultsMessage&&!y))){L=true;if(!n){F.push('<div class="title local">'+v.localLabel+"</div>")}}if(A[l]&&A[l].length>0){L=true;if(n){var I=g(A[l]);for(var B=0;B<I.length;B++){w(I[B])}}else{w(A[l])}}else{if(L){F.push('<div class="no-results">'+v.noResultsMessage+"</div>")}}if(A[t]&&A[t].length>0){if(v.globalLabel&&(L||K)){F.push('<div class="title global">'+v.globalLabel+"</div>")}w(A[t])}if(!J&&A[r]&&A[r].length>0){var M=A[r][0];var H=C.query&&C.query.query||"";var z="search resultContainer";if(M.noResults){z+=" noResults"}if(q){F.push('<ul class="'+z+'"><li class="searchRow">'+M.name.replace("%","<b>"+h(H)+"</b>")+"</div></li></ul>")}else{F.push('<ul class="'+z+'"><li class="searchRow">'+h(M.name.replace("%",H))+" &raquo;</div></li></ul>")}}if(G&&!J&&v.showNoResultsMessage&&v.noResultsMessage){F.push('<div class="no-results">'+v.noResultsMessage+"</div>")}return F.join("")};return v};b.views.simpleItemTemplate=function(){return function(j){return[j.details.name,'<span class="addr">',j.details.address,"</span>"].join("")}};b.views.simpleListTemplate=function(j){return function(m){if(!m.results||!m.results.length){return'<div class="noResults">'+j+"</div>"}var l=m.results||[];var k=["<ul>"];var n;l.forEach(function(o){k.push("<li>");if(o.title!==n){n=o.title;k.push('<span class="label">',n,'<img src="/img2/icons/typeahead/',o.type.slice(0,1).toLowerCase(),'.gif"/></span>')}k.push(o.rendered);k.push("</li>")});k.push("</ul>");return k.join("")}};b.views.ptptListTemplate=function(q){var y=['<div class="typeahead-choices">'];var u={};var l={history:true};var m=CDNHOST+"/img2/x.gif";function r(z){var B=z.scope=="history";var A=z.type?z.type.toLowerCase():"";var s=B?"history":A;return{historyScope:B,choiceType:A,headerType:s}}var x=q.results;var k=x.length;for(var p=0;p<k;p++){var o=x[p];var w=r(o);var j="typeahead-choice "+w.choiceType;var n=false;if(!(w.headerType in u)){j+=" first";u[w.headerType]=true;n=true}if(w.historyScope){j+=" history"}y.push('<div class="'+j+'">');y.push('<img src="'+m+'" class="icon" alt="">');y.push('<span class="cutoff">');y.push(o.rendered);y.push("</span>");if(w.historyScope){y.push('<img src="'+m+'" class="history_icon" alt="">')}y.push("</div>");var v=x[p+1];var t=v&&r(v);if(t&&l[w.headerType]&&t.headerType!=w.headerType){y.push('<div class="divider"></div>')}}y.push("</div>");return y.join("")};var g=function(l){var j={};var o=0;for(var m=0;m<l.length;m++){var k=l[m];var n=/(global|local)(_(.*))?/.exec(k.scope);var r=n&&n.length>3?n[3]:k.scope;var q=r&&r.length>0?"common_group":k.type;if(!j[q]){j[q]=[o++,q]}j[q].push(k)}var p=function(t){var s=[];var w=[];var v;for(v in t){if(t.hasOwnProperty(v)){w.push(t[v])}}w=w.sort(function(y,x){if(y.length<=1){return -1}if(x.length<=1){return 1}if(y[1]!=x[1]){if(y[1]=="common_group"){return -1}if(x[1]=="common_group"){return 1}if(y[1]=="GEO"){return -1}if(x[1]=="GEO"){return 1}}return y[0]-x[0]});for(var u=0;u<w.length;u++){s.push(w[u].slice(2))}return s};return p(j)}}(TypeAhead));ta.common.dualsearch=(function(){var n=TypeAhead.views.escapeHTML;var e=ta.find(".altSearch");var l=e&&ta.find(".twoField");var j=false;var b=false;var a;var o=function(){if(!a){a=ta.has("typeahead.searchSessionId")?ta.retrieve("typeahead.searchSessionId"):"no_search_session_id"}return a};var h=(function(q){var s=function(t){if(document.activeElement!=t){if(Browser.ie&&Browser.version<=9){t.focus()}else{t.focus();t.select()}}setTimeout(function(){if(document.activeElement!=t){if(Browser.ie&&Browser.version<=9){t.focus()}else{t.focus();t.select()}}},200)};var r=function(t){this.geoScopeInput=new Element(t.geoScopeInput);this.geoScopeLabel=new Element(t.geoScopeLabel);if(t.swapped){ta.removeClass(this.staticSearchInput,"focusClear")}ta.removeClass(this.geoScopeInput,"focusClear");this.geoScopeFormElement=new Element(t.geoScopeFormElement);this.staticSearchInput=new Element(t.staticSearchInput);this.geoScopeTypeahead=t.geoScopeTypeAhead;this.staticSearchTypeAhead=t.staticSearchTypeAhead;this.options=t;this.geoInfo=null;this.clearGeoInfo();this.firstFocusTrigger=false};var p=function(t){return new Element("DIV",{html:t}).get("text")};r.prototype.clearGeoInfo=function(){this.setGeoInfo(1,"","")};r.prototype.saveGeoInfo=function(){var x=this.geoInfo;if(!x||x.geoID==1){return}var A=this.geoScopeTypeahead.options.recentHistory;var w=A.length;for(var v=0;v<w;v++){if(A[v].value==x.geoID){this.geoScopeTypeahead.removeHistory(v);break}}var y=this.geoScopeTypeahead.injectHistory({name:x.geoName,type:"GEO",isNeighborhood:x.isNeighborhood},1);y.value=x.geoID;y.details={name:y.name,geo_name:x.parentName,isNeighborhood:x.isNeighborhood};y.scope="overview";var z=[];for(var t in x.categories){var u=x.categories[t];u=ta.extend(u);u.type=t;z.push(u)}y.urls=z};r.prototype.setGeoInfo=function(u,w,t,v,C,x){var y=this.geoInfo&&this.geoInfo.getId;var z={geoID:u,geoName:w,parentName:t,shortParentName:C,categories:{},isNeighborhood:x};for(var B in v){var A=v[B];if(A.url){z.categories[B]=A}}this.geoInfo=z;this.refreshGeoInfo(y!=u)};r.prototype.refreshGeoInfo=function(y){var v=this.geoInfo;if(!v){return}this.staticSearchTypeAhead.options.viewOptions.historyLabel=this.options.translations.recently_viewed;this.staticSearchTypeAhead.options.viewOptions.noResultsLabel=null;this.geoScopeTypeahead.clearResults();var x=this.staticSearchTypeAhead;var t=function(G,z,B,D){B=B||z;var H=v.categories[G];if(!H&&this.options.swapped&&(!v.geoID||v.geoID===1)){H={}}if(!H){return}var E=n(v.geoName);var C="";if(v.isNeighborhood&&v.shortParentName){C=", "+n(v.shortParentName)}var F=B.replace("%",E);var A=z.replace("%",E+C);var I=x.injectHistory({name:F,type:G,details:{name:A}});I.url=H.url;I.data_type=I.type==="GEO"?"LOCATION":"PAGE";I.icon_type="LOCATION";I.scope="overview";I.normalized_name=p(A).trim();E=z.replace("%",E);E="<span>"+E+"</span>";E=Elements.from(E);I.scoped_render=E[0];I.aliases=w(D)};var u=function(A,G){var C=0;var D=A.options.recentHistory;var B=D.length;var E=A.options.maxHistoryInjections;for(var F=0;F<B&&C<E;F++){var H=D[F];var z=H.details&&H.details.parent_ids&&H.details.parent_ids.contains(v.geoID);if(!G||z){A.staticSearchTypeAhead.injectHistory(H);C+=1}}};var w=function(A){if(A){var z=ta.retrieve("typeahead.aliases."+A);if(z){return z}}return[]};if(v.geoID!=1){this.staticSearchTypeAhead.options.scopeFilter="global";if(!b){this.setGeoScopeInputText(this.geoInfo.geoName+", "+this.geoInfo.parentName)}this.geoScopeFormElement.set("value",this.geoInfo.geoID);this.staticSearchTypeAhead.options.viewOptions.globalLabel=null;this.staticSearchTypeAhead.options.viewOptions.localLabel=this.options.translations.area_title.replace("%",this.geoInfo.geoName);if(y){this.staticSearchTypeAhead.setGeoId(this.geoInfo.geoID);this.staticSearchTypeAhead.clearHistory();t("GEO",this.options.translations.poi_overview_geo,this.options.translations.overview_text);t("HOTEL",this.options.translations.poi_hotels_geo,this.options.translations.hotels_text,"hotels");if(!ta.retrieve("isDaoDao")){t("VACATION_RENTAL",this.options.translations.poi_vr_geo,this.options.translations.vacation_rentals_text)}t("ATTRACTION",this.options.translations.poi_attractions_geo,this.options.translations.things_to_do_text,"things_to_do");t("EATERY",this.options.translations.poi_eat_geo,this.options.translations.restaurants_text,"restaurants");t("TRAVEL_GUIDE",this.options.translations.poi_travel_guides_geo,this.options.translations.travel_guides_text,"travel_guides");t("NEIGHBORHOOD",this.options.translations.poi_nbrhd_geo,this.options.translations.neighborhoods_text);if(!ta.retrieve("isDaoDao")){t("FLIGHTS_TO",this.options.translations.poi_flights_geo,this.options.translations.flights_text)}u(this,true)}}else{this.staticSearchTypeAhead.options.scopeFilter=null;if(!b){this.setGeoScopeInputText(this.options.translations.all_of_trip)}this.geoScopeFormElement.set("value",null);this.staticSearchTypeAhead.options.viewOptions.globalLabel=this.options.translations.worldwide_title;this.staticSearchTypeAhead.options.viewOptions.localLabel=null;if(y){this.staticSearchTypeAhead.setGeoId(null);this.staticSearchTypeAhead.clearHistory();if(this.options.swapped){t("HOTEL",'<span class="poi_overview_item">'+this.options.translations.hotels_text+"</span>",undefined,"hotels");if(!ta.retrieve("isDaoDao")){t("VACATION_RENTAL",'<span class="poi_overview_item">'+this.options.translations.vacation_rentals_text+"</span>")}t("ATTRACTION",'<span class="poi_overview_item">'+this.options.translations.things_to_do_text+"</span>",undefined,"things_to_do");t("EATERY",'<span class="poi_overview_item">'+this.options.translations.restaurants_text+"</span>",undefined,"restaurants");t("FLIGHTS_TO",'<span class="poi_overview_item">'+this.options.translations.flights_text+"</span>")}u(this,false)}}if(y){this.staticSearchTypeAhead.clearCache()}};r.prototype.setActiveCategory=function(t){this.options.activeCategory=t};r.prototype.showDimmer=function(t){if(!this.options.pageDimmerOverlay){return}if(t){this.options.pageDimmerOverlay.show()}else{this.options.pageDimmerOverlay.hide()}};r.prototype.startGeoSearch=function(t){if(t){s(this.geoScopeInput)}if(this.geoScopeInput.value==this.geoScopeInput.getAttribute("placeholder")||this.geoScopeInput.value==this.geoScopeInput.getAttribute("data-initialVal")){this.setGeoScopeInputText("")}this.showDimmer(true);if(!this.firstFocusTrigger){this.firstFocusTrigger=true;this.geoScopeTypeahead.showHistoryIfEnabled()}};r.prototype.stopGeoSearch=function(){if(this.geoInfo){this.geoScopeLabel.show();this.refreshGeoInfo()}};r.prototype.startStaticSearch=function(t){if(t){s(this.staticSearchInput)}this.showDimmer(true);if(!this.firstFocusTrigger){this.firstFocusTrigger=true;this.staticSearchTypeAhead.showHistoryIfEnabled()}};r.prototype.stopStaticSearch=function(){};r.prototype.setGeoScopeInputText=function(t){this.geoScopeInput.set("value",t);this.geoScopeTypeahead.options.defaultValue=t};r.prototype.setStaticSearchInputText=function(t){this.staticSearchInput.set("value",t)};return r}(api));var i=function(x,s,u){if(!ta){return true}var v="";var p="";var y=ta.retrieve("ta_scoped_typeahead_search");var t=y&&y.staticSearchTypeAhead;if(y&&y.geoInfo.geoID>1){v=y.geoScopeTypeahead.source.value;p=y.staticSearchTypeAhead.getNormalizedQuery()}else{if(u){v=u;p=""}}var q=false;var r=ta.id("mainSearch");var w=ta.id("TOURISM_REDIRECT");if(v&&!p&&r&&w){w.value="true";r.value="";q=true}return ta.call("ta.common.search.recordAndValidate",x,s,q,t)};var g=function(q){var p=q=="poi"?ta.find(".whereHeader"):ta.find(".whatHeader");var r=q=="geo"?ta.find(".whereHeader"):ta.find(".whatHeader");if(l&&j){return}p.toggleClass("out");setTimeout(function(){r.toggleClass("out")},300);l&&(j=true)};var d=function(t,s){var r=ta.id("GEO_SCOPE_CONTAINER");var q=ta.id("global_nav_search_form");if(!q){return}if(q.elements.geo.value!=""){q&&(q.elements.redirect.value="true")&&q.submit();l&&ta.select(".whereThenWhat").addClass("loading")}else{var p=r.getChildren("input")[0];p&&p.focus()}};var k=function(p){ta.select(".twoFieldFocus").removeClass("twoFieldFocus");ta.select("."+p).addClass("twoFieldFocus");if(ta.find(".tablet_desktop")&&ta.find(".hintHeader")){window.scrollTo(0,ta.find(".hintHeader").getTop())}};var f=function(r,q){var s=ta.find(".whereThenWhat");var p=ta.id("GEO_SCOPED_SEARCH_INPUT");var t=ta.find(".geoExample");p&&t&&(p.placeholder=t.innerHTML);k("geoScopeContainer");setTimeout(function(){get_scoped_typeahead(r,q,function(u){u.stopStaticSearch();u.startGeoSearch(false)})},500);s&&s.addClass("two_field");ta.trackEventOnPage("TopNav_geo_search","focus","")};var c=function(v,r,F){var u=function(H){var G=H.target&&Element.getParent(H.target,"#GEO_SCOPE_CONTAINER, #MAIN_SEARCH_CONTAINER");if(G){return}v&&v.hide();t&&t.stopGeoSearch()};var w=ta.id(document.body);w.addEvent("click",u);w.addEventListener&&w.addEventListener("focus",u,true);ta.id(window).addEvent("blur",u);if(v){v.container.addEvent("click",u)}var q=function(H){var G=H.indexOf("#");if(G>0){H=H.substring(0,G)}return H};var A=(function(){var G=TypeAhead.views.itemTemplate({showChildren:true,tagLabels:{newLocation:ta.retrieve("typeahead_new_location_label"),moved:ta.retrieve("typeahead_moved_label"),closed:ta.retrieve("typeahead_closed_label")},poiClasses:"primaryText",geoClasses:"secondaryText"});return function(H){if(!H.details){return""}var I="displayItem";var J=true;if(H.scope=="history"){I+=" history"}else{if(H.scope=="overview"){I+=" overview";J=false}else{if(H.scope=="local_tag"||H.scope=="local_keyword"){I+=" overview short_cell";J=false}else{I+=" result"}}}H.wrapperCSS=I;return G(H,{HTMLEscape:J})}})();var E={pageDimmerOverlay:v,geoScopeInput:ta.id("GEO_SCOPED_SEARCH_INPUT"),geoScopeLabel:ta.id("GEO_SCOPED_SEARCH_LABEL"),geoScopeFormElement:ta.id("TYPEAHEAD_GEO_ID"),staticSearchInput:ta.id("mainSearch"),recentHistory:ta.retrieve("typeahead.recentHistoryList")||[],popularDestinations:ta.retrieve("typeahead.popularDestinations"),translations:{hotels_text:ta.retrieve("typeahead.hotel_list"),hotel_text:ta.retrieve("typeahead.hotel"),restaurants_text:ta.retrieve("typeahead.restaurant_list"),restaurant_text:ta.retrieve("typeahead.restaurant"),attractions_text:ta.retrieve("typeahead.attraction_list"),thing_to_do_text:ta.retrieve("typeahead.attraction"),vacation_rentals_text:ta.retrieve("typeahead.vacation_rental_list"),vacation_rental_text:ta.retrieve("typeahead.vacation_rental"),all_of_trip:ta.retrieve("typeahead.scoped.all_of_trip"),static_local_label:ta.retrieve("typeahead.scoped.static_local_label"),no_results_found:ta.retrieve("typeahead.noResultsFound"),title_text:ta.retrieve("typeahead.scoped.result_title_text"),recently_viewed:ta.retrieve("typeahead.history"),popular_destinations:ta.retrieve("typeahead.popular_destinations"),worldwide_title:ta.retrieve("typeahead.worldwide"),area_title:ta.retrieve("typeahead.scoped.geo_area_template"),restaurants:ta.retrieve("typeahead.restaurant_list"),hotels:ta.retrieve("typeahead.hotel_list"),vacation_rentals:ta.retrieve("typeahead.vacation_rental_list"),poi_overview_geo:ta.retrieve("typeahead.scoped.poi_overview_geo"),poi_hotels_geo:ta.retrieve("typeahead.scoped.poi_hotels_geo"),poi_vr_geo:ta.retrieve("typeahead.scoped.poi_vr_geo"),poi_attractions_geo:ta.retrieve("typeahead.scoped.poi_attractions_geo"),poi_eat_geo:ta.retrieve("typeahead.scoped.poi_eat_geo"),poi_flights_geo:ta.retrieve("typeahead.scoped.poi_flights_geo"),poi_nbrhd_geo:ta.retrieve("typeahead.scoped.poi_nbrhd_geo"),poi_travel_guides_geo:ta.retrieve("typeahead.scoped.poi_travel_guides_geo"),overview_text:ta.retrieve("typeahead.scoped.overview"),flights_text:ta.retrieve("typeahead.scoped.flights"),neighborhoods_text:ta.retrieve("typeahead.scoped.neighborhoods"),things_to_do_text:ta.retrieve("typeahead.things_to_do"),travel_guides_text:ta.retrieve("typeahead.scoped.travel_guides"),typeahead_transport_error:JS_location_not_found},maxHistoryInjections:5};var C=r===E.staticSearchInput;var z=r===E.geoScopeInput;var s=ta.id("MAIN_SEARCH_CONTAINER");var D=ta.extend(F.staticTypeAheadOptions,{minChars:1,minCharsForSearch:3,maxResults:12,defaultValue:Browser.ie&&Browser.version<=9?ta.retrieve("typeahead.scoped.poi_default_text"):"",geoId:F.geoID>1?F.geoID:undefined,name:"MASTHEAD",searchSessionId:o(),nextField:false,autoSelectFirst:false,selectOnBlur:false,startEventOn:C?"creation":"focus",width:null,offsetX:e?-36:0,offsetY:-2,cacheResults:true,enableQueryDelay:true,autopopulateHighlighted:false,cycleInput:false,assumeOnBlur:false,selectInputText:false,jpFirefoxIME:ta.retrieve("jp_typeahead_ime_firefox.enabled"),positionRelative:!e,containerParent:e||s,containerClass:"scopedSearchDisplay staticPOIDisplay",itemSelector:"li",validator:function(G){return i(G,s.getParent("form"))},recentHistory:[],historyTypes:["overview"],showHistory:true,integrateHistory:true,eligibleForHistoryInjection:function(G){return(G.data_type=="LOCATION"||G.data_type=="PAGE")},shouldReplaceHistoryItem:function(G){return(G.data_type!="PAGE")},getHistoryMatchingKey:function(G){return G.url},maxHistoryItems:E.maxHistoryInjections+7,focusAction:"history",searchParams:function(H){var I={};I.interleaved=true;I.details=true;I.types="geo,hotel,eat,attr,vr,air,theme_park";I.link_type="geo";I.neighborhood_geos=true;I.matchTags=true;I.matchKeywords=true;I.allowPageInsertionOnGeoMatch=false;I.defaultListInsertionType="hotel";if(H&&H.options){if(!H.options.scopeFilter){I.scopeFilter=(H.options.geoId>1)?"global":undefined}else{I.scopeFilter=H.options.scopeFilter}I.injectNeighborhoods=H.options.injectNeighborhoods;I.injectNewLocation=H.options.injectNewLocation;I.geoPages=true;if(H.options.includeListPages){I.blenderPages=true;I.flightsToPages=true;I.nearPages=true;I.vpPages=true;I.smartDealPages=true}}I.max=12;if(ta.has("typeahead.relevancy_threshold")){I.scoreThreshold=0.5;I._ignoreMinCount=true}var G=H.options.geoId;if(G!==""){I.nearby=true;I.local=true;I.parentids=G}else{I.global=true}return I},search:function(I,J){if(J.getInputLength(true)<J.options.minCharsForSearch){var G=ta.util.Deferred();var H={results:[],normalized:{query:I}};G.resolve(H);return G.promise()}else{return J.searchFn(I)}},postResultsFnList:[function(J){var G=ta.util.Deferred();var H=J.results||J;if(H&&typeOf(H)==="array"){var I=H.length==0;H.push({name:ta.retrieve("typeahead.searchMore"),title:"Search",type:"SEARCH",url:"#",noResults:I});G.resolve(J);return G.promise()}else{G.reject(JS_location_not_found);return G.promise()}}],onRender:function(P,N){if(P.container&&P.container.innerHTML===""){P.hide();return}var J=api.select(".displayItem.history",P.container);var U=J&&J.length>0;P.container.toggleClass("titleTop",U);var R=ta.select(".search-tagged-poi");var O,H,K,G,I;if(R){for(O=0;O<R.length;O++){K=R[O];H=K.getSize().x;var Q=[K.getSiblings(".poi-name")[0],K.getSiblings(".geo-name")[0]];for(var S=0;S<Q.length;S++){G=Q[S];if(!G){continue}I=G.getStyle("max-width");I=I.replace("px","");if(I.contains("%")){I=I.replace("%","");var T=G.getParent("li").getSize().x;I=T*(I/100)}var L=G.getStyle("margin-left").replace("px","");var M=20;G.setStyle("max-width",(I-H-L-M)+"px")}}}},errorTemplate:function(){return""},onShow:function(){if(e){var I=1000;var L=ta.find(".scopedSearchDisplay.staticPOIDisplay");var K=ta.find(".whereThenWhat.secondaryNavBar");var H=ta.util.i18n.isRtl();var G=28;var J=l?94:74;if(l){G=H?124:350}if(!ta.common.dualsearch.whatDropdownHasShown){L&&L.hide();setTimeout(function(){L&&L.show();ta.store("shownDropdown",true);ta.common.dualsearch.whatDropdownHasShown=true},I)}L&&(L.style.left=(ta.find(".secondaryNavBar").getBoundingClientRect().left+G)+"px");(navigator.userAgent.contains("MSIE 10.0")||ta.retrieve("ta.isIE11orHigher"))&&L&&(L.style.top=(ta.find(".secondaryNavBar").getBoundingClientRect().top+J)+"px")}},onSelect:function(L,P,N,I,G){if(L){ta.find(".backArrow")&&ta.find(".backArrow").hide();if(e&&ta.find(".tablet_desktop")==null){ta.id("STATIC_SEARCH_LABEL").addClass("spinner")}l&&ta.select(".whereThenWhat").addClass("loading");if(typeof L.type==="string"&&L.type.toUpperCase()==="SEARCH"){ta.setEvtCookie("TopNav_Search","Action","Selected_findmoreresults_inTaA_toSRP",0,"/Search");var K=r.getParent("form");K&&K.submit()}else{if(L.url){var J=L.scope=="history"?1:0;if(L.scope==="local_tag"){ta.setEvtCookie("TopNav_Search","TagSelected",L.value,L.tagId,L.url)}else{if(L.scope==="local_keyword"){ta.setEvtCookie("TopNav_Search","KeywordSelected",L.value,L.indexInType,L.url)}else{var H="Selected_TaA_Result";if(L.type==="TRAVEL_GUIDE"){H=H+"_TravelGuides"}ta.setEvtCookie("TopNav_Search","Action",H,J,L.url)}}var M=q(L.url);var Q=q(window.location.href);var O=Q.indexOf(M,Q.length-M.length)>=0;if(O){get_scoped_typeahead(event,this,function(R){R.showDimmer(false)})}window.location=L.url}else{if(F.swapped){get_scoped_typeahead(event,this,function(R){R.stopStaticSearch();R.setActiveCategory(L.type.toUpperCase());R.startGeoSearch(true)})}}}}},onKeyDown:function(G,H){if(H.tabPressed&&H.selectedIndex>=0){if(Browser.ie&&Browser.version<=9){G.preventDefault();G.stopPropagation()}H.select(true,"tab")}},resolveSelection:function(G){if(!G){return}if(G.type.toUpperCase()==="SEARCH"){return E.staticSearchInput.value}else{return G.name&&G.name.stripTags()}},itemTemplate:A});D.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(D,{noResultsMessage:E.translations.no_results_found,globalLabel:E.translations.worldwide_title,historyLabel:E.translations.recently_viewed,historyOnEmpty:true,resultClassWrap:""});var x=new TypeAhead(ta.id("mainSearch"),D);if(!x.hasDefaultText()){x.query=x.source.value}F=api.extend({},E,F);var y={defaultValue:Browser.ie&&Browser.version<=9?(E.geoScopeInput.getAttribute("data-initialVal")||E.geoScopeInput.value):"",recentHistory:ta.has("typeahead.popularDestinations")?ta.retrieve("typeahead.popularDestinations"):(ta.retrieve("typeahead.recentHistoryList")||[]),historyTypes:["geo","all"],showHistory:true,integrateHistory:true,maxHistoryItems:E.maxHistoryInjections+1,containerParent:e||ta.id("GEO_SCOPE_CONTAINER"),containerClass:"scopedSearchDisplay geoScopeDisplay whiteCaret",itemSelector:"li",nextField:false,autoSelectFirst:true,positionRelative:!e,offsetX:(!e||ta.find(".rtl"))?0:-43,offsetY:-2,width:null,cacheResults:true,autopopulateHighlighted:false,cycleInput:false,assumeOnBlur:false,selectInputText:false,selectOnBlur:false,name:"GEOSCOPE",searchSessionId:o(),linkedTypeAhead:x,doSelectionBeforeLogging:true,startEventOn:z?"creation":"focus",shouldSubmit:function(){return false},minChars:1,minCharsForSearch:3,maxResults:12,search:function(I,J){var G=ta.util.Deferred();if(J.getInputLength(true)<J.options.minCharsForSearch){var H={results:[],normalized:{query:I}};G.resolve(H);return G.promise()}var K={query:I,action:"API",startTime:this.startTime,uiOrigin:this.name,source:this.name,interleaved:true,types:"geo,theme_park",neighborhood_geos:true,link_type:"geo,hotel,vr,attr,eat,flights_to,nbrhd,tg",details:true,max:J.options.maxResults,injectNeighborhoods:true,searchSessionId:o()};new ta.util.ajax({method:"GET",url:"/TypeAheadJson",data:K}).always(function(L){if(L){G.resolve(L)}else{G.reject(JS_location_not_found)}});return G.promise()},onRender:function(H,G){if(G.length===0){H.hide()}},errorTemplate:function(){return E.translations.typeahead_transport_error},itemTemplate:A,resolveSelection:function(G){return""},onSelect:function(O,V,R,K,J){if(!O){return}var Q={};var U=O.urls;for(var P=0;U&&P<U.length;P++){var H=U[P];Q[H.type]={url:H.url}}if(t.options.swapped&&t.options.activeCategory&&Q[t.options.activeCategory]){window.location=Q[t.options.activeCategory].url;return}if(!O.value){t.clearGeoInfo()}else{t.setGeoInfo(O.value,O.details.name,O.details.geo_name,Q,O.details.parent_name,O.isNeighborhood)}var T=ta.id("SEARCH_BUTTON");if(t.staticSearchTypeAhead.getNormalizedQuery()){t.staticSearchTypeAhead.search(null,function(){if(t.options.swapped){T&&T.focus()}else{t.startStaticSearch(true)}})}else{if(t.options.swapped){T&&T.focus()}else{t.startStaticSearch(true)}}var L=O.scope=="history"?1:0;ta.trackEventOnPage("TopNav_geo_search","Action","Selected_TaA_Result",L);if(e){var G=ta.find(".whereThenWhat.secondaryNavBar");var M=ta.find(".whereHeader");var I=ta.find(".whatHeader");var N=ta.find(".translationHeader.loc");var S=ta.find(".translationHeader.worldwide");var W=(O.name=="Worldwide")?S.innerHTML:N.innerHTML.replace("_",O.details.name);I.set("html",W);(!l)&&G&&G.addClass("geoFilled");ta.common.dualsearch.toggleHeaders("poi");ta.common.dualsearch.whatDropdownHasShown=false}},onKeyDown:function(G,H){if(H.tabPressed&&H.selectedIndex>=0){if(e&&!l){return false}if(Browser.ie&&Browser.version<=9){G.preventDefault();G.stopPropagation()}H.select(true,"tab")}}};y.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(y,{localLabel:null,globalLabel:E.translations.worldwide_title,historyLabel:E.translations.recently_viewed,historyOnEmpty:true,noResultsMessage:E.translations.no_results_found,showNoResultsMessage:true});var B=new TypeAhead(E.geoScopeInput,y);var p=B.injectHistory({name:E.translations.all_of_trip,type:"ALL"},0);p.details={name:p.name};p.normalized_name=p.name;p.scope="overview";x.options.linkedTypeAhead=B;F.staticSearchTypeAhead=x;F.geoScopeTypeAhead=B;var t=new h(F);ta.store("ta_scoped_typeahead_search",t);return t};var m=function(t,r,p,v){t&&t.stop();if(typeof globalTypeAheadCss!=="undefined"&&!ta.has("ta.globalTypeAheadCss")){ta.store("ta.globalTypeAheadCss",Asset.css(globalTypeAheadCss))}b=true;var q=ta.id("SECONDARY_NAV_BAR");var s=new Element("div",{"class":"pageDim"});var u=function(){var x;if(q){x=new ta.overlays.RelativeOverlayBelow({content:s,autoShow:false,permanent:true,style:"pageDimOverlay scopeSearchOverlay",zIndex:null},q);var w=function(){var y=api.getSize(ta.id("PAGE"));x.container.setStyles({width:y.x,height:y.y})};w();ta.id(window).addEvent("resize",w)}v(c(x,r,p));b=false};ta.load("ta.overlays.RelativeOverlayBelow",u)||u()};return{toggleHeaders:g,geoOnFocus:f,toggleFocus:k,twoFieldSearchOnClick:d,scopedSearchSubmitValidate:i,createScopedSearch:m}})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"dual_search","handlers.js");a(["placement"],function(j){var n=false;var d=false;var k=false;var b;var q=function(){if(!b){b=ta.has("typeahead.searchSessionId")?ta.retrieve("typeahead.searchSessionId"):"no_search_session_id"}return b};l("GEO_SCOPED_SEARCH_INPUT");l("mainSearch");c("GEO_SCOPE_CONTAINER","GEO_SCOPED_SEARCH_INPUT");c("MAIN_SEARCH_CONTAINER","mainSearch");function c(s,r){var t=ta.id(s);t&&t.addEvent("click",function(v,u){v&&v.stop();ta.id(r).focus()})}function l(y){var w=ta.id(y);if(w){var x=w.getParent();var s=x.getChildren(".findNearLabel, .ui_icon.single-chevron-down");if(s.length){var z=parseInt(x.getStyle("width"));if(z){var u=0;for(var r=0;r<s.length;r++){var v=s[r];u+=v.offsetWidth+parseInt(v.getStyle("marginLeft"))+parseInt(v.getStyle("marginRight"))}var t=z-u-parseInt(w.getStyle("marginLeft"))-parseInt(w.getStyle("marginRight"))-8;w.setStyle("width",t)}}}}var i=(function(s){var u=function(v){if(document.activeElement!=v){if(Browser.ie&&Browser.version<=9){v.focus()}else{v.focus();v.select()}}setTimeout(function(){if(document.activeElement!=v){if(Browser.ie&&Browser.version<=9){v.focus()}else{v.focus();v.select()}}},200)};var t=function(v){this.geoScopeInput=new Element(v.geoScopeInput);ta.removeClass(this.staticSearchInput,"focusClear");ta.removeClass(this.geoScopeInput,"focusClear");this.geoScopeFormElement=new Element(v.geoScopeFormElement);this.staticSearchInput=new Element(v.staticSearchInput);this.geoScopeTypeahead=v.geoScopeTypeAhead;this.staticSearchTypeAhead=v.staticSearchTypeAhead;this.options=v;this.geoInfo=null;this.postponedRedirect=null;this.clearGeoInfo();this.firstFocusTrigger=false};var r=function(v){return new Element("DIV",{html:v}).get("text")};t.prototype.clearGeoInfo=function(){this.setGeoInfo(1,"","")};t.prototype.saveGeoInfo=function(){var z=this.geoInfo;if(!z||z.geoID==1){return}var C=this.geoScopeTypeahead.options.recentHistory;var y=C.length;for(var x=0;x<y;x++){if(C[x].value==z.geoID){this.geoScopeTypeahead.removeHistory(x);break}}var A=this.geoScopeTypeahead.injectHistory({name:z.geoName,type:"GEO",isNeighborhood:z.isNeighborhood},1);A.value=z.geoID;A.details={name:A.name,geo_name:z.parentName,isNeighborhood:z.isNeighborhood};A.scope="overview";var B=[];for(var v in z.categories){var w=z.categories[v];w=ta.extend(w);w.type=v;B.push(w)}A.urls=B};t.prototype.setGeoInfo=function(w,y,v,x,E,z){var A=this.geoInfo&&this.geoInfo.getId;var B={geoID:w,geoName:y,parentName:v,shortParentName:E,categories:{},isNeighborhood:z};for(var D in x){var C=x[D];if(C.url){B.categories[D]=C}}this.geoInfo=B;this.refreshGeoInfo(A!=w)};t.prototype.refreshGeoInfo=function(A){var x=this.geoInfo;if(!x){return}this.staticSearchTypeAhead.options.viewOptions.historyLabel=this.options.translations.recently_viewed;this.staticSearchTypeAhead.options.viewOptions.noResultsLabel=null;this.geoScopeTypeahead.clearResults();var z=this.staticSearchTypeAhead;var y=function(C){if(C){var B=ta.retrieve("typeahead.aliases."+C);if(B){return B}}return[]};var v=function(I,B,D,F){D=D||B;var J=x.categories[I];if(!J&&(!x.geoID||x.geoID===1)){J={}}if(!J){return}var G=TypeAhead.views.escapeHTML(x.geoName);var E="";if(x.isNeighborhood&&x.shortParentName){E=", "+TypeAhead.views.escapeHTML(x.shortParentName)}var H=D.replace("%",G);var C=B.replace("%",G+E);var K=z.injectHistory({name:H,type:I,details:{name:C}});K.url=J.url;K.data_type=K.type==="GEO"?"LOCATION":"PAGE";K.icon_type="LOCATION";K.scope="overview";K.normalized_name=r(C).trim();G=B.replace("%",G);G="<span>"+G+"</span>";G=Elements.from(G);K.scoped_render=G[0];K.aliases=y(F)};var w=function(C,I){var E=0;var F=C.options.recentHistory;var D=F.length;var G=C.options.maxHistoryInjections;for(var H=0;H<D&&E<G;H++){var J=F[H];var B=J.details&&J.details.parent_ids&&J.details.parent_ids.contains(x.geoID);if(!I||B){C.staticSearchTypeAhead.injectHistory(J);E+=1}}};if(x.geoID!=1){this.staticSearchTypeAhead.options.scopeFilter="global";if(!d){this.setGeoScopeInputText(this.geoInfo.geoName+", "+this.geoInfo.parentName)}this.geoScopeFormElement.set("value",this.geoInfo.geoID);this.staticSearchTypeAhead.options.viewOptions.globalLabel=null;this.staticSearchTypeAhead.options.viewOptions.localLabel=this.options.translations.area_title.replace("%",this.geoInfo.geoName);if(A){this.staticSearchTypeAhead.setGeoId(this.geoInfo.geoID);this.staticSearchTypeAhead.clearHistory();v("GEO",this.options.translations.poi_overview_geo,this.options.translations.overview_text,"");v("HOTEL",this.options.translations.poi_hotels_geo,this.options.translations.hotels_text,"hotels");if(!ta.retrieve("isDaoDao")){v("VACATION_RENTAL",this.options.translations.poi_vr_geo,this.options.translations.vacation_rentals_text,"")}v("ATTRACTION",this.options.translations.poi_attractions_geo,this.options.translations.things_to_do_text,"things_to_do");v("EATERY",this.options.translations.poi_eat_geo,this.options.translations.restaurants_text,"restaurants");v("TRAVEL_GUIDE",this.options.translations.poi_travel_guides_geo,this.options.translations.travel_guides_text,"travel_guides");v("NEIGHBORHOOD",this.options.translations.poi_nbrhd_geo,this.options.translations.neighborhoods_text,"");if(!ta.retrieve("isDaoDao")){v("FLIGHTS_TO",this.options.translations.poi_flights_geo,this.options.translations.flights_text,"")}w(this,true)}}else{this.staticSearchTypeAhead.options.scopeFilter=null;if(!d){this.setGeoScopeInputText(this.options.translations.all_of_trip)}this.geoScopeFormElement.set("value",null);this.staticSearchTypeAhead.options.viewOptions.globalLabel=this.options.translations.worldwide_title;this.staticSearchTypeAhead.options.viewOptions.localLabel=null;if(A){this.staticSearchTypeAhead.setGeoId(null);this.staticSearchTypeAhead.clearHistory();v("HOTEL",'<span class="poi_overview_item">'+this.options.translations.all_hotels_text+"</span>",undefined,"hotels");if(!ta.retrieve("isDaoDao")){v("VACATION_RENTAL",'<span class="poi_overview_item">'+this.options.translations.all_vacation_rentals_text+"</span>")}v("ATTRACTION",'<span class="poi_overview_item">'+this.options.translations.all_attractions_text+"</span>",undefined,"things_to_do");v("EATERY",'<span class="poi_overview_item">'+this.options.translations.all_restaurants_text+"</span>",undefined,"restaurants");v("FLIGHTS_TO",'<span class="poi_overview_item">'+this.options.translations.all_flights_text+"</span>");w(this,false)}}if(A){this.staticSearchTypeAhead.clearCache()}};t.prototype.setActiveCategory=function(v){this.options.activeCategory=v};t.prototype.setPostponedRedirect=function(v){this.postponedRedirect=v};t.prototype.showDimmer=function(v){if(!this.options.pageDimmerOverlay){return}if(v){this.options.pageDimmerOverlay.show()}else{this.options.pageDimmerOverlay.hide()}};t.prototype.startGeoSearch=function(v){if(v){u(this.geoScopeInput)}if(this.geoScopeInput.value==this.geoScopeInput.getAttribute("placeholder")||this.geoScopeInput.value==this.geoScopeInput.getAttribute("data-initialVal")){this.setGeoScopeInputText("")}this.showDimmer(true);if(!this.firstFocusTrigger){this.firstFocusTrigger=true;this.geoScopeTypeahead.showHistoryIfEnabled()}};t.prototype.stopGeoSearch=function(){if(this.geoInfo){this.refreshGeoInfo()}};t.prototype.startStaticSearch=function(v){if(v){u(this.staticSearchInput)}this.showDimmer(true);if(!this.firstFocusTrigger){this.firstFocusTrigger=true;this.staticSearchTypeAhead.showHistoryIfEnabled()}};t.prototype.stopStaticSearch=function(){};t.prototype.setGeoScopeInputText=function(v){this.geoScopeInput.set("value",v);this.geoScopeTypeahead.options.defaultValue=v};t.prototype.setStaticSearchInputText=function(v){this.staticSearchInput.set("value",v)};return t}(api));var m=function(z,u,w){if(!ta){return true}var A=ta.retrieve("ta_scoped_typeahead_search");var x="";var r=A&&A.staticSearchTypeAhead&&A.staticSearchTypeAhead.getNormalizedQuery()||"";var v=A&&A.staticSearchTypeAhead;if(A&&A.geoInfo.geoID>1){x=A.geoScopeTypeahead.source.value}else{if(w){x=w}}if(!r||!x){if(!r){get_scoped_typeahead&&get_scoped_typeahead(z,u,function(B){B&&B.startStaticSearch(true)});return false}if(!x){get_scoped_typeahead&&get_scoped_typeahead(z,u,function(B){if(B){B.stopStaticSearch();B.startGeoSearch(true)}});return false}}var s=false;var t=ta.id("mainSearch");var y=ta.id("TOURISM_REDIRECT");if(x&&!r&&t&&y){y.value="true";t.value="";s=true}return ta.call("ta.common.search.recordAndValidate",z,u,s,v)};var h=function(s){var r=s=="poi"?ta.find(".whereHeader"):ta.find(".whatHeader");var t=s=="geo"?ta.find(".whereHeader"):ta.find(".whatHeader");r.toggleClass("out");setTimeout(function(){t.toggleClass("out")},300)};var f=function(v,u){var t=ta.id("GEO_SCOPE_CONTAINER");var s=ta.id("global_nav_search_form");if(!s){return}if(s.elements.geo.value!=""){s&&(s.elements.redirect.value="true")&&s.submit()}else{var r=t.getChildren("input")[0];r&&r.focus()}};var o=function(r){ta.select(".twoFieldFocus").removeClass("twoFieldFocus");ta.select("."+r).addClass("twoFieldFocus");if(ta.find(".tablet_desktop")&&ta.find(".hintHeader")){window.scrollTo(0,ta.find(".hintHeader").getTop())}};var g=function(t,s){var u=ta.find(".whereThenWhat");var r=ta.id("GEO_SCOPED_SEARCH_INPUT");var v=ta.find(".geoExample");r&&v&&(r.placeholder=v.innerHTML);o("geoScopeContainer");get_scoped_typeahead&&get_scoped_typeahead(t,s,function(w){w.stopStaticSearch();w.startGeoSearch(false)});u&&u.addClass("two_field");ta.trackEventOnPage("TopNav_geo_search","focus","")};var e=function(J,H,z,u){var E=function(P){var O=P.target&&Element.getParent(P.target,"#GEO_SCOPE_CONTAINER, #MAIN_SEARCH_CONTAINER");if(O){return}J&&J.hide();y&&y.stopGeoSearch()};var A=ta.id(document.body);A.addEvent("click",E);A.addEventListener&&A.addEventListener("focus",E,true);ta.id(window).addEvent("blur",E);if(J){J.container.addEvent("click",E)}var w=function(P){var O=P.indexOf("#");if(O>0){P=P.substring(0,O)}return P};var M={showChildren:true,tagLabels:{newLocation:ta.retrieve("typeahead_new_location_label"),moved:ta.retrieve("typeahead_moved_label"),closed:ta.retrieve("typeahead_closed_label")},poiClasses:"primaryText",geoClasses:"secondaryText",useIconFont:u.groupResults};var G=(function(){return function(O){if(!O.details){return""}var P="displayItem";var Q=true;if(O.scope=="history"){P+=" history"}else{if(O.scope=="overview"){P+=" overview";Q=false}else{if(O.scope=="local_tag"||O.scope=="local_keyword"){P+=" overview short_cell";Q=false}else{P+=" result"}}}O.wrapperCSS=P;return TypeAhead.views.itemTemplate(M)(O,{HTMLEscape:Q})}})();var C=(function(){return function(O,Q){if(!O.details){return""}var P="displayItem";if(O.scope=="history"){P+=" history"}else{if(O.scope=="overview"){P+=" overview"+(Q?" short_cell":"")}else{if(O.scope=="local_tag"||O.scope=="local_keyword"){P+=" overview short_cell"}else{P+=" result"}}}O.wrapperCSS=P;return TypeAhead.views.itemTemplate(M)(O,{HTMLEscape:false})}})();var x={pageDimmerOverlay:J,geoScopeInput:ta.id("GEO_SCOPED_SEARCH_INPUT"),geoScopeFormElement:ta.id("TYPEAHEAD_GEO_ID"),staticSearchInput:ta.id("mainSearch"),recentHistory:ta.retrieve("typeahead.recentHistoryList")||[],popularDestinations:ta.retrieve("typeahead.popularDestinations"),translations:{all_hotels_text:ta.retrieve("typeahead.all_hotels"),all_restaurants_text:ta.retrieve("typeahead.all_restaurants"),all_attractions_text:ta.retrieve("typeahead.all_attractions"),all_vacation_rentals_text:ta.retrieve("typeahead.all_vacation_rentals"),all_flights_text:ta.retrieve("typeahead.all_flights"),hotels_text:ta.retrieve("typeahead.hotel_list"),hotel_text:ta.retrieve("typeahead.hotel"),restaurants_text:ta.retrieve("typeahead.restaurant_list"),restaurant_text:ta.retrieve("typeahead.restaurant"),attractions_text:ta.retrieve("typeahead.attraction_list"),thing_to_do_text:ta.retrieve("typeahead.attraction"),vacation_rentals_text:ta.retrieve("typeahead.vacation_rental_list"),vacation_rental_text:ta.retrieve("typeahead.vacation_rental"),all_of_trip:ta.retrieve("typeahead.scoped.all_of_trip"),static_local_label:ta.retrieve("typeahead.scoped.static_local_label"),no_results_found:ta.retrieve("typeahead.noResultsFound"),title_text:ta.retrieve("typeahead.scoped.result_title_text"),recently_viewed:ta.retrieve("typeahead.history"),popular_destinations:ta.retrieve("typeahead.popular_destinations"),worldwide_title:ta.retrieve("typeahead.worldwide"),area_title:ta.retrieve("typeahead.scoped.geo_area_template"),restaurants:ta.retrieve("typeahead.restaurant_list"),hotels:ta.retrieve("typeahead.hotel_list"),vacation_rentals:ta.retrieve("typeahead.vacation_rental_list"),poi_overview_geo:ta.retrieve("typeahead.scoped.poi_overview_geo"),poi_hotels_geo:ta.retrieve("typeahead.scoped.poi_hotels_geo"),poi_vr_geo:ta.retrieve("typeahead.scoped.poi_vr_geo"),poi_attractions_geo:ta.retrieve("typeahead.scoped.poi_attractions_geo"),poi_eat_geo:ta.retrieve("typeahead.scoped.poi_eat_geo"),poi_flights_geo:ta.retrieve("typeahead.scoped.poi_flights_geo"),poi_nbrhd_geo:ta.retrieve("typeahead.scoped.poi_nbrhd_geo"),poi_travel_guides_geo:ta.retrieve("typeahead.scoped.poi_travel_guides_geo"),overview_text:ta.retrieve("typeahead.scoped.overview"),flights_text:ta.retrieve("typeahead.scoped.flights"),neighborhoods_text:ta.retrieve("typeahead.scoped.neighborhoods"),things_to_do_text:ta.retrieve("typeahead.things_to_do"),travel_guides_text:ta.retrieve("typeahead.scoped.travel_guides"),typeahead_transport_error:JS_location_not_found},maxHistoryInjections:5};var K=function(R){var O=ta.util.Deferred();var P=R.results||R;if(P&&typeOf(P)==="array"){var Q=P.length==0;P.push({name:ta.retrieve("typeahead.searchMore.v2"),title:"Search",type:"SEARCH",url:"#",noResults:Q});O.resolve(R);return O.promise()}else{O.reject(JS_location_not_found);return O.promise()}};var F=z===x.staticSearchInput;var s=z===x.geoScopeInput;var D=new Element("div");D.addClass(ta.retrieve("typeahead_divClasses"));document.body.appendChild(D);var r=ta.id("MAIN_SEARCH_CONTAINER");var t=ta.extend(u.staticTypeAheadOptions,{minChars:1,minCharsForSearch:3,maxResults:9,defaultValue:Browser.ie&&Browser.version<=9?ta.retrieve("typeahead.scoped.poi_default_text"):"",geoId:u.geoID>1?u.geoID:undefined,name:"MASTHEAD",searchSessionId:q(),nextField:false,autoSelectFirst:false,selectOnBlur:false,startEventOn:F?"creation":"focus",width:null,offsetX:-(ta.id("mainSearch").getBoundingClientRect().left-r.getBoundingClientRect().left),offsetY:0,cacheResults:true,restoreOnFocus:true,enableQueryDelay:true,autopopulateHighlighted:false,cycleInput:false,assumeOnBlur:false,selectInputText:false,jpFirefoxIME:ta.retrieve("jp_typeahead_ime_firefox.enabled"),positionRelative:false,containerParent:D,containerClass:"scopedSearchDisplay staticPOIDisplay"+(u.groupResults?" typeahead_2016_q1":""),itemSelector:"li",validator:function(O){return m(O,r.getParent("form"))},recentHistory:[],historyTypes:["overview"],showHistory:true,integrateHistory:true,eligibleForHistoryInjection:function(O){return(O.data_type=="LOCATION"||O.data_type=="PAGE")},shouldReplaceHistoryItem:function(O){return(O.data_type!="PAGE")},getHistoryMatchingKey:function(O){return O.url},maxHistoryItems:x.maxHistoryInjections+7,focusAction:"history",searchParams:function(P){var Q={};Q.interleaved=true;Q.geoPages=true;Q.details=true;Q.types="geo,hotel,eat,attr,vr,air,theme_park";Q.link_type="geo";Q.neighborhood_geos=true;Q.matchTags=true;Q.matchGlobalTags=true;Q.matchKeywords=true;Q.hglt=true;Q.disableMaxGroupSize=true;Q.max=P.options.maxResults;Q.allowPageInsertionOnGeoMatch=false;Q.defaultListInsertionType="hotel";if(!P.options.scopeFilter){Q.scopeFilter=(P.options.geoId>1)?"global":undefined}else{Q.scopeFilter=P.options.scopeFilter}Q.injectNeighborhoods=P.options.injectNeighborhoods;Q.injectNewLocation=P.options.injectNewLocation;if(ta.has("typeahead.relevancy_threshold")){Q.scoreThreshold=0.5;Q._ignoreMinCount=true}var O=P.options.geoId;if(O!==""){Q.nearby=true;Q.local=true;Q.parentids=O}else{Q.global=true}return Q},search:function(Q,R){if(R.getInputLength(true)<R.options.minCharsForSearch){var O=ta.util.Deferred();var P={results:[],normalized:{query:Q}};O.resolve(P);return O.promise()}else{return R.searchFn(Q)}},postResultsFnList:[K],onRender:function(X,V){if(X.container&&X.container.innerHTML===""){X.hide();return}var R=api.select(".displayItem.history",X.container);var ac=R&&R.length>0;X.container.toggleClass("titleTop",ac);var Z=ta.select(".search-tagged-poi");var W,P,S,O,Q;if(Z){for(W=0;W<Z.length;W++){S=Z[W];P=S.getSize().x;var Y=[S.getSiblings(".poi-name")[0],S.getSiblings(".geo-name")[0]];for(var aa=0;aa<Y.length;aa++){O=Y[aa];if(!O){continue}Q=O.getStyle("max-width");Q=Q.replace("px","");if(Q.contains("%")){Q=Q.replace("%","");var ab=O.getParent("li").getSize().x;Q=ab*(Q/100)}var T=O.getStyle("margin-left").replace("px","");var U=20;O.setStyle("max-width",(Q-P-T-U)+"px")}}}},errorTemplate:function(){return""},onShow:function(O){r.addClass("dropdownVisible");O.container.setStyle("width",r.offsetWidth-1);O.container.setStyle("left",r.getBoundingClientRect().left)},onHide:function(O){r.removeClass("dropdownVisible")},onSelect:function(T,X,V,Q,O){if(T){y.setPostponedRedirect(undefined);ta.find(".backArrow")&&ta.find(".backArrow").hide();if(typeof T.type==="string"&&T.type.toUpperCase()==="SEARCH"){ta.setEvtCookie("TopNav_Search","Action","Selected_findmoreresults_inTaA_toSRP",0,"/Search");var S=z.getParent("form");S&&S.submit()}else{if(T.url){if(T.scope==="local_tag"){if(y.geoScopeTypeahead.source.value&&y.geoInfo.geoID!=1){ta.setEvtCookie("TopNav_Search","TagSelected",T.value,T.tagId,T.url)}else{y.startGeoSearch(true);y.setPostponedRedirect(T.url);ta.trackEventOnPage("TopNav_Search","TagSelected",T.value,T.tagId);return}}else{if(T.scope==="local_keyword"){if(y.geoScopeTypeahead.source.value){ta.setEvtCookie("TopNav_Search","KeywordSelected",T.value,T.indexInType,T.url)}else{y.startGeoSearch(true);ta.trackEventOnPage("TopNav_Search","KeywordSelected",T.value,T.indexInType);return}}else{var P="Selected_TaA_Result";var R=T.scope=="history"?1:0;if(T.type==="TRAVEL_GUIDE"){P=P+"_TravelGuides"}ta.setEvtCookie("TopNav_Search","Action",P,R,T.url)}}var U=w(T.url);var Y=w(window.location.href);var W=Y.indexOf(U,Y.length-U.length)>=0;if(W){get_scoped_typeahead(H,this,function(Z){Z.showDimmer(false)})}window.location=T.url}else{get_scoped_typeahead(H,this,function(Z){Z.stopStaticSearch();Z.setActiveCategory(T.type.toUpperCase());Z.startGeoSearch(true)})}}}},onKeyDown:function(O,P){if(P.tabPressed&&P.selectedIndex>=0){if(Browser.ie&&Browser.version<=9){O.preventDefault();O.stopPropagation()}P.select(true,"tab")}},resolveSelection:function(O){if(!O){return}if(O.type.toUpperCase()==="SEARCH"){return x.staticSearchInput.value}else{return O.name&&O.name.stripTags()}},itemTemplate:u.groupResults?C.partial(Function._,true):G});t.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(t,{noResultsMessage:x.translations.no_results_found,globalLabel:x.translations.worldwide_title,historyLabel:x.translations.recently_viewed,historyOnEmpty:true,resultClassWrap:"",groupByPlacetype:u.groupResults,boldSearchQuery:u.groupResults});var I=new TypeAhead(ta.id("mainSearch"),t);if(!I.hasDefaultText()){I.query=I.source.value}u=api.extend({},x,u);var D=new Element("div");D.addClass(ta.retrieve("typeahead_divClasses"));document.body.appendChild(D);var N=ta.id("GEO_SCOPE_CONTAINER");var v={defaultValue:Browser.ie&&Browser.version<=9?(x.geoScopeInput.getAttribute("data-initialVal")||x.geoScopeInput.value):"",recentHistory:ta.has("typeahead.popularDestinations")?ta.retrieve("typeahead.popularDestinations"):(ta.retrieve("typeahead.recentHistoryList")||[]),historyTypes:["geo","all"],showHistory:true,integrateHistory:true,maxHistoryItems:x.maxHistoryInjections+1,containerParent:D,containerClass:"scopedSearchDisplay geoScopeDisplay whiteCaret"+(u.groupResults?" typeahead_2016_q1":""),itemSelector:"li",nextField:false,autoSelectFirst:true,positionRelative:false,offsetX:-(ta.id("GEO_SCOPED_SEARCH_INPUT").getBoundingClientRect().left-N.getBoundingClientRect().left),offsetY:0,width:null,cacheResults:true,autopopulateHighlighted:false,cycleInput:false,assumeOnBlur:false,selectInputText:false,selectOnBlur:false,name:"GEOSCOPE",searchSessionId:q(),linkedTypeAhead:I,doSelectionBeforeLogging:true,startEventOn:s?"creation":"focus",shouldSubmit:function(){return false},minChars:1,minCharsForSearch:3,maxResults:9,search:function(Q,R){var O=ta.util.Deferred();if(R.getInputLength(true)<R.options.minCharsForSearch){var P={results:[],normalized:{query:Q}};O.resolve(P);return O.promise()}var S={query:Q,action:"API",startTime:this.startTime,uiOrigin:this.name,source:this.name,interleaved:true,types:"geo,theme_park",neighborhood_geos:true,link_type:"geo,hotel,vr,attr,eat,flights_to,nbrhd,tg",details:true,max:R.options.maxResults,injectNeighborhoods:R.options.injectNeighborhoods,hglt:true,searchSessionId:q()};new ta.util.ajax({method:"GET",url:"/TypeAheadJson",data:S}).always(function(T){if(T){O.resolve(T)}else{O.reject(JS_location_not_found)}});return O.promise()},onShow:function(O){N.addClass("dropdownVisible");O.container.setStyle("width",N.offsetWidth);O.container.setStyle("left",N.getBoundingClientRect().left)},onHide:function(O){N.removeClass("dropdownVisible")},onRender:function(P,O){if(O.length===0){P.hide()}},errorTemplate:function(){return x.translations.typeahead_transport_error},itemTemplate:u.groupResults?C.partial(Function._,false):G,resolveSelection:function(O){return""},onSelect:function(T,Y,W,Q,P){if(!T){return}var V={};var X=T.urls;for(var U=0;X&&U<X.length;U++){var O=X[U];V[O.type]={url:O.url}}if(y.options.activeCategory&&V[y.options.activeCategory]){window.location=V[y.options.activeCategory].url;return}if(!T.value){y.clearGeoInfo()}else{y.setGeoInfo(T.value,T.details.name,T.details.geo_name,V,T.details.parent_name,T.isNeighborhood)}var R=T.scope=="history"?1:0;if(y.postponedRedirect){if(T.value&&T.value>1){urlRedirect=y.postponedRedirect.replace("-g1-","-g"+T.value+"-");ta.setEvtCookie("TopNav_geo_search","Action","Selected_TaA_Result",R,urlRedirect);window.location=urlRedirect;return}}if(y.staticSearchTypeAhead.getNormalizedQuery()){ta.setEvtCookie("TopNav_geo_search","Action","Selected_TaA_Result",R,"/Search");var S=z.getParent("form");S&&S.submit()}else{ta.trackEventOnPage("TopNav_geo_search","Action","Selected_TaA_Result",R);y.startStaticSearch(true)}},onKeyDown:function(O,P){if(P.tabPressed&&P.selectedIndex>=0){if(Browser.ie&&Browser.version<=9){O.preventDefault();O.stopPropagation()}P.select(true,"tab")}}};v.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(v,{localLabel:null,globalLabel:x.translations.worldwide_title,historyLabel:x.translations.recently_viewed,historyOnEmpty:true,noResultsMessage:x.translations.no_results_found,showNoResultsMessage:true,groupByPlacetype:u.groupResults,boldSearchQuery:u.groupResults});var L=new TypeAhead(x.geoScopeInput,v);var B=L.injectHistory({name:x.translations.all_of_trip,type:"ALL"},0);B.details={name:B.name};B.normalized_name=B.name;B.scope="overview";I.options.linkedTypeAhead=L;u.staticSearchTypeAhead=I;u.geoScopeTypeAhead=L;var y=new i(u);ta.store("ta_scoped_typeahead_search",y);return y};var p=function(v,t,r,x){v&&v.stop();if(typeof globalTypeAheadCss!=="undefined"&&!ta.has("ta.globalTypeAheadCss")){ta.store("ta.globalTypeAheadCss",Asset.css(globalTypeAheadCss))}d=true;var s=ta.id("SECONDARY_NAV_BAR");var u=new Element("div",{"class":"pageDim"});var w=function(){var z;if(s){z=new ta.overlays.RelativeOverlayBelow({content:u,autoShow:false,permanent:true,style:"pageDimOverlay scopeSearchOverlay",zIndex:null},s);var y=function(){var A=api.getSize(ta.id("PAGE"));z.container.setStyles({width:A.x,height:A.y})};y();ta.id(window).addEvent("resize",y)}x(e(z,v,t,r));d=false};ta.load("ta.overlays.RelativeOverlayBelow",w)||w()};return{toggleHeaders:h,geoOnFocus:g,toggleFocus:o,twoFieldSearchOnClick:f,scopedSearchSubmitValidate:m,createScopedSearch:p}})})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"dmo_discover_more","handlers.js");a(["placement"],function(s){var x;var n;var g;var m;var q;var l=false;var z=false;var k=false;var A="DMO_content_click";var D="content_hub_module";function w(E,I){var J=ta.id(s.id);J.getElements(".tab").removeClass("selected");I.addClass("selected");if(!x){x=J.getElements(".card.event, .article, .card.collection");n=J.getElements(".card.event");g=J.getElements(".article");m=J.getElements(".card.collection");q=J.getElements(".column")}var F;if(E==="articles"){F=g}else{if(E==="collections"){F=m}else{if(E==="events"){F=n}else{F=x}}}var K;for(var H=0;H<q.length;H++){K=q[H];while(K.lastChild){if(H===0&&K.childNodes.length==1){break}K.removeChild(K.childNodes[K.childNodes.length-1])}}var G=1;for(var H=0;H<F.length;H++){q[G].appendChild(F[H]);if(++G>=q.length){G=0}}j(E);setTimeout(function(){window.fireEvent("scroll",["force"])},1)}function h(E){if(B()){t("destination_article_link",E)}else{c("dmo_article",E)}}function r(E){if(B()){t("destination_collection_link",E)}else{c("dmo_collection",E)}}function y(){v("see_all")}function o(E){if(B()){t("destination_event_link",E)}else{c("dmo_event",E)}}function i(){if(B()){e("provided_by_logo")}else{ta.trackEventOnPage("dmo_tourism_links","provided_by_logo")}}function j(E){if(E==="all"){E="all_resources"}ta.trackEventOnPage("destination_filter_links",E)}function p(){return document.getElementById("dmoDiscMore"+s.occurrence)}function C(){if(!l){if(B()){l="dmo_"+window.pageServlet.toLowerCase()+"_links"}else{l="Tourism"}}return l}function b(){if(!z){if(B()){z="dmo_"+window.pageServlet.toLowerCase()+"_home"}else{z="dmo_"+window.pageServlet.toLowerCase()}}return z}function B(){return window.pageServlet==="Destinations"}function v(E){e("DMO",E)}function c(E,F){ta.trackEventOnPage(C(),"DMO",E,F)}function e(F,E){ta.trackEventOnPage(C(),F,E,E)}function t(E,F){ta.trackEventOnPage(C(),E,F,F)}function d(F,E){ta.trackEventOnPage(A,E,D,F)}function f(){if(k){return}var E=p();if(ta.util.element.isScrolledIntoView(E)){ta.trackEventOnPage(b(),"dmo_content_in_view");k=true}}function u(){f();window.addEvent("scroll",function(){f()})}window.addEvent("load",u);return{switchToTab:w,linkClickedArticle:h,linkClickedCollection:r,linkClickedEvent:o,linkClickedLogo:i,linkClickedSeeAll:y,init:u,trackDmoContentClick:d}})})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"expanding_read_more_box","handlers.js");a(["placement"],function(b){function d(f){var e=ta.find("#"+b.id+" .ermb_text");e.toggleClass("expanded");if(f){f(e.hasClass("expanded"))}}function c(){var e=ta.find("#"+b.id+" .ermb_text");var f=ta.find("#"+b.id+" .content");e.toggleClass("no_expand",f.scrollHeight<=f.clientHeight)}window.addEvent("resize",c);return{toggleDescription:d,hideDividerIfNeeded:c}})})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"hover_scrolling_text","handlers.js");a(["placement"],function(g){var i=ta.id(g.id);var j;function n(){return i&&ta.find(".scroll_parent",i)}function f(){return i&&ta.find(".top_panel",i)}function e(){return i&&ta.find(".bottom_panel",i)}function m(s){c();var u=n();var r=9;if(u){var t=s(u);var q=p(u);if(t!==q){j=new Fx.Scroll(u,{transition:Fx.Transitions.linear,duration:Math.abs(q-t)*r});j.start(0,t)}}}function o(){return 0}function b(s){var r=s.getScrollHeight();var q=s.getHeight();return Math.max(r-q,o())}function p(q){return q.getScroll().y}function l(){m(b)}function k(){m(o)}function c(){if(j){j.stop();j=null}}function h(){var v=n();var r=e();var s=f();if(v&&s&&r){var u=b(v);var t=o();if(u>t){d(v)}var q=0;v.addEvent("scroll",function(){var w=p(v);if(q==t||q==u||w==t||w==u){q=w;s.toggleClass("invisible",w==0);r.toggleClass("invisible",w==u)}if(u>t&&w===u){ta.trackEventOnPage("hover_scrolling_text","max_scroll")}});v.fireEvent("scroll")}}function d(s){var q=o();var r=b(s);s.addEvent("mousewheel",function(u){u.stopPropagation();var t=p(s);var w=u.wheel<0;if(Browser&&Browser.ie&&u.event&&u.event.wheelDelta){var v;if(w){v=Math.min(50,r-t)}else{v=Math.max(-50,q-t)}s.scrollTop+=v;u.preventDefault()}else{if(w&&t>=r||!w&&t<=q){u.preventDefault()}}})}return{initialize:h,startScrollingDown:l,startScrollingUp:k,stopScrolling:c}})})();(function(){var a=ta.p13n.placements.define.bind(ta.p13n.placements,"nearby_airports","handlers.js");a(["placement"],function(b){var d=ta.id(b.id);var c=function(){d.getElements(".airportCard").toggle();d.getElements(".moreLessText").toggle();return};return{switchPage:c}})})();(function(d){var g=d.select||window.z||window.$;var j={};function e(m,l,k,n){l=l.replace(/\.js$/i,"");j[m+":"+l]={reqs:k,inifunc:n}}function i(k,p,r){p=p.replace(/\.js$/i,"");var o=k[p];if(o){return o}var m=k.widget.name+":"+p;if(r[p]){throw m+" depends on itself recursively"}var n=j[m];if(!n){return window.require(p)}r[p]=true;var s=n.reqs;var q=[];for(var l=0;l<s.length;l++){q.push(i(k,s[l],r))}o=n.inifunc.apply({},q);r[p]=false;k[p]=o;return o}function a(l,m){var k=c(l);if(k){return i(k,m,{})}}function h(k){var m,l;if(!k){k=document}if(typeof(k)==="string"){k=document.getElementById(k);if(!k){return}}m=g(".prw_rup",k);for(l=0;l<m.length;l++){f(m[l])}m=g(".prw_dyn",k);for(l=0;l<m.length;l++){f(m[l])}}function f(o){var m,k,l,n;if(!o){return}if(o._prWidgetContext){return}m=o.getAttribute("data-prwidget-init");if(typeof(m)!="string"){return}l=o.getAttribute("data-prwidget-name");if(!l){return}m=m.match(/[^\s,]+(\s+[^\s,]+)*/g)||[];k={widget:{name:l,element:o,modules:m}};o._prWidgetContext=k;for(n=0;n<m.length;n++){var p=m[n];i(k,p,{})}}function c(m){var l;if(!m){return null}var k=m._prWidgetContext;if(k){return k}l=m;while(l&&!l.hasAttribute("data-prwidget-init")){l=l.parentNode}if(l){k=l._prWidgetContext;if(k){m._prWidgetContext=k;return k}}return}function b(l,k){k=k||document.body;return k.getElement(".prw_"+l)}d.prwidgets={define:e,getjs:a,initWidgets:h,getWidgetElement:b}})(ta);if(window.ta&&ta.rollupAmdShim){ta.rollupAmdShim.install(["mixins/Events","overlays/Overlay","overlays/utils","overlays/options/closeOnDocClick","overlays/options/closeOnChildClick","overlays/options/closeOnMouseOut","overlays/options/closeOnScroll","overlays/options/closeOnEscape","overlays/options/closeOnLegacyOverlay","overlays/options/hoverDelay","overlays/options/storeOverlayOnElement","overlays/options/fadeInOut","overlays/options/highlightElement","overlays/options/repositionOnEvent","overlays/options/keepInDom","overlays/options/maxWidth","overlays/options/minWidth","overlays/position","overlays/styles/modal","overlays/styles/popover","overlays/styles/tooltip","overlays/styles/windowshade","overlays/styles/dropdown","overlays/uiOverlay","overlays/rtl"],["ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta"])}if(window.requirejs&&requirejs.taConfig){requirejs.taConfig({deferred:{},name:"uiOverlays",files:{"js-amd":{src:{mixins:{Events:1},overlays:{uiOverlay:1,utils:1,options:{keepInDom:1,closeOnEscape:1,minWidth:1,closeOnLegacyOverlay:1,closeOnDocClick:1,closeOnMouseOut:1,closeOnChildClick:1,repositionOnEvent:1,fadeInOut:1,highlightElement:1,storeOverlayOnElement:1,closeOnScroll:1,hoverDelay:1,maxWidth:1},styles:{popover:1,tooltip:1,windowshade:1,dropdown:1,modal:1},position:1,rtl:1,Overlay:1}}}},_:{baseUrl:"/"}})};define("mixins/Events",["ta"],function(b){var a=function(){this.events={};Array.prototype.slice.call(arguments).forEach(function(c){this.events[c]=[]},this)};a.extend=function(d,e){var c=Object.create(a.prototype);c.delegate=d;a.apply(c,e);return c};a.prototype.on=a.prototype.addListener=function(d,c){if(this.events[d]!==undefined){this.events[d].push(c)}else{if(this.delegate){this.delegate.on(d,c)}}return this};a.prototype.off=a.prototype.removeListener=function(e,d){if(this.events[e]!==undefined){if(d){var c=this.events[e].indexOf(d);if(c>=0){this.events[e].splice(c,1)}}else{this.events[e].length=0}}else{if(this.delegate){this.delegate.removeListener(e,d)}}return this};a.prototype.removeAllListeners=function(d){if(d&&this.events[d]!==undefined){this.events[d].length=0}else{if(!d){for(var c in this.events){if(this.events.hasOwnProperty(c)){this.events[c].length=0}}if(this.delegate&&this.delegate.removeAllListeners){this.delegate.removeAllListeners()}}else{if(this.delegate&&this.delegate.removeAllListeners){this.delegate.removeAllListeners(d)}}}};a.prototype.emit=function(d){if(this.events[d]){var c=Array.prototype.slice.call(arguments,1);this.events[d].forEach(function(e){if(e){try{e.apply(this,c)}catch(f){if(typeof f==="string"){f=new Error(f)}if(typeof(b)==="object"&&b&&b.util&&b.util.error&&b.util.error.record){b.util.error.record(f,"Error in event handler for "+d)}else{if(typeof(b)==="object"&&b&&b.log&&b.log.error){b.log.error(f,"Error in event handler for "+d)}else{if(typeof(b)==="object"&&b&&b.m&&b.m.recordJSError){b.m.recordJSError([f,"Error in event handler for "+d])}else{if(console.error){console.error("Error in event handler for "+d,f)}else{console.log("Error in event handler for "+d)}}}}}}},this)}else{if(this.delegate&&this.delegate.emit){this.delegate.emit.apply(delegate,arguments)}}return this};return a});define("overlays/Overlay",["ta","mixins/Events"],function(c,b){var a=function(f,d){this.sourceElement=f;this.domParent=document.body;c.mixin(this,new b("show","hide","destroy","positionDirty"));c.bindAll(this,"show","hide","destroy");var d=(d&&Object.prototype.toString.call(d)==="[object Array]"?d:Array.prototype.slice.call(arguments,1));for(var e=0;e<d.length;e++){d[e]&&d[e].call(this)}};a.prototype.show=function(){if(c.inDocument(this.container)){return this}this.domParent.appendChild(this.container);this.emit("show");return this};a.prototype.hide=function(d){if(!c.inDocument(this.container)){return this}this.domParent.removeChild(this.container);this.emit("hide",{trigger:d});return this};a.prototype.destroy=function(){this.hide();this.emit("destroy");this.sourceElement=null;return this};return a});define("overlays/utils",["ta"],function(b){var a={};a.arrowDir={above:"bottom",below:"top",left:"right",right:"left"};a.injectContent=function(d,e,g,c,f){if(b.isElement(g)){b.adopt(d,g)}else{if(c){g=b.find(c,e);b.removeClass(g,"hidden");b.adopt(d,g)}else{if(f){g=b.find(f);g&&(d.innerHTML+=g.innerHTML)}else{d.innerHTML+=g}}}};a.parseOffsets=function(c){if(!c||!c.length){return{x:0,y:0}}return{x:c[0]&&parseInt(c[0],10)||0,y:c[1]&&parseInt(c[1],10)||0}};return a});define("overlays/options/closeOnDocClick",["ta"],function(d){function b(e){if(d.containsElement(this.sourceElement,e.target)){return}if(d.containsElement(this.container,e.target)){return}if(e.target&&e.target.tagName=="option"){return}if(d.checkBrowser("ie")&&e.target&&e.target.tagName=="select"&&d.containsEvent(e.target,e)&&d.select(this.container,"input").indexOf(e.target)){return}this.hide("doc-click")}function a(e){return function(){var f=d.bind(b,this);this.on("show",function(){d.addEvent(this.domParent,"click",f);e&&d.addEvent(this.domParent,"touchstart",f)}).on("hide",function(){d.removeEvent(this.domParent,"click",f);e&&d.removeEvent(this.domParent,"touchstart",f)})}}var c=a(true);c.withoutTouchEvents=a(false);return c});define("overlays/options/closeOnChildClick",["ta"],function(d){function b(e){if(d.containsElement(this.container,e.target)){this.hide("child-click")}}function a(e){return function(){var f=d.bind(b,this);this.on("show",function(){d.addEvent(this.domParent,"click",f);e&&d.addEvent(this.domParent,"touchstart",f)}).on("hide",function(){d.removeEvent(this.domParent,"click",f);e&&d.removeEvent(this.domParent,"touchstart",f)})}}var c=a(true);c.withoutTouchEvents=a(false);return c});define("overlays/options/closeOnMouseOut",["ta"],function(c){function a(d){if(c.containsElement(this.sourceElement,d.relatedTarget)){return}if(c.containsElement(this.container,d.relatedTarget)){return}this.hide()}var b=function(){var d=c.bind(a,this);this.on("show",function(){c.addEvent(this.sourceElement,"mouseout",d);c.addEvent(this.container,"mouseout",d)}).on("hide",function(){c.removeEvent(this.sourceElement,"mouseout",d);c.removeEvent(this.container,"mouseout",d)})};return b});define("overlays/options/closeOnScroll",["ta"],function(b){var a=function(){this.on("show",function(){b.addEvent(window,"scroll",this.hide)}).on("hide",function(){b.removeEvent(window,"scroll",this.hide)})};return a});define("overlays/options/closeOnEscape",["ta"],function(b){function c(d){if(d.keyCode===27){this.hide("escape")}}var a=function(){var d=b.bind(c,this);this.on("show",function(){b.addEvent(this.domParent,"keydown",d)}).on("hide",function(){b.removeEvent(this.domParent,"keydown",d)})};return a});define("overlays/options/closeOnLegacyOverlay",["ta"],function(b){var a=function(){window.addEvent("onOverlayShow",b.bind(this.hide,this))};return a});define("overlays/options/hoverDelay",["ta"],function(b){var a=function(c,d){return function(){var e=b.bind(function(){this.hoverTimer=setTimeout(this.show,c)},this);var f=b.bind(function(){clearTimeout(this.hoverTimer)},this);b.addEvent(this.sourceElement,"mouseover",e);b.addEvent(this.sourceElement,"mouseout",f);d&&e()}};return a});define("overlays/options/storeOverlayOnElement",["ta"],function(b){var a=function(){this.sourceElement.store("overlay",this)};return a});define("overlays/options/fadeInOut",["ta"],function(a){var c={fade_none:0,fade_short:250,fade_normal:500,fade_long:1000};var b="fade_in";return function(e,d){return function(){if(!e||!(e in c)){return}this.container.addClass(e);var g=c[e];var f=a.bind(this.show,this);var h=a.bind(this.hide,this);this.show=function(){f&&f();this.container.addClass(b);setTimeout(a.bind(this.hide,this),g+d)};this.hide=function(){this.container.removeClass(b);setTimeout(function(){h&&h()},g)}}}});define("overlays/options/highlightElement",["ta"],function(b){var a=function(){this.on("show",function(){this.sourceElement.addClass("highlight")}).on("hide",function(){this.sourceElement.removeClass("highlight")})};return a});define("overlays/options/repositionOnEvent",["ta"],function(a){function b(){this.emit("positionDirty")}return function(d,c){return function(){var e=a.bind(b,this);this.on("show",function(){a.addEvent(d,c,e)}).on("hide",function(){a.removeEvent(d,c,e)})}}});define("overlays/options/keepInDom",["ta"],function(b){var a="";return function(){this.show=function(){if(b.inDocument(this.container)){this.container.style.display=a}else{this.domParent.appendChild(this.container)}this.emit("show");return this};this.hide=function(c){if(b.inDocument(this.container)){a=this.container.style.display||"";this.container.style.display="none";this.emit("hide",{trigger:c})}return this}}});define("overlays/options/maxWidth",["ta"],function(a){var b=function(c){function d(){a.setStyle(this.container,"max-width",c+"px");this.emit("positionDirty")}return function(){this.on("show",a.bind(d,this))}};return b});define("overlays/options/minWidth",["ta"],function(a){var b=function(c){function d(){a.setStyle(this.container,"min-width",c+"px");this.emit("positionDirty")}return function(){this.on("show",a.bind(d,this))}};return b});define("overlays/position",["ta","overlays/utils"],function(e,d){function c(l,k,j,i){return function(m,n){return function(){function o(){var p=e.getSize(this.container),u=e.getSize(this.arrow)||{x:0,y:0},v=g(m,this.sourceElement),q=e.getSize(v),s=e.getPosition(v),x=e.getSize(this.domParent),r=d.parseOffsets(f(m)),t=n||b(this.sourceElement);this.container.style.position=t?"fixed":"absolute";if(j&&i){this.container.style.position="fixed";this.container.style.left=(l()+r.x)+"px";this.container.style.top=(k()+r.y)+"px";this.container.style.right=(j()+r.x)+"px";this.container.style.bottom=(i()+r.y)+"px"}else{this.container.style.right="auto";var w=Math.floor(l(p,u,q,s,x,t))+r.x;if(this.domParent===document.body){w=Math.max(w,0);if(w+p.x>x.x){w=x.x-p.x}}this.container.style.left=w+"px";this.container.style.top=Math.floor(k(p,u,q,s,x,t))+r.y+"px"}}this.on("show",o);this.on("positionDirty",o)}}}function h(i,j){return function(){return function(){function k(){var l=e.getSize(this.container);this.container.style.position="fixed";if(i){if(ta.util.i18n.isRtl()){this.container.style.right="50%";this.container.style.marginRight=-l.x/2+"px"}else{this.container.style.left="50%";this.container.style.marginLeft=-l.x/2+"px"}}if(j){this.container.style.top="50%";this.container.style.marginTop=-l.y/2+"px"}}this.on("show",k);this.on("positionDirty",k)}}}function g(j,i){if(!j||!j.length||!isNaN(j[0])){return i}return i.getElement(j[0])}function f(i){if(!i||!i.length||!isNaN(i[0])){return i}return i.slice(1)}function b(i){while(i){if(i.currentStyle&&i.currentStyle.position==="fixed"){return true}if(i.getComputedStyle&&i.getComputedStyle("position")==="fixed"){return true}i=i.parentNode}return false}var a={};a.above=c(function(n,k,i,j,m,l){return j.x+(i.x/2)-(n.x/2)-(l?e.scrollLeft():0)},function(n,k,i,j,m,l){return j.y-n.y-k.y-(l&&!Browser.Platform.ios?e.scrollTop():0)});a.below=c(function(n,k,i,j,m,l){return j.x+(i.x/2)-(n.x/2)-(l?e.scrollLeft():0)},function(n,k,i,j,m,l){return j.y+(i.y)+k.y-(l&&!Browser.Platform.ios?e.scrollTop():0)});a.bottomRight=c(function(n,k,i,j,m,l){return j.x-(l?e.scrollLeft():0)},function(n,k,i,j,m,l){return j.y+(i.y)+k.y-(l&&!Browser.Platform.ios?e.scrollTop():0)});a.left=c(function(n,k,i,j,m,l){return j.x-n.x-k.x-(l?e.scrollLeft():0)},function(n,k,i,j,m,l){return j.y+(i.y/2)-(n.y/2)-(l&&!Browser.Platform.ios?e.scrollTop():0)});a.right=c(function(n,k,i,j,m,l){return j.x+i.x+k.x-(l?e.scrollLeft():0)},function(n,k,i,j,m,l){return j.y+(i.y/2)-(n.y/2)-(l&&!Browser.Platform.ios?e.scrollTop():0)});a.center=c(function(m,k,i,j,l){return(l.x/2)-(m.x/2)},function(n,k,i,j,m,l){return(m.y/2)-(n.y/2)+(l&&!Browser.Platform.ios?0:e.scrollTop())});a.movingCenter=h(true,true);a.movingCenterX=h(true,false);a.movingCenterY=h(false,true);a.absolute=c(function(){return 0},function(){return 0});a.framed=c(function(){return 0},function(){return 0},function(){return 0},function(){return 0});return a});define("overlays/styles/modal",["ta","overlays/utils"],function(c,b){function d(f,g,h,e){this.container=c.createElement("span",{"class":"ui_modal "+g});if(h){this.header=c.createElement("div",{"class":"header_text",html:h});this.container.appendChild(this.header)}if(e){this.subheader=c.createElement("div",{"class":"subheader_text",html:e});this.container.appendChild(this.subheader)}this.inner=c.createElement("div",{"class":"body_text"});this.container.appendChild(this.inner);this.close=c.createElement("div",{"class":"ui_close_x"});this.container.appendChild(this.close)}var a=function(i,h,g,k,f,j){g=g||(i&&i.getAttribute("data-modal"))||"";k=k||(i&&i.getAttribute("data-header"))||"";f=f||(i&&i.getAttribute("data-subheader"))||"";j=j||(i&&i.getAttribute("data-content"))||"";var e=i&&i.getAttribute("data-element");return function(){d.call(this,h,g,k,f);b.injectContent(this.inner,i,j,e);c.addEvent(this.close,"click",c.bind(function(){this.hide.apply(this,arguments)},this,"close-button"))}};return a});define("overlays/styles/popover",["ta","overlays/utils"],function(c,a){function d(e,f){this.container=c.createElement("span",{"class":"ui_popover arrow_"+a.arrowDir[e]+" "+f});this.arrow=c.createElement("div",{"class":"arrow"});this.container.appendChild(this.arrow);this.header=c.createElement("div",{"class":"header_text"});this.container.appendChild(this.header);this.inner=c.createElement("div",{"class":"body_text"});this.container.appendChild(this.inner);this.close=c.createElement("div",{"class":"ui_close_x"});this.container.appendChild(this.close)}var b=function(e,f,m,j,k){m=m||e.getAttribute("data-popover");j=j||e.getAttribute("data-header");k=k||e.getAttribute("data-content");var h=e.getAttribute("data-element");var l=e.getAttribute("data-element-copy");var i=e.getAttribute("data-header-element");var g=e.getAttribute("data-header-copy");return function(){d.call(this,f,m);a.injectContent(this.inner,e,k,h,l);a.injectContent(this.header,e,j,i,g);c.addEvent(this.close,"click",this.hide)}};return b});define("overlays/styles/tooltip",["ta","overlays/utils"],function(c,a){function d(e,f){this.container=c.createElement("span",{"class":"ui_tooltip arrow_"+a.arrowDir[e]+" "+f});this.arrow=c.createElement("div",{"class":"arrow"});this.container.appendChild(this.arrow);this.inner=c.createElement("div",{"class":"body_text"});this.container.appendChild(this.inner)}var b=function(h,g,f,i){f=f||h.getAttribute("data-tooltip");i=i||h.getAttribute("data-content");var e=h.getAttribute("data-element");return function(){d.call(this,g,f);a.injectContent(this.inner,h,i,e)}};return b});define("overlays/styles/windowshade",["ta"],function(b){var a=function(c){return function(){this.shade=b.createElement("div",{"class":"ui_backdrop "+(c||"dark")});this.on("show",function(){this.domParent.appendChild(this.shade)});this.on("hide",function(){if(b.inDocument(this.shade)){this.domParent.removeChild(this.shade)}})}};return a});define("overlays/styles/dropdown",["ta","overlays/utils"],function(c,b){function d(e,f){this.container=c.createElement("span",{"class":"ui_dropdown "+f})}var a=function(h,g,f,i){f=f||h.getAttribute("data-dropdown");i=i||h.getAttribute("data-content");var e=h.getAttribute("data-element");return function(){d.call(this,g,f);b.injectContent(this.container,h,i,e)}};return a});define("overlays/uiOverlay",["ta"],function(b){var c={tooltip:{defaultPosition:"above"},popover:{defaultPosition:"below"},modal:{defaultPosition:"center",defaultFixed:true},dropdown:{defaultPosition:"below"}};var a=function(k,f){k=k||window.event;f=f||k.target||k.srcElement;var h=k&&k.type;if(h){b.removePropertyEvent(f,h,"uiOverlay")}if(k){k=new Event(k);k.preventDefault();k.stopPropagation()}var e=(f.getAttribute("data-position")||"").split(" ").filter(function(l){return !!l.length});var j=e.shift();var d=["overlays/Overlay","overlays/position"];for(var g in c){if(f.hasAttribute("data-"+g)){j=j||c[g].defaultPosition;d.push("overlays/styles/"+g);break}}d.push(f.hasAttribute("data-windowshade")?"overlays/styles/windowshade":null);var i=false;if(f.hasAttribute("data-defer")){i=parseInt(f.getAttribute("data-defer"))}d.push(i?"overlays/options/hoverDelay":null);d.push("overlays/options/storeOverlayOnElement");if(f.hasAttribute("data-tooltip")){if(h==="click"){d.push("overlays/options/closeOnDocClick")}else{if(h==="mouseover"){d.push("overlays/options/closeOnMouseOut")}}}if(f.hasAttribute("data-options")){d=d.concat(f.getAttribute("data-options").split(" ").map(function(l){return"overlays/options/"+l}))}require(d,function(l,m,t,n,s){var r=[t(f,j),m[j](e,c[g].defaultFixed),n&&n(f.getAttribute("data-windowshade")),s&&s(i,true)],o=Array.prototype.slice.call(arguments,4),p=new l(f,r.concat(o));if(h){!i&&b.addEvent(f,h,p.show);p.on("destroy",function(){b.removeEvent(f,h,p.show)})}!i&&p.show();if(f.hasAttribute("data-callback")){var q=b.fn(f.getAttribute("data-callback"));q&&q(p)}});return false};return a});window.uiOverlay=function(){var a=arguments;require(["overlays/uiOverlay"],function(b){b.apply(null,a)})};require(["ta","overlays/position","overlays/utils"],function(c,a,b){if(!c.hasClass(document.body,"rtl")){return}var d=a.left;var e=a.right;a.left=e;a.right=d});ta.media||(ta.media={});ta.media.viewer=(function(){var e;var i;var g;var b;var n=ta.isTabletAlbumViewer();var w=n?0:20;var x;var a=new u();var l="#photos";var j=l+";";function u(){var A=[];this.register=function(E,D,F,C){if(!F){C=true;F=ta}var G=C?"on":"addEvent";var B=C?"off":"removeEvent";F[G](E,D);A.push(function(){F[B](E,D)})};this.addCleanup=function(B){A.push(B)};this.cleanup=function(){A.forEach(function(B){B()});A=[]}}function y(){if(i&&i.onResize){i.onResize()}}function r(){a.register("resize",y,window);y();if(i&&i.onLoad){i.onLoad()}var A=ta.retrieve("oyster_location_data");if(A&&A.hasOyster&&A.hasOyster[g]){ta.run("ta.photos.oysterTracking.trackCandidateSession",null,null,null,"LB_OPEN")}a.register("mediaViewerEscapePressed",function(){try{e.fireEvent("onClose",e)}catch(B){}e.hide()})}function h(){document.body.addClass("remove-scrolling");if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.retrieve("meta.baseLocationId")){ta.commerce.meta.updateProvAreaFromLightBox(ta.retrieve("meta.baseLocationId"))}if(i&&i.onShow){i.onShow()}if(n){if(ta.retrieve("tabletRacOnPhotoViewer")){ta.remove("RASCalendar");if(ta.restaurantAvailabilitySearch){x=ta.restaurantAvailabilitySearch.getContainerSelector()}}ta.find(".albumLightbox .ui_close_x").addClass("svgico")}ta.fireEvent("refreshedDOMContent",e.container)}function t(){e.container.removeClass("loaded");ta.fireEvent("mediaViewerLightboxHide");document.body.removeClass("remove-scrolling");if(i&&i.onClose){i.onClose()}ta.remove("meta.requestFromArea");var A=ta.retrieve("metaCheckRatesOverlay");if(A){A.hide();ta.remove("metaCheckRatesOverlay")}ta.meta.linkTracking.restoreCRPageServlet();if(ta.retrieve("photo.viewer.refreshOnClose")){window.location=window.location}if(ta.has("translationOverlay")){ta.retrieve("translationOverlay").hide()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")&&ta.isMetaHotelsRequest&&ta.isMetaHotelsRequest()){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}else{if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.ajax.resetAjaxCall();ta.commerce.minimeta.ajax.send(false,true);ta.remove("hotels.datesChanged")}}ta.widgets.calendar.closeCalendarWidgets();a.cleanup();if(n){if(ta.retrieve("tabletRacOnPhotoViewer")){ta.remove("RASCalendar");if(ta.restaurantAvailabilitySearch){ta.restaurantAvailabilitySearch.setContainerSelector(x)}}}if(i&&i.onHide){i.onHide()}window.fireEvent("photoLightBoxHidden")}function q(A){ta.store("media.albums.loadOnEvent",true);e.inner.innerHTML=A;a.register("show",h,e,true);a.register("hide",t,e,true);r();h();setTimeout(function(){ta.fireEvent("mediaViewerDOMLoaded");e.container.addClass("loaded");if(!ta.has("albumViewer.testBeigeBg")){e.container.addClass("dark")}},1)}function s(A){require(["overlays/Overlay","overlays/styles/modal","overlays/position","overlays/styles/windowshade"],function(E,D,C,F){var H="dark mediaAlbumsBackdrop";var G="albumLightbox";if(ta.has("albumViewer.testBeigeBg")){G+=" testBeigeBg"}var B=ta.isTabletAlbumViewer()?C.framed([0,0]):C.framed([18,18]);e=e||new E(document.body,D(null,"",G,"","",d()),B,F(H));e.show();A()})}function p(){try{if(navigator.userAgent.match(/ Safari\//)&&!navigator.userAgent.match(/ Chrom/)&&navigator.userAgent.match(/ Version\/5\./)){return false}var B=navigator.userAgent.match(/\ AppleWebKit\/(\d+)\.(\d+)/);if(B){B.shift();var A=parseInt(B[0]),C=parseInt(B[1]);if(A<535||(A==535&&C<23)){return false}}return"onload" in document.createElement("link")}catch(D){return false}}var o=false;function m(A,F){var D=null;var K=false;var G=false;function J(){if(G&&K&&D){o=true;F(D)}}if(o){K=G=true}else{var I=[ta.isTabletAlbumViewer()&&window.getCssAlbumPhotoLBIconAsset&&window.getCssAlbumPhotoLBIconAsset(),window.cssAlbumViewerAssetHotels,window.cssPhotoLightboxAsset,window.cssAlbumViewerExtendedAsset,window.hrExtraCssLightboxAsset];var B=0;function E(){B++;if(B>=I.length){G=true;J()}}for(var H=0;H<I.length;H++){(function(L){L?Asset.css(L,{onLoad:E}):E()})(I[H])}if(!p()){G=true;J()}if(!K){if(window.jsAlbumViewerExtendedAsset){function C(){ta.loadInOrder(window.jsAlbumViewerExtendedAsset,function(){K=true;J()})}if(window.jQuery||!window.jsJqueryLib){C()}else{Asset.javascript(window.jsJqueryLib,{onLoad:function(){jQuery.noConflict();C()}})}}}}new ta.util.ajax({method:"GET",url:A,evalScripts:true}).success(function(L){D=L.text;J()})}function d(){if(window.AnimationEvent){return'<div class="cssLoadingSpinner" style="display:block"><div class="cssLoadingSpinner_step1"></div><div class="cssLoadingSpinner_step2"></div><div class="cssLoadingSpinner_step3"></div><div class="cssLoadingSpinner_step4"></div><div class="cssLoadingSpinner_step5"></div><div class="cssLoadingSpinner_step6"></div><div class="cssLoadingSpinner_step7"></div><div class="cssLoadingSpinner_step8"></div></div>'}else{return'<div class="cssLoadingSpinner" style="display:block"><img src="'+CDNHOST+'/img2/spinner24_green.gif"></div>'}}function k(F){var B=F;B.heroMinWidth=window.getSize().x-w*2;B.heroMinHeight=window.getSize().y-w*2;if(!F.albumViewMode){if(F.ff||F.imageId){B.ff=F.ff||F.imageId;B.albumid=101;B.albumViewMode="hero";B.albumPartialsToUpdate="full";B.thumbnailMinWidth=50;B.cnt=30;B.offset=-5;B.baseMediaId=B.ff;B.extraAlbumCoverCount=2}if(F.albumId){B.albumid=F.albumId;B.albumViewMode="images";B.albumPartialsToUpdate="full";B.extraAlbumCoverCount=4}}var A="QC_Meta_Mini|Photo_Lightbox";B.area=A;ta.commerce.meta.tracking.resetTimingLockForNavArea(A);if(ta.meta&&ta.meta.update&&window.pageServlet){Object.merge(B,ta.commerce.meta.getMetaParams())}var C="/LocationPhotoAlbum?"+Object.toQueryString(B);var D=C;try{C=ta.commerce.meta.tracking.updateUrlWithTiming(C,A)}catch(E){ta.util.error.record(E,"problem updating url with timing in viewerScaffold");C=D}return C}function v(B,D){var C=window.location.hash;if(C.indexOf(l)>=0){var A=f();if(A){if(!A.detail&&window.modelLocId){A.detail=window.modelLocId}if(!A.geo&&window.modelGeoId){A.geo=window.modelGeoId}z(A)}else{z({detail:B,geo:D})}}}function f(){var A=window.location.hash;var B=A.substring(A.indexOf(j)+j.length,A.length);if(B.length>0){return B.parseQueryString(false,false)}return null}function c(){require(["utils/HistoryManager"],function(B){var A=new B();if(A.isSupported()){a.register("albumViewerPushState",A.pushState);a.register("albumViewerReplaceState",A.replaceState);a.register("mediaViewerLightboxHide",function(){var C=window.location.protocol+"//"+window.location.host+window.location.pathname;window.history.pushState(null,null,C)});window.addEvent("popstate",function(){if(window.location.hash.indexOf(l)>=0){e.show()}else{e.hide()}})}})}function z(C){i=C.evtDelegates;g=C.detail;b=C.geo;var A=false;var B=0;var D=setInterval(function(){if(A){clearInterval(D)}else{ta.trackEventOnPage("Photo_LB","slow_load",(++B)*30,navigator.userAgent)}},30000);s(function(){m(k(C),function(E){A=true;q(E);if(ta.has("albumViewer.historyEnabled")){c()}})})}return{load:z,handleFragment:v,parseFragment:f}})();