/* 9:56:00 17/02/2016 [http://oystatic.ignimgs.com/src/core/js/external/neon/neon-ign-main.js]*/
var neonPublisherId="2089095449",neonTrackerType="gen",_neon=_neon||{},neonPageId=null,videoIds=[],imgObjs=[],apiBaseURL="i3.neon-images.com",lastMouseClick,lastMouseClickElement;eventMethod=window.addEventListener?"addEventListener":"attachEvent";eventer=window[eventMethod];messageEvent="attachEvent"==eventMethod?"onmessage":"message";
function _trackLastMouseClick(b){var a,b=b||event;if(b.srcElement)a=b.srcElement;else if(b.target)a=b.target;lastMouseClickElement=a.localName;"object"==lastMouseClickElement&&(lastMouseClick=(new Date).getTime())}document.onmouseup=_trackLastMouseClick;eventer(messageEvent,function(b){orig=b.origin;-1<orig.indexOf(apiBaseURL)&&startTrackingNeonISPImages(b.data)},!1);Object.size=function(b){var a=0,g;for(g in b)b.hasOwnProperty(g)&&a++;return a};
(function(b){function a(){h=!1;for(var a in g){var k=b(g[a]).filter(function(){return b(this).is(":appeared")});k.trigger("appear",[k]);if(d){var i=d.not(k);i.trigger("disappear",[i])}d=k}}var g=[],c=!1,h=!1,l={interval:250,force_process:!1},e=b(window),d;b.expr[":"].appeared=function(a){a=b(a);if(!a.is(":visible"))return!1;var d=e.scrollLeft(),i=e.scrollTop(),j=a.offset(),g=j.left,j=j.top;return j+a.height()>=i&&j-(a.data("appear-top-offset")||0)<=i+e.height()&&g+a.width()>=d&&g-(a.data("appear-left-offset")||
0)<=d+e.width()?!0:!1};b.fn.extend({appear:function(d){var k=b.extend({},l,d||{}),d=this.selector||this;if(!c){var i=function(){h||(h=!0,setTimeout(a,k.interval))};b(window).scroll(i).resize(i);c=!0}k.force_process&&setTimeout(a,k.interval);g.push(d);return b(d)}});b.extend({force_appear:function(){return c?(a(),!0):!1}})})(IGN.jQuery);
(function(b){_neon.JsonRequester=function(){function a(b){this.fullUrl=b;this.noCacheIE="&noCacheIE="+(new Date).getTime();this.headLoc=document.getElementsByTagName("head").item(0);this.scriptId="JscriptId"+a.scriptCounter++}a.scriptCounter=1;a.prototype.buildScriptTag=function(){this.scriptObj=document.createElement("script");this.scriptObj.setAttribute("type","text/javascript");this.scriptObj.setAttribute("charset","utf-8");this.scriptObj.setAttribute("src",this.fullUrl+this.noCacheIE);this.scriptObj.setAttribute("id",
this.scriptId)};a.prototype.removeScriptTag=function(){this.headLoc.removeChild(this.scriptObj)};a.prototype.addScriptTag=function(){this.headLoc.appendChild(this.scriptObj)};return{sendRequest:function(b){try{bObj=new a(b),bObj.buildScriptTag(),bObj.addScriptTag()}catch(c){}}}}();_neon.utils={getRandomString:function(a){return parseInt(1E8*(1+Math.random()),10).toString().substr(0,a)},isHidden:function(a){return null===a.offsetParent},beacon:function(){},isAnchor:function(a){return"A"===a.prop("tagName")},
sameSiteReferral:function(){var a=document.referrer;-1!==a.indexOf("http://")?a=a.substr(7):-1!==a.indexOf("https://")&&(a=a.substr(8));return a==window.location.hostname},getPageRequestUUID:function(){for(var a="",b=16;0<b;--b)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return a},isOnScreen:function(a){var a=b(a),g=b(window),c=a.offset();viewport={top:g.scrollTop(),left:g.scrollLeft()};viewport.right=viewport.left+g.width();viewport.bottom=viewport.top+
g.height();c.right=c.left+a.outerWidth();c.bottom=c.top+a.outerHeight();return!(viewport.right<c.left||viewport.left>c.right||viewport.bottom<c.top||viewport.top>c.bottom)},makeJQueryObject:function(a){return a instanceof IGN.jQuery?a:b(a)},getMysteryElementImageSource:function(a){a=_neon.utils.makeJQueryObject(a);return _neon.utils.getElementImageSource(a)||_neon.utils.getElementBackgroundImageSource(a)},getElementImageSource:function(a){a=_neon.utils.makeJQueryObject(a);return a.attr("data-original")||
a.attr("src")||""},getElementBackgroundImageSource:function(a){a=_neon.utils.makeJQueryObject(a);a=a.attr("data-background-image")||a.css("background-image")||"";"none"===a&&(a="");return a},getElementsUsingImageSourceSelector:function(a,b){var c=a?'$="'+a+'"':"",h=_neon.utils.makeJQueryObject(b),c=h.find("img[data-original"+c+"], img[src"+c+"]"),h=h.find("*").filter(function(){var b=_neon.utils.getElementBackgroundImageSource(this);return a?-1<b.indexOf(a):""!==b});return c.add(h)},getQueryValue:function(a,
b){for(var c=a&&a.substring(1).split("&"),h=0,l=c.length;h<l;h++){var e=c[h],d=e.indexOf("=");if((e&&e.substring(0,d))===b)return e.substring(d+1,e.length)}}};_neon.tracker=function(){function a(a){lastMouseClick=(new Date).getTime();var d=a.data.imgsrc,i=b(this).offset();wx=i.left-b(window).scrollLeft();wy=i.top-b(window).scrollTop();px=i.left;py=i.top;thumbData=m[d];"undefined"!==typeof thumbData?(_neon.utils.beacon("click hit",d),d=thumbData[0],i=thumbData[1],"undefined"===typeof s[i]&&(s[i]=lastMouseClick,
_neon.TrackerEvents.sendImageClickEvent(d,i,wx,wy,px,py,a.clientX,a.clientY))):_neon.utils.beacon("click miss",d)}function g(d){d=_neon.utils.getElementsUsingImageSourceSelector("",d);0<d.length&&d.each(function(){var d=_neon.utils.makeJQueryObject(this),f=_neon.utils.getMysteryElementImageSource(d);if("undefined"===typeof f?0:-1<f.indexOf("neontn")||-1<f.indexOf("neonvid")){f=-1<f.indexOf("neontn")?k(f)[0]:-1<f.indexOf("neonvid")?i(f):void 0;-1===b.inArray(f,videoIds)&&(videoIds.push(f),imgObjs.push(d));
$parent=d.parent();$gparent=$parent.parent();try{var o=_neon.utils.getMysteryElementImageSource(d);_neon.utils.beacon("_registerClickEvent",o);d.click({imgsrc:o},a);$parent.click({imgsrc:o},a);$parent=d.parent();var j=$parent.attr("href");if("undefined"!=typeof j&&""!=j){var c=$parent.parent().parent();if("listElmnt"==c.prop("class")){var m=b(c.children()[0]),n=m.find("a"),g=_neon.utils.getMysteryElementImageSource(d);n.click({imgsrc:g},a);for(var h=b(c.children()[1]),d=0;d<h.length;d++)if("listElmnt-blogItem"==
h.prop("class"))for(var e=h.children(),o=0;o<e.length;o++)for(var l=b(e[o]).find("a"),j=0;j<l.length;j++)b(l[j]).click({imgsrc:g},a)}else-1<c.prop("class").indexOf("grid")&&(m=b(c.children()[1]),n=m.find("a"),n.click({imgsrc:g},a))}}catch(q){}}})}function c(a){q&&g(a)}function h(){setInterval(function(){l()},2E3)}function l(){if(videoIds.length>n){var d=videoIds.slice(n,videoIds.length);if(1>d.length)startTrackingNeonISPImages(imgObjs,d,"");else{var i=_neon.tracker.getNeonPublisherId(),f="http://"+
apiBaseURL+"/v1/getthumbnailid/",f=f+(i+".html?params="+d.join()),d=document.createElement("iframe");b("body").append(d);d.style.display="none";d.id=i;d.src=f}i=document.getElementsByTagName("video");for(f=0;f<i.length;f++){for(var d=b(i[f]).siblings(),j,c,m=0;m<d.length;m++){var g=d[m];if("IMG"==g.tagName)c=g.src;"image"==g.type&&(j=g)}c&&j&&b(j).click({imgsrc:c},a)}}n=videoIds.length}function e(){g(document);q=!0;l()}function d(){b(window).bind("load",function(){e();b(document).bind("DOMNodeInserted",
function(a){c(a.target)});h()})}function f(a){b("img").appear();for(var d={},f={},i=[],j=a.length,c=0;c<j;c++){var g=a[c],n=_neon.utils.getElementsUsingImageSourceSelector(g,document);Array.prototype.push.apply(i,n);d[g]=0;f[g]=0}var k={};setInterval(function(){for(var a={},b=!1,j=0;j<i.length;j++){var c=_neon.utils.makeJQueryObject(i[j]);c.is(":appeared")&&(c=_neon.utils.getMysteryElementImageSource(c),m.hasOwnProperty(c)&&(vidId=m[c][0],thumbId=m[c][1],k.hasOwnProperty(c)||(d[c]=1,_neon.StorageModule.storeThumbnail(vidId,
thumbId)),a[c]=1,1!==k[c]&&(b=!0)))}if(b){k=a;var a=[],g;for(g in d)1===d[g]&&0===f[g]&&(f[g]=1,a.push(m[g]));0<a.length&&_neon.TrackerEvents.sendImagesVisibleEvent(a)}},1E3);b(window).bind("beforeunload",function(){_neon.StorageModule.getAllThumbnails("session")})}function k(a){if(a=/neontn[A-Z,a-z,0-9,-]*_[A-Z,a-z,0-9,-,.]*_[A-Z,a-z,0-9,-]*/.exec(a))return tid=a[0],[tid.split("_")[1],tid]}function i(a){return/neonvid_(?=.*.jpg|.png)([A-Z,a-z,0-9,_,-,.]*).(jpg|png)/.exec(a)[1]}var j,m,n=0,r=0,q=
!1,s={};window.startTrackingNeonISPImages=function(a){if(""!=a&&("string"===typeof a||a instanceof String)){for(var d=a.split(","),a={},b=r,c=0;b<videoIds.length;b++,c++)a[videoIds[b]]=d[c];m={};imgVisibleSizes={};imgURLs=[];for(b=r;b<imgObjs.length;b++)d=imgObjs[b],url=_neon.utils.getMysteryElementImageSource(d),("undefined"===typeof url?0:-1<url.indexOf("neonvid"))?(c=i(url),m[url]=[c,a[c]]):m[url]=k(url),imgURLs.push(url),imgVisibleSizes[url]=[d.width(),d.height()];_neon.TrackerEvents.sendImagesLoadedEvent(m,
imgVisibleSizes);r=imgObjs.length;f(imgURLs)}};return{init:function(){d();if("undefined"!==typeof neonPublisherId)j=neonPublisherId;else for(var a=document.getElementsByTagName("script"),b=0;b<a.length;b++){sTag=a[b];if(0<=sTag.src.search("neonbootloader")||0<=sTag.src.search("neonbctracker.js"))j=sTag.id;0<=sTag.src.search("neonoptimizer")&&(j=sTag.src.split("_")[1].split(".js")[0])}},getTrackerAccountId:function(){return j},getTrackerType:function(){return"undefined"!==typeof neonTrackerType?neonTrackerType:
"gen"},getLastClickNeonElementTS:function(){return lastMouseClick},getLastClickNeonElement:function(){return lastMouseClickElement},setLastClickNeonElement:function(a){lastMouseClick=(new Date).getTime();lastMouseClickElement=a},getNeonPublisherId:function(){return j},mapImagesToTids:e,getNewImages:c,startISPSubmitInterval:h}}();_neon.StorageModule=function(){function a(a){return a.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/)[2]}function b(a,f){"undefined"===typeof f&&(f=l);if("undefined"===typeof a){var c=
document.URL.split("?")[0];return f+e+c}return f+e+a}function c(a,c,k){var i=parseInt((new Date).getTime()/1E3,10);storageKey=a==localStorage?l:b();var j=JSON.parse(a.getItem(storageKey));j||(j={});j[c]={thumbId:k,ts:i};a.setItem(storageKey,JSON.stringify(j))}function h(a,b,c){return(a=JSON.parse(a.getItem(b)))?a[c]:!1}var l="neonThumbnails",e="+";return{getUid:function(){var a=localStorage.getItem("uid");a||(a=(new Date).getTime(),a=_neon.utils.getRandomString(4)+_neon.utils.getRandomString(4)+a.toString().substring(11,
13),localStorage.setItem("uid",a));return a},storeThumbnail:function(a,b){c(sessionStorage,a,b);c(localStorage,a,b)},getThumbnail:function(d,c){var k="session",i=b(c);if(i=h(sessionStorage,i,d))return[i,k];return c&&a(document.URL)!=a(c)?null:(i=h(localStorage,l,d))?[i,"local"]:null},getThumbnailSessionStorage:function(a,c){var k=b(c);return h(sessionStorage,k,a)},getThumbnailLocalStorage:function(a){return h(localStorage,l,a)},getAllThumbnails:function(a){if("session"==a){for(var a=RegExp(l),b=0;b<
sessionStorage.length;b++){var c=sessionStorage.key(b);if(a.test(c))return sessionStorage.getItem(c)}return null}return JSON.parse(localStorage.getItem(l))},clearPageSessionData:function(a){if("undefined"===typeof a)for(var a=document.URL.split("?")[0],a=b(a),c=0;c<sessionStorage.length;c++){var h=sessionStorage.key(c);h==a&&sessionStorage.removeItem(h)}}}}();_neon.TrackerEvents=function(){function a(a){h=_neon.tracker.getTrackerAccountId();l=_neon.tracker.getTrackerType();e=document.URL.split("?")[0];
d=document.referrer.split("?")[0];var b=(new Date).getTime();"undefined"!==typeof a&&(b=a);return k+"/v2/track?a="+f+"&page="+encodeURIComponent(e)+"&pageid="+c+"&ttype="+l+"&ref="+encodeURIComponent(d)+"&tai="+h+"&cts="+b}function b(a,c){var d=[],f;for(f in a)a[f]&&(tid=a[f][1],"undefined"!==typeof c&&(tid+="+"+c[f][0]+"+"+c[f][1]),d.push(tid));return d}var c=_neon.utils.getPageRequestUUID(),h,l,e,d,f,k="http://tracker.neon-images.com";return{sendImageClickEvent:function(b,c,d,g,h,k,e,l){f="ic";
var p=a(),p=p+("&vid="+b+"&tid="+c);"undefined"!==typeof d&&"undefined"!==typeof g&&"undefined"!==typeof h&&"undefined"!==typeof k&&"undefined"!==typeof e&&(p+="&wx="+d+"&wy="+g+"&x="+h+"&y="+k+"&cx="+e+"&cy="+l);_neon.utils.beacon(f,p);_neon.JsonRequester.sendRequest(p)},sendVideoPlayEvent:function(b,c,d,g,h,k){f="vp";var e=a(),e=e+("&vid="+b+"&tid="+c+"&adPlay="+g+"&adelta="+h+"&pcount="+k);"undefined"!==typeof d&&(e+="&playerid="+d);_neon.utils.beacon(f,e);_neon.JsonRequester.sendRequest(e)},sendAdPlayEvent:function(b,
c,d,g,h,e){f="ap";e=a(e);e+="&vid="+b+"&tid="+c+"&adelta="+g+"&pcount="+h;"undefined"!==typeof d&&(e+="&playerid="+d);_neon.utils.beacon(f,e);_neon.JsonRequester.sendRequest(e)},sendImagesVisibleEvent:function(c){f="iv";var c=b(c),d=a();0<c.length&&(d+="&tids="+c,_neon.utils.beacon(f,c.length,d),_neon.JsonRequester.sendRequest(d))},sendImagesLoadedEvent:function(c,d){f="il";var e=b(c,d),h=a();0<e.length&&(h+="&tids="+e,_neon.utils.beacon(f,e.length,h),_neon.JsonRequester.sendRequest(h))},sendVideoClickEvent:function(b,
c,d){f="vc";var e=a(),e=e+("&vid="+b+"&tid="+c+"&playerid="+d);_neon.utils.beacon(f,e);_neon.JsonRequester.sendRequest(e)},setPageLoadId:function(a){c=a},getPageLoadId:function(){return c}}}();(function(){if(!_neon.UNITTEST){var a=setInterval(function(){if("complete"===document.readyState||"interactive"===document.readyState)_neon.StorageModule.clearPageSessionData(),clearInterval(a),b(document).bind("touchstart",function(){lastMouseClick=(new Date).getTime()})},100);sessionStorage&&localStorage&&
JSON&&_neon.tracker.init()}})()})(IGN.jQuery);
