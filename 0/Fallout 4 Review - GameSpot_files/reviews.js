$(document).ready(function(){"use strict";var t=false;$(".js-add-to-user-list").click(function(i){$("#modal_add_to_list").modal("show");if(!t){AjaxApiRequest.makeGetApiRequest("/api/list/paginated-lists/",function(t){if(t.success){$("#modal_add_to_list .loading").remove();$("#modal_add_to_list .js-simple-paginator-container").html(t.html)}else{Phoenix.Ui.showErrorMessage("Could not load lists");$("#modal_add_to_list").modal("hide")}},function(){Phoenix.Ui.showErrorMessage("Could not load lists");$("#modal_add_to_list").modal("hide")});t=true}i.preventDefault()});$("#modal_add_to_list").on("click","tr.js-add-list",function(t){var i=$("#modal_add_to_list table").data("object-guid");var o=$(t.target);if(!o.is("tr")){o=o.parents("tr")}var a=o.attr("data-ref-id");AjaxApiRequest.makeGetApiRequest("/api/list/"+a+"/add-item/"+i+"/",function(t){if(t.success){Phoenix.Ui.showSuccessMessage("Successfully added item to list.");$("#modal_add_to_list").modal("hide")}else{Phoenix.Ui.showErrorMessage("Error while adding object to list.");$("#modal_add_to_list").modal("hide")}},function(){Phoenix.Ui.showErrorMessage("Error while adding object to list.");$("#modal_add_to_list").modal("hide")})})});
$(function(){"use strict";var t;var e="js-upvote-btn";var r="js-post-render-upvote";var n="upvote-in-progress";var a="disabled";var i="upvoted";var s="."+e;var o=".js-event-tracking";var u=".js-upvote-btn__text";var f=".js-upvote-status";var v;var d={};var c=function(e){return t.filter('[data-guid="'+e+'"]')};var l=function(){var t=$("<span/>");var r=[e,n,"js-event-tracking"].join(" ");return function(e){var n,o,f;if(!e||e.length<1){return}var v=!e.data("userVoted");e.data("userVoted",v);n=e.find(s);if(v){n.addClass(i);e.attr("action","/vote/?unvote=1")}else{n.removeClass(i);e.attr("action","/vote/")}f=n.find(u);var d=f.text();f.text(f.data("successMsg"));f.data("successMsg",d);if(e.data("allowUnvote")){return}o=t.clone();o.addClass(n.attr("class")).removeClass(r).append(n.contents());e.replaceWith(o);o.addClass(a);e.off(".upvote")}}();var g=function(t){t.each(function(){l($(this))})};var h=function(t){var e=t.find(s);t.addClass(n);e.each(function(){var t=$(this),e=t.find(u),r=e.data("progressMsg");if(r){if(!e.data("originalMsg")){e.data("originalMsg",e.text())}e.text(r)}})};var p=function(t){var e=t.find(s);t.removeClass(n);e.each(function(){var t=$(this),e=t.find(u),r=e.data("originalMsg");if(r){e.text(r)}})};var m=function(t,e){var r;if(!t||t.length<1){return}r=t.next(f);if(!r||r.length<1){return}r.html(e.buttonCount)};var b=function(t,e){var r="Upvoting isn't working right now, please try again later.";if(e&&e.errorMsg){r=e.errorMsg}if(Phoenix&&Phoenix.Ui&&Phoenix.Ui.showErrorMessage){Phoenix.Ui.showErrorMessage(r,{hideDelay:3e3})}p(t)};var x=function(){var t;return function(e,r){if(!t){t={}}var a=t[e],i,u,f;if(!!a){return}i=r.find(s);u=r.find(o);u.trigger("customEventTracking");f=c(e);a=$.ajax({url:r.attr("action"),type:"POST",data:r.serializeArray(),error:function(){b(f)},success:function(t){if(!!t.voteFailed){b(f,t);return}if(!!t.buttonCount){m(f,t)}g(f);if(t.csrfToken){var e=r.find("input[data-bb]").val(t.csrfToken).removeAttr("data-decrypted");if(t.csrfTokenId){r.find("input[name*='_token_id']").val(t.csrfTokenId);var n=e.attr("data-token-id");e.attr("data-token-id",n.substring(0,n.length-t.csrfTokenId.length)+t.csrfTokenId)}}},complete:function(){f.removeClass(n);delete d[e];delete t[e]}});t[e]=a}}();var j=function(t){t.preventDefault();var e=$(this),r,n=e.data("guid"),a=!!d[n];if(a){return}d[n]=e;r=c(n);h(r);if(v){return}x(n,e)};var k=function(){var e=function(t,e){var r=t.next(f).find(".js-upvote-status-msg"),n=e.statusMsg;if(n){r.replaceWith(n)}if(e.hasVoted){return}};var n=function(t,r){var n=c(t),a;if(!n||n.length<1){return}n.each(function(){e($(this),r)});a=d[t];if(r.hasVoted){g(n)}else if(a&&a.length>0){delete d[t];a.trigger("submit")}};return function(){PostRender.getPostRenderData("UserBundle",function(e,a){v=false;t.removeClass(r);if($.isEmptyObject(a)){return}var i=a.upvote;if($.isEmptyObject(i)){return}$.each(i,n)})}}();var C=function(){t=$(".js-upvote-form");if(!t||t.length<1){return}v=t.hasClass(r);t.filter(function(){return!$(this).data("submit.upvote.bound")}).on("submit.upvote",j).data("submit.upvote.bound",true)};C();if(true===v){k()}$(document).ajaxSuccess(C)});