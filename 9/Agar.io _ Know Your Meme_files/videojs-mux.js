/**
 * videojs-mux
 * @version 1.0.3
 * @copyright 2016 Matthew McClure
 * @license MIT
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.videojsMux=e()}}(function(){var e;return function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!u&&l)return l(a,!0);if(o)return o(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e,t){return"function"==typeof e[t]?e[t].call(e):""}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return a["default"].defaultView&&a["default"].defaultView.getComputedStyle?a["default"].defaultView.getComputedStyle(e,null).getPropertyValue(t):void 0}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var o=e("global/document"),a=r(o)},{"global/document":5}],3:[function(e,t,n){"use strict";function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],4:[function(e,t,n){},{}],5:[function(e,t,n){(function(n){var r="undefined"!=typeof n?n:"undefined"!=typeof window?window:{},i=e("min-document");if("undefined"!=typeof document)t.exports=document;else{var o=r["__GLOBAL_DOCUMENT_CACHE@4"];o||(o=r["__GLOBAL_DOCUMENT_CACHE@4"]=i),t.exports=o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"min-document":4}],6:[function(e,t,n){(function(e){"undefined"!=typeof window?t.exports=window:"undefined"!=typeof e?t.exports=e:"undefined"!=typeof self?t.exports=self:t.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,t,n){function r(e,t){return e="number"==typeof e||b.test(e)?+e:-1,t=null==t?_:t,e>-1&&e%1==0&&t>e}function i(e,t,n){var r=e[t];x.call(e,t)&&c(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function o(e){return function(t){return null==t?void 0:t[e]}}function a(e,t,n){return u(e,t,n)}function u(e,t,n,r){n||(n={});for(var o=-1,a=t.length;++o<a;){var u=t[o],l=r?r(n[u],e[u],u,n,e):e[u];i(n,u,l)}return n}function l(e){return y(function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o="function"==typeof o?(i--,o):void 0,a&&f(n[0],n[1],a)&&(o=3>i?void 0:o,i=1),t=Object(t);++r<i;){var u=n[r];u&&e(t,u,r,o)}return t})}function f(e,t,n){if(!v(n))return!1;var i=typeof t;return("number"==i?s(n)&&r(t,n.length):"string"==i&&t in n)?c(n[t],e):!1}function c(e,t){return e===t||e!==e&&t!==t}function s(e){return null!=e&&!("function"==typeof e&&d(e))&&p(j(e))}function d(e){var t=v(e)?k.call(e):"";return t==g||t==w}function p(e){return"number"==typeof e&&e>-1&&e%1==0&&_>=e}function v(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var h=e("lodash.keys"),y=e("lodash.rest"),_=9007199254740991,g="[object Function]",w="[object GeneratorFunction]",b=/^(?:0|[1-9]\d*)$/,m=Object.prototype,x=m.hasOwnProperty,k=m.toString,j=o("length"),C=l(function(e,t){a(t,h(t),e)});t.exports=C},{"lodash.keys":8,"lodash.rest":9}],8:[function(e,t,n){function r(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function i(e,t){return e="number"==typeof e||j.test(e)?+e:-1,t=null==t?w:t,e>-1&&e%1==0&&t>e}function o(e,t){return E.call(e,t)||"object"==typeof e&&t in e&&null===I(e)}function a(e){return T(Object(e))}function u(e){return function(t){return null==t?void 0:t[e]}}function l(e){var t=e?e.length:void 0;return v(t)&&(F(e)||_(e)||c(e))?r(t,String):null}function f(e){var t=e&&e.constructor,n=p(t)&&t.prototype||C;return e===n}function c(e){return d(e)&&E.call(e,"callee")&&(!S.call(e,"callee")||O.call(e)==b)}function s(e){return null!=e&&!("function"==typeof e&&p(e))&&v(L(e))}function d(e){return y(e)&&s(e)}function p(e){var t=h(e)?O.call(e):"";return t==m||t==x}function v(e){return"number"==typeof e&&e>-1&&e%1==0&&w>=e}function h(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){return!!e&&"object"==typeof e}function _(e){return"string"==typeof e||!F(e)&&y(e)&&O.call(e)==k}function g(e){var t=f(e);if(!t&&!s(e))return a(e);var n=l(e),r=!!n,u=n||[],c=u.length;for(var d in e)!o(e,d)||r&&("length"==d||i(d,c))||t&&"constructor"==d||u.push(d);return u}var w=9007199254740991,b="[object Arguments]",m="[object Function]",x="[object GeneratorFunction]",k="[object String]",j=/^(?:0|[1-9]\d*)$/,C=Object.prototype,E=C.hasOwnProperty,O=C.toString,I=Object.getPrototypeOf,S=C.propertyIsEnumerable,T=Object.keys,L=u("length"),F=Array.isArray;t.exports=g},{}],9:[function(e,t,n){function r(e,t,n){var r=n.length;switch(r){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function i(e,t){if("function"!=typeof e)throw new TypeError(f);return t=x(void 0===t?e.length-1:u(t),0),function(){for(var n=arguments,i=-1,o=x(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];switch(t){case 0:return e.call(this,a);case 1:return e.call(this,n[0],a);case 2:return e.call(this,n[0],n[1],a)}var u=Array(t+1);for(i=-1;++i<t;)u[i]=n[i];return u[t]=a,r(e,this,u)}}function o(e){var t=a(e)?m.call(e):"";return t==p||t==v}function a(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function u(e){if(!e)return 0===e?e:0;if(e=l(e),e===c||e===-c){var t=0>e?-1:1;return t*s}var n=e%1;return e===e?n?e-n:e:0}function l(e){if(a(e)){var t=o(e.valueOf)?e.valueOf():e;e=a(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(h,"");var n=_.test(e);return n||g.test(e)?w(e.slice(2),n?2:8):y.test(e)?d:+e}var f="Expected a function",c=1/0,s=1.7976931348623157e308,d=NaN,p="[object Function]",v="[object GeneratorFunction]",h=/^\s+|\s+$/g,y=/^[-+]0x[0-9a-f]+$/i,_=/^0b[01]+$/i,g=/^0o[0-7]+$/i,w=parseInt,b=Object.prototype,m=b.toString,x=Math.max;t.exports=i},{}],10:[function(t,n,r){!function(r,i){"use strict";"object"==typeof n&&n.exports&&"function"==typeof t?n.exports=i():"function"==typeof e&&"object"==typeof e.amd?e(i):r.log=i()}(this,function(){"use strict";function e(e){return typeof console===u?!1:void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):a}function t(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function n(e,t,n){return function(){typeof console!==u&&(r.call(this,t,n),this[e].apply(this,arguments))}}function r(e,t){for(var n=0;n<l.length;n++){var r=l[n];this[r]=e>n?a:this.methodFactory(r,e,t)}}function i(t,r,i){return e(t)||n.apply(this,arguments)}function o(e,t,n){function o(e){var t=(l[e]||"silent").toUpperCase();try{return void(window.localStorage[s]=t)}catch(n){}try{window.document.cookie=encodeURIComponent(s)+"="+t+";"}catch(n){}}function a(){var e;try{e=window.localStorage[s]}catch(t){}if(typeof e===u)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(s)+"=");r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(t){}return void 0===c.levels[e]&&(e=void 0),e}var f,c=this,s="loglevel";e&&(s+=":"+e),c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=n||i,c.getLevel=function(){return f},c.setLevel=function(t,n){if("string"==typeof t&&void 0!==c.levels[t.toUpperCase()]&&(t=c.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;return f=t,n!==!1&&o(t),r.call(c,t,e),typeof console===u&&t<c.levels.SILENT?"No console available for logging":void 0},c.setDefaultLevel=function(e){a()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var d=a();null==d&&(d=null==t?"WARN":t),c.setLevel(d,!1)}var a=function(){},u="undefined",l=["trace","debug","info","warn","error"],f=new o,c={};f.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=c[e];return t||(t=c[e]=new o(e,f.getLevel(),f.methodFactory)),t};var s=typeof window!==u?window.log:void 0;return f.noConflict=function(){return typeof window!==u&&window.log===f&&(window.log=s),f},f})},{}],11:[function(e,t,n){(function(t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a="undefined"!=typeof window?window.videojs:"undefined"!=typeof t?t.videojs:null,u=r(a),l=e("loglevel"),f=r(l),c=e("global/window"),s=r(c),d=e("global/document"),p=r(d),v=e("lodash.assign"),h=r(v),y=e("./lib/get-computed-style.js"),_=r(y),g=e("./lib/call-if-exists.js"),w=r(g),b=e("./lib/uuid.js"),m=r(b),x=["ended","loadstart","pause","play","playing","ratechange","stalled","waiting"];s["default"][s["default"].MUX_VAR_NAME||"mux"]||f["default"].error("[videojs-mux] No core mux function found! Did you forget to install it?");var k=function(){function e(t,n){var r=this;i(this,e);var o={heart_beat_interval:1e4,check_buffering_interval:100,debug:!1};this.player=t,this.options=(0,h["default"])({},o,n),f["default"].setLevel(this.options.debug?"debug":"warn"),(n.userId||n.user_id)&&this.queue("set","viewer_user_id",n.userId||n.user_id),this.player_data=(0,h["default"])({player_instance_id:this._uniqueShortCode(),player_load_start:Date.now(),player_software:"Video.js",player_software_version:u["default"].VERSION||"< 4.11",player_mux_plugin_version:"1.0.3",player_view_count:1},this.options.player_data),this._resetViewData(),this.setVideo(this.options.video_data),this.track("playerloadstart"),this.player.mux=function(){f["default"].error("[videojs-mux] The plugin was initialized more than once.")},this.player.mux.setVideo=this.setVideo.bind(this),t.muxChangeVideo=this.setVideo.bind(this),t.ready(function(){r.track("playerready"),t.addClass("vjs-mux"),r._initEventListeners()})}return o(e,[{key:"queue",value:function(){var e=s["default"].MUX_VAR_NAME||"mux",t=s["default"][e]||function(){};t.apply(null,arguments)}},{key:"track",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this._clearNextHeartbeat();var n=(0,h["default"])(this._baseEventData(),t);f["default"].info(e,n),this.queue("send",e,n),this.player.paused()||this._createPendingHeartbeat()}},{key:"setVideo",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this.video_data,n={};!function(){var t={id:"video_id",title:"video_title",series:"video_series",variantId:"video_variant_id",variant:"video_variant_name"};for(var n in t)e[n]&&(e[t[n]]=e[n],delete e[n])}(),(0,h["default"])(n,e),n.video_id||(n.video_id=this._videoIdFromSrc(this.player.currentSrc())),this.video_data=n,f["default"].debug("[mux] Changing Video (old, new): ",t&&t.video_id,n.video_id),t&&(this._resetViewData(),this.player_data.player_view_count+=1)}},{key:"_resetViewData",value:function(){this._watchedRanges=[],this._currentWatchRange=null,this.view_data={view_id:(0,m["default"])(),view_buffering_count:0,view_buffering_duration:0,view_watch_time:0}}},{key:"_initEventListeners",value:function(){var e=this;this._initTimeToFirstFrameCheck(),this._initSeekListener(),this._initBufferingCheck(),this._trackWatchTime(),this.player.on("error",function(){var t=e.player.error()||{};e.track("error",{player_error_code:t.code,player_error_message:t.message})}),x.forEach(function(t){e.player.on(t,function(){e.track(t)})})}},{key:"_initTimeToFirstFrameCheck",value:function(){var e=this;this.player.one("play",function(){e.view_data.view_start=Date.now(),e.player.one("playing",function(){var t=Date.now()-e.view_data.view_start;e.view_data.view_time_to_first_frame=t})})}},{key:"_initSeekListener",value:function(){var e=!1;this.player.on("seeking",function(){e===!1&&(e=!0,this.track("seeking"))}.bind(this)),this.player.on("playing",function(){e=!1})}},{key:"_initBufferingCheck",value:function(){this._bufferingCheck(this.player.currentTime())}},{key:"_bufferingCheck",value:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],i=this.player.currentTime(),o=1/this.options.check_buffering_interval;if(!t&&!r&&e+o>i&&i!==e&&!this.player.paused())this.track("bufferingstart"),t=Date.now(),r=!0;else if(t&&r&&i>e+o&&!this.player.paused()){var a=Date.now()-t;a>30&&(this.view_data.view_buffering_count+=1,this.view_data.view_buffering_duration+=a,this.track("bufferingend")),t=null,r=!1}this.player.setTimeout(function(){n._bufferingCheck(i,t,r)},this.options.check_buffering_interval)}},{key:"_createPendingHeartbeat",value:function(){var e=this;return this._nextHeartbeatId=this.player.setTimeout(function(){e.track("hb")},this.options.heart_beat_interval),this._nextHeartbeatId}},{key:"_clearNextHeartbeat",value:function(){this._nextHeartbeatId&&this.player.clearTimeout(this._nextHeartbeatId)}},{key:"_trackWatchTime",value:function(){var e=this.player,t=function(){if(!e.paused()){if(e.seeking())return void(this._currentWatchRange=null);var t=e.currentTime(),n=this._currentWatchRange;if(!n||t<n[1]||t>n[1]+1)this._currentWatchRange=[t,t],this._watchedRanges.push(this._currentWatchRange);else{var r=t-n[1];this._currentWatchRange[1]=t,this.view_data.view_watch_time+=r}}}.bind(this);this.player.on("playing",t),this.player.on("timeupdate",t),this.player.on("end",t),this.player.on("seeking",function(){this._currentWatchRange=null}.bind(this))}},{key:"_uniqueShortCode",value:function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)}},{key:"_currentVideoId",value:function(e){if("undefined"==typeof e&&null===this._currentVideoInfo.id){var t=this._currentVideoInfo.id=this._videoIdFromSrc(e);return t}return"undefined"==typeof e?this._currentVideoInfo.id:this._videoIdFromSrc(e)}},{key:"_videoIdFromSrc",value:function(e){var t=p["default"].createElement("a");t.href=e;var n=t.pathname.replace(/\.[^\/.]+$/,"");return s["default"].btoa(t.host+n).split("=")[0]}},{key:"_baseEventData",value:function(){var e=this.player,t={};return(0,h["default"])(t,this.player_data),(0,h["default"])(t,this.video_data),(0,h["default"])(t,this.view_data),(0,h["default"])(t,{player_paused:e.paused(),player_time:e.currentTime(),player_language:(0,w["default"])(e,"language"),player_is_fullscreen:e.isFullscreen(),player_source_url:e.currentSrc(),player_source_type:(0,w["default"])(e,"currentType"),player_source_duration:e.duration(),player_source_height:(0,w["default"])(e,"videoHeight"),player_source_width:(0,w["default"])(e,"videoWidth"),player_autoplay:e.autoplay(),player_preload:e.preload(),player_poster_url:e.poster(),player_width:(0,_["default"])(e.el(),"width"),player_height:(0,_["default"])(e.el(),"height")}),e.duration()===1/0?t.player_source_stream_type="live":e.duration()>0&&(t.player_source_stream_type="on-demand"),e.error()&&1!==e.error().code&&(t.player_error_code=e.error().code,t.player_error_message=e.error().message),t}}]),e}();u["default"].plugin("mux",function(e){return u["default"].IS_IE8?!1:new k(this,e)}),n["default"]=k}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/call-if-exists.js":1,"./lib/get-computed-style.js":2,"./lib/uuid.js":3,"global/document":5,"global/window":6,"lodash.assign":7,loglevel:10}]},{},[11])(11)});