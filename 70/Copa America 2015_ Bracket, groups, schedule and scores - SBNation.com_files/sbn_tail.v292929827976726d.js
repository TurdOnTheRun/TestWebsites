!function(e){function t(e,t,n){var o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},i=o[Chorus.Modernizr.prefixed("transition")];e.each(function(e,t){function o(e){t.removeEventListener(i,o),n(t)}t.addEventListener(i,o)})}e.fn.addClassWithAnimationCallback=function(e,n){return"undefined"!=typeof Modernizr&&Chorus.Modernizr.csstransitions?(t(this,e,n),this.addClass(e),this):(this.addClass(e),this.each(function(e,t){n(t)}),this)},e.fn.removeClassWithAnimationCallback=function(e,n){return"undefined"!=typeof Modernizr&&Chorus.Modernizr.csstransitions?(t(this,e,n),this.removeClass(e),this):(this.removeClass(e),this.each(function(e,t){n(t)}),this)}}(jQuery),/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.8.0.sbn
 * - Hacked so that it lazy loads non-IMG tags
 * - Hacked so that the scroll event that ends up firing lazyload:appear is debounced
 * - Hacked so resize event is debounced
 * - Hacked so data attributes are not cached via jQuery (neccesary for optimization)
 *
 */
function(e,t){var n=e(t);e.fn.lazyload=function(o){function i(e,t){return"undefined"!=typeof _?_.debounce(e,t):e}function r(){var t=0;s.each(function(){var n=e(this);if(!l.skip_invisible||n.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else n.trigger("lazyload:appear")})}var a,s=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,scrollInterval:200,resizeInterval:250};if(o&&(void 0!==o.failurelimit&&(o.failure_limit=o.failurelimit,delete o.failurelimit),void 0!==o.effectspeed&&(o.effect_speed=o.effectspeed,delete o.effectspeed),e.extend(l,o)),a=void 0===l.container||l.container===t?n:e(l.container),0===l.event.indexOf("scroll")){var c=function(e){return r()};a.bind(l.event,i(c,l.scrollInterval))}this.each(function(){var n=this,o=e(n);n.loaded=!1,n.error_event_set=!1;var r=4e3,a=4,c=0,u=function(){if(!this.loaded){if(l.appear){var i=s.length;l.appear.call(n,i,l)}if("IMG"===this.tagName)e("<img />").bind("load",function(){o.hide().attr("src",o.attr("data-"+l.data_attribute))[l.effect](l.effect_speed),n.loaded=!0;var t=e.grep(s,function(e){return!e.loaded});if(s=e(t),l.load){var i=s.length;l.load.call(n,i,l)}}).bind("error",function(){n.error_event_set||t.setTimeout(e.proxy(d,this),r),n.error_event_set=!0}).attr("src",o.attr("data-"+l.data_attribute));else{o.css("background-image","url('"+o.attr("data-"+l.data_attribute)+"')")[l.effect](l.effect_speed),n.loaded=!0;var a=e.grep(s,function(e){return!e.loaded});if(s=e(a),l.load){var i=s.length;l.load.call(n,i,l)}}}},d=function(){if(c+=1,a>=c){e(this).bind("error",function(){t.setTimeout(e.proxy(d,this),r)});var n=this.src.split("?")[0];this.src=n+"?"+(new Date).getTime()}};if(o.one("lazyload:appear",u),0!==l.event.indexOf("scroll")){var h=function(e){n.loaded||o.trigger("lazyload:appear")};o.bind(l.event,i(h,l.scrollInterval))}});var u=function(e){r()};return n.bind("resize",i(u,l.resizeInterval)),r(),this},e.belowthefold=function(o,i){var r;return r=void 0===i.container||i.container===t?n.height()+n.scrollTop():e(i.container).offset().top+e(i.container).height(),r<=e(o).offset().top-i.threshold},e.rightoffold=function(o,i){var r;return r=void 0===i.container||i.container===t?n.width()+n.scrollLeft():e(i.container).offset().left+e(i.container).width(),r<=e(o).offset().left-i.threshold},e.abovethetop=function(o,i){var r;return r=void 0===i.container||i.container===t?n.scrollTop():e(i.container).offset().top,r>=e(o).offset().top+i.threshold+e(o).height()},e.leftofbegin=function(o,i){var r;return r=void 0===i.container||i.container===t?n.scrollLeft():e(i.container).offset().left,r>=e(o).offset().left+i.threshold+e(o).width()},e.inviewport=function(t,n){return!(e.rightofscreen(t,n)||e.leftofscreen(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return!e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(e){function t(t,n){var s={failure_limit:20,load:function(){var t=e(this),n=t.parent(".image-window");if(t.is("img")&&(n.length>0?(t.css({position:"absolute",top:Math.round((n.outerHeight()-t.outerHeight())/2),left:Math.round((n.outerWidth()-t.outerWidth())/2)}),"undefined"==typeof t.attr("height")&&t.css("height","auto")):"undefined"==typeof t.attr("height")&&t.css("height","auto")),t.addClass(r),t.removeClass(a),t.removeClass("m-chorus-asset__in-entry-body"),e.fn.playGIF){var o=Chorus.Context.gif_opts||{},i={on:"touchstart",off:"touchstart"};if(Chorus.Context&&Chorus.Context.main_link_color&&(o.circleBackgroundColor=Chorus.Context.main_link_color,o.circleTextColor="FFFFFF"),"undefined"==typeof PLAYGIF_DISABLE_FLAG){var s=e('.m-entry__body img[src*=".gif"], .m-entry__body img[data-original*=".gif"], .m-block__fanshot-media img[src*=".gif"]'),l=e('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');s.length+l.length===1?PLAYGIF_DISABLE_FLAG=!0:s&&s.length>0&&(PLAYGIF_DISABLE_FLAG=!1,Modernizr.touch?s.playGIF(i):s.playGIF(o))}Modernizr.touch?t.playGIF(i):t.playGIF(o)}},threshold:800};n&&e.extend(s,n),t=e("undefined"!=typeof t&&null!==t?t:"body");var l=t.find(i+":visible").not("."+a+", ."+r),c=[],u=[];l.each(function(){var t,n,i,r,l,d=e(this),h=d.attr("data-imgkey"),m=d.data("chorus-asset-id");if("undefined"!=typeof h){if(s.parentDimensionSlc){var f=d.closest(s.parentDimensionSlc);t=f.outerWidth(),n=f.outerHeight()}t||(t=d.outerWidth()),n||(n=d.outerHeight()),0==n&&(i=d.data("ratio"),n="undefined"!=typeof i&&i>0?Math.ceil(t/i):t),d.is("img")&&(i=d.data("ratio"),r=d.parent(".image-window"),"undefined"!=typeof i&&i>0&&(n=Math.ceil(t/i)),r.length>0&&(t=Math.ceil(r.outerWidth()),n=Math.ceil(r.outerHeight())),n>0&&d.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),Chorus.Context&&"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n)),/\.(png|jpg|jpeg)$/i.test(d.attr("data-original"))&&o.webp&&!Chorus.Modernizr.touch&&(l="webp");var p=h+":"+t+"x"+n+(l?":"+l:"");c.push(p),d.attr("data-dim",t+"x"+n),d.addClass(a)}else if("undefined"!=typeof m){t=d.outerWidth(),n=d.outerHeight(),d.is("img")&&(i=d.data("ratio"),r=d.parent(".image-window"),"undefined"!=typeof i&&i>0&&(n=Math.ceil(t/i)),r.length>0&&(t=Math.ceil(r.outerWidth()),n=Math.ceil(r.outerHeight())),n>0&&d.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n));var g=m+":"+t+":"+n;u.push(g),d.data("asset-key",g),d.addClass(a)}else d.lazyload(s)}),(0!==c.length||0!==u.length)&&(e.each([u,c],function(e,t){t.sort(function(e,t){return+e.split(":")[0]-+t.split(":")[0]})}),e.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",timeout:1e4,data:{imgkeys:c.join(","),asset_keys:u.join(",")},success:function(t){var n=t.urls,o={};_.forEach(n,function(e,t){var n=t.replace(/\:webp|\:jp2/,"");o[n]=e}),n=o,l.each(function(){var t,o=e(this);t=o.attr("data-imgkey")?o.attr("data-imgkey")+":"+o.attr("data-dim"):o.data("asset-key");var i=n[t];"undefined"!=typeof i&&(o.attr("data-original",i),o.lazyload(s))})}}))}e(document).ready(function(){Chorus.DynamicSizedImages.init(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("dynamic-images-available",{},!0)});var n={},o={webp:!1,jp2:!1},i=".vox-lazy-load",r="lazy-loaded",a="lazy-loading";return n.init=function(){function e(){if(Chorus.Modernizr.localstorage&&window.localStorage.getItem("supportsWebp"))o.webp="true"===window.localStorage.getItem("supportsWebp")?!0:!1,i();else{var e=new Image;e.onload=function(){o.webp=!!(e.height>0&&e.width>0),Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",o.webp),i()},e.onerror=function(){o.webp=!1,Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",o.webp),i()},e.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4IBoAAAAwAQCdASoBAAEAAIAOJaQAA3AA/v89WAAAAA=="}}function i(){Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading?Chorus.Context.defer_image_loading=!1:n.initUI(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(e){t(e.modules)})}e()},n.initUI=function(e,n){t(e,n)},n.applyTo=function(e,n){t(e,n)},n}(jQuery),/*
* touchSwipe - jQuery Plugin
* https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
* http://labs.skinkers.com/touchSwipe/
* http://plugins.jquery.com/project/touchSwipe
*
* Copyright (c) 2010 Matt Bryson (www.skinkers.com)
* Dual licensed under the MIT or GPL Version 2 licenses.
*
* $version: 1.3.3
*/
function(e){function t(t){return!t||void 0!==t.allowPageScroll||void 0===t.swipe&&void 0===t.swipeStatus||(t.allowPageScroll=s),t||(t={}),t=e.extend({},e.fn.swipe.defaults,t),this.each(function(){var o=e(this),i=o.data(v);i||(i=new n(this,t),o.data(v,i))})}function n(t,n){function b(e){var t,e=e.originalEvent,o=g?e.touches[0]:e;return O=h,g?R=e.touches.length:e.preventDefault(),U=0,M=null,$=0,g&&R!==n.fingers&&n.fingers!==d?y(e):(B=T=o.pageX,j=E=o.pageY,z=(new Date).getTime(),n.swipeStatus&&(t=w(e,O))),!1===t?(O=p,w(e,O),t):(L.bind(F,C),void L.bind(D,_))}function C(e){if(e=e.originalEvent,O!==f&&O!==p){var t,h=g?e.touches[0]:e;T=h.pageX,E=h.pageY,Q=(new Date).getTime(),M=x(),g&&(R=e.touches.length),O=m;var h=e,v=M;if(n.allowPageScroll===s)h.preventDefault();else{var b=n.allowPageScroll===l;switch(v){case o:(n.swipeLeft&&b||!b&&n.allowPageScroll!=c)&&h.preventDefault();break;case i:(n.swipeRight&&b||!b&&n.allowPageScroll!=c)&&h.preventDefault();break;case r:(n.swipeUp&&b||!b&&n.allowPageScroll!=u)&&h.preventDefault();break;case a:(n.swipeDown&&b||!b&&n.allowPageScroll!=u)&&h.preventDefault()}}R!==n.fingers&&n.fingers!==d&&g?(O=p,w(e,O)):(U=S(),$=Q-z,n.swipeStatus&&(t=w(e,O,M,U,$)),n.triggerOnTouchEnd||(h=!(n.maxTimeThreshold?!($>=n.maxTimeThreshold):1),!0===k()?(O=f,t=w(e,O)):h&&(O=p,w(e,O)))),!1===t&&(O=p,w(e,O))}}function _(e){if(e=e.originalEvent,e.preventDefault(),Q=(new Date).getTime(),U=S(),M=x(),$=Q-z,n.triggerOnTouchEnd||!1===n.triggerOnTouchEnd&&O===m)if(O=f,R!==n.fingers&&n.fingers!==d&&g||0===T)O=p,w(e,O);else{var t=!(n.maxTimeThreshold?!($>=n.maxTimeThreshold):1);!0!==k()&&null!==k()||t?(t||!1===k())&&(O=p,w(e,O)):w(e,O)}else O===m&&(O=p,w(e,O));L.unbind(F,C,!1),L.unbind(D,_,!1)}function y(){z=Q=E=T=j=B=R=0}function w(e,t){var s=void 0;if(n.swipeStatus&&(s=n.swipeStatus.call(L,e,t,M||null,U||0,$||0,R)),t!==p||!n.click||1!==R&&g||!isNaN(U)&&0!==U||(s=n.click.call(L,e,e.target)),t==f)switch(n.swipe&&(s=n.swipe.call(L,e,M,U,$,R)),M){case o:n.swipeLeft&&(s=n.swipeLeft.call(L,e,M,U,$,R));break;case i:n.swipeRight&&(s=n.swipeRight.call(L,e,M,U,$,R));break;case r:n.swipeUp&&(s=n.swipeUp.call(L,e,M,U,$,R));break;case a:n.swipeDown&&(s=n.swipeDown.call(L,e,M,U,$,R))}return(t===p||t===f)&&y(e),s}function k(){return null!==n.threshold?U>=n.threshold:null}function S(){return Math.round(Math.sqrt(Math.pow(T-B,2)+Math.pow(E-j,2)))}function x(){var e;return e=Math.atan2(E-j,B-T),e=Math.round(180*e/Math.PI),0>e&&(e=360-Math.abs(e)),45>=e&&e>=0?o:360>=e&&e>=315?o:e>=135&&225>=e?i:e>45&&135>e?a:r}function A(){L.unbind(N,b),L.unbind(P,y),L.unbind(F,C),L.unbind(D,_)}var T,E,B,j,I=g||!n.fallbackToMouseEvents,N=I?"touchstart":"mousedown",F=I?"touchmove":"mousemove",D=I?"touchend":"mouseup",P="touchcancel",U=0,M=null,$=0,L=e(t),O="start",R=0,z=E=T=j=B=0,Q=0;try{L.bind(N,b),L.bind(P,y)}catch(V){e.error("events not supported "+N+","+P+" on jQuery.swipe")}this.enable=function(){return L.bind(N,b),L.bind(P,y),L},this.disable=function(){return A(),L},this.destroy=function(){return A(),L.data(v,null),L}}var o="left",i="right",r="up",a="down",s="none",l="auto",c="horizontal",u="vertical",d="all",h="start",m="move",f="end",p="cancel",g="ontouchstart"in window,v="TouchSwipe";e.fn.swipe=function(n){var o=e(this),i=o.data(v);if(i&&"string"==typeof n){if(i[n])return i[n].apply(this,Array.prototype.slice.call(arguments,1));e.error("Method "+n+" does not exist on jQuery.swipe")}else if(!(i||"object"!=typeof n&&n))return t.apply(this,arguments);return o},e.fn.swipe.defaults={fingers:1,threshold:75,maxTimeThreshold:null,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,click:null,triggerOnTouchEnd:!0,allowPageScroll:"auto",fallbackToMouseEvents:!0},e.fn.swipe.phases={PHASE_START:h,PHASE_MOVE:m,PHASE_END:f,PHASE_CANCEL:p},e.fn.swipe.directions={LEFT:o,RIGHT:i,UP:r,DOWN:a},e.fn.swipe.pageScroll={NONE:s,HORIZONTAL:c,VERTICAL:u,AUTO:l},e.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:d}}(jQuery),function(e){function t(t){t.preventDefault();var n=t.data,i=n.attr("href"),r=n.data("rec-url")===i,a=n.data("recommend-entry-id"),s=e('*[data-recommend-entry-id="'+a+'"]');e.post(i,function(){s.each(function(){o(r,e(this))})})}function n(e){var t=e.data("rec-count");e.find(".recommend-link-count").remove(),1>t&&(t=""),e.append('<span class="recommend-link-count p-button__count">'+t+"</span>")}function o(e,t){var o=parseInt(t.data("rec-count"));e?(t.attr("href",t.data("unrec-url")),t.data("rec-count",o+1),t.find(".p-button__social-text").text("Unrec"),t.find(".p-button__social-text-long").text("Unrecommend this Post"),n(t)):(t.attr("href",t.data("rec-url")),t.data("rec-count",o-1),t.find(".p-button__social-text").text("Rec"),t.find(".p-button__social-text-long").text("Recommend this Post"),n(t))}e.fn.sbnRecommendLink=function(){return this.each(function(){var o=e(this);o.data("rec-link-init")!==!0&&(o.data("rec-link-init",!0),o.on("click",o,t),n(o))})}}(jQuery),function(e){e("*[data-recommend-entry-id]").sbnRecommendLink()}(jQuery),function(e){e.fn.serializeObject=function(){var t=this,n={},o={},i={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(e,t,n){return e[t]=n,e},this.push_counter=function(e){return void 0===o[e]&&(o[e]=0),o[e]++},e.each(e(this).serializeArray(),function(){if(i.validate.test(this.name)){for(var o,r=this.name.match(i.key),a=this.value,s=this.name;void 0!==(o=r.pop());)s=s.replace(new RegExp("\\["+o+"\\]$"),""),o.match(i.push)?a=t.build([],t.push_counter(s),a):o.match(i.fixed)?a=t.build([],o,a):o.match(i.named)&&(a=t.build({},o,a));n=e.extend(!0,n,a)}}),n}}(jQuery),function(e){function t(t,n){var o={oddClass:n.oddClass||"ui-state-odd",evenClass:n.evenClass||"ui-state-even",highlightRows:n.highlightRows===!0?!0:!1,highlightClass:n.highlighClass||"ui-state-hover"},i=t.find("tbody tr");o.highlightRows&&(i.unbind("mouseenter",function(){e(this).addClass(o.highlighClass)}),i.unbind("mouseleave",function(){e(this).removeClass(o.highlighClass)}),i.bind("mouseenter",function(){e(this).addClass(o.highlighClass)}),i.bind("mouseleave",function(){e(this).removeClass(o.highlighClass)})),o.oddClass&&i.filter(":odd").addClass(o.oddClass),o.evenClass&&i.filter(":even").addClass(o.evenClass)}e.fn.zebraTables=function(e){if(this.length>0){var n=e||{};table=this,t(table,n),this.bind("DOMNodeInserted",function(){t(table,n)})}return this}}(jQuery);var PLAYGIF_DISABLE_FLAG;!function(e){e.fn.playGIF=function(t){var n=e.extend({on:"mouseenter",off:"mouseleave",autoResize:!1,enable:!0,circleBackgroundColor:"FFF200",circleTextColor:"4C4E4D",gifText:"GIF",removeAnchor:!0},t);"undefined"!=typeof PLAYGIF_DISABLE_FLAG&&(n.enable=!PLAYGIF_DISABLE_FLAG);var o=function(e,t,o){t=Math.floor(t),o=Math.floor(o);var i=35;e.fillStyle="#"+n.circleBackgroundColor,e.beginPath(),e.arc(t,o,i,0,2*Math.PI,!0),e.closePath(),e.fill(),e.fillStyle="#"+n.circleTextColor,e.font="15px 'Gotham SSm A', 'Gotham SSm B', sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(n.gifText,t,o)};return this.each(function(){if(n.enable!==!1){var t=e(this);if(!t.is("img")||!/\.gif$/i.test(t.attr("src")))return!0;var i=document.createElement("canvas");if("undefined"==typeof i.getContext)return!0;var r=i.getContext("2d"),a=new Image,s=function(e,t){t.on(n.off,function(){l(e,t)});var o=t.attr("src");t.attr("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),t.css({width:e.attr("width"),height:e.attr("height")}),setTimeout(function(){t.attr("src",o)},0),e.replaceWith(t)},l=function(e,t){e.on(n.on,function(){s(e,t)}),t.replaceWith(e)};a.onload=function(){var l=t.width(),c=t.height();i.width=l,i.height=c,r.drawImage(a,0,0,l,c);var u=e(i);if(n.autoResize===!0){i.setAttribute("data-src",t.attr("src")),i.setAttribute("class","gif");var d=e('<span class="faux-image">');d.css({"float":t.css("float"),margin:t.css("margin"),padding:t.css("padding"),"max-width":"100%",position:"relative",display:"block",height:i.height}),u.css({position:"absolute",top:0,left:0}),u=d.append(u)}else u.css({"float":t.css("float"),margin:t.css("margin"),padding:t.css("padding"),display:t.css("display")});t.replaceWith(u);var h=u.parent();h.is("p")||"none"===h.css("max-width")&&"none"===h.css("max-height")||(l=h.width(),c=h.height()),n.removeAnchor&&h.is("a")&&/\.gif$/i.test(h.attr("href"))&&h.replaceWith(u),l>150&&c>150&&o(r,l/2,c/2),u.on(n.on,function(){s(u,t)})},a.src=t.attr("src")}})}}(jQuery),function(e){e.fn.redraw=function(){return e(this).each(function(){var t=document.createTextNode(" ");e(this).append(t),setTimeout(function(){t.parentNode.removeChild(t)},0)})}}(jQuery),function(e){e.fn.noUiSlider=function(t,n){function o(e,t,n){"function"==typeof e&&e.call(t,n)}function i(e,t,n){var o=t.data("setup"),i=o.handles,r=o.settings,a=o.pos;if(e=0>e?0:e>100?100:e,2==r.handles)if(n.is(":first-child")){var s=parseFloat(i[1][0].style[a])-r.margin;e=e>s?s:e}else{var s=parseFloat(i[0][0].style[a])+r.margin;e=s>e?s:e}if(r.step){var c=l.from(r.range,r.step);e=Math.round(e/c)*c}return e}function r(e){try{return[e.clientX||e.originalEvent.clientX||e.originalEvent.touches[0].clientX,e.clientY||e.originalEvent.clientY||e.originalEvent.touches[0].clientY]}catch(t){return["x","y"]}}function a(e,t){return parseFloat(e[0].style[t])}var s=window.navigator.msPointerEnabled?2:"ontouchend"in document?3:1;window.debug&&console&&console.log(s);var l={to:function(e,t){return t=e[0]<0?t+Math.abs(e[0]):t-e[0],100*t/this._length(e)},from:function(e,t){return 100*t/this._length(e)},is:function(e,t){return t*this._length(e)/100+e[0]},_length:function(e){return e[0]>e[1]?e[0]-e[1]:e[1]-e[0]}},c={handles:2,serialization:{to:["",""],resolution:.01}};methods={create:function(){return this.each(function(){function n(e,t,n){e.css(u,t+"%").data("input").val(l.is(h.range,t).toFixed(C))}var u,d,h=e.extend(c,t),m="<a><div></div></a>",f=e(this).data("_isnS_",!0),p=[],g="",v=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},b=(h.serialization.resolution=h.serialization.resolution||.01).toString().split("."),C=1==b[0]?0:b[1].length;h.start=v(h.start)?[h.start,0]:h.start,e.each(h,function(e,t){v(t)?h[e]=parseFloat(t):"object"==typeof t&&v(t[0])&&(t[0]=parseFloat(t[0]),v(t[1])&&(t[1]=parseFloat(t[1])));var n=!1;switch(t="undefined"==typeof t?"x":t,e){case"range":case"start":n=2!=t.length||!v(t[0])||!v(t[1]);break;case"handles":n=1>t||t>2||!v(t);break;case"connect":n="lower"!=t&&"upper"!=t&&"boolean"!=typeof t;break;case"orientation":n="vertical"!=t&&"horizontal"!=t;break;case"margin":case"step":n="undefined"!=typeof t&&!v(t);break;case"serialization":n="object"!=typeof t||!v(t.resolution)||"object"==typeof t.to&&t.to.length<h.handles;break;case"slide":n="function"!=typeof t}n&&console&&console.error("Bad input for "+e+" on slider:",f)}),h.margin=h.margin?l.from(h.range,h.margin):0,(h.serialization.to instanceof jQuery||"string"==typeof h.serialization.to||h.serialization.to===!1)&&(h.serialization.to=[h.serialization.to]),"vertical"==h.orientation?(g+="vertical",u="top",d=1):(g+="horizontal",u="left",d=0),g+=h.connect?"lower"==h.connect?" connect lower":" connect":"",f.addClass(g);for(var _=0;_<h.handles;_++){p[_]=f.append(m).children(":last");var y=l.to(h.range,h.start[_]);p[_].css(u,y+"%"),100==y&&p[_].is(":first-child")&&p[_].css("z-index",2);var w=".noUiSlider",k=(1===s?"mousedown":2===s?"MSPointerDown":"touchstart")+w+"X",S=(1===s?"mousemove":2===s?"MSPointerMove":"touchmove")+w,x=(1===s?"mouseup":2===s?"MSPointerUp":"touchend")+w;p[_].find("div").on(k,function(t){if(e("body").bind("selectstart"+w,function(){return!1}),!f.hasClass("disabled")){e("body").addClass("TOUCH");var n=e(this).addClass("active").parent(),a=n.add(e(document)).add("body"),s=parseFloat(n[0].style[u]),c=r(t),m=c,g=!1;e(document).on(S,function(e){e.preventDefault();var t=r(e);if("x"!=t[0]){t[0]-=c[0],t[1]-=c[1];var a=[m[0]!=t[0],m[1]!=t[1]],v=s+100*t[d]/(d?f.height():f.width());v=i(v,f,n),a[d]&&v!=g&&(n.css(u,v+"%").data("input").val(l.is(h.range,v).toFixed(C)),o(h.slide,f.data("_n",!0)),g=v,n.css("z-index",2==p.length&&100==v&&n.is(":first-child")?2:1)),m=t}}).on(x,function(){a.off(w),e("body").removeClass("TOUCH"),f.find(".active").removeClass("active").end().data("_n")&&f.data("_n",!1).change()})}}).on("click",function(e){e.stopPropagation()})}1==s&&f.on("click",function(e){if(!f.hasClass("disabled")){var t=r(e),a=100*(t[d]-f.offset()[u])/(d?f.height():f.width()),s=p.length>1?t[d]<(p[0].offset()[u]+p[1].offset()[u])/2?p[0]:p[1]:p[0];n(s,i(a,f,s),f),o(h.slide,f),f.change()}});for(var _=0;_<p.length;_++){var A=l.is(h.range,a(p[_],u)).toFixed(C);"string"==typeof h.serialization.to[_]?p[_].data("input",f.append('<input type="hidden" name="'+h.serialization.to[_]+'">').find("input:last").val(A).change(function(e){e.stopPropagation()})):0==h.serialization.to[_]?p[_].data("input",{val:function(e){return"undefined"==typeof e?this.handle.data("noUiVal"):void this.handle.data("noUiVal",e)},handle:p[_]}):p[_].data("input",h.serialization.to[_].data("handleNR",_).val(A).change(function(){var t=[null,null];t[e(this).data("handleNR")]=e(this).val(),f.val(t)}))}e(this).data("setup",{settings:h,handles:p,pos:u,res:C})})},val:function(){if("undefined"!=typeof arguments[0]){var t="number"==typeof arguments[0]?[arguments[0]]:arguments[0];return this.each(function(){for(var n=e(this).data("setup"),o=0;o<n.handles.length;o++)if(null!=t[o]){var r=i(l.to(n.settings.range,t[o]),e(this),n.handles[o]);n.handles[o].css(n.pos,r+"%").data("input").val(l.is(n.settings.range,r).toFixed(n.res))}})}for(var n=e(this).data("setup").handles,o=[],r=0;r<n.length;r++)o.push(parseFloat(n[r].data("input").val()));return 1==o.length?o[0]:o},disabled:function(){return n?e(this).addClass("disabled"):e(this).removeClass("disabled")}};var u=jQuery.fn.val;return jQuery.fn.val=function(){return this.data("_isnS_")?methods.val.apply(this,arguments):u.apply(this,arguments)},"disabled"==t?methods.disabled.apply(this):methods.create.apply(this)}}(jQuery),jQuery(document).ready(function(e){var t={networkVars:{sbn:{scope:e(".m-entry__body"),linkable:"p",buffer:!1},verge:{scope:e(".article-body, .entry-content"),linkable:"p",buffer:!1},polygon:{scope:e("article .body, .forum_article"),linkable:"p",buffer:e("#polybar")}},init:function(){this.config(function(){t.scope.length&&(e(document).bind("keydown",t.keydown),t.buildLinks(t.readHash))})},config:function(t){this.network=window.Chorus.Context.network_slug,this.scope=this.networkVars[this.network].scope,this.linkable=this.scope.find(this.networkVars[this.network].linkable).filter(function(){return 0==e(this).parents("table").length?e(this):void 0}),this.keyStore=this.keyDivider="|",this.trigger="|16|16|",this.linksVisible=!1,this.linkClassname="pgh-link",this.scrollSpeed=200,this.highlightFadeSpeed=5e3,this.extraBuffer=100,this.loaded=!1,this.paragraphClassname="pgh-paragraph",this.buffer=this.networkVars[this.network].buffer?this.networkVars[this.network].buffer.outerHeight():0,t()},buildLinks:function(n){t.linkable.each(function(n,o){var i=e(o);if(""!==i.text().replace(/^\s+|\s+$/g,"")){var r=i.offset(),a=e('<a href="" id="pgh'+n+'" class="'+t.linkClassname+'" />').css({top:r.top,left:r.left}).data({id:n,top:Math.floor(r.top)});i.attr("id","paragraph"+n).addClass(t.paragraphClassname).data("id",n),e("body").append(a)}}),t.links=e("."+t.linkClassname),t.links.on("click",t.buildHash),n()},recalculateLinks:function(){e("."+t.paragraphClassname).each(function(t,n){var o=e(n),i=o.offset(),r=e("#pgh"+o.data("id"));r.css("top",i.top).data("top",i.top)})},buildHash:function(){var n=e(this).data();return window.location.hash="pgh/"+n.id+"/"+n.top,t.scrollToParagraph(n.id,n.top,!1),!1},readHash:function(){if(window.location.hash&&window.location.hash.indexOf("pgh")>-1){var e=window.location.hash.split("/");t.scrollToParagraph(e[1],e[2],!0)}},scrollToParagraph:function(t,n,o){var i=n-this.buffer,r=e("#paragraph"+t);if(o){var a=this.scope.find(this.networkVars[this.network].linkable);i-=this.extraBuffer,a.fadeTo(0,.25,function(){r.fadeTo(0,1)}),setTimeout(function(){a.fadeTo(500,1)},this.highlightFadeSpeed)}e("html, body").animate({scrollTop:i},this.scrollSpeed)},keydown:function(e){var n=e.keyCode;t.keyStore=t.keyStore+n+t.keyDivider,t.keyStore.indexOf(t.trigger)>-1&&(t.linksVisible?(t.linksVisible=!1,t.links.hide()):(t.loaded||(t.recalculateLinks(),t.loaded=!0),t.linksVisible=!0,t.links.show())),setTimeout(function(){t.keyStore=t.keyDivider},500)}};t.init()}),function(e,t){e.rails!==t&&e.error("jquery-ujs has already been loaded!");var n,o=e(document);e.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(t){var n=e('meta[name="csrf-token"]').attr("content");n&&t.setRequestHeader("X-CSRF-Token",n)},refreshCSRFTokens:function(){var t=e("meta[name=csrf-token]").attr("content"),n=e("meta[name=csrf-param]").attr("content");e('form input[name="'+n+'"]').val(t)},fire:function(t,n,o){var i=e.Event(n);return t.trigger(i,o),i.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e[0].href},handleRemote:function(o){var i,r,a,s,l,c;if(n.fire(o,"ajax:before")){if(s=o.data("with-credentials")||null,l=o.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,o.is("form")){i=o.attr("method"),r=o.attr("action"),a=o.serializeArray();var u=o.data("ujs:submit-button");u&&(a.push(u),o.data("ujs:submit-button",null))}else o.is(n.inputChangeSelector)?(i=o.data("method"),r=o.data("url"),a=o.serialize(),o.data("params")&&(a=a+"&"+o.data("params"))):o.is(n.buttonClickSelector)?(i=o.data("method")||"get",r=o.data("url"),a=o.serialize(),o.data("params")&&(a=a+"&"+o.data("params"))):(i=o.data("method"),r=n.href(o),a=o.data("params")||null);return c={type:i||"GET",data:a,dataType:l,beforeSend:function(e,i){return i.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+i.accepts.script),n.fire(o,"ajax:beforeSend",[e,i])?void o.trigger("ajax:send",e):!1},success:function(e,t,n){o.trigger("ajax:success",[e,t,n])},complete:function(e,t){o.trigger("ajax:complete",[e,t])},error:function(e,t,n){o.trigger("ajax:error",[e,t,n])},crossDomain:n.isCrossDomain(r)},s&&(c.xhrFields={withCredentials:s}),r&&(c.url=r),n.ajax(c)}return!1},isCrossDomain:function(e){var t=document.createElement("a");t.href=location.href;var n=document.createElement("a");try{return n.href=e,n.href=n.href,!n.protocol||!n.host||t.protocol+"//"+t.host!=n.protocol+"//"+n.host}catch(o){return!0}},handleMethod:function(o){var i=n.href(o),r=o.data("method"),a=o.attr("target"),s=e("meta[name=csrf-token]").attr("content"),l=e("meta[name=csrf-param]").attr("content"),c=e('<form method="post" action="'+i+'"></form>'),u='<input name="_method" value="'+r+'" type="hidden" />';l===t||s===t||n.isCrossDomain(i)||(u+='<input name="'+l+'" value="'+s+'" type="hidden" />'),a&&c.attr("target",a),c.hide().append(u).appendTo("body"),c.submit()},formElements:function(t,n){return t.is("form")?e(t[0].elements).filter(n):t.find(n)},disableFormElements:function(t){n.formElements(t,n.disableSelector).each(function(){n.disableFormElement(e(this))})},disableFormElement:function(e){var n,o;n=e.is("button")?"html":"val",o=e.data("disable-with"),e.data("ujs:enable-with",e[n]()),o!==t&&e[n](o),e.prop("disabled",!0)},enableFormElements:function(t){n.formElements(t,n.enableSelector).each(function(){n.enableFormElement(e(this))})},enableFormElement:function(e){var t=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[t](e.data("ujs:enable-with")),e.prop("disabled",!1)},allowAction:function(e){var t,o=e.data("confirm"),i=!1;return o?(n.fire(e,"confirm")&&(i=n.confirm(o),t=n.fire(e,"confirm:complete",[i])),i&&t):!0},blankInputs:function(t,n,o){var i,r,a=e(),s=n||"input,textarea",l=t.find(s);return l.each(function(){if(i=e(this),r=i.is("input[type=checkbox],input[type=radio]")?i.is(":checked"):i.val(),!r==!o){if(i.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+i.attr("name")+'"]').length)return!0;a=a.add(i)}}),a.length?a:!1},nonBlankInputs:function(e,t){return n.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(e){var o=e.data("disable-with");e.data("ujs:enable-with",e.html()),o!==t&&e.html(o),e.bind("click.railsDisable",function(e){return n.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.unbind("click.railsDisable")}},n.fire(o,"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,o){e.crossDomain||n.CSRFProtection(o)}),e(window).on("pageshow.rails",function(){e(e.rails.enableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableFormElement(t)}),e(e.rails.linkDisableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableElement(t)})}),o.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(e(this))}),o.delegate(n.buttonDisableSelector,"ajax:complete",function(){n.enableFormElement(e(this))}),o.delegate(n.linkClickSelector,"click.rails",function(o){var i=e(this),r=i.data("method"),a=i.data("params"),s=o.metaKey||o.ctrlKey;if(!n.allowAction(i))return n.stopEverything(o);if(!s&&i.is(n.linkDisableSelector)&&n.disableElement(i),i.data("remote")!==t){if(s&&(!r||"GET"===r)&&!a)return!0;var l=n.handleRemote(i);return l===!1?n.enableElement(i):l.fail(function(){n.enableElement(i)}),!1}return r?(n.handleMethod(i),!1):void 0}),o.delegate(n.buttonClickSelector,"click.rails",function(t){var o=e(this);if(!n.allowAction(o))return n.stopEverything(t);o.is(n.buttonDisableSelector)&&n.disableFormElement(o);var i=n.handleRemote(o);return i===!1?n.enableFormElement(o):i.fail(function(){n.enableFormElement(o)}),!1}),o.delegate(n.inputChangeSelector,"change.rails",function(t){var o=e(this);return n.allowAction(o)?(n.handleRemote(o),!1):n.stopEverything(t)}),o.delegate(n.formSubmitSelector,"submit.rails",function(o){var i,r,a=e(this),s=a.data("remote")!==t;if(!n.allowAction(a))return n.stopEverything(o);if(a.attr("novalidate")==t&&(i=n.blankInputs(a,n.requiredInputSelector),i&&n.fire(a,"ajax:aborted:required",[i])))return n.stopEverything(o);if(s){if(r=n.nonBlankInputs(a,n.fileInputSelector)){setTimeout(function(){n.disableFormElements(a)},13);var l=n.fire(a,"ajax:aborted:file",[r]);return l||setTimeout(function(){n.enableFormElements(a)},13),l}return n.handleRemote(a),!1}setTimeout(function(){n.disableFormElements(a)},13)}),o.delegate(n.formInputClickSelector,"click.rails",function(t){var o=e(this);if(!n.allowAction(o))return n.stopEverything(t);var i=o.attr("name"),r=i?{name:i,value:o.val()}:null;o.closest("form").data("ujs:submit-button",r)}),o.delegate(n.formSubmitSelector,"ajax:send.rails",function(t){this==t.target&&n.disableFormElements(e(this))}),o.delegate(n.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&n.enableFormElements(e(this))}),e(function(){n.refreshCSRFTokens()}))}(jQuery);var SBN=SBN||{};SBN.Nav=function(e){function t(){var t=e(".m-site-nav__logo img"),n=t.attr("data-logo-url");t.attr("src",n)}function n(t,n,o){var r=e(".m-site-nav__logo img"),a=r.attr("data-dark-logo-url"),s=r.attr("data-light-logo-url");if(i(),_.delay(i,1e3),a&&s&&(r.attr("src",t?s:a),n)){var l=r.attr("data-bw-logo-url");l?r.attr("src",l):console.log("Tried to apply third logo/black and white logo, but none was available for this site/network.")}}function o(t,n){if(!T){t.children("li").css({visibility:"hidden"}).removeClass("is-hidden-desktop");var o=t.find(".m-site-nav__more-link"),i=o.find("ul").empty(),r=n-o.width()-E,a=0,s=0;t.children(".is-pinned").css("visibility","visible").each(function(){a+=e(this).width()}),t.children("li").not(".is-pinned").each(function(){var t=e(this);if(!t.is(o))if(a+=t.width(),r>a)t.css("visibility","visible");else{s++;var n=t.children("a");n.length>0&&i.append("<li>"+n[0].outerHTML+"</li>"),t.addClass("is-hidden-desktop"),t.css("visibility","visible")}}),s>0&&o.css("visibility","visible")}}function i(){if(Chorus.Environment.currentBreakpoint().index>1){var t=x.width()-A.width();x.find(".m-site-nav__network, .m-site-nav__community").each(function(){o(e(this),t)})}else x.find("> ul > li").css({visibility:"visible"})}function r(){S.toggleClass("is-mobile-nav-active")}function a(){clearTimeout(k),Chorus.Environment.currentBreakpoint().index>1&&S.hasClass("has-both-navs")===!0&&S.addClass("is-network-nav-active")}function s(){S.removeClass("is-network-nav-active"),clearTimeout(k)}function l(e){n(e.useLightLogo===!0,e.useThirdLogo===!0,e.useSolidBackground===!0)}function c(e){Chorus.Environment.currentBreakpoint().index>1&&e.toggleClass("is-active")}function u(e){Chorus.Environment.currentBreakpoint().index<2&&e.hasClass("has-dropdown")&&(x.find(".is-active").not(e).removeClass("is-active"),e.toggleClass("is-active"))}function d(t){c(e(t.currentTarget))}function h(t){var n=e(t.currentTarget);n.hasClass("has-dropdown")===!0&&n.hasClass("is-active")===!1&&t.preventDefault(),u(n)}function m(e){i()}function f(e){a()}function p(e){k=setTimeout(s,2e3)}function g(e){s()}function v(t){e(".m-site-nav__search").addClass("is-focus")}function b(t){e(".m-site-nav__search").removeClass("is-focus")}function C(e){r()}function y(t){var n=e(t.currentTarget);n.find("iframe").css({"background-color":n.css("background-color")}),FB.XFBML.parse(document.getElementById("nav-fb-like-btn"))}function w(){S=e(".m-site-nav"),x=S.find("nav"),t(),A=e(".m-site-nav__right-side"),e(".m-site-nav nav > ul > li").on("mouseenter",d).on("mouseleave",d),e(".m-site-nav nav .m-site-nav__community > li").on("click",h),Chorus.EventDispatcher.subscribe("campaignReskinApplied",l),e(window).on("resize",_.debounce(m,100)),e(".m-site-nav__netnav-trigger, .m-site-nav__network").on("mouseenter",f),x.on("mouseleave",p),e(".m-site-nav__logo").on("mouseenter",g),e(".m-site-nav__search__input").on("focus",v).on("blur",b),e(".m-site-nav__mobile-trigger").on("click",C),e(".m-site-nav__social-btn").on("mouseenter",y),i()}var k,S,x,A,T=e.browser.msie&&e.browser.version<9,E=10;return{init:function(){w()}}}(jQuery),jQuery(function(){SBN.Nav.init()});var SBN=SBN||{};SBN.UserNav=function(e){return{init:function(e){this.config(function(){SBN.UserNav.mySbnToggle.off("click",SBN.UserNav.showMySbnModal),SBN.UserNav.mySbnToggle.on("click",SBN.UserNav.showMySbnModal)})},config:function(t){this.mySbnToggle=e("#user-nav-my-sbn"),t()},showMySbnModal:function(e){Chorus.EventDispatcher.publish("modal_open",{url:"/modal/mysbn"}),e.preventDefault()}}}(jQuery),jQuery(function(){SBN.UserNav.init()});var SBN=SBN||{};SBN.FilterPane=function(e){return{init:function(){var t=e(".m-filter-pane");t.length<1||this.config(function(){SBN.FilterPane.cloneToggleEvents(),SBN.FilterPane.mobileDropdown.on("change",SBN.FilterPane.triggerMobileChange)})},config:function(t){this.contentToggle=e("#filter-pane-toggle"),this.mobileDropdown=e("#filter-pane-toggle-mobile"),this.selectedClass="is-selected",t()},cloneToggleEvents:function(){this.contentToggle.find("li").each(function(t,n){var o=e('<option data-index="'+t+'">'+e(this).find("a").text()+"</option>").appendTo(SBN.FilterPane.mobileDropdown);0==e(this).data("count")&&o.attr("disabled",!0),e(this).hasClass(SBN.FilterPane.selectedClass)&&o.attr("selected",!0)})},triggerMobileChange:function(e){var t=SBN.FilterPane.mobileDropdown.find(":selected").data("index");SBN.FilterPane.contentToggle.find("li").eq(t).find("a")[0].click()}}}(jQuery),jQuery(function(){SBN.FilterPane.init()});var SBN=SBN||{};SBN.FanShots=function(e){var t=!1;return{init:function(){t||(t=!0,this.config(function(){SBN.FanShots.fanshotModalTrigger.on("click",SBN.FanShots.openModal),SBN.FanShots.collapseOn.length&&(SBN.FanShots.collapseImageShots(),SBN.FanShots.collapseFanShotBlurbs())}),SBN.UnreadComments.init())},config:function(t){this.fanshotModalTrigger=e("#new-fanshot-trigger"),this.fanshotInput=e("#new-fanshot-input"),this.form="#new-fanshot-form",this.formTypes="#fanshot-type-toggle li",this.formTypeToggle="#fanshot-type-toggle a",this.typeInput="#type",this.forms=".m-modal-fanshots__details",this.selectedClass="is-selected",this.url=null,this.linkEmbed="#link_shot_url",this.imageEmbed="#image_shot_url",this.videoEmbed="#video_shot_html",this.twitterToggle={User:"#entry_tweet_as_user",Community:"#entry_tweet_as_community"},this.twitterBox={User:"#twitter-box-user",Community:"#twitter-box-community"},this.tweetCount={User:"#twitter-count-user",Community:"#twitter-count-community"},this.tweetLength=110,this.collapseOn=e(".m-fanshot-index, .is-front-page"),this.collapsible=e(".m-block__fanshot-media.image"),this.collapseToggle=e(".m-fanshot__image-collapse"),this.collapsedImageClass="-is-collapsed",this.imageShotMaxHeight=150,this.fanShotBlurbs=e(".m-block.fanshot .m-block__body__blurb"),this.blurbMaxWords=15,this.blurbReadMoreClass="m-fanshot__read-more-link",this.blurbReadMore=' ... <a href="" class="'+this.blurbReadMoreClass+'">Read More</a>',t()},openModal:function(){return Chorus.Context.logged_in?Chorus.EventDispatcher.publish("modal_open",{url:"/modal/new_fanshot",callbacks:{attach:function(){SBN.FanShots.parseUrl()},submit:function(){SBN.FanShots.submitForm()}}}):(event.preventDefault(),Chorus.Auth.modal.open("login")),!1},switchTypeForm:function(){e(SBN.FanShots.formTypes).removeClass(SBN.FanShots.selectedClass),e(this).parent().addClass(SBN.FanShots.selectedClass);var t=e(this).data("fanshot-type");return e(SBN.FanShots.typeInput).val(t),e(SBN.FanShots.forms).hide().filter("#"+t.toLowerCase()).show(0,function(){e(window).trigger("recalculate_modal")}),!1},parseUrl:function(){e(SBN.FanShots.formTypeToggle).on("click",SBN.FanShots.switchTypeForm),e(SBN.FanShots.twitterToggle.User).on("click",{account:"User"},SBN.FanShots.toggleTwitterBox),e(SBN.FanShots.twitterToggle.Community).on("click",{account:"Community"},SBN.FanShots.toggleTwitterBox),SBN.FanShots.url=SBN.FanShots.fanshotInput.val().replace(/^\s+|\s+$/g,""),e.ajax({type:"POST",url:"/fanshots/lookup",data:{url:SBN.FanShots.url}}).done(function(t){var n=t.shot_type;e(SBN.FanShots.formTypeToggle).filter('[data-fanshot-type="'+n+'"]').trigger("click"),"ImageShot"==n?e(SBN.FanShots.imageEmbed).val(t.data):"VideoShot"==n?e(SBN.FanShots.videoEmbed).val(t.data):e(SBN.FanShots.linkEmbed).val(SBN.FanShots.url)})},toggleTwitterBox:function(t){type=t.data.account,e(t.currentTarget).is(":checked")?(e(SBN.FanShots.twitterBox[type]).show(),e(SBN.FanShots.tweetCount[type]).text(SBN.FanShots.tweetLength),e(SBN.FanShots.twitterBox[type]).find("textarea").on("keyup",t.data,SBN.FanShots.countTweetChars)):(e(SBN.FanShots.twitterBox[type]).hide(),e(SBN.FanShots.tweetCount[type]).text(""),e(SBN.FanShots.twitterBox[type]).find("textarea").off("keyup",t.data,SBN.FanShots.countTweetChars))},countTweetChars:function(t){type=t.data.account;var n=e(SBN.FanShots.tweetCount[type]),o=SBN.FanShots.tweetLength-e(SBN.FanShots.twitterBox[type]).find("textarea").val().length;n.text(o),10>o&&!n.hasClass("warning")?e(SBN.FanShots.tweetCount[type]).addClass("warning"):o>10&&n.hasClass("warning")&&e(SBN.FanShots.tweetCount[type]).removeClass("warning")},submitForm:function(){var t=e(this.form),n=t.serialize(),o=t.attr("action"),i=e("input:submit",t),r=0,a=e(SBN.FanShots.forms).filter(":visible"),s=e(SBN.FanShots.forms).filter(":hidden");return a.find('[data-required="true"]').each(function(){
return""===e.trim(e(this).val())?(alert("Please fill out all required fields"),e(this).focus(),r++,!1):void 0}),0===r&&(s.find("input, textarea").val(""),e.ajax({type:"POST",url:o,data:n,beforeSend:function(){i.val("Saving...")}}).done(function(e){200!==e.status?(i.val("Post"),alert(e.message)):(i.val("Saved!"),location.reload())}).fail(function(){i.val("Post"),alert("An error occured while saving this fanshot.")})),!1},collapseImageShots:function(){SBN.FanShots.collapsible.each(function(){var t=e(this),n=t.find("img");t.find("img").on("click",SBN.FanShots.expandImageShots),t.find(SBN.FanShots.collapseToggle).on("click",SBN.FanShots.expandImageShots),t.data("image-height",t.height()),t.data("image-height")>SBN.FanShots.imageShotMaxHeight&&(t.addClass(SBN.FanShots.collapsedImageClass).height(SBN.FanShots.imageShotMaxHeight),t.find(SBN.FanShots.collapseToggle).width(n.width()))})},expandImageShots:function(t){var n=e(this).parent();n.removeClass(SBN.FanShots.collapsedImageClass),n.animate({height:n.data("image-height")},100,function(){n.removeClass(SBN.FanShots.collapsedImageClass)}),t.preventDefault()},collapseFanShotBlurbs:function(){SBN.FanShots.fanShotBlurbs.each(function(t,n){var o=e(n);if(0!==o.length){o.data("full-content",o.html());var i=o.text().match(/(\S+)/g);i.length>SBN.FanShots.blurbMaxWords&&(o.html("<p>"+i.slice(0,SBN.FanShots.blurbMaxWords).join(" ")+SBN.FanShots.blurbReadMore+"</p>"),o.find("."+SBN.FanShots.blurbReadMoreClass).on("click",SBN.FanShots.expandFanShotBlurb))}})},expandFanShotBlurb:function(t){var n=e(this).closest(".m-block__body__blurb");n.html(n.data("full-content")),t.preventDefault()}}}(jQuery);var SBN=SBN||{};SBN.UserProfile=function(e){return{init:function(){var t=e(".m-profile");t.length<1||this.config(function(){SBN.UserProfile.activityToggle.on("click","a",SBN.UserProfile.toggleActivity),SBN.UserProfile.blogMembershipToggle.on("click","a",SBN.UserProfile.toggleBlogMembership),SBN.UserProfile.favoriteToggle.on("click",SBN.UserProfile.toggleFavoriteBlog),SBN.UserProfile.adminLinkToggle.on("change",SBN.UserProfile.gotoAdminLink),SBN.UserProfile.coloredRows(SBN.UserProfile.activityTableClass,"tr"),SBN.UserProfile.activityToggle.find("a:first").trigger("click")})},config:function(t){this.activityToggle=e("#filter-pane-toggle"),this.blogMembershipToggle=e("#blog-membership-toggle"),this.blogMembershipList=e(".m-profile__memberships"),this.profileRail=e(".m-filter-pane__rail"),this.profileRiver=e(".m-filter-pane__content"),this.activityTable=e(".m-profile__activity-table"),this.activityTableClass=".m-profile__activity-table",this.favoriteToggle=e(".m-profile__blog__favorite"),this.adminLinkToggle=e("#profile-meta-link-toggle"),this.selectedClass="is-selected",this.disabledClass="is-disabled",this.favoriteClass="is-favorite",this.oddClass="odd",t()},gotoAdminLink:function(t){var n=e(this).val();""!==n&&(window.location=n)},toggleFavoriteBlog:function(t){var n=e(this),o=n.parent().hasClass(SBN.UserProfile.favoriteClass)?n.data("unfavorite-url"):n.data("favorite-url");e.post(o,function(e){n.parent().toggleClass(SBN.UserProfile.favoriteClass)}),t.preventDefault()},toggleActivity:function(){if(e(this).parent().hasClass(SBN.UserProfile.disabledClass))return e(this).parent().next().find("a").trigger("click"),!1;var t=e(this).data("type");if(!_.isUndefined(t)){var n=SBN.UserProfile.activityTable.length,o=n?SBN.UserProfile.activityTable.find("tr"):SBN.UserProfile.profileRiver.find(".m-block"),i=e(this).parents(SBN.UserProfile.activityToggle.selector).find("li");return i.removeClass(SBN.UserProfile.selectedClass),e(this).parent().addClass(SBN.UserProfile.selectedClass),n&&o.removeClass(SBN.UserProfile.oddClass),o.hide(),"all"===t?o.show():o.filter("."+t+", ."+t.toLowerCase()).show(),n&&SBN.UserProfile.coloredRows(SBN.UserProfile.activityTableClass,"tr"),!1}},toggleBlogMembership:function(){return SBN.UserProfile.blogMembershipToggle.find("li").removeClass(SBN.UserProfile.selectedClass),e(this).parent().addClass(SBN.UserProfile.selectedClass),"all"===e(this).data("show")?SBN.UserProfile.blogMembershipList.addClass("show-all"):SBN.UserProfile.blogMembershipList.removeClass("show-all"),!1},coloredRows:function(t,n){e(t).find(n).filter(":visible").each(function(t,n){t%2&&e(this).addClass("odd")})}}}(jQuery),jQuery(function(){SBN.UserProfile.init()});var Chorus=Chorus||{};Chorus.Debug={countCSSRules:function(){function e(e){var n=0;if(e&&e.cssRules){for(var o=0,i=e.cssRules.length;i>o;o++)e.cssRules[o].selectorText&&(n+=e.cssRules[o].selectorText.split(",").length);log+="\nFile: "+(e.href?e.href:"inline <style> tag"),log+="\nRules: "+e.cssRules.length,log+="\nSelectors: "+n,log+="\n--------------------------",n>=4096&&(t+="\n********************************\nWARNING:\n There are "+n+" CSS rules in the stylesheet "+e.href+" - IE will ignore the last "+(n-4096)+" rules!\n")}}var t=log="";if(document.styleSheets){for(var n=0;n<document.styleSheets.length;n++)e(document.styleSheets[n]);console.log(log),t&&console.log(t)}}};var SBN=SBN||{};SBN.DelayedLoadGlobalNav=function(e){return{init:function(){var t=e("#delayedLoadGlobalNavSubItems");t.find(".m-site-nav__dropdown").each(function(t,n){var o=e(n);e("#"+o.data("nav-id")).append(o)}),t.remove()}}}(jQuery);var SBN=SBN||{};SBN.StreamFilter=function(e){function t(){e(b).remove()}function n(){var t=e(p),n=1,o=_.template(e(g).html());t.each(function(t,i){var a=e(i),s=a.next();if(s.length>0&&s.hasClass(f))n+=1;else{var l=e(o({count:n}));l.on("click",r),a.after(l),n=1}})}function o(o){t(),e(h).removeClass(f).not(e("*["+c+'*="'+o+'"]')).addClass(f),e(d+"."+u).removeClass(u),e(d+"["+c+'="'+o+'"]').addClass(u),n(),Chorus.DynamicSizedImages.initUI(e(".m-stream__update"))}function i(e){var t=e.prev();for(e.remove();t.hasClass(f);)t.removeClass(f),t=t.prev()}function r(t){i(e(t.currentTarget))}function a(t){o(e(t.currentTarget).attr(c))}function s(e){o(e.target.value)}var l=".m-stream",c="data-filter-info",u="is-selected",d="#stream-filter-rail li",h=".m-stream__update",m="#stream-filter-rail .m-filter-pane__filter-list--mobile",f="is-hidden",p=h+"."+f,g="#m-stream-flag-template",v="m-stream__hidden-flag",b="."+v;return{init:function(){e(l).length<1||(e(d+"["+c+"]").on("click",a),e(m).on("change",s),e(g).length>0&&n())}}}(jQuery),jQuery(function(){SBN.StreamFilter.init()});var SBN=SBN||{};SBN.ShortLinkTooltip=function(e){function t(e){e.addClass(s),e.find("input").focus()}function n(e){e.removeClass(s),e.find("input").blur()}function o(t,n){var o=e('<div class="m-shortlink-tooltip"><input type="text" value="'+n+'" /><button class="'+l+'">&times;</button></div>');t.on("mouseenter",i),t.on("click","."+l,r),t.append(o)}function i(n){t(e(n.currentTarget))}function r(t){n(e(t.currentTarget).closest(a))}var a=".m-shortlink-tooltip__container",s="is-active",l="m-shortlink-tooltip__close";return{init:function(){e(a).each(function(){var t=e(this);o(t,t.find("a").attr("href"))})}}}(jQuery),jQuery(function(){SBN.ShortLinkTooltip.init()});var Chorus=Chorus||{};Chorus.EntryGallery=function(e){"use strict";function t(t){t.next("[data-gallery-full-size]").each(function(t,n){var o=e(n),i=new Image;i.src=o.data("gallery-full-size")})}function n(e){var t=e.parent(),n=Math.floor(t.height()),o=Math.floor(e.height());o>n&&(n=o),(void 0===t.data("min-height")||n>t.data("min-height"))&&(t.css("min-height",n+"px"),t.css("line-height",n+"px"),t.data("min-height",n))}function o(e,o){function i(){s.attr("src",r),s.addClass("is-stable"),t(e),_.delay(n,200,s)}var r=e.data("gallery-full-size"),a=e.closest(".m-gallery"),s=a.find(".m-gallery__image"),l=e.data("gallery-caption"),c=e.data("gallery-title"),u=l,d=o||!1;if(c&&(u='<span class="gallery-title">'+c+"</span> "+l),r!==s.attr("src")){!s.attr("src")||d?i():s.removeClassWithAnimationCallback("is-stable",i,500);var h=a.data("gallery-id"),m=a.find(".m-gallery__thumb").length,f=e.index()+1+" of "+m;a.find(".m-gallery__caption-index").text(f),a.find(".m-gallery__caption-body").html(u),Chorus.Analytics.event("gallery","image",h,{"Pagination Tracking":f,"Content ID":h})}}function i(e){if(e.hasClass("is-selected")!==!0){var t=e.closest(".m-gallery"),n=e.closest(".m-gallery__metadata");n.find(".is-selected").removeClass("is-selected"),e.addClass("is-selected");var o=0;n.width()>=n.parent().width()&&(o=e.position().left-.5*t.width()+.5*e.width(),0>o&&(o=0),o=0-o),n.css({left:o})}}function r(e,t){o(e,t),i(e);var n="http://"+window.location.host+window.location.pathname+"#"+e.data("gallery-id");history.replaceState({url:n},"",n)}function a(e,t){var n,o=e.find(".m-gallery__thumb.is-selected");n=0===o.length||t&&o.is(":last-child")?e.find(".m-gallery__thumb").first():!t&&o.is(":first-child")?e.find(".m-gallery__thumb").last():o[t?"next":"prev"](),n.trigger("click")}function s(t,n){var o=t.find(".m-gallery__metadata"),i=Math.round(.5*t.width()),r=parseInt(o.css("left"),10),a=0;o.find("a").each(function(){var t=e(this);a=a+t.width()+parseInt(t.css("margin-right"),10)}),r=n?r-i:r+i,0-(a-i)>r?r=0:r>0&&(r=0-(a-i)),o.css({left:r})}function l(){e(".m-gallery__nav .prev").trigger("click")}function c(){e(".m-gallery__nav .next").trigger("click")}function u(t){var n=e('<div class="m-gallery__thumb-modal"><h2 class="m-gallery__close m-gallery__close-top">Back To Gallery<a class="m-gallery__close m-gallery__close-x">\xd7</a></h2></div>'),o=e('<div class="m-gallery__thumb-modal-inner"></div'),i=t.data("gallery-id");o.append(t.find(".m-gallery__thumb").clone()),n.on("click",".m-gallery__thumb",function(t){var n=e(t.currentTarget),o=n.index()+1;Chorus.Analytics.event("gallery","grid:thumb:click:"+o,i,{"Pagination Tracking":o}),r(e('.m-gallery .m-gallery__thumb[data-gallery-id="'+e(t.currentTarget).data("gallery-id")+'"]'),!0)}),n.on("click",function(){Chorus.Analytics.event("gallery","grid:close",i,{"Content ID":i}),e(".m-gallery__thumb-modal").remove(),e("html").removeClass("gallery-modal-open")}),Chorus.Analytics.event("gallery","grid:open",i,{"Content ID":i}),e("html").addClass("gallery-modal-open").append(n.append(o)),_.delay(function(){n.addClass("is-visible")},500)}function d(e){37===e.keyCode&&l(),39===e.keyCode&&c()}function h(t){t.preventDefault();var n=e(t.currentTarget),o=n.closest(".m-gallery"),i=o.data("gallery-id");Chorus.Analytics.event("gallery","next_image_arrow:click",i,{"Content ID":i}),a(e(t.currentTarget).closest(".m-gallery"),!0)}function m(t){t.preventDefault();var n=e(t.currentTarget),o=n.closest(".m-gallery"),i=o.data("gallery-id");Chorus.Analytics.event("gallery","prev_image_arrow:click",i,{"Content ID":i}),a(e(t.currentTarget).closest(".m-gallery"),!1)}function f(t){var n=e(t.currentTarget),o=n.closest(".m-gallery"),i=o.data("gallery-id"),a=n.index()+1;Chorus.Analytics.event("gallery","thumb:click:"+a,i,{"Pagination Tracking":a}),r(e(t.currentTarget))}function p(t){t.preventDefault();var n=e(t.currentTarget),o=n.closest(".m-gallery"),i=o.data("gallery-id");Chorus.Analytics.event("gallery","prev_thumb_arrow:click",i,{"Content ID":i}),s(e(t.currentTarget).closest(".m-gallery"),!1)}function g(t){t.preventDefault();var n=e(t.currentTarget),o=n.closest(".m-gallery"),i=o.data("gallery-id");Chorus.Analytics.event("gallery","next_thumb_arrow:click",i,{"Content ID":i}),s(e(t.currentTarget).closest(".m-gallery"),!0)}function v(t){t.preventDefault(),u(e(t.currentTarget).closest(".m-gallery"))}var b=e("body");return{init:function(){var t=e(".m-gallery");t.length<1||(b.on("keydown",d),t.on("click",".m-gallery__thumb",f),t.on("click",".m-gallery__nav .prev",m),t.on("click",".m-gallery__nav .next",h),t.on("click",".m-gallery__thumbs-nav .prev",p),t.on("click",".m-gallery__thumbs-nav .next",g),t.on("click",".m-gallery__thumb-trigger",v),t.each(function(){var t=e(this),n=t.find(".m-gallery__thumb").first(),o=window.location.hash;if(""!==o.substring(1)){var i=t.find('.m-gallery__thumb[data-gallery-id="'+o.substring(1)+'"]');i.length>0&&(n=i)}n.trigger("click")}))}}}(jQuery),jQuery(Chorus.EntryGallery.init);var Chorus=Chorus||{};Chorus.EntryResponsiveVideo=function(e){function t(){n(e(i)),e(a).each(o)}function n(e){e.find(r).each(o)}function o(){var t="";return $this=e(this),$this.hasClass("no-responsive-video")||$this.parents(".no-responsive-video").length?!0:(/instagram\.com/.test($this.attr("src"))?(t=" instagram",$this.wrap('<div class="instagram-wrap"></div>')):/vine\.co/.test($this.attr("src"))&&(t=" vine"),$this.find("object, embed, video").attr("width","100%").attr("height","100%"),$this.find("div.OoyalaHtml5VideoPlayer").css({width:"100%",height:"100%"}),$this.removeAttr("width").removeAttr("height").wrap('<div class="p-scalable-video'+t+'"></div>'),!0)}var i=".m-entry__body, .m-stream__update, .feature-body",r=['iframe[src*="youtube.com"]','iframe[src*="vine.co"]','iframe[src*="ooyala.com"]'].join(","),a=["div[id*=ooyalaPlayer]",".m-video__pane iframe",".mceItemFlash",".m-block__fanshot-media.video iframe",".m-block__fanshot-media.video object",".sbn-body-feature .sbn-feature-entry .feature-body iframe"].join(",");return{wrapVideosInEntryBody:function(e){setTimeout(function(){n(e)},1e3)},init:function(){setTimeout(t,1e3)}}}(jQuery),jQuery(Chorus.EntryResponsiveVideo.init);var SBN=SBN||{};SBN.FeaturedPoll=function(e){function t(t){return e(l+"[data-"+p+'="'+t+'"]')}function n(n){for(var o=_.template(e(g).html()),i=t(n.poll_id),r=i.find(d),a=0,s=n.options.length-1;s>-1;s--)a+=n.options[s].poll_option.votes;i.find(f).html("<i>"+a+" vote"+(1==a?"":"s")+" total</i>"),i.find(m).remove(),i.find(h).remove();for(var s=0,l=n.options.length;l>s;s++){var c=n.options[s].poll_option,u=parseFloat(c.votes/a)||0,u=Math.round(100*u);r.append(o({title:c.title,votes:c.votes,percentage:u}))}}function o(n){t(n);e.ajax({url:v,data:{id:n},success:s})}function i(n){var o=t(n),i=o.find("input:radio:checked");i.length>0&&e.ajax({url:b,dataType:"json",data:{poll_option:i[0].value,id:n},type:"POST",success:s})}function r(e){e.preventDefault(),o(e.data.pollId)}function a(e){e.preventDefault(),i(e.data.pollId)}function s(e){n(e)}var l=".m-poll-body",c=".m-poll-body__view-results",u=".m-poll-body__submit",d=".m-poll-body__options",h=".m-poll-body__controls",m=".m-poll-body__options li",f=".m-poll-body__count",p="poll-id",g="#m-poll-body-result",v="/polls/results_json",b="/polls/vote_json";return{init:function(){e(l).each(function(){var t=e(this),n=t.data(p);t.find(c).on("click",{pollId:n},r),t.find(u).on("click",{pollId:n},a)})}}}(jQuery);var Chorus=Chorus||{};Chorus.FlagEntry=function(e){"use strict";function t(e){Chorus.EventDispatcher.publish("modal_open",{url:e,callbacks:{attach:c}})}function n(e){Chorus.EventDispatcher.publish("modal_open",{url:e})}function o(t){var n=confirm("Pressing OK will remove the flag you placed on this entry. Cancel will leave it in place.");n===!0&&e.post(t,l,"json")}function i(t){var n=t.attr("action");e.post(n,t.serializeObject(),s,"json")}function r(t){e(f+"[data-"+g+'="'+t.id+'"]').replaceWith(t.markup),Chorus.EventDispatcher.publish("modal_close"),Chorus.FlagEntry.init()}function a(t){t.preventDefault(),i(e(this).parent("form"))}function s(e){r(e)}function l(e){r(e)}function c(){e(p).on("click",a)}function u(i){i.preventDefault();var r=e(i.currentTarget),a=r.find("a");return r.has(m).length>0?void n(a.attr("href")):r.has(h).length>0?void o(a.attr("href")):void t(a.attr("href"))}var d=".m-flag-button",h=".m-flag-button__unflag",m=".m-flag-button__view",f=".m-flag-button-wrapper",p=".m-modal-flag__submit",g="flag-id",v="flag-init";return{init:function(){e(d).each(function(){var t=e(this);t.data(v)||(t.data(v,!0),t.on("click",u))})}}}(jQuery),jQuery(function(){Chorus.FlagEntry.init()});var Chorus=Chorus||{};Chorus.ToggleLink=function(e){function t(){var t=e(this),n=t.data();return n.toggleInProcess?!1:(n.toggleText&&(oldText=t.text(),t.text(n.toggleText)),n.toggleInProcess=!0,e.ajax({url:t.attr("href"),type:n.toggleMethod||"POST",dataType:"text",success:function(){if(n.toggleText=oldText,n.toggleUrl){var e=n.toggleUrl;t.attr("href",n.toggleUrl),n.toggleUrl=e}n.toggleInProcess=!1},error:function(){t.text(oldText),n.toggleInProcess=!1,alert("An unknown error occurred. Please try again later.")}}),!1)}var n="a[data-toggle-url]";return{init:function(){e(document).on("click",n,t)}}}(jQuery),jQuery(function(){Chorus.ToggleLink.init()});var Chorus=Chorus||{};Chorus.EntryDropCap=function(e){return{init:function(){var t=e(".m-entry__body > p:first-child, .m-entry-body article > p:first-child, .racked-feature .m-feature-intro > p").not('.m-entry__body.no-drop-caps > p:first-child, head[data-network="racked"] + body .m-entry__intro');if("undefined"!=typeof t){t=t.first();var n,o=t.text().trim();!Util.UserAgentProfiler.isAndroid()&&null!==o.match(/^[a-zA-Z]/)&&o.length>170&&o.split(" ").length>30&&(t.addClass("has-dropcap"),n=o.charAt(0).toLowerCase(),t.addClass("has-dropcap--"+n))}}}}(jQuery),jQuery(function(){Chorus.EntryDropCap.init()}),SBN.EntryTableSupport=function(e){function t(){e(".m-entry__body table:not([class]), .m-entry__body .sports_data_widget table").addClass("sbn-data-table").removeClass("zebra"),e(".sbn-data-table, .sports_data_widget .zebra").zebraTables();var t=e(".m-entry__body").width();e(".m-entry__body table").each(function(n,o){var i=e(o),r=e(o).width();r>t&&i.wrap('<div class="overflow-wrapper"></div>')})}return{init:function(e){t()}}}(jQuery),jQuery(function(){SBN.EntryTableSupport.init()});var SBN=SBN||{};SBN.SocialCount=function(e){function t(e,n){return o[e]?void n(o[e]):void(window.FB?FB.api("/?id="+encodeURIComponent(e),function(t){var i=t.shares||0;o[e]=i,n(i)}):Chorus.EventDispatcher.subscribe("facebookSdkAvailable",function(){t(e,n)}))}function n(){e("[data-facebook-share-count-url]").each(function(){var n=e(this);t(n.data("facebook-share-count-url"),function(e){e>0&&(n.data("use-parens")===!1?n.text(e).redraw():n.text("("+e+")").redraw())})})}var o={};return{init:function(){n()}}}(jQuery),jQuery(function(){SBN.SocialCount.init()});var SBN=SBN||{};SBN.GroupHead=function(e){function t(t){t.useLightLogo&&e(".m-section-header").children().css("color","white")}return{init:function(){Chorus.EventDispatcher.subscribe("campaignReskinApplied",t)}}}(jQuery),jQuery(function(){SBN.GroupHead.init()});var SBN=SBN||{};SBN.UnreadComments=function(e){function t(t){console.log("SBN.UnreadComments: requestUnreadCommentCounts called");var t=t||e("body"),r=t.find("*["+o+"]").map(function(t,n){return e(n).data(i)});r=_.uniq(r).sort(),l===!0&&console.log("SBN.UnreadComments: Requesting Unread Comments for :",r),r.length>0&&e.get(s+r.join(","),n,"json")}function n(t){l===!0&&console.log("SBN.UnreadComments: Data Returned:",t),_.each(t,function(t,n){e("["+o+'="'+n+'"]').each(function(n,o){var i=t;$item=e(o);var s=$item.data(r);s&&(i+=" "+s);var l=$item.data(a);l&&(i=l+i),$item.text(i).addClass("loaded")})})}var o="data-unread-comments-id",i="unread-comments-id",r="unread-comments-token",a="unread-comments-token-before",s="/comments/unread_counts/",l=Util.getUrlVars().debugUnreadComments===!0;return{init:function(){Chorus.Context.logged_in&&t()},applyTo:function(e){Chorus.Context.logged_in&&t(e)}}}(jQuery),jQuery(function(){SBN.UnreadComments.init()});var SBN=SBN||{};SBN.BreakingNews=function(e){function t(){var t=e(o),n=t.data(i);e.cookie(a+n,"true",{expires:365,path:"/"}),t.remove()}function n(e){t()}var o=".m-breaking-news",i="breaking-news-id",r='<div class="m-breaking-news__close">&times;</div>',a="breaking_news_";return{init:function(){var t=e(o);if(!(t.length>1||0==Chorus.Context.logged_in)){var i=e(r);i.on("click",n),t.append(i)}}}}(jQuery),jQuery(function(){SBN.BreakingNews.init()});var SBN=SBN||{};SBN.LookitCover=function(e){function t(e){var t=e.data.main,n=t.width();return t.removeClass("lookit-size-sm lookit-size-md lookit-size-lg"),470>n?void t.addClass("lookit-size-sm"):730>n?void t.addClass("lookit-size-md"):void t.addClass("lookit-size-lg")}function n(t,n){t.data("carousel-nav-index",n),t.find(".is-active").addClassWithAnimationCallback("is-animating",function(t){e(t).removeClass("is-animating")}).removeClass("is-active"),t.find(".lookit-cover-nav li:eq("+n+"), .lookit-box:eq("+n+")").addClassWithAnimationCallback("is-animating",function(t){e(t).removeClass("is-animating")}).addClass("is-active")}function o(e){var t=e.data("carousel-nav-index")+1;t>e.data("carousel-pane-last-index")&&(t=0),n(e,t)}function i(e){var t=e.data("carousel-nav-index")-1;0>t&&(t=e.data("carousel-pane-last-index")),n(e,t)}function r(){clearInterval(h),h=void 0}function a(){h=window.setInterval(function(){e(".lookit-cover-next").trigger("click")},4e3)}function s(t){t.preventDefault();var o=t.data.main;n(o,e(t.currentTarget).data("carousel-nav-index"))}function l(e){e.preventDefault();var t=e.data.main;i(t)}function c(e){e.preventDefault();var t=e.data.main;o(t)}function u(){event.preventDefault();var e=event.data.main;r(),i(e)}function d(){event.preventDefault();var e=event.data.main;r(),o(e)}var h,m=e(window);return{init:function(){var o=e(".lookit-cover");o.length<1||(o.each(function(o,i){var h=e(i);h.data("carousel-pane-last-index",h.find(".lookit-box").length-1),h.find(".lookit-cover-nav li").bind("click",{main:h},s),h.find(".lookit-cover-prev").bind("click",{main:h},l),h.find(".lookit-cover-next").bind("click",{main:h},c),h.swipe({swipeLeft:function(t){d(e.extend(!0,t,{data:{main:h}}))},swipeRight:function(t){u(e.extend(!0,t,{data:{main:h}}))},threshold:100,fingers:1}),h.bind("mouseenter",r),h.bind("mouseleave",a);var f=h.find(".is-active");t({data:{main:h}}),m.bind("resizeStop",{main:h},t),f.length>0?n(h,f.index()):n(h,0)}),a())}}}(jQuery),jQuery(function(){SBN.LookitCover.init()});var SBN=SBN||{};SBN.LookitTagBrowser=function(e){return{init:function(){var t=e(".lookit-tag-browser");t.length<1||t.each(function(t,n){var o=e(n),i=o.find("ul").width();o.find("li").each(function(t,n){var o=e(n);o.position().left+o.width()>i&&o.addClass("is-hidden")})})}}}(jQuery),jQuery(function(){SBN.LookitTagBrowser.init()});var SBN=SBN||{};SBN.LookitTweetShot=function(e){return{init:function(){e(".lookit-box-tweet").on("click",function(){window.location=e(this).data("href")})}}}(jQuery),jQuery(function(){SBN.LookitTweetShot.init()});var SBN=SBN||{};SBN.LivePromo=function(e){function t(){e(".m-live-promo").addClass("is-negative-color");var t=e(".m-live-promo .m-live-promo__logo img");t.attr("src",t.data("light-logo-url"))}return{init:function(){Chorus.EventDispatcher.subscribe("campaignReskinApplied",function(e){e.useLightLogo===!0&&t()})}}}(jQuery),jQuery(function(){SBN.LivePromo.init()});var SBN=SBN||{};SBN.Scoreboard=function(e){function t(e){var t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()]+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]+" "+e.getDate()+", "+e.getFullYear();return t}function n(e){var t=e.getHours(),n=e.getMinutes(),o=t>11?"PM":"AM",i=e.toString().split("(")[1].split(")")[0];return t=0==t?12:t>12?t-12:t,n=10>n?"0"+n:n,t+":"+n+o+" "+i}function o(e,t){w(),p(e),C()}function i(e,t){w(),a("there was an error loading the score")}function r(e,t){B=(new Date).getTime(),C()}function a(t){var n=T({message:t});e(".m-scoreboard__error-message").remove(),e(".m-scoreboard__meta").append(n),SBN.DismissableMessage.init(e(".m-scoreboard__error-message"))}function s(t){c(t);var n=e('.m-scoreboard[data-scoreboard-league="'+t+'"]');1==n.data("scoreboard-hide-if-empty")?(n.remove(),e('.m-scoreboard__link a[href*="/scoreboard/'+n.data("scoreboard-league")+'"]').parent().remove()):(n.find(".m-scoreboard__empty-league").remove(),n.append('<div class="m-scoreboard__empty-league">There are no games scheduled for today.</div>'))}function l(){e(".m-scoreboard .m-scoreboard__loading").html('<div class="m-scoreboard__empty-league">There were no events found that match the request.</div>')}function c(t){e('.m-scoreboard[data-scoreboard-event-id="'+t+'"] .m-scoreboard__loading, .m-scoreboard[data-scoreboard-league="'+t+'"] .m-scoreboard__loading').remove()}function u(n,o,i){var r="Scores for ";i&&"Day"!==i&&(r+="the "+i.toLowerCase()+" of "),r+=t(new Date(o.from)),i&&"Day"!==i&&(r+=" - "+t(new Date(o.until))),e('.m-scoreboard[data-scoreboard-league="'+n+'"] .m-scoreboard__date').html(r)}function d(o,i){var r=new Date(o.start_time);o.event_time=t(r)+" - "+n(r);var a=A(o),s=e('.m-scoreboard__box-score[data-scoreboard-event-id="'+o.id+'"]');if(s.length>0)return void s.replaceWith(a);var l=e('.m-scoreboard[data-scoreboard-event-id="'+o.id+'"] .m-scoreboard__table-attach, .m-scoreboard[data-scoreboard-league="'+i+'"] .m-scoreboard__table-attach');return l.length>0?void l.append(a):void console.warn("data was recieved that is an unrequested event id, or is part of a league that cannot be found in the dom. data = ",o,"league = ",i)}function h(e,t){return e=new Date(e.dateModified),t=new Date(t.dateModified),e>t?-1:t>e?1:0}function m(e){for(var t=[],n=[],o=[],i=[],r=[],a=0,s=e.length;s>a;a++)switch(e[a].status){case"mid-event":t.push(e[a]);break;case"post-event":o.push(e[a]);break;case"postponed":case"weather-delay":n.push(e[a]);break;case"pre-event":i.push(e[a]);break;default:r.push(e[a])}return t.sort(h).concat(n.sort(h),o.sort(h),i.sort(h),r.sort(h))}function f(e,t){void 0!==t&&(0===e.length?s(t):c(t));for(var n=m(e),o=0,i=n.length;i>o;o++)d(n[o],t),void 0===t&&c(n[o].id)}function p(e){f(e.events);for(var t in e.leagues)f(e.leagues[t],t);l()}function g(){var t=(new Date).getTime()-B,n=S-t,o=(Math.floor(n/6e4),Math.floor(n/1e3)%60);o=10>o?"0"+o.toString():o.toString(),e(".m-scoreboard__counter-bar").width(n/S*100+"%")}function v(){e(".m-scoreboard__counter-time").html("")}function b(){e.ajax({dataType:"jsonp",url:E.url,data:{ranges:E.ranges,events:E.events},timeout:1e4,success:o,error:i,complete:r})}function C(){w(),I=setInterval(g,x),j=setTimeout(y,S)}function y(){w(),b()}function w(){v(),clearInterval(I),clearTimeout(j)}var k="/sbn_scoreboard/ajax_leagues_and_events",S=3e5,x=1e3,A=null,T=null,E={url:k,ranges:{},events:[]},B=(new Date).getTime(),j=null,I=null;return{init:function(){var t=e(".m-scoreboard");t.length<1||(A=_.template(e("#scoreboard-boxscore-template").html()),T=_.template(e("#scoreboard-error-template").html()),t.each(function(){var t=e(this);if(t.data("scoreboard-event-id"))E.events.push(t.data("scoreboard-event-id"));else{var n=t.data("scoreboard-league"),o=t.data("scoreboard-date-range"),i=t.data("scoreboard-interval");E.ranges[n]=o,u(n,o,i)}}),b())}}}(jQuery),jQuery(SBN.Scoreboard.init);var SBN=SBN||{};SBN.SocialPromo=function(e){function n(e,t){Chorus.DataStore.set(e,t)}function o(e){return Chorus.DataStore.get(e)}function i(t){var o=e(".m-social-promo__unit");n("social-promo-hidden",1),o.remove()}function r(){var n=e(".m-social-promo__unit");if(!(n.length<1)){n.addClass("is-active"),n.find(".m-social-promo__close").on("click",function(e){e.preventDefault(),i("close")}),Chorus.EventDispatcher.subscribe("facebookSdkAvailable",function(){FB.Event.subscribe("edge.create",function(e){/ref=promo$/.test(e)&&i("like")})}),window.twttr=window.twttr||(t={_e:[],ready:function(e){t._e.push(e)}}),twttr.ready(function(e){e.widgets.createFollowButton(Chorus.Context.community_twitter_screen_name,document.getElementById("social-promo-twitter-follow-button"),function(t){e.events.bind("follow",function(e){null==e.target&&i("follow")})},{size:"medium",count:"horizontal"})}),jQuery(".m-live-promo").length>0&&e(".m-social-promo__subnav").remove();var o=e(document),r=function(){o.scrollTop()>=400&&(e(".m-social-promo__slideout").addClass("is-available"),window.clearInterval(a))},a=window.setInterval(r,5e3)}}Chorus.Context.ga_track_prefix?Chorus.Context.ga_track_prefix+"_trackEvent":"_trackEvent";return{init:function(){Util.isReferrerCurrentDomain()||"sbnation.com"===Chorus.Context.community_domain&&Util.isReferrerSocialDomain()||1===parseInt(o("social-promo-hidden"))||r()}}}(jQuery),jQuery(function(){SBN.SocialPromo.init()});var SBN=SBN||{};SBN.DismissableMessage=function(e){function t(e){e.removeClass("is-visible")}function n(n){event&&event.preventDefault&&event.preventDefault(),t(e(event.currentTarget))}function o(e){e.on("click",".dismiss",n)}return{init:function(t){o(t?t:e(".p-dismissible-message"))}}}(jQuery),SBN.NewsletterSignup=function(e){function t(){var t=e(".m-newsletter-signup form"),n=[],o=[];e("#selected-newsletters li").each(function(t,i){i=e(i),n.push(i.attr("data-list_id")),o.push(i.attr("data-team_id"))}),e("#lists_").val(n.toString()),e("#team_ids_").val(o.toString()),a(),e.ajax({type:"POST",url:t.attr("action"),data:t.serialize(),success:d,error:h})}function n(e){var t="li[data-list_id = '"+e.data("list_id")+"'][data-team_id = '"+e.data("team_id")+"']";return t}function o(t){var o=n(t);e(".m-newsletter-signup__section").find(o).addClass("is-selected"),e("#selected-newsletters").append('<li class="is-selectable is-selected" data-list_id="'+t.data("list_id")+'" data-team_id="'+t.data("team_id")+'">'+t.text()+"</li>")}function i(t){var o=n(t);e("#selected-newsletters").find(o).remove(),e(".m-newsletter-signup__section").find(o).removeClass("is-selected")}function r(){var t=e(".m-newsletter-signup__left-rail-field");return t.val().indexOf("@")<1?(s(),!1):!0}function a(){e("#newsletter_submit").val("Submiting").attr("disabled","disabled")}function s(){e("#newsletter_submit").after('<span class="p-err-msg">There appears to be a problem with that email address.</span>')}function l(){p||(Chorus.Analytics.event("email","signup",document.title),p=!0),e("#newsletter_submit").after('<span class="p-confirm-msg">Thank you for signing up!</span>')}function c(){e("#newsletter_submit").after('<span class="p-err-msg">There was an error with the request. Maybe your email is invalid?</span>')}function u(){e("#newsletter_submit").val("Sign Up").removeAttr("disabled"),e(".m-newsletter-signup .p-err-msg, .m-newsletter-signup .p-confirm-msg").remove()}function d(e){u(),l()}function h(e){u(),c()}function m(t){var n=e(t.currentTarget);n.hasClass("is-selected")?i(n):o(n)}function f(e){e.preventDefault(),u(),r()&&t()}var p=!1;return{init:function(){e(".m-newsletter-signup").on("click",".is-selectable",m),e("#newsletter_submit").on("click",f)}}}(jQuery),jQuery(function(){SBN.NewsletterSignup.init()});var SBN=SBN||{};SBN.SiteDirectory=function(e){function t(t){s.val().length<3?n():(u.hide(),d.each(function(t,n){var o=e(n),i=o.text().toUpperCase(),r=s.val().toUpperCase();o.toggle(i.indexOf(r)>=0)}))}function n(e){u.show(),d.show(),l.find(".is-selected").removeClass("is-selected"),l.find('a[href="#all"]').parent().addClass("is-selected")}function o(t){l.find(".is-selected").removeClass("is-selected"),l.find('a[href="#'+t+'"]').parent().addClass("is-selected"),u.hide(),d.hide(),e("#"+t).show().nextUntil("h2").show()}function i(e){e.preventDefault(),t(!0)}function r(t){t.preventDefault();var i=e(t.currentTarget).val();"all"===i?n():o(i)}function a(t){t.preventDefault();var i=e(t.currentTarget).attr("href").substr(1);"all"===i?n():o(i)}var s,l,c,u,d;return{init:function(){var t=e(".m-sitedir");t.length<1||(s=e("#blog-query"),c=e("#blog-select"),l=e("#blog-filter"),u=e(".m-sitedir .m-filter-pane__content").find("h2, h3, h4").not(".m-sitedir__entry-title"),d=e(".m-sitedir__entry"),s.on("keyup",_.debounce(i,500)),c.on("change",r),l.on("click","a",a))}}}(jQuery),jQuery(SBN.SiteDirectory.init);var SBN=SBN||{};SBN.Fanposts=function(e){function t(e){Chorus.Context.logged_in||(e.preventDefault(),Chorus.Auth.modal.open("login"))}return{init:function(){e(".m-fanpost-index__new-link, .m-rock-fanpost__new").on("click",t)}}}(jQuery),jQuery(function(){SBN.Fanposts.init()});var SBN=SBN||{};SBN.AutoTabs=function(e){function t(){return""!==window.location.hash?window.location.hash.substring(1):null}function n(e,t){e.find(".is-selected").removeClass("is-selected"),e.find('.m-autotabs__content[id="'+t+'"]').add(e.find('.p-tabs a[href="#'+t+'"]').closest("li")).addClass("is-selected")}function o(t){var n=t.find(".m-autotabs__content"),o='<ul class="p-tabs">[% _.each(data.tabs, function(tab) { %] <li><a href="#[%= tab.id %]">[%= tab.label %]</a></li> [% }); %]</ul>',i={tabs:_.map(n,function(t){var t=e(t);return{id:t.attr("id"),label:t.data("autotabs-label")}})},r=_.template(o,i),a=e(r);n.first().before(a)}function i(t){t.preventDefault();var o=e(t.currentTarget);n(o.closest(".m-autotabs"),o.attr("href").substring(1))}return{init:function(){var n=e(".m-autotabs");if(!(n.length<1)){n.each(function(){o(e(this))}),n.on("click",".p-tabs a",i);var r=t();null!==r?n.find('.p-tabs a[href="#'+r+'"]').trigger("click"):n.find(".p-tabs a").first().trigger("click")}}}}(jQuery),jQuery(SBN.AutoTabs.init);var SBN=SBN||{};SBN.FullArchive=function(e){
function t(t){r(e(t.currentTarget()).val())}function n(t){var n=e(t),o=e('.m-full-archive__entries[data-full-archive-year="'+n.data("full-archive-year")+'"][data-full-archive-month="'+n.data("full-archive-month")+'"]');o.replaceWith(n),SBN.UnreadComments.applyTo(n)}function o(e){alert("There was an error loading data from the server")}function i(t,i){e.ajax(a.entries_for_month_data,{data:{month:i,year:t},dataType:"html",timeout:1e4,error:o,success:n})}function r(e){window.location=a.entries_by_year.replace(":year",e.toString())}e(function(){SBN.FullArchive.init()});var a={entries_for_month_data:"/sbn_full_archive/entries_by_month",entries_by_year:"archives/full/:year"};return{init:function(){e(".m-full-archive").length<1||(e("select.m-full-archive__year").on("change",t),e(".m-full-archive__entries").each(function(){var t=e(this);i(t.data("full-archive-year"),t.data("full-archive-month"))}))}}}(jQuery),jQuery(function(){function e(e){if(e.videoId){var t="ooyala"===Chorus.VideoContext.getVideoById(e.videoId).provider_video_type;return Chorus.VideoContext.createPlayer(h,e.placement,{autoplay:t})}if(e.embedCode){var n=e.embedCode;return n=n.replace("&lt;","<"),n=n.replace("&gt;",">"),n=k(n).attr("width","100%").attr("height","100%").each(function(){var e=k(this);src=e.attr("src"),src+=src.indexOf("?")>-1?"&":"?",src=src.replace(/autoplay=\d/g,"")+"autoplay=1&",src=src.replace(/ap=false/g,"")+"ap=true",src=src.replace(/width=\d+/g,""),src=src.replace(/height=\d+/g,""),e.css({"background-color":"#222"}),e.attr("src",src)}),k("#"+h).html(n).closest(d).addClass(b)}setTimeout(function(){window.location.href=e.url},100)}function t(e){k(g).removeClass(v),e.addClass(v);var t=k(f);t.animate({scrollTop:t.scrollTop()+e.parent().position().top},{duration:500})}function n(e){var t={videoId:e.data("video-chorus-id")||null,placement:e.data("placement")},n=(e.parent().find("script").html()||"").match(/["'](embed-.+?)['"]/);return n&&(t.videoId=n[1]),e.data(_)&&(t.embedCode=e.data(_)),t.url=e.attr("href"),t}function o(e,t){function n(){e.siblings(".up")[0==e.scrollTop()?"removeClass":"addClass"]("is-active")}var o=e.scrollTop();t===!0?o-=e.height():o+=e.height(),e.animate({scrollTop:o},{duration:500,complete:n})}function i(t){t.preventDefault(),e(n(k(t.currentTarget)))}function r(o){o.preventDefault();var i=k(o.currentTarget);t(i),e(n(i))}function a(e){e.preventDefault(),k(e.currentTarget).siblings("a").trigger("click")}function s(e){e.stopPropagation(),e.preventDefault(),o(e.data.playlist,!0)}function l(e){e.stopPropagation(),e.preventDefault(),o(e.data.playlist,!1)}function c(){Chorus.Analytics.onElementView(S,function(){var e=S.find("a[data-placement]").map(function(){return this.getAttribute("data-placement")});Chorus.VideoContext.trackPlacementsInViewport(e)})}function u(){x.on("click",m,i),x.on("click","h3",a),k(g).on("click",r),t(k(g+"[data-"+C+'="'+x.find(m).data(C)+'"]')),k(f).each(function(){var e=k(this),t=e.find(p),n=t.height();if(n*t.length>e.height()){var o=k('<div class="'+y+'"><span>&#xF500;</span></div>').on("click",{playlist:e},s),i=k('<div class="'+w+'"><span>&#xF501;</span></div>').on("click",{playlist:e},l);e.after(o).after(i)}}),c()}var d=".m-video-browser",h="video-browser",m="a",f=".m-video-browser__playlist",p=".m-video-browser__item",g=".m-video-browser__item a",v="is-selected",b="is-playing",C="video-title",_="video-embed-code",y="m-video-browser__playlist_btn up",w="m-video-browser__playlist_btn is-active down",k=jQuery,S=k(d),x=S.find(".m-video-browser__player");S.length&&u()});var SBN=SBN||{};!function(e){var t=Chorus.VideoContext,n={autoplay:!1,onPlay:function(e){},callback:function(t){var n=e("#linkset_embed_stub");n.children("div").css({position:"absolute"}),n.find("object, embed, video").attr("width","100%").attr("height","100%"),n.find("div.OoyalaHtml5VideoPlayer").css({width:"100%",height:"100%"})}};SBN.VideoLinkset={ooyala:function(e,o){var i=t.addOoyalaVideo(e,o);t.createPlayer("linkset_embed_stub",i,n)},entryGroup:function(e,o){var i=t.findUnviewedVideo(e,o);t.addVideo(e),t.createPlayer("linkset_embed_stub",i.id,n)}}}(jQuery),jQuery(function(){function e(){"undefined"!=typeof r&&(a&&a.trigger("click"),s&&s.trigger("click"))}function t(t){a=l(".m-hero__player-exit");var n=l(".m-hero__player"),o=".m-hero-block__overlay";t.on("click",o,function(t){var o=l(this).parents(".m-hero-block"),i=o.data("chorus-video-id"),r=Chorus.VideoContext.getVideo(i);"ooyala"===r.provider_video_type&&(t.preventDefault(),e(),n.removeClass("hidden").addClass(h?"transition":"").find("[data-chorus-video-id="+i+"]").removeClass("hidden"),Chorus.VideoContext.createPlayer("hero-video",i,p))}),a.on("click",function(e){e.preventDefault();var t=l(this).parents(".m-hero-block"),o=t.data("chorus-video-id");n.addClass("hidden").find("[data-chorus-video-id="+o+"]").addClass("hidden"),r.destroy()}),t.each(function(){var e=l(this);Chorus.VideoContext.createViewportProxy(l("#hero-video"),e,e.data("chorus-video-id"))})}function n(t){s=l(".m-block__player-exit");var n=".m-block__player";t.on("click",".m-block__image > a",function(t){var o=l(this).parents(".m-block.video"),i=o.find(".m-block__body"),r=o.find(".m-block__image"),a=o.innerHeight(),s=o.data("chorus-video-id"),c="block-video-"+s,u=Chorus.VideoContext.getVideo(s),m=p;"ooyala"===u.provider_video_type&&(t.preventDefault(),e(),h&&f?(o.css("min-height",a).addClass("accelerate").find(n).removeClass("hidden").addClass("transition"),i.addClass("absolute"),r.addClass("full-width transition").on(d,function(e){r.off(d),Chorus.VideoContext.createPlayer(c,s,m)})):(o.css("min-height",a).find(n).removeClass("hidden"),i.addClass("absolute"),r.addClass("full-width"),Chorus.VideoContext.createPlayer(c,s,m)))}),s.on("click",function(e){e.preventDefault();var t=l(this).parents(".m-block.video"),o=t.find(".m-block__body"),i=t.find(".m-block__image");i.hasClass("full-width")&&(h&&f?(i.find(n).addClass("hidden"),i.removeClass("full-width").on(d,function(e){t.css("min-height","initial").removeClass("accelerate"),o.removeClass("absolute"),i.off(d)})):(i.find(n).addClass("hidden"),i.removeClass("full-width"),t.css("min-height","initial"),o.removeClass("absolute")),r.destroy())}),t.each(function(){var e=l(this),t=e.data("chorus-video-id");Chorus.VideoContext.createViewportProxy(l("#block-video-"+t),e,t)})}function o(){return window.location.host.indexOf(u)>-1}function i(){if(o()&&!m){var e=l(".m-hero-block.videopost"),i=l(".m-block.video");e.length&&t(e),i.length&&n(i)}}var r,a,s,l=jQuery,c=l("html"),u="sbnation",d="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",h=Util.UserAgentProfiler.isDesktop(),m=c.hasClass("ie8"),f=c.hasClass("csstransitions"),p={autoplay:!0,namespace:"INLINE",player_id:window.alternate_ooyala_player_id,callback:function(e){r=e}};i()});var SBN=SBN||{};SBN.FeatureVideo=function(e){var t={playButton:e(".m-video__link"),exitButton:e(".m-video__exit"),videoPane:e(".m-video__pane")},n=t.playButton.data("title"),o=function(e){e.preventDefault();var o=t.playButton.data("ooyala-id"),i=Chorus.VideoContext.addOoyalaVideo(o,n);t.videoPane.removeClass("hidden"),""!==o&&Chorus.VideoContext.createPlayer("video-pane",i,{autoplay:!0,callback:function(e){Chorus.VideoContext.ooyalaPlayer=e}})},i=function(e){e.preventDefault(),Chorus.VideoContext.ooyalaPlayer&&Chorus.VideoContext.ooyalaPlayer.destroy(),t.videoPane.addClass("hidden")},r=function(){t.playButton.on("click",o),t.exitButton.on("click",i)};return{init:r}}(jQuery),jQuery(SBN.FeatureVideo.init);var SBN=SBN||{};SBN.YahooRecommends=function(e){document.referrer.indexOf("yahoo")>-1?e(".yahoo-referral").addClass("show"):e(".no-referral").addClass("show")}(jQuery),Chorus.ModuleLoader=function(e){var t={};e(document).ready(function(){Chorus.ModuleLoader.init()});var n=function(t){e.ajax({type:"GET",url:"/chorus_page/delayed_load_cells",dataType:"json",contentType:"application/json",timeout:1e4,data:t,success:function(t){null!==t&&e.each(t,function(t,n){var o=e(e.parseHTML(n,document,!0)),i=o.data("sbn-module-name");e("#"+t).replaceWith(o),Chorus.EventDispatcher&&(Chorus.EventDispatcher.publish("moduleInserted",{modules:o}),i&&SBN[i]&&SBN[i].init())})}})},o=function(t){t=t||e(document);var o=[],i=Util.UserAgentProfiler.profile();if(t.find("[data-delayed-load-cell-key]").each(function(){var t=e(this);t.data("unless-profile-is")!==i&&o.push(t.data("delayed-load-cell-key"))}),0!=o.length){o.sort();for(var r=2e3,a=0,s=[],l=0,c=o.length;c>l;l++){var u=o[l],d=u.length;if(a+d>=r){var h={cells:JSON.stringify(s)};Chorus.Context.hub_id&&(h.hub_id=Chorus.Context.hub_id),Chorus.Context.entry_id&&(h.entry_id=Chorus.Context.entry_id),n(h),s=[u],a=0}else a+=d,s.push(u);if(l+1==c){var h={cells:JSON.stringify(s)};Chorus.Context.hub_id&&(h.hub_id=Chorus.Context.hub_id),Chorus.Context.entry_id&&(h.entry_id=Chorus.Context.entry_id),n(h)}}}};return t.init=function(){this.initUI()},t.initUI=function(){o()},t}(jQuery);var Chorus=Chorus||{};Chorus.EditoriallyManagedCell=function(e,t){"use strict";function n(e){for(var t={},n=e.serializeArray(),o=n.length-1;o>-1;o--){var i=n[o].name,r=n[o].value;t[i]?t[i]=_.flatten([t[i],r]):t[i]=r}return t}function o(e){alert("There was an error updating this cell. Please check your URL and/or that all fields are completed.")}function i(t){t.preventDefault();var n=e(t.currentTarget);a(n.closest(".chorus-emc__admin"),n.data("emc-action"),n.data("emc-data"))}function r(t){t.preventDefault();var o=e(t.currentTarget),i=o.closest("form");a(e('.chorus-emc__admin[data-emc-slug="'+i.data("emc-slug")+'"]'),"update",_.extend(n(i),{button_action:o.data("emc-action")}))}function a(t,n,i){var i=_.extend({slug:t.data("emc-slug"),bucket:t.data("emc-bucket")},i),r=c[n];if("edit"===n||"help"===n)Chorus.EventDispatcher.publish("modal_open",{method:a,url:r,data:i});else{var a="update"==n?"POST":"GET";s(t),e.ajax({method:a,url:r,data:i,success:function(n){Chorus.EventDispatcher.publish("modal_close");var o=e('.chorus-emc__content[data-emc-slug="'+t.data("emc-slug")+'"]');o.length>0&&o.replaceWith(n)},error:o})}}function s(t){e(t).find(".chorus-emc__content").html("Loading...")}function l(){e(t).on("click",".chorus-emc__admin *[data-emc-action]",i),e(t).on("click",".chorus-emc__form *[data-emc-action]",r)}var c={edit:"/editorially_managed_cells/handle_edit",update:"/editorially_managed_cells/handle_update",preview:"/editorially_managed_cells/preview",show_live:"/editorially_managed_cells/refresh",help:"/editorially_managed_cells/help"};return{init:l,urls:c}}(jQuery,document),jQuery(function(){Chorus.EditoriallyManagedCell.init()});var Chorus=Chorus||{};Chorus.EmcAdmin=function(e){function t(t,n){var o=t.find("input"),i=n.find("input");o.each(function(t){var n=e(this),o=e(i[t]),r=o.val();o.val(n.val()),n.val(r)})}function n(n){var o=e(n.currentTarget).closest("li"),i=o.prev("li");t(o,i)}function o(n){var o=e(n.currentTarget).closest("li"),i=o.next("li");t(o,i)}return{init:function(t){Chorus.Context.emc_admin!==!1&&($doc=e(document),$doc.on("click",".m-emc-admin__reorderable-list .up",n),$doc.on("click",".m-emc-admin__reorderable-list .down",o))}}}(jQuery),jQuery(function(){Chorus.EmcAdmin.init()});var SBN=SBN||{};SBN.ChannelBrowser=function(e){function t(){var e=r.width(),t=Math.floor((e-s)/(a+s));return{number:t,gutterWidth:1>=t?s:(e-s-t*a)/(t-1)}}function n(){console.log(t());var e=r.find(".m-channel-browser__ad");e.prevAll(".m-channel-browser__item").insertAfter(e),e.nextAll(".m-channel-browser__item:lt("+(t().number-1)+")").insertBefore(e)}function o(){for(var e=r.find(".m-channel-browser__item"),n=t(),o=n.number,i=n.gutterWidth-4,a=0,l=0,c=e.length;c>l;l++){var u=a===o-1,d=i;u&&(d=0),1>=o&&(d=s),e.eq(l).css("margin-right",d),a=u?0:a+1}}function i(e){n(),o()}var r,a=300,s=40;return{init:function(){r=e(".m-channel-browser"),r.length<1||(n(),o(),e(window).on("resize",_.debounce(i,500)))}}}(jQuery),jQuery(SBN.ChannelBrowser.init),jQuery(function(){function e(){if(sel=window.getSelection(),sel.rangeCount&&(range=sel.getRangeAt(0).cloneRange(),range.getClientRects)){var e=range.getClientRects(),t=e[e.length-1];if(t)return{x:t.right+l.scrollLeft()+5,y:t.top+l.scrollTop()+5}}return null}function t(e){a||(a=s(['<div class="m-share_selection_contextual">',"<h3>Share your selection with your interweb friends</h3>","<ul>",'<li><a href="#" class="p-button has-icon twitter" data-analytics-social="twitter" data-analytics-placement="selection">Tweet (<span id="contextual-chars"></span> char)</a></li>','<li><a href="#" class="p-button has-icon facebook" data-analytics-social="facebook" data-analytics-placement="selection">Share on Facebook</a></li>',"</ul>","</div>"].join("")).on("click","a",n),s("head").append('<script src="//connect.facebook.net/en_US/sdk.js"></script>')),a.find("#contextual-chars").text(window.getSelection().toString().length),a.css({top:e.y,left:e.x}),s("body").append(a)}function n(e){var t=s(e.currentTarget),n=t.attr("data-analytics-social"),i=Chorus.Context.entry_url||window.location.href,r="#";if("facebook"===n&&("undefined"!=typeof FB?(FB.ui({method:"feed",link:Chorus.Context.entry_url||window.location.href,caption:c},function(e){}),e.stopPropagation()):r="https://facebook.com/sharer.php?u="+i),"twitter"===n){var a=Chorus.Context.community_twitter_screen_name;r="https://twitter.com/intent/tweet?url="+i+"&text="+c,a&&(r+="&via="+a)}t.attr("href",r),_.delay(o,20)}function o(e){a&&a.detach()}function i(n){_.delay(function(){c=window.getSelection().toString();var n=e();c.length<1||!n?o():t(n)},100)}function r(){window.getSelection&&Chorus.Context.select_to_tweet!==!1&&s(".m-entry__intro, .m-entry__body").on("mouseup",i)}var a,s=jQuery,l=s(window),c="";r()}),function(e){function t(e){var t={};e=(e||"").replace(/^(\?|\&)/,"").split("&");for(var n=0;n<e.length;n++){var o=e[n].split("=");o.length>1&&(t[o[0]]=o[1])}return t}function n(n,o){var r=n.attr("href"),a=n.attr("data-url");if(a&&i[o]&&(r=i[o]+encodeURIComponent(a)),r&&"#"!==r[0]){var s=r.match(/(.*(?:\?|\&)(?:url|u)=)([^&]+)(.*)/),l=n.closest("[data-analytics-placement]").attr("data-analytics-placement"),c=decodeURIComponent(s[2]).split("?"),u=c[0].split("#"),d=u[0]||c[0],h=u[1]||"",m=e.extend({utm_campaign:location.hostname.replace(/(www\.)?(.+)\.com/,"$2"),utm_content:Chorus.Analytics.contentType()+(l?":"+l:""),utm_medium:"social",utm_source:o},t(c[1]),t(n.attr("data-params")));r=""==h.trim()?s[1]+encodeURIComponent(d+"?"+e.param(m))+s[3]:s[1]+encodeURIComponent(d+"?"+e.param(m)+"#"+h)+s[3],n.attr("href",r)}return r}var o,i={facebook:"http://www.facebook.com/share.php?u=",twitter:"https://twitter.com/intent/tweet?url=",pinterest:"https://www.pinterest.com/pin/create/button/?url="};e("[data-analytics-social]").on("click",function(t){var i,r,a=e(this),s=a.attr("data-analytics-social"),l=n(a,s),c=570,u=570;if(Chorus.Context.is_preview)return t.stopPropagation(),alert("Social buttons cannot be used during preview.");switch(s){case"facebook":u=279;break;case"twitter":u=279;break;case"linkedin":u=520;break;case"pinterest":c=u=750}if("#"!==l[0]&&"_blank"!==a.attr("target")&&"whatsapp"!==s){o&&o.close&&o.close(),r=screen.width/2-c/2,i=screen.height/2-u/2,o=window.open(l,"","width="+c+", height="+u+", top="+i+", left="+r),t.preventDefault();var d=window.open;window.open=function(){},setTimeout(function(){window.open=d},0)}}),function(e,t,n){function o(){var e,o=t.getElementsByTagName(n)[0],i=function(i,r){t.getElementById(r)||(e=t.createElement(n),e.src=i,e.id=r,o.parentNode.insertBefore(e,o))};Util.UserAgentProfiler.isAndroidLt3()||(i("https://connect.facebook.net/en_US/all.js#xfbml=1","fbjs"),i("https://platform.twitter.com/widgets.js","tweetjs"))}e.addEventListener?e.addEventListener("load",o,!1):e.attachEvent&&e.attachEvent("onload",o)}(window,document,"script"),function(){function t(){u();var e=c,t=o.scrollTop(),i=t>=a,r=!s||s>=t;c=i&&r&&!l,c!==e&&(Chorus.EventDispatcher.publish("fixedSocial",{isFixed:c,position:n.position()}),n.toggleClass("fixed",c))}var n=e("#chorus-social-fixed");if(n.length){n.appendTo("body");var o=e(window),i=e("#chorus-social-fixed-threshold"),r=e("#comments"),a=0,s=0,l=!1,c=!1,u=_.throttle(function(){Chorus.Environment.touch()&&(l=screen.width>window.innerWidth),i.length&&(a=i.offset().top),r.length&&(s=r.offset().top)},1500);e(document).on("scroll",_.throttle(t,150)),t()}}(),e("[data-shareable-content]").each(function(){var t=e(this),n=t.attr("data-original")||t.attr("src");if(!n){var o=this.currentStyle||window.getComputedStyle(this,!1);n=o&&o.backgroundImage.slice(4,-1)}if(n){var r="m-shareable-content",a=r+"__wrap",s=i.pinterest+encodeURIComponent(location.href)+"&media="+encodeURIComponent(n),l=Chorus.Environment.touch()?" touch":"";if(t.is("img")){var c=t.closest("."+a);t=c.length?c:t.wrap('<div class="'+a+'"></div>').parent()}else t.toggleClass(a,!0);t.prepend('<a href="'+s+'" class="'+r+"__pinterest"+l+'" data-analytics-social="pinterest"></a>')}})}(jQuery);var Chorus=Chorus||{};Chorus.MobileAdandSocialMediator=function(e){"use strict";function t(){e(a).css("display","none")}function n(){e(s).css("display","none")}function o(e){var o=e&&e.isFixed,i=e&&e.position&&e.position.top>100;!r&&o&&i&&(r=!0,t(),n())}function i(){Chorus.EventDispatcher.subscribe("fixedSocial",o,!0)}var r=!1,a=".krg-hov-wrapper",s=".crisp_Css_Ad_Cradle, .crispTopAdCradle";return{init:i}}(jQuery),jQuery(function(){Chorus.MobileAdandSocialMediator.init()});var Chorus=Chorus||{};Chorus.Tooltip=function(e){var t="tooltip-text",n="tooltip-class",o=function(t){return t.preventDefault(),e(this).data("tooltip-shown")||i(e(this)),!1},i=function(o){var i=o.data(t),a=o.data(n)||"tooltip",s="tool-tip-"+Math.round(1e3*Math.random());o.data("tooltip-shown",s);var l=o.offset().top+o.height(),c=o.offset().left,u=e("<span id='"+s+"' data-is-tooltip class='"+a+"'>"+i+"</span>");u.on("click",r),u.css({top:l,left:c,position:"absolute"}),Util.UserAgentProfiler.isMobile()&&u.css({left:0}),"undefined"!=typeof i&&""!==i&&(e(document.body).prepend(u),setTimeout(function(){u.addClass("shown")},200))},r=function(t){var n=e(this).data("tooltip-shown")||e(this).filter("is-tooltip").attr("id");if(n){var o=e("#"+n);e(this).removeData("tooltip-shown"),o.removeClass("shown"),setTimeout(function(){o.remove()},1e3)}},a=function(t){e(t).not("[data-tooltip-shown]").on("click",o),e(t).not("[data-tooltip-shown]").on("mouseover",o),e(t).on("mouseout",r)};return{attachTo:a,init:a}}(jQuery),jQuery(function(){Chorus.Tooltip.attachTo("[data-tooltip-text]"),jQuery(document).on("hymnal:render",function(e,t){var n=jQuery(t.ad.getElement()).find("[data-tooltip-text]");Chorus.Tooltip.attachTo(n)})});var Chorus=Chorus||{};Chorus.Modernizr.localstorage&&"object"==typeof sessionStorage&&(Chorus.GBSignal=function(e){"use strict";function t(){Util.isReferrerCurrentDomain()||(C.referralDomain=C.referralDomain||Util.getReferrerDomain())}function n(){C.pagesSeeninSession++}function o(){var e=new Date-new Date(2014,0,0),t=864e5;return Math.floor(e/t)}function i(){C.recordedSessionCount||(v.loyaltySessions.push(o()),C.recordedSessionCount=!0)}function r(){return v.loyaltySessions.length}function a(){var e=v.loyaltySessions.length;if(1>e)return 0;var t=(o()-p,0);for(var n in v.loyaltySessionTimes)v.loyaltySessionTimes.hasOwnProperty(n)&&(t+=v.loyaltySessionTimes[n]);return Math.ceil(t/e)}function s(){var e=o()-p,t={};for(var n in v.loyaltySessionTimes)v.loyaltySessionTimes.hasOwnProperty(n)&&n>e&&(t[n]=v.loyaltySessionTimes[n]);v.loyaltySessionTimes=t,v.loyaltySessions=_.reject(v.loyaltySessions,function(t){return e>t})}function l(){C.updatedAt=new Date,sessionStorage.setItem(f,JSON.stringify(C)),localStorage.setItem(f,JSON.stringify(v))}function c(){C=JSON.parse(sessionStorage.getItem(f)),v=JSON.parse(localStorage.getItem(f)),(null===C||"object"!=typeof C||new Date-C.updatedAt>g)&&(C={},e.extend(C,y)),(null===v||"object"!=typeof v)&&(v={},e.extend(v,b)),u()}function u(){for(var e in b)v[e]=v[e]||b[e];for(e in y)sessionStorage[e]=sessionStorage[e]||y[e]}function d(){if("undefined"!=typeof window.onbeforeunload){var t=new Date,n=function(){var e=Math.round((new Date-t)/1e3);v.loyaltySessionTimes[o()]=(v.loyaltySessionTimes[o()]||0)+e,l()};e(window).on("beforeunload",n)}}function h(){return{loyalty_bsg:r(),avgsestime_bsg:a(),firstimp_bsg:C.pagesSeeninSession,referral_bsg:C.referralDomain}}function m(){var e=[],t=h();for(var n in t)e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));var o="http://js.moatads.com/essencedigital34895338176918191/moatcontent.js?"+e.join("&"),i=document.getElementsByTagName("script")[0],r=document.createElement("SCRIPT");r.async=1,r.type="text/javascript",r.charset="UTF-8",r.src=o,i.parentNode.insertBefore(r,i)}var f="GBSignal",p=30,g=18e5,v={loyaltySessions:[],loyaltySessionTimes:{}},b={};e.extend(b,v);var C={referralDomain:null,pagesSeeninSession:0,recordedSessionCount:!1,updatedAt:new Date},y={};return e.extend(y,C),{init:function(){c(),d(),t(),s(),n(),i(),l(),m()},results:function(){return h()}}}(jQuery),Chorus.GBSignal.init());var Chorus=Chorus||{};Chorus.PrintRef=function(e){var t=function(){var t=e(".m-entry__top-header, .m-entry__body, .m-breaker-stream").find("a[href^='http']:visible"),n=_.map(t,function(t,n){return"<div>["+n+"] "+e(t).attr("href")+"</div>"}).join("");_.each(t,function(t,n){e(t).attr("data-ref-index",n)}),e(".l-container, .l-wrapper").after("<div class='print-ref' style='display: none;'>"+n+"</div>")},n=function(){e(".video-wrap, .p-scalable-video").attr("data-ref-message",window.location.href)};return{init:function(){setTimeout(function(){t(),n()},1e3)}}}(jQuery),jQuery(Chorus.PrintRef.init);var Chorus=Chorus||{};Chorus.UserMessaging=function(e){function t(e){e.on("webkittransitionend transitionend otransitionEnd mstransitionend transitionend",function(){e.remove()}),e.addClass("is-closed")}function n(n){n.preventDefault(),n.stopPropagation(),t(e(n.delegateTarget))}function o(){var t=e(".m-user-msg__notice");t.length>1&&i(),t.first().find(".m-user-msg__close").trigger("click")}function i(){s===!0&&(dur=e(".m-user-msg__notice_short").length>0?c:l,to=setTimeout(o,dur))}function r(){e(".m-user-msg__notice, .m-user-msg__error").on("click",".m-user-msg__close",n)}function a(){e(".m-user-msg__modal").each(function(){Chorus.EventDispatcher.publish("modal_open",{content:e(this)})})}var s="polygon"===Chorus.Context.network_slug,l=3e4,c=4e3;return{init:function(){e(".m-user-msg").length<1||(a(),r(),i())}}}(jQuery),jQuery(Chorus.UserMessaging.init);var Chorus=Chorus||{};Chorus.Modal=function(e){"use strict";function t(){if(null===y){var t=e(C());v.append(t),t.on("click",f),y=t.find(".m-chorus-modal__root").addBack(".m-chorus-modal__root").first()}}function n(){t(),v.addClass("chorus-modal-loading")}function o(){v.removeClass("chorus-modal-loading")}function i(){t(),v.addClass("chorus-modal-open")}function r(){v.removeClass("chorus-modal-open")}function a(t){n();t.data||{};t.success=function(e){t.content=e,s(t)},t.error=function(e,t){"abort"!==t&&alert("There was an error recieving data from the server."),o()},w.push(e.ajax(t))}function s(t){o(),i();var n=e(b(t));n.find(".m-chorus-modal__window-root").append(t.content),n.addClass(t.modalClass),n.data("chorus-modal-callbacks",t.callbacks),y.prepend(n),n.on("click","*[data-chorus-modal-action]",m),u("attach",n)}function l(e){e.remove(),0===y.children().length&&(r(),o())}function c(e){e.callbacks=e.callbacks||{},e.title=e.title||"Untitled Modal",e.content=e.content||null,e.modalClass=e.modalClass||null,e.url?a(e):null!==e.content&&s(e)}function u(e,t){var n=t.data("chorus-modal-callbacks");if("cancel_confirm"===e){if(!confirm("Are you sure you want to close this window?"))return;e="cancel"}"function"==typeof n[e]&&n[e](t),("cancel"==e||"close"==e)&&l(t)}function d(){for(Chorus.EventDispatcher.publish("modal_closed_by_modaljs"),e(".m-chorus-modal__window").each(function(){u("cancel",e(this))}),null!==y&&y.empty(),r(),o();w.length>0;)w.pop().abort()}function h(){k=!0;var t=e("#chorus-modal-window-template").html()||"",n=e("#chorus-modal-wrapper-template").html()||"";v=e("body"),b=_.template(t),C=_.template(n)}function m(t){t.preventDefault(),u(e(t.target).data("chorus-modal-action").toString().trim(),e(t.delegateTarget))}function f(t){e(t.target).is(y)&&d()}function p(e){k===!1&&h(),c(e)}function g(e){d()}var v,b,C,y=null,w=[],k=!1;return{init:function(){Chorus.EventDispatcher.subscribe("modal_open",p),Chorus.EventDispatcher.subscribe("modal_close",g)},open:function(e){Chorus.EventDispatcher.publish("modal_open",e)},close:function(e){Chorus.EventDispatcher.publish("modal_close",e)}}}(jQuery),Chorus.Modal.init();var shortcut={all_shortcuts:{},add:function(e,t,n){var o={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(n)for(var i in o)"undefined"==typeof n[i]&&(n[i]=o[i]);else n=o;var r=n.target;"string"==typeof n.target&&(r=document.getElementById(n.target));e=e.toLowerCase();var a=function(o){if(o=o||window.event,n.disable_in_input){var i;if(o.target?i=o.target:o.srcElement&&(i=o.srcElement),3==i.nodeType&&(i=i.parentNode),"INPUT"==i.tagName||"TEXTAREA"==i.tagName)return}o.keyCode?code=o.keyCode:o.which&&(code=o.which),o.key?character=o.key.toLowerCase():character=String.fromCharCode(code).toLowerCase(),188==code&&(character=","),190==code&&(character=".");var r=e.split("+"),a=0,s={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},l={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},c={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};o.ctrlKey&&(c.ctrl.pressed=!0),o.shiftKey&&(c.shift.pressed=!0),o.altKey&&(c.alt.pressed=!0),o.metaKey&&(c.meta.pressed=!0);for(var u=0;k=r[u],u<r.length;u++)"ctrl"==k||"control"==k?(a++,c.ctrl.wanted=!0):"shift"==k?(a++,c.shift.wanted=!0):"alt"==k?(a++,c.alt.wanted=!0):"meta"==k?(a++,c.meta.wanted=!0):k.length>1?l[k]==code&&a++:n.keycode?n.keycode==code&&a++:character==k?a++:s[character]&&o.shiftKey&&(character=s[character],character==k&&a++);return a!=r.length||c.ctrl.pressed!=c.ctrl.wanted||c.shift.pressed!=c.shift.wanted||c.alt.pressed!=c.alt.wanted||c.meta.pressed!=c.meta.wanted||(t(o),n.propagate)?void 0:(o.cancelBubble=!0,o.returnValue=!1,o.stopPropagation&&(o.stopPropagation(),o.preventDefault()),!1)};this.all_shortcuts[e]={callback:a,target:r,event:n.type},r.addEventListener?r.addEventListener(n.type,a,!1):r.attachEvent?r.attachEvent("on"+n.type,a):r["on"+n.type]=a},remove:function(e){e=e.toLowerCase();var t=this.all_shortcuts[e];if(delete this.all_shortcuts[e],t){var n=t.event,o=t.target,i=t.callback;o.detachEvent?o.detachEvent("on"+n,i):o.removeEventListener?o.removeEventListener(n,i,!1):o["on"+n]=!1}}},miuScript;!function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=!1,"string"==typeof settings&&(method=settings,params=extraSettings),options={id:"",nameSpace:"",root:"",previewHandler:!1,previewInWindow:"",previewInElement:"",previewAutoRefresh:!0,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:!1,previewParserPath:"",previewParserVar:"data",resizeHandle:!0,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]},$.extend(options,settings,extraSettings),options.root||$("script").each(function(e,t){miuScript=$(t).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/),null!==miuScript&&(options.root=miuScript[1])});var uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},matched=uaMatch(navigator.userAgent),browser={};return matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),this.each(function(){function localize(e,t){return t?e.replace(/("|')~\//g,"$1"+options.root):e.replace(/^~\//,options.root)}function init(){id="",nameSpace="",options.id?id='id="'+options.id+'"':$$.attr("id")&&(id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"'),options.nameSpace&&(nameSpace='class="'+options.nameSpace+'"'),$$.wrap("<div "+nameSpace+"></div>"),$$.wrap("<div "+id+' class="markItUp"></div>'),$$.wrap('<div class="markItUpContainer"></div>'),$$.addClass("markItUpEditor"),header=$('<div class="markItUpHeader"></div>').insertBefore($$),$(dropMenus(options.markupSet)).appendTo(header),footer=$('<div class="markItUpFooter"></div>').insertAfter($$),options.resizeHandle===!0&&browser.safari!==!0&&(resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var t,n,o=$$.height(),i=e.clientY;t=function(e){return $$.css("height",Math.max(20,e.clientY+o-i)+"px"),!1},n=function(e){return $("html").unbind("mousemove.markItUp",t).unbind("mouseup.markItUp",n),!1},$("html").bind("mousemove.markItUp",t).bind("mouseup.markItUp",n)}),footer.append(resizeHandle)),$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed),$$.bind("insertion.markItUp",function(e,t){t.target!==!1&&get(),textarea===$.markItUp.focused&&markup(t)}),$$.bind("focus.markItUp",function(){$.markItUp.focused=this}),options.previewInElement&&refreshPreview()}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;return $("li:hover > ul",ul).css("display","block"),$.each(markupSet,function(){var button=this,t="",title,li,j;if(title=button.key?(button.name||"")+" [Ctrl+"+button.key+"]":button.name||"",key=button.key?'accesskey="'+button.key+'"':"",button.separator)li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul);else{for(i++,j=levels.length-1;j>=0;j--)t+=levels[j]+"-";li=$('<li class="markItUpButton markItUpButton'+t+i+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'" tabindex="-1">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return!1}).bind("touchstart.markItUp",function(){(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))&&textarea.blur()}).bind("click.markItUp touchstart.markItUp",function(e){e.preventDefault()}).bind("mouseup touchend",function(){return button.call&&eval(button.call)(),markup(button),!1}).bind("mouseenter.markItUp",function(){$("> ul",this).show(),$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul),button.dropMenu&&(levels.push(i),$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu)))}}),levels.pop(),ul}function magicMarkups(e){return e?(e=e.toString(),e=e.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(e,t){var n=t.split("|!|");return altKey===!0?void 0!==n[1]?n[1]:n[0]:void 0===n[1]?"":n[0]}),e=e.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(e,t){var n=t.split(":!:");return abort===!0?!1:(value=prompt(n[0],n[1]?n[1]:""),null===value&&(abort=!0),value)})):""}function prepare(e){return $.isFunction(e)&&(e=e(hash)),magicMarkups(e)}function build(e){var t=prepare(clicked.openWith),n=prepare(clicked.placeHolder),o=prepare(clicked.replaceWith),i=prepare(clicked.closeWith),r=prepare(clicked.openBlockWith),a=prepare(clicked.closeBlockWith),s=clicked.multiline;if(""!==o)block=t+o+i;else if(""===selection&&""!==n)block=t+n+i;else{e=e||selection;var l=[e],c=[];s===!0&&(l=e.split(/\r?\n/));for(var u=0;u<l.length;u++){line=l[u];var d;(d=line.match(/ *$/))?c.push(t+line.replace(/ *$/g,"")+i+d):c.push(t+line+i)}block=c.join("\n")}return block=r+block+a,{block:block,openBlockWith:r,openWith:t,replaceWith:o,placeHolder:n,closeWith:i,closeBlockWith:a}}function markup(e){var t,n,o,i;if(hash=clicked=e,get(),$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:selection||"",caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey}),prepare(options.beforeInsert),prepare(clicked.beforeInsert),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.beforeMultiInsert),$.extend(hash,{line:1}),ctrlKey===!0&&shiftKey===!0){for(lines=selection.split(/\r?\n/),n=0,o=lines.length,i=0;o>i;i++)""!==$.trim(lines[i])?($.extend(hash,{line:++n,selection:lines[i]
}),lines[i]=build(lines[i]).block):lines[i]="";string={block:lines.join("\n")},start=caretPosition,t=string.block.length+(browser.opera?o-1:0)}else ctrlKey===!0?(string=build(selection),start=caretPosition+string.openWith.length,t=string.block.length-string.openWith.length-string.closeWith.length,t-=string.block.match(/ $/)?1:0,t-=fixIeBug(string.block)):shiftKey===!0?(string=build(selection),start=caretPosition,t=string.block.length,t-=fixIeBug(string.block)):(string=build(selection),start=caretPosition+string.block.length,t=0,start-=fixIeBug(string.block));""===selection&&""===string.replaceWith&&(caretOffset+=fixOperaBug(string.block),start=caretPosition+string.openBlockWith.length+string.openWith.length,t=string.block.length-string.openBlockWith.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length,caretOffset=$$.val().substring(caretPosition,$$.val().length).length,caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))),$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition}),string.block!==selection&&abort===!1?(insert(string.block),set(start,t)):caretOffset=-1,get(),$.extend(hash,{line:"",selection:selection}),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.afterMultiInsert),prepare(clicked.afterInsert),prepare(options.afterInsert),previewWindow&&options.previewAutoRefresh&&refreshPreview(),shiftKey=altKey=ctrlKey=abort=!1}function fixOperaBug(e){return browser.opera?e.length-e.replace(/\n*/g,"").length:0}function fixIeBug(e){return browser.msie?e.length-e.replace(/\r*/g,"").length:0}function insert(e){if(document.selection){var t=document.selection.createRange();t.text=e}else textarea.value=textarea.value.substring(0,caretPosition)+e+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}function set(e,t){if(textarea.createTextRange){if(browser.opera&&browser.version>=9.5&&0==t)return!1;range=textarea.createTextRange(),range.collapse(!0),range.moveStart("character",e),range.moveEnd("character",t),range.select()}else textarea.setSelectionRange&&textarea.setSelectionRange(e,e+t);textarea.scrollTop=scrollPosition,textarea.focus()}function get(){if(scrollPosition=textarea.scrollTop,document.selection)if(selection=document.selection.createRange().text,browser.msie){textarea.focus();var e=document.selection.createRange(),t=e.duplicate();for(t.moveToElementText(textarea),caretPosition=-1;t.inRange(e);)t.moveStart("character"),caretPosition++}else caretPosition=textarea.selectionStart;else caretPosition=textarea.selectionStart,selection=textarea.value.substring(caretPosition,textarea.selectionEnd);return selection}function preview(){"function"==typeof options.previewHandler?previewWindow=!0:options.previewInElement?previewWindow=$(options.previewInElement):!previewWindow||previewWindow.closed?options.previewInWindow?(previewWindow=window.open("","preview",options.previewInWindow),$(window).unload(function(){previewWindow.close()})):(iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>'),"after"==options.previewPosition?iFrame.insertAfter(footer):iFrame.insertBefore(header),previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]):altKey===!0&&(iFrame?iFrame.remove():previewWindow.close(),previewWindow=iFrame=!1),options.previewAutoRefresh||refreshPreview(),options.previewInWindow&&previewWindow.focus()}function refreshPreview(){renderPreview()}function renderPreview(){if(options.previewHandler&&"function"==typeof options.previewHandler)options.previewHandler($$.val());else if(options.previewParser&&"function"==typeof options.previewParser){var e=options.previewParser($$.val());writeInPreview(localize(e,1))}else""!==options.previewParserPath?$.ajax({type:"POST",dataType:"text",global:!1,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(e){writeInPreview(localize(e,1))}}):template||$.ajax({url:options.previewTemplatePath,dataType:"text",global:!1,success:function(e){writeInPreview(localize(e,1).replace(/<!-- content -->/g,$$.val()))}});return!1}function writeInPreview(e){if(options.previewInElement)$(options.previewInElement).html(e);else if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(t){sp=0}previewWindow.document.open(),previewWindow.document.write(e),previewWindow.document.close(),previewWindow.document.documentElement.scrollTop=sp}}function keyPressed(e){if(shiftKey=e.shiftKey,altKey=e.altKey,ctrlKey=e.altKey&&e.ctrlKey?!1:e.ctrlKey||e.metaKey,"keydown"===e.type){if(ctrlKey===!0&&(li=$('a[accesskey="'+(13==e.keyCode?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li"),0!==li.length))return ctrlKey=!1,li.triggerHandler("mouseup"),!1;if(13===e.keyCode||10===e.keyCode)return ctrlKey===!0?(ctrlKey=!1,markup(options.onCtrlEnter),options.onCtrlEnter.keepDefault):shiftKey===!0?(shiftKey=!1,markup(options.onShiftEnter),options.onShiftEnter.keepDefault):(markup(options.onEnter),options.onEnter.keepDefault);if(9===e.keyCode)return 1==shiftKey||1==ctrlKey||1==altKey?!1:-1!==caretOffset?(get(),caretOffset=$$.val().length-caretOffset,set(caretOffset,0),caretOffset=-1,!1):(markup(options.onTab),options.onTab.keepDefault)}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor"),$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$),$$.data("markItUp",null)}var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;if($$=$(this),textarea=this,levels=[],abort=!1,scrollPosition=caretPosition=0,caretOffset=-1,options.previewParserPath=localize(options.previewParserPath),options.previewTemplatePath=localize(options.previewTemplatePath),method)switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}else init()})},$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})},$.markItUp=function(e){var t={target:!1};return $.extend(t,e),t.target?$(t.target).each(function(){$(this).focus(),$(this).trigger("insertion",[t])}):void $("textarea").trigger("insertion",[t])}}(jQuery),window.Chorus||(Chorus={}),Chorus.Comments=_.extend({},Backbone.Events,{Collections:{},Models:{},Views:{},Mixins:{},autoUpdateTimeout:null,defaults:{ajaxParams:{},ajaxTimeout:15e3,alertErrors:!0,avatarBreakpointIndex:2,autoUpdateAlertMaxShown:5,autoUpdateAlertTimeShown:6500,autoUpdateEnabled:!1,buildAncestry:!0,currentAutoUpdateInterval:4e4,editTimeWindow:90,emptyUpdateTolerance:5,fastAutoUpdateInterval:3e4,flaggedThreshold:1,localClockOffset:null,markItUp:{onShiftEnter:{keepDefault:!1,replaceWith:"\n\n"},markupSet:[{name:"Bold",key:"B",closeWith:"*",openWith:"*"},{name:"Italic",key:"I",closeWith:"_",openWith:"_"},{name:"Strike through",key:"S",closeWith:"-",openWith:"-"},{name:"Spoilers",key:"F",openWith:"%(spoiler)",closeWith:"%"},{separator:"---------------"},{name:"Bulleted list",openWith:"* ",multiline:!0},{name:"Numeric list",openWith:"# ",multiline:!0},{separator:"---------------"},{name:"Picture",openWith:"![![Source:!:http://]!](",closeWith:")!"},{name:"Link",openWith:'"',closeWith:'(!(([![Title (Shown on hover)]!]))!)":[![Link:!:http://]!]',placeHolder:"Your text to link here..."},{separator:"---------------"},{name:"Quotes",openWith:"bq. "}],resizeHandle:!1},maxIndentationDepth:30,offsetHeight:Math.floor(.333*jQuery(window).height()),recommendedThreshold:1,renderChunkLength:200,renderTo:"#comments",scrollAnimationDuration:300,scrollBuffer:0,showAutoUpdateAlert:!0,showAvatars:!0,showSignatures:!0,showImages:!0,removeImages:!1,removeEmoji:!1,slowAutoUpdateInterval:6e4,sortMethod:"ancestry",startOnScroll:Chorus.Environment.currentBreakpoint().index>1},settings:{},initialize:function(e,t){return this.stop(),this.started=!1,this.context={},this.settings=_.extend({},this.defaults,this.settings,t),this.collection=new Chorus.Comments.Collections.Comments([],{entryId:e}),this.settings.renderTo&&(this.compileTemplates(),this.view=new Chorus.Comments.Views.Main({el:this.settings.renderTo,collection:this.collection}),this.view.render()),window.location.hash.match(/^#\d+$/)&&this.start(),this},initContext:function(e){this.context=e,this.settings.autoUpdateEnabled=this.settings.autoUpdateEnabled&&this.context.able_to_comment&&!this.context.comments_closed&&Chorus.Environment.currentBreakpoint().index>1,this.settings.autoUpdateEnabled&&this.startAutoUpdate()},start:function(){return this.started?void 0:(this.started=!0,this.listenTo(this,"ajaxSuccess",this.ajaxSuccess),this.listenTo(this,"ajaxError",this.ajaxError),this.collection.load(),this.trigger("start"),Chorus.Analytics&&Chorus.Analytics.eventAutoFormat("interaction","comment_load"),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("startComments"),this)},stop:function(){return this.view&&this.view.remove(),this.view=null,this.collection=null,this.started=!1,this.trigger("stop"),this.stopListening(),this},compileTemplates:function(){_.each(Chorus.Comments.Views,function(e){if(e.prototype.templateId){var t=jQuery("#"+e.prototype.templateId).html()||"";e.prototype.template=_.template(t)}})},scheduleAutoUpdate:function(e){if(this.settings.autoUpdateEnabled){var t;t=e.emptyUpdateCount<this.settings.emptyUpdateTolerance?this.settings.fastAutoUpdateInterval:this.settings.slowAutoUpdateInterval,this.settings.currentAutoUpdateInterval=t,clearTimeout(this.autoUpdateTimeout),this.autoUpdateTimeout=setTimeout(function(){e.update()},t)}},startAutoUpdate:function(){this.settings.autoUpdateEnabled=!0,this.listenTo(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate),this.scheduleAutoUpdate(this.collection)},stopAutoUpdate:function(){this.settings.autoUpdateEnabled=!1,this.stopListening(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate),clearTimeout(this.autoUpdateTimeout),this.autoUpdateTimeout=null},openModal:function(e){Chorus.EventDispatcher.publish("modal_open",{content:e})},closeModal:function(){Chorus.EventDispatcher.publish("modal_close")},ajaxSuccess:function(e,t,n,o){var i=Date.parse(n.getResponseHeader("Date")),r=((new Date).valueOf()-i.valueOf())/1e3,a=this.settings.localClockOffset;_.isNumber(a)?this.settings.localClockOffset=(a+r)/2:this.settings.localClockOffset=r},ajaxError:function(e,t,n,o){try{var i=JSON.parse(e.responseText);i.message&&this.settings.alertErrors&&alert(i.message)}catch(r){}}}),Chorus.Comments.Mixins.Ajax={urlFor:function(e){var t=this.urls[e];return t&&(t=t.replace(/:([^\/]+)/,_.bind(function(e,t){return this instanceof Backbone.Model?this.get(t):this[t]},this))),t},ajax:function(e,t){var n=this.urlFor(e);if(!n)throw"ArgumentError: No url specified for action: "+e;var o=this,i=_.extend({url:n,dataType:"json",context:this,timeout:Chorus.Comments.settings.ajaxTimeout},this.ajaxOptions||{},t);return i.data&&_.isObject(i.data)&&"POST"===i.type&&(i.contentType="application/json",i.data=JSON.stringify(i.data),i.processData=!1),i.error=function(n,r,a){t&&_.isFunction(t.error)&&t.error.call(i.context,o,a),o.trigger(e+"Error",o,a,n),Chorus.Comments.trigger("ajaxError",n,r,a,o)},i.success=function(n,r,a){t&&_.isFunction(t.success)&&t.success.call(i.context,o,n),o.trigger(e+"Success",o,n,a),Chorus.Comments.trigger("ajaxSuccess",n,r,a,o)},o.trigger(e+"Start",o),Chorus.Comments.trigger("ajaxStart",o),jQuery.ajax(i)}},Chorus.Comments.Models.Comment=Backbone.Model.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{ajaxOptions:{type:"POST"},urls:{preview:"/comments/preview_comment",post:"/comments/post_comment",edit:"/comments/edit_comment/:id",hide:"/comments/hide_comment/:id",flag:"/comments/flag_comment/:id",unflag:"/comments/unflag_comment/:id",recommend:"/comments/recommend_comment/:id",destroy:"/comments/destroy_comment/:id",loadFlaggings:"/comments/ajax_comment_flags/:id",blockUser:"/comments/block_user/:id"},initialize:function(){!Chorus.Comments.settings.buildAncestry||this.get("ancestry")&&this.get("depth")||this.buildAncestry(),this.listenTo(this,"change:id change:parent_id",this.buildAncestry),this.listenTo(this,"change:collapsed",this.collapseDescendants)},buildAncestry:function(){var e,t=function(e){return e=e.toString(),e.length>=10?e:new Array(10-e.length+1).join("0")+e},n=this.id?t(this.id):"preview",o=this.parent();o&&(n=o.get("ancestry")+"/"+n),e=n.split("/").length,e=Math.min(e,Chorus.Comments.settings.maxIndentationDepth),this.set({ancestry:n,depth:e},{silent:!0})},user:function(){return this.collection.users.get(this.get("user_id"))||new Chorus.Comments.Models.User({display_name:this.get("username")||"anonymous"})},parent:function(){var e=this.get("parent_id");return e?this.collection.get(e):null},ancestors:function(){if(!this.get("ancestry"))return[];var e=this.get("ancestry").split("/");return e.pop(),_.map(e,function(e){return e=parseInt(e,10),this.collection.get(e)},this)},descendants:function(){var e=new RegExp("^"+this.get("ancestry")+"/");return this.collection.filter(function(t){return e.test(t.get("ancestry"))})},matchesConditions:function(e){for(var t in e)if(e[t]!=this.get(t))return!1;return!0},findNeighbor:function(e,t,n){var o,i=this.collection.indexOf(this),r=this.collection.length-1,a=i;if(0===r)return null;do{if(a=n?a-1:a+1,!t&&(0>a||a>r))return null;if(0>a?a=r:a>r&&(a=0),o=this.collection.at(a),o&&o.matchesConditions(e))return o}while(a!==i);return null},prev:function(e,t){return this.findNeighbor(e,t,!0)},next:function(e,t){return this.findNeighbor(e,t,!1)},flaggings:function(){return this.collection.flaggings.where({flaggable_id:this.id})},isFlagged:function(){return this.get("bad_flags_count")>=Chorus.Comments.settings.flaggedThreshold},isRecommended:function(){return this.get("recommended_flags_count")>=Chorus.Comments.settings.recommendedThreshold},createFlagging:function(e){return this.collection.flaggings.add({flag_name:e,flaggable_id:this.id,user_id:Chorus.Comments.context.user_id,created_on:new Date})},secondsSinceCreate:function(){var e=Chorus.Comments.settings.localClockOffset||0,t=(new Date).getTime()/1e3;return t=Math.round(t-e),t-this.get("created_on_timestamp")},isEditable:function(){return this.get("user_id")===Chorus.Comments.context.user_id&&this.secondsSinceCreate()<Chorus.Comments.settings.editTimeWindow},isPreview:function(){return!this.id},toJSON:function(){var e,t=_.clone(this.attributes);return t.is_flagged=this.isFlagged(),t.is_recommended=this.isRecommended(),t.is_editable=this.isEditable(),t.is_preview=this.isPreview(),t.permalink=this.getAbsoluteURL("permalink"),t.shortlink=this.getAbsoluteURL("shortlink"),Chorus.Environment.currentBreakpoint().index<2?t.created_on=this.get("created_on_short"):t.created_on=this.get("created_on_long"),e=this.user(),e&&(t.user=e.toJSON(!0)),t},getAbsoluteURL:function(e){return window.location.origin+this.get(e)},preview:function(){return this.ajax("preview",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(e,t){e.collection.users.add(t,{parse:!0}),e.set(t.comments[0])}})},post:function(){var e=this.get("body");return e&&this.set("rawBody",e),this.ajax("post",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(e,t){e.collection.users.add(t,{parse:!0}),e.set(t.comments[0]),e.collection.add(e)}})},edit:function(e){return e.body&&this.set("rawBody",e.body),this.ajax("edit",{data:{entry_id:this.collection.entryId,comment:e},success:function(e,t){e.set(t.comments[0])}})},hide:function(){var e={},t=this.descendants();return _.each(t,function(t){e[t.id]=t.get("hidden"),t.set("hidden",!0)}),this.set("hidden",!0),this.ajax("hide",{error:function(n){n.set("hidden",!1),_.each(t,function(t){t.set("hidden",e[t.id])})}})},unhide:function(){return this.set("hidden",!1),this.ajax("hide",{error:function(e){e.set("hidden",!0)}})},flag:function(e){var t=this.createFlagging("inappropriate");return this.set({is_flagged_by_user:!0,bad_flags_count:this.get("bad_flags_count")+1}),this.ajax("flag",{data:e,error:function(e){e.set({is_flagged_by_user:!1,bad_flags_count:e.get("bad_flags_count")-1}),e.collection.flaggings.remove(t)}})},unflag:function(){var e=this.flaggingsLoaded,t=this.flaggings();return this.flaggingsLoaded=!1,this.collection.flaggings.remove(t),this.set({is_flagged_by_user:!1,bad_flags_count:this.get("bad_flags_count")-1}),this.ajax("unflag",{error:function(n){n.set({is_flagged_by_user:!0,bad_flags_count:n.get("bad_flags_count")+1}),n.collection.flaggings.add(t),n.flaggingsLoaded=e}})},recommend:function(){var e=this.createFlagging("recommended");return this.set({is_recommended_by_user:!0,recommended_flags_count:(this.get("recommended_flags_count")||0)+1}),this.ajax("recommend",{error:function(t){t.set({is_recommended_by_user:!1,recommended_flags_count:t.get("recommended_flags_count")-1}),t.collection.flaggings.remove(e)}})},unrecommend:function(){var e=this.flaggings();return this.collection.flaggings.remove(e),this.set({is_recommended_by_user:!1,recommended_flags_count:this.get("recommended_flags_count")-1}),this.ajax("unflag",{error:function(t){t.set({is_recommended_by_user:!0,recommended_flags_count:t.get("recommended_flags_count")+1}),t.collection.flaggings.add(e)}})},destroy:function(){var e=this.collection,t=this.descendants();return e.remove(t),e.remove(this),this.ajax("destroy",{error:function(n){e.add(n),e.add(t)}})},loadFlaggings:function(){return this.ajax("loadFlaggings",{type:"GET",success:function(e,t){e.collection.users.add(t,{parse:!0,merge:!0}),e.collection.flaggings.add(t,{parse:!0,merge:!0}),e.flaggingsLoaded=!0}})},collapseDescendants:function(e,t){t?_.each(this.descendants(),function(e){e.get("collapsedAncestorId")||e.set("collapsedAncestorId",this.id)},this):_.each(this.descendants(),function(e){e.get("collapsedAncestorId")===this.id&&e.set("collapsedAncestorId",null)},this)},blockUser:function(){var e=this.user(),t=this.collection,n=t.where({user_id:this.get("user_id")});return t.remove(n),t.users.remove(e),this.ajax("blockUser",{error:function(){t.users.add(e),t.add(n)}})}})),Chorus.Comments.Models.Flagging=Backbone.Model.extend({initialize:function(){this.set("created_on_timestamp",Math.round(new Date(this.get("created_on")).getTime()/1e3))},user:function(){return this.collection.users.get(this.get("user_id"))},flaggable:function(){return this.collection.comments.get(this.get("flaggable_id"))},toJSON:function(){var e=_.clone(this.attributes),t=this.user(),n=new Date(this.get("created_on")).toLocaleString();return e.created_on=n,t&&(e.user=t.toJSON()),e}}),Chorus.Comments.Models.User=Backbone.Model.extend({initialize:function(){var e=this.get("author_profile"),t=this.get("network_membership"),n=this.get("membership");e?this.set({profile_image:this.get("author_profile").image_url,profile_url:this.get("author_profile").url}):t&&this.set({profile_image:t.image_url,profile_url:t.url}),n&&this.set({inspect_user_url:n.inspect_user_url})},isAuthor:function(){return Chorus.Comments.context.author_id===this.id},isContributor:function(){return _.indexOf(Chorus.Comments.context.contributor_ids,this.id)>-1},toJSON:function(){var e=_.clone(this.attributes);return e.is_author=this.isAuthor(),e.is_contributor=this.isContributor(),e}}),Chorus.Comments.Collections.Comments=Backbone.Collection.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{model:Chorus.Comments.Models.Comment,urls:{load:"/comments/load_comments/:entryId",update:"/comments/ajax_comments_update/:entryId"},loaded:!1,lastRequestId:0,emptyUpdateCount:0,initialize:function(e,t){return this.entryId=t.entryId,this.users=new Chorus.Comments.Collections.Users,this.flaggings=new Chorus.Comments.Collections.Flaggings([],{users:this.users,comments:this}),this.listenTo(this,"add",this.findCollapsedAncestor),this},comparator:function(e,t){switch(Chorus.Comments.settings.sortMethod){case"ancestry":var n=e.get("ancestry"),o=t.get("ancestry");return o>n?-1:n>o?1:0;case"forward-chron":return e.get("created_on_timestamp")===t.get("created_on_timestamp")?e.get("id")-t.get("id"):e.get("created_on_timestamp")-t.get("created_on_timestamp");case"reverse-chron":return e.get("created_on_timestamp")===t.get("created_on_timestamp")?t.get("id")-e.get("id"):t.get("created_on_timestamp")-e.get("created_on_timestamp")}},parse:function(e){return e.comments||[]},load:function(){return this.ajax("load",{timeout:null,data:_.extend({t:(new Date).getTime()},Chorus.Comments.settings.ajaxParams),success:function(e,t){Chorus.Comments.initContext(t.context),e.loaded=!0,e.lastId=t.last_id,e.lastVersion=t.last_version,e.users.reset(t,{parse:!0}),e.flaggings.reset(t,{parse:!0}),e.reset(t,{parse:!0})}})},update:function(){return this.lastRequestId+=1,this.ajax("update",{data:_.extend({request_id:this.lastRequestId,last_id:this.lastId,last_version:this.lastVersion},Chorus.Comments.settings.ajaxParams),success:function(e,t){return e.lastRequestId!==t.last_request_id?void console.warn("Failed to update comments: updates arrived out of order"):(e.lastId=t.last_id,e.lastVersion=t.last_version,t.comments.length?e.emptyUpdateCount=0:e.emptyUpdateCount++,_.each(t.deleted_comment_ids,function(t){var n=e.get(t);n&&(e.remove(n.descendants()),e.remove(n))}),e.users.add(t,{parse:!0}),e.add(t,{parse:!0}),void e.flaggings.add(t,{parse:!0}))},error:function(e,t){e.emptyUpdateCount++}})},findCollapsedAncestor:function(e){var t=_.find(e.ancestors().reverse(),function(e){return e.get("collapsed")});t&&(e.set("collapsedAncestorId",t.id),t.trigger("change"))}})),Chorus.Comments.Collections.Flaggings=Backbone.Collection.extend({model:Chorus.Comments.Models.Flagging,initialize:function(e,t){this.users=t.users,this.comments=t.comments},parse:function(e){return e.flaggings||[]}}),Chorus.Comments.Collections.Users=Backbone.Collection.extend({model:Chorus.Comments.Models.User,parse:function(e,t){return e.users||[]},current:function(){return this.get(Chorus.Comments.context.user_id)}}),Chorus.Comments.Views.AccountActions=Backbone.View.extend({id:"",className:"",templateId:"comment-account-actions-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.AutoUpdateAlert=Backbone.View.extend({id:"autoupdate_info",templateId:"comment-auto-update-alert-template",events:{"click .close":"hide","click .go_to_comment":"goToComment"},initialize:function(e){this.listenTo(this.collection,"updateSuccess",this.show)},render:function(){return this.$el.hide(),this.trigger("render",this),this},show:function(e,t){if(Chorus.Comments.settings.showAutoUpdateAlert!==!1){var n=[];if(_.each(t.comments,function(t){if(t.user_id!==Chorus.Comments.context.user_id){var o=e.get(t.id),i=o.toJSON(),r=o.parent();r&&(i.parent=r.toJSON()),n.push(i)}}),0!==n.length){var o=this.template({comments:n,settings:Chorus.Comments.settings});this.$el.html(o).fadeIn(1e3),setTimeout(_.bind(this.hide,this),Chorus.Comments.settings.autoUpdateAlertTimeShown)}}},hide:function(){return this.$el.fadeOut(500),!1},goToComment:function(e){var t=e.currentTarget.getAttribute("data-comment-id");return Chorus.Comments.trigger("activateComment",t),!1}}),Chorus.Comments.Views.BaseForm=Backbone.View.extend({events:{"submit form":"submit","click .post_comment_button":"post","click .preview_comment_button":"preview","click .cancel_comment_button":"cancel","focusin textarea":"hideTouchTools","focusout textarea":"showTouchTools"},renderPreview:function(e){return this.previewView?this.previewView.model=e:this.previewView=new Chorus.Comments.Views.Comment({model:e}),this.previewView.render().$el.prependTo(this.el),this.$(".preview-controls").show(),this.$(".preview_comment_button").prop("disabled",!1).val("Preview"),this},formData:function(){var e=this.$("form").serializeArray(),t={};return _.each(e,function(e){t[e.name]=e.value}),t},submit:function(){return this.previewView?this.post():this.preview(),!1},post:function(){var e=this.$(".post_comment_button");e.prop("disabled",!0).val(this.submitText+"ing...");var t=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});return t.once("postSuccess",function(){this.cancel()},this),t.once("postError",function(){e.prop("disabled",!1).val(this.submitText)},this),t.post(),!1},preview:function(){var e=this.$(".preview_comment_button");e.prop("disabled",!0).val("Previewing...");var t=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});return t.once("previewSuccess",this.renderPreview,this),t.once("previewError",function(){e.prop("disabled",!1).val("Preview")},this),t.preview(),!1},remove:function(){return this.previewView&&(this.previewView.remove(),this.previewView=null),Backbone.View.prototype.remove.call(this)},hideTouchTools:function(){"undefined"!=typeof Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.hide()},showTouchTools:function(){"undefined"!=typeof Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.show()}}),Chorus.Comments.Views.Comment=Backbone.View.extend({templateId:"comment-template",events:{"click .reply_link":"reply","click .edit_link":"edit","click .flag_link":"toggleFlagged","click .rec_link":"toggleRecommended","click .delete_link":"destroy","click .hide_link":"toggleHidden","click .up_link":"activateParent","click .actions_toggle":"toggleActions","click .inspect_flags_link":"inspectFlags","click .inspect_user_link":"inspectUser","click .block_user_link":"blockUser","click .collapse_toggle":"toggleCollapsed","click .image_toggle .message":"toggleImage"},renderTriggers:["id","parent_id","title","body","user_id","signature","hidden","created_on_long","created_on_short","created_on_timestamp","recommended_flags_count","is_recommended_by_user","troll_flags_count","spam_flags_count","inappropriate_flags_count","bad_flags_count","is_flagged_by_user"],initialize:function(){return this.listenTo(this.model,"change:"+this.renderTriggers.join(" change:"),this.render),this.listenTo(this.model,"change",this.regenerateWrapperClass),this.listenTo(this.model,"markRead",this.markCollapsedDescendantsRead),this.listenTo(this.model,"remove",this.remove),this},className:function(){var e=this.model.toJSON(),t=Chorus.Comments.context,n=[],o=function(e,t){t?n.push(e):n=_.without(n,e)};return this.el&&this.el.className&&(n=n.concat(this.el.className.split(" "))),o("citem",!0),o("cdepth-"+e.depth,!0),o("recommended",e.is_recommended),o("flagged",t.able_to_moderate&&e.is_flagged),o("new",e.is_new),o("hidden",e.hidden),o("obscured",e.obscured),o("collapsed",e.collapsed),o("collapsed-child",e.collapsedAncestorId),o("moderator",e.is_posted_by_moderator),o("preview",e.is_preview),_.uniq(n).join(" ")},attributes:function(){return{id:this.model.id}},delegateEvents:function(){},hasProfilePicture:function(){return this.model.user().get("profile_image")&&Chorus.Environment.currentBreakpoint().index>=Chorus.Comments.settings.avatarBreakpointIndex&&Chorus.Comments.settings.showAvatars},render:function(){var e=this.model.toJSON();return this.$el.html(this.template({view:this,context:Chorus.Comments.context,settings:Chorus.Comments.settings,comment:e})),this.model.isEditable()&&this.updateEditCountdown(),Chorus.Comments.settings.removeImages?this.removeImages():this.makeImagesHideable(),Chorus.Comments.settings.removeEmoji&&this.$(".cbody img.emoji").each(function(){jQuery(this).replaceWith(this.getAttribute("alt"))}),this.replyForm&&(this.$el.append(this.replyForm.el),this.replyForm.delegateEvents()),this.trigger("render",this),this},makeImagesHideable:function(){var e=this.$(".cbody img:not(.emoji)");e.wrap('<span href="#" class="image_toggle"></span>').parent().toggleClass("hidden",!Chorus.Comments.settings.showImages).append('<span class="message"></span>'),Chorus.Modernizr.localstorage&&e.each(function(){var e=jQuery(this);localStorage.getItem(e.attr("src"))&&e.parent().addClass("hidden")})},removeImages:function(){this.$(".cbody img:not(.emoji)").remove()},toggleImage:function(e){if(jQuery(e.currentTarget).parent().toggleClass("hidden"),Chorus.Modernizr.localstorage){var t=jQuery(e.currentTarget).parent(),n=t.find("img").attr("src");t.hasClass("hidden")?localStorage.setItem(n,"hidden"):localStorage.removeItem(n)}return!1},renderReplyCounts:function(){var e=this.model.descendants(),t=e.length;if(t>0){var n=_.filter(e,function(e){return e.get("is_new")}).length,o=1===t?"1 reply":t+" replies";n>0&&(o+=", "+n+" new"),this.$(".reply_count").text(o)}},regenerateWrapperClass:function(){this.$el.attr("class",this.className())},updateEditCountdown:function(){var e=Chorus.Comments.settings.editTimeWindow-this.model.secondsSinceCreate();e>0?(this.$(".countdown_timer").text(Math.round(e)),this.$(".countdown_timer_bar").width(100*(e/Chorus.Comments.settings.editTimeWindow)+"%"),setTimeout(_.bind(this.updateEditCountdown,this),1e3)):(this.$(".edit_link").remove(),this.$(".countdown_timer").text(""),this.$(".countdown_timer_bar").remove())},reply:function(){if(Chorus.Comments.context.user_id)if(Chorus.Comments.context.able_to_comment)this.replyForm||(this.replyForm=new Chorus.Comments.Views.ReplyForm({model:this.model,collection:this.model.collection}),this.replyForm.renderTo(this.el),this.listenTo(this.replyForm,"cancel",function(){this.replyForm=null}));else{var e=jQuery("#comment_tease, #comments .m-user-msg__account-action, #comments .m-user-msg__membership_required").offset();e&&jQuery("html, body").animate({scrollTop:e.top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})}else Chorus.Auth.modal.open("login");return!1},edit:function(){this.$el.addClass("ui-state-editing");var e=new Chorus.Comments.Views.EditForm({model:this.model});return e.render().$el.prependTo(this.el),e.once("cancel",function(){this.$el.removeClass("ui-state-editing")},this),!1},toggleHidden:function(){var e=this.model.get("hidden"),t=_.any(this.model.ancestors(),function(e){return e.get("hidden")});return t?alert("You can't "+(e?"unhide":"hide")+" this comment, because its parents are already hidden."):e?this.model.unhide():this.model.hide(),!1},destroy:function(){var e=confirm("You're about to delete this comment and all its replies. Are you sure?");return e===!0&&this.model.destroy(),!1},blockUser:function(){var e=["Spam ban is to be used exclusively for obvious spam, and not for normal moderation of community members.","","This action will ban the user from all Chorus communities (not just this one) and delete their comments. It is not reversible."].join("\n");return confirm(e)&&("BAN"==prompt("Enter the word 'BAN' (all caps) to confirm.")?this.model.blockUser():alert("Confirmation did not match.")),!1},toggleActions:function(){return this.$el.toggleClass("ui-state-tools-active"),!1},toggleRecommended:function(){return this.model.get("is_recommended_by_user")?this.model.unrecommend():this.model.recommend(),!1},toggleFlagged:function(){return this.model.get("is_flagged_by_user")?this.model.unflag():new Chorus.Comments.Views.FlagDialog({model:this.model}).render(),!1},inspectFlags:function(){return new Chorus.Comments.Views.InspectFlagsDialog({model:this.model}).render(),!1},inspectUser:function(){var e=this.model.user();return window.open(e.get("inspect_user_url")),!1},toggleCollapsed:function(){return this.model.get("collapsed")?this.uncollapse():(this.collapse(),this.renderReplyCounts()),!1},collapse:function(){this.model.set("collapsed",!0)},uncollapse:function(){this.model.set("collapsed",!1)},activate:function(){this.$el.addClass("active"),jQuery("html, body").stop(!0).animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})},activateParent:function(){var e=this.model.parent();return e&&Chorus.Comments.trigger("activateComment",e.id),!1},deactivate:function(){this.$el.removeClass("active")},markCollapsedDescendantsRead:function(){this.model.get("collapsed")&&(_.each(this.model.descendants(),function(e){e.set("is_new",!1)}),this.renderReplyCounts())}}),Chorus.Comments.Views.CommentList=Backbone.View.extend({id:"comments_list",className:"comment_master_list",childSelector:".citem",childView:Chorus.Comments.Views.Comment,shortcuts:{"Shift+a":"markAllRead","Shift+c":"activatePrev",c:"activateNext",j:"activateNext",k:"activatePrev",x:"markRead",z:"markReadAndActivateNext",r:"replyToCurrent"},initialize:function(){this.childViews={},this.listenTo(this.collection,"loadSuccess",this.renderAll),this.listenTo(this.collection,"add",this.renderOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"loadSuccess add",this.renderEmbeds),this.listenTo(Chorus.Comments,"activateComment",this.activateId),
this.listenTo(this,"renderAll",this.activateHash),_.each(this.shortcuts,function(e,t){shortcut.add(t,_.bind(this[e],this),{disable_in_input:!0,type:"keypress"})},this)},render:function(){return this},delegateEvents:function(){return _.each(this.childView.prototype.events,function(e,t){var n=t.match(/^(\S+)\s+(.+)$/),o=n[1],i=n[2],r=this.childViews,a=this.childSelector;this.$el.on(o+".delegateEvents",a+" "+i,function(t){var n=jQuery(this).closest(a),o=r[n.attr("id")];return o?o[e].call(o,t):void 0})},this),Backbone.View.prototype.delegateEvents.call(this)},removeAll:function(){return this.$el.empty(),this.trigger("removeAll",this),this.childViews={},this},removeOne:function(e){var t=this.childViews[e.id];return t&&t.remove(),delete this.childViews[e.id],this.trigger("removeOne",this,t,e),this},renderAll:function(){var e=Chorus.Comments.settings;return this.renderPage(0,e.renderChunkLength)},renderPage:function(e,t){var n=(Chorus.Comments.settings,_.map(this.collection.slice(e,t),function(e){return this.renderOne(e,!1).el},this));if(this.$el.append(n),this.trigger("renderPage",this,e,t),t<this.collection.length){e=t,t=Math.min(this.collection.length,e+Chorus.Comments.settings.renderChunkLength);var o=function(){this.renderPage(e,t)};setTimeout(_.bind(o,this),0)}else this.trigger("renderAll",this);return this},renderOne:function(e,t){var n=this.childViews[e.id]||new this.childView({model:e});if(this.childViews[e.id]=n.render(),t){for(var o,i=this.collection.length,r=this.collection.indexOf(e)+1;!o&&i>r;)o=this.collection.at(r++),o=o&&this.childViews[o.id];o?o.$el.before(n.el):this.$el.append(n.el),this.trigger("renderOne",this,n,e)}return n},renderEmbeds:function(){window.twttr&&window.twttr.widgets&&_.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load()},activeModel:function(){return this.activeId?this.collection.get(this.activeId):null},activeView:function(){return this.activeId?this.childViews[this.activeId]:null},activateId:function(e){var t=this.activeView(),n=this.childViews[e];return t&&t.deactivate(),n&&(n.$el.hasClass("collapsed-child")?this.activateId(n.model.get("parent_id")):(n.activate(),this.activeId=e)),this},activateHash:function(){var e=window.location.hash.match(/^#(\d+)$/);e&&setTimeout(_.bind(this.activateId,this,e[1]),1e3)},activateNeighbor:function(e){var t,n=this.activeModel();if(n)t=n[e]({is_new:!0},!0);else for(t="next"===e?this.collection.first():this.collection.last();t&&!t.get("is_new");)t=t[e]();return t?this.activateId(t.id):void 0},activatePrev:function(){this.collection.loaded?this.activateNeighbor("prev"):this.loadThenRun("activatePrev")},activateNext:function(){this.collection.loaded?this.activateNeighbor("next"):this.loadThenRun("activateNext")},markRead:function(){var e=this.activeModel(),t=this.activeView();e&&(e.set("is_new",!1),e.trigger("markRead")),t&&t.deactivate()},markAllRead:function(){_.each(this.collection.where({is_new:!0}),function(e){e.set("is_new",!1)})},markAllUnread:function(){this.collection.each(function(e){e.set("is_new",!0)}),this.activeId||(this.activeId=this.collection.first().id)},markReadAndActivateNext:function(){this.collection.loaded?(this.markRead(),this.activateNext()):this.loadThenRun("markReadAndActivateNext")},replyToCurrent:function(){var e=this.activeView();e&&e.reply()},loadThenRun:function(e){jQuery("html, body").animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.animationDuration}),Chorus.Comments.settings.startOnScroll||Chorus.Comments.start(),this.listenToOnce(this.collection,"loadSuccess",this[e])}}),Chorus.Comments.Views.CommentsClosedNotice=Backbone.View.extend({templateId:"comments-closed-notice-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.EditForm=Backbone.View.extend({className:"cedit cform",templateId:"comment-edit-form-template",events:{"submit form":"submit","click .post_edit_button":"submit","click .cancel_edit_button":"cancel"},render:function(){return this.$el.html(this.template({comment:this.model.toJSON()})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp),this.trigger("render",this),this},formData:function(){var e=this.$("form").serializeArray(),t={};return _.each(e,function(e){t[e.name]=e.value}),t},submit:function(){var e=this.$(".post_edit_button");return e.prop("disabled",!0).val("Saving..."),this.model.once("editSuccess",function(){this.cancel()},this),this.model.once("editError",function(){e.prop("disabled",!1).val("Save")},this),this.model.edit(this.formData()),!1},cancel:function(){return this.remove(),this.trigger("cancel"),!1}}),Chorus.Comments.Views.FlagDialog=Backbone.View.extend({templateId:"comment-flag-dialog-template",events:{"submit form":"submit"},render:function(){var e=this.template({comment:this.model.toJSON()});return Chorus.Comments.openModal(e),this.setElement("#comment_flag_modal"),this.trigger("render",this),this},submit:function(){return this.model.flag(this.$("form").serialize()),Chorus.Comments.closeModal(),!1}}),Chorus.Comments.Views.Footer=Backbone.View.extend({templateId:"comments-footer-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.FormattingGuide=Backbone.View.extend({id:"comment_formatting_guide",templateId:"comment-formatting-guide-template",render:function(){return this.$el.html(this.template()).hide(),this.trigger("render",this),this}}),Chorus.Comments.Views.Header=Backbone.View.extend({className:"comments-header ui-state-unloaded",templateId:"comments-header-template",events:{"click .show_comments_link":"loadComments","click .tips_link":"toggleTips","click .auto_update_alert_toggle":"toggleAutoUpdateAlert","click .touch_tools_toggle":"toggleTouchTools"},initialize:function(){this.listenTo(Chorus.Comments,"start",this.showLoadingIndicator),this.listenTo(this.collection,"loadSuccess",this.hideLoadingIndicator),this.listenTo(this.collection,"loadError",this.showLoadError),this.listenTo(this.collection,"loadSuccess",this.render),this.listenTo(this.collection,"updateSuccess",this.updateCount)},render:function(){return this.$el.html(this.template({context:Chorus.Comments.context,settings:Chorus.Comments.settings})),this.trigger("render",this),this},loadComments:function(){return Chorus.Comments.start(),!1},toggleTips:function(){return this.$el.toggleClass("ui-state-tips-active"),!1},showLoadError:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-loading").addClass("ui-state-load-error")},showLoadingIndicator:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-load-error").addClass("ui-state-loading")},hideLoadingIndicator:function(){this.$el.removeClass("ui-state-unloaded").removeClass("ui-state-loading").removeClass("ui-state-load-error").addClass("ui-state-loaded")},updateCount:function(){this.$(".count").text(this.collection.length)},toggleAutoUpdateAlert:function(){var e=!Chorus.Comments.settings.showAutoUpdateAlert;return Chorus.Comments.settings.showAutoUpdateAlert=e,this.$(".auto_update_alert_toggle").text(e?"Hide it!":"Show it!"),!1},toggleTouchTools:function(){return Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.toggle(),!1}}),Chorus.Comments.Views.InspectFlagsDialog=Backbone.View.extend({templateId:"comment-inspect-flags-dialog-template",render:function(){if(!this.model.flaggingsLoaded)return this.model.once("loadFlaggingsSuccess",this.render,this),this.model.loadFlaggings(),this;var e=this.template({comment:this.model.toJSON(),flaggings:_.invoke(this.model.flaggings(),"toJSON")});return Chorus.Comments.openModal(e),this.setElement("#inspect_flags_modal"),this.trigger("render",this),this}}),Chorus.Comments.Views.MainForm=Chorus.Comments.Views.BaseForm.extend({id:"main_comment_form",className:"cform cform-main",templateId:"comment-main-form-template",submitText:"Post",events:function(){var e=_.clone(Chorus.Comments.Views.BaseForm.prototype.events);return e["click #formatting_guide_links a"]="toggleFormattingGuide",e},render:function(){this.$el.html(this.template({context:Chorus.Comments.context})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);var e=new Chorus.Comments.Views.FormattingGuide;return e.render().$el.appendTo(this.el),this.trigger("render",this),this},cancel:function(){return this.previewView&&(this.previewView.remove(),this.previewView=null),this.$(".preview-controls").hide(),this.$(".post_comment_button").prop("disabled",!1).val("Post"),this.$(".preview_comment_button").prop("disabled",!1).val("Preview"),this.$("form").get(0).reset(),this.trigger("cancel"),!1},toggleFormattingGuide:function(e){return jQuery(e.target).hide().siblings().show(),jQuery("#comment_formatting_guide").slideToggle(),!1}}),Chorus.Comments.Views.Main=Backbone.View.extend({events:{"click .spoiler":"toggleSpoiler"},initialize:function(){var e=Chorus.Comments.Views;this.header=new e.Header({collection:this.collection}),this.commentList=new e.CommentList({collection:this.collection}),this.footer=new e.Footer,Chorus.Comments.settings.startOnScroll&&this.pollScrollPosition(),this.listenTo(this.collection,"loadSuccess",this.renderWithContext),this.listenTo(this.collection,"loadError",this.renderError)},render:function(){return this.$el.append(this.header.render().el,this.commentList.render().el),this.trigger("render",this),this},remove:function(){return this.header.remove(),this.commentList.remove(),this.footer.remove(),this.mainForm&&this.mainForm.remove(),this.touchTools&&this.touchTools.remove(),this.autoUpdateAlert&&this.autoUpdateAlert.remove(),this.$el.remove(),this},renderWithContext:function(){var e=Chorus.Comments.Views,t=Chorus.Comments.context,n=Chorus.Comments.settings,o=!1;t.comments_closed?(this.mainForm=new e.CommentsClosedNotice,o=!0):t.able_to_comment?this.mainForm=new e.MainForm({collection:this.collection}):(this.mainForm=new Backbone.View,o=!0);var i=new e.AccountActions;return this.$el.append(i.render().el,this.mainForm.render().el,this.footer.render().el),o&&!_.isUndefined(Chorus.Auth)&&Chorus.Auth.init(),t.able_to_comment&&Chorus.Environment.touch()&&(this.touchTools=new e.TouchTools({collection:this.collection}),this.touchTools.render().$el.appendTo(this.el)),n.autoUpdateEnabled&&n.showAutoUpdateAlert&&(this.autoUpdateAlert=new e.AutoUpdateAlert({collection:this.collection}),this.autoUpdateAlert.render().$el.appendTo(this.el)),this.trigger("render",this),this},renderError:function(){this.$el.append('<h2 class="comments-load-error-msg">There was an error loading the comments. Please try again later</h2>')},pollScrollPosition:function(){var e=this.$el,t=jQuery(window),n=Chorus.Comments.settings.scrollBuffer,o=function(){e.offset().top-t.scrollTop()-t.height()-n<0&&Chorus.Comments.start()};o=_.throttle(o,200),o(),t.on("scroll",o),Chorus.Comments.once("start",function(){t.off("scroll",o)})},toggleSpoiler:function(e){return jQuery(e.target).toggleClass("reveal_spoiler"),!1}}),Chorus.Comments.Views.ReplyForm=Chorus.Comments.Views.BaseForm.extend({className:"cform",templateId:"comment-reply-form-template",submitText:"Reply",renderTo:function(e){return this.$el.html(this.template({context:Chorus.Comments.context,comment:this.model.toJSON()})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp),this.$el.appendTo(e),this.$("[autofocus]:first").focus(),this.trigger("render",this),this},cancel:function(){return this.remove(),this.trigger("cancel"),!1}}),Chorus.Comments.Views.TouchTools=Backbone.View.extend({id:"comment_touch_tools",templateId:"comment-touch-tools-template",events:{"click .close":"toggle","click .refresh":"refresh","click .next":"activateNext","click .mark":"markAllRead"},initialize:function(){this.listenTo(this.collection,"updateSuccess updateError",this.stopLoading)},render:function(){return this.$el.html(this.template()),this.trigger("render",this),this},toggle:function(){return this.$el.toggle(),!1},refresh:function(){return this.$el.addClass("loading"),this.collection.update(),!1},stopLoading:function(){this.$el.removeClass("loading")},activateNext:function(){return Chorus.Comments.view.commentList.markReadAndActivateNext(),!1},markAllRead:function(){return Chorus.Comments.view.commentList.markAllRead(),!1},show:function(){return this.$el.show(),!1},hide:function(){return this.$el.hide(),!1}});var Chorus=Chorus||{};Chorus.RemoteEntryAdminPermissions=function(e){"use strict";function t(){var t=e(s).map(function(t,n){return e(n).data(r)});t=_.uniq(_.compact(t)).sort(),t.length&&e.ajax({method:"GET",url:a,dataType:"json",data:{entry_ids:t.join(":")},success:n,error:o})}function n(e){i=_.extend(i,{loaded:!0},e),Chorus.EventDispatcher.publish("permissionsLoaded",_.clone(i),!0)}function o(){console&&console.error("there was an error loading the permissions object from the client controls")}var i={loaded:!1},r="remote-admin-entry-id",a="/remote_entry_admin/check_permissions",s="*[data-"+r+"]";return{init:function(){Chorus.Context.logged_in!==!1&&t()},getPermissions:function(){return i}}}(jQuery),jQuery(Chorus.RemoteEntryAdminPermissions.init);var Chorus=Chorus||{};Chorus.EntryAdminControls=function(e){"use strict";function t(t){e(p).each(function(n,o){var i=e(o),r=i.data(m),a=t[r];if(a&&a.permitted===!0){var s=i.data(f);"button"===s&&(i.append(C(a)),i.on("click",l)),"pane"===s&&i.load(g,{entry_id:r},function(){i.on("mouseenter",c),i.on("mouseleave",u)})}}),e("body").on("click","#inspect-images-link",d),e("body").on("click","#hide-entry-link",h)}function n(e){Chorus.EventDispatcher.publish("modal_open",{url:v,data:{entry_id:e}})}function o(e){return"*[data-"+m+'="'+e+'"][data-'+f+'="pane"]'}function i(t){e(o(t)).addClass("is-active")}function r(t){e(o(t)).removeClass("is-active")}function a(t){var n="Hidden"===t.text();t.text(n?"Unhiding":"Hiding"),e.ajax({method:"POST",url:t.attr("href"),dataType:"text",complete:function(){location.reload(!0)}})}function s(e){t(e)}function l(t){if(Util.UserAgentProfiler.isMobile()===!1){var i=e(t.delegateTarget).data(m);e(o(i)).length<1&&(t.preventDefault(),n(i))}}function c(t){i(e(t.delegateTarget).data(m))}function u(t){r(e(t.delegateTarget).data(m))}function d(t){t.preventDefault(),Chorus.EventDispatcher.publish("modal_open",{url:b+"/"+e(t.target).data(m)})}function h(t){var n=confirm("Are you sure?");return n?(t.preventDefault(),void a(e(t.target))):!1}var m="remote-admin-entry-id",f="remote-admin-entry-type",p="*[data-"+f+"]",g="/remote_entry_admin/pane",v="/remote_entry_admin/actions_modal",b="/remote_entry_admin/image_sizes_modal",C=_.template('<a href="[%= data.edit_url%]">Edit Entry</a>');return{init:function(){Chorus.Context.logged_in!==!1&&Chorus.EventDispatcher.subscribe("permissionsLoaded",s)}}}(jQuery),jQuery(Chorus.EntryAdminControls.init);var Chorus=Chorus||{};Chorus.RemoteHeadlineEdit=function(e){"use strict";function t(t){var n=t.data("remote-headline-promo-headine"),o=e(C({current_headline:t.text(),headline_save_url:v,field:t.data(p),entry_id:t.data(f),include_buttons:n?!1:!0}));if(t.after(o),t.addClass("is-editing"),o.on("change",'input[type="text"]',h),o.on("click",'input[type="submit"]',d),o.on("click",'input[value="cancel"]',u),o.on("submit",function(e){e.preventDefault()}),n){var i=e(C({current_headline:n,headline_save_url:v,field:g,entry_id:t.data(f),include_buttons:!0}));o.after(i),i.on("change",'input[type="text"]',h),i.on("click",'input[type="submit"]',d),i.on("click",'input[value="cancel"]',u),i.on("submit",function(e){e.preventDefault()})}}function n(t,n){return n===g&&(n="title"),e("*[data-"+p+'="'+n+'"][data-'+f+'="'+t+'"]')}function o(e){n(e.data(f),e.data(p)).removeClass("is-editing"),e.siblings(".m-inline-headline-edit__form").remove(),e.remove()}function i(e){e.find('input[type="text"], input[type="submit"]').prop("disabled",!0)}function r(e){e.find('input[type="text"], input[type="submit"]').prop("disabled",!1)}function a(e){e.data("remote-headline-edit-submit",!0)}function s(t){t.add(t.siblings(".m-inline-headline-edit__form")).each(function(t,a){var s=e(a);if(s.data("remote-headline-edit-submit")===!0){var l=s.find('input[name="entry_id"]').val(),c=s.find('input[name="new_value"]').val(),u=s.find('input[name="field"]').val();i(s),e.ajax({method:"POST",url:v,dataType:"json",data:{entry_id:l,field:u,value:c},success:function(e){u===g?n(l,"title").data("remote-headline-promo-headine",c):n(l,u).text(c),o(s),alert(Util.stringToTitleCase(u.replace(/_/g," "))+" saved!")},error:function(e,t){r(s),alert("There was an error recieving data from the server.")}})}})}function l(t){e("*[data-"+p+"]").each(function(n,o){var i=e(o),r=t[i.data(f)];r&&r.permitted===!0&&(i.addClass("is-editable"),i.on("click",c))})}function c(n){n.preventDefault();var o=e(n.delegateTarget);o.hasClass("is-editing")===!1&&t(o)}function u(t){t.preventDefault(),o(e(t.delegateTarget))}function d(t){t.preventDefault(),s(e(t.delegateTarget))}function h(t){a(e(t.delegateTarget))}function m(e){e.is_headline_editor===!0&&l(e)}var f="remote-admin-entry-id",p="remote-headline-edit",g="promo_headline_field",v="/remote_entry_admin/update_title",b=['<form action="[%= data.headline_save_url %]" data-'+f+'="[%= data.entry_id %]" data-'+p+'= "[%= data.field %]" method="post" class="m-inline-headline-edit__form">','<label for="new_value">[%= data.field.replace(/_/g, " ")  %]</label>','<input type="text" name="new_value" value="[%= data.current_headline %]" />','<input type="hidden" name="entry_id" value="[%= data.entry_id %]" />','<input type="hidden" name="field" value="[%= data.field %]" />','[% if (data.include_buttons === true) { %]<input type="submit" value="Save" class="p-button"/>','<input type="button" value="cancel" class="p-button" /> [% } %]',"</form>"].join(""),C=_.template(b);return{init:function(){Chorus.Context.logged_in!==!1&&Util.UserAgentProfiler.isMobile()!==!0&&Chorus.EventDispatcher.subscribe("permissionsLoaded",m)}}}(jQuery),jQuery(Chorus.RemoteHeadlineEdit.init);var Chorus=Chorus||{};Chorus.HubAdminMenu=function(e){"use strict";function t(){o.on("click",function(){o.toggleClass("is-open")}),n()}function n(){o.on("mouseenter",function(){if(!i){i=!0;var t=o.find(".m-quick_admin__pageviews");if(0!==t.length){var n=t.find(".m-quick_admin__pageviews-count"),r=window.location.hostname+window.location.pathname;e.ajax({method:"GET",dataType:"json",url:"http://providence.voxmedia.com/api/count.json",data:{event_name:"page_view",location:r},success:function(e){n.html(Number(e.count).toLocaleString()+" "+n.html()),t.show()}})}}})}var o=e("#hub-admin-menu"),i=!1;return{init:function(){t()}}}(jQuery),jQuery(Chorus.HubAdminMenu.init);var Util=Util||{};Util.UserAgentProfiler=function(){var e="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||navigator.msMaxTouchPoints>0,t=window.innerWidth,n=window.navigator.userAgent,o=e&&728>t||window.location.href.indexOf("mobile=true")>0,i=e&&t>=728,r=!o&&!i,a=/(iPad|iPhone|iPod)/g.test(n),s=a&&/OS\s(7|6_1_4)/g.test(n),l=/Android/g.test(n),c=!1,u=o?"mobile":i?"tablet":"desktop";if(n.indexOf("Android")>0)for(var d=n.split(";"),h=0,m=d.length;m>h;h++)if(d[h].indexOf("Android")>0){var f=d[h].split(" ");if(parseInt(f[f.length-1].split(".")[0])<3){c=!0;break}}return{screenWidth:function(){return t},profile:function(){return u},isTablet:function(){return i},isMobile:function(){return o},isDesktop:function(){return r},isAndroid:function(){return l},isAndroidLt3:function(){return c},isIOS:function(){return a},isIOS7:function(){return s},deviceTypeForAds:function(){return this.profile()},browserWidthForAds:function(){return Chorus.Environment.currentBreakpoint().name},doNotTrack:function(){var e;if(void 0!==navigator.doNotTrack)e=navigator.doNotTrack;else if(void 0!==window.doNotTrack)e=window.doNotTrack;else{if(void 0===navigator.msDoNotTrack)return"unsupported";e=navigator.msDoNotTrack}return/1|yes|true/.test(e)?"1":"0"}}}();var Kicksend={mailcheck:{threshold:3,defaultDomains:"yahoo.com google.com hotmail.com gmail.com me.com aol.com mac.com live.com comcast.net googlemail.com msn.com hotmail.co.uk yahoo.co.uk facebook.com verizon.net sbcglobal.net att.net gmx.com mail.com".split(" "),defaultTopLevelDomains:"co.uk com net org info edu gov mil".split(" "),run:function(e){e.domains=e.domains||Kicksend.mailcheck.defaultDomains,e.topLevelDomains=e.topLevelDomains||Kicksend.mailcheck.defaultTopLevelDomains,e.distanceFunction=e.distanceFunction||Kicksend.sift3Distance;var t=Kicksend.mailcheck.suggest(encodeURI(e.email),e.domains,e.topLevelDomains,e.distanceFunction);t?e.suggested&&e.suggested(t):e.empty&&e.empty()},suggest:function(e,t,n,o){if(e=e.toLowerCase(),e=this.splitEmail(e),t=this.findClosestDomain(e.domain,t,o)){if(t!=e.domain)return{address:e.address,domain:t,full:e.address+"@"+t}}else if(n=this.findClosestDomain(e.topLevelDomain,n),e.domain&&n&&n!=e.topLevelDomain)return t=e.domain,t=t.substring(0,t.lastIndexOf(e.topLevelDomain))+n,{address:e.address,domain:t,full:e.address+"@"+t};return!1},findClosestDomain:function(e,t,n){var o,i=99,r=null;if(!e||!t)return!1;n||(n=this.sift3Distance);for(var a=0;a<t.length;a++){if(e===t[a])return e;o=n(e,t[a]),i>o&&(i=o,r=t[a])}return i<=this.threshold&&null!==r?r:!1},sift3Distance:function(e,t){if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(var n=0,o=0,i=0,r=0;n+o<e.length&&n+i<t.length;){if(e.charAt(n+o)==t.charAt(n+i))r++;else for(var a=i=o=0;5>a;a++){if(n+a<e.length&&e.charAt(n+a)==t.charAt(n)){o=a;break}if(n+a<t.length&&e.charAt(n)==t.charAt(n+a)){i=a;break}}n++}return(e.length+t.length)/2-r},splitEmail:function(e){if(e=e.split("@"),2>e.length)return!1;for(var t=0;t<e.length;t++)if(""===e[t])return!1;var n=e.pop(),o=n.split("."),i="";if(0==o.length)return!1;if(1==o.length)i=o[0];else{for(t=1;t<o.length;t++)i+=o[t]+".";2<=o.length&&(i=i.substring(0,i.length-1))}return{topLevelDomain:i,domain:n,address:e.join("@")}}}};window.jQuery&&function(e){e.fn.mailcheck=function(e){var t=this;if(e.suggested){var n=e.suggested;e.suggested=function(e){n(t,e)}}if(e.empty){var o=e.empty;e.empty=function(){o.call(null,t)}}e.email=this.val(),Kicksend.mailcheck.run(e)}}(jQuery);var Chorus=Chorus||{},handleRecaptchaLoad=function(){Chorus.Auth.actions.captcha.addAll()};Chorus.Auth=function(e){return{config:function(t){this.element={wrapper:e(".m-auth-modal__wrapper"),modal:e(".m-auth-modal"),close:e(".m-auth-modal__close"),body:e(".m-auth-modal__body"),form:e(".m-auth-modal__form"),loginTable:e(".m-auth-modal__login-table"),loadingMsg:e("#chorus-auth-loading-message")},this.authTriggers={data:e("[data-chorus-auth]"),goTo:e("[data-chorus-auth-goto]"),auto:e("[data-chorus-auth-auto]"),facebook:e('[data-chorus-auth-login="facebook"]'),openId:e('[data-chorus-auth-login="openid"]'),twitter:e('[data-chorus-auth-login="twitter"]'),yahoo:e('[data-chorus-auth-login="yahoo"]'),password:e("#chorus-auth-password")},this.globals={serializedForm:"",bindOnceExecuted:!1,dispatcherDefined:!!Chorus&&!!Chorus.EventDispatcher},this.openModalClass="-has-open-auth-modal",this.networkUrl=this.element.modal.data("chorus-auth-network-url"),Chorus.Auth.helpers.noCorsSupport()&&(this.networkUrl=Chorus.Auth.helpers.httpNetworkUrl()),t()},defaultAjaxOptions:{xhrFields:{withCredentials:!0}},init:function(){this.config(function(){Chorus.Auth.networkUrl&&(window.addEventListener&&window.addEventListener("message",function(e){var t=Chorus.Auth.helpers.httpNetworkUrl();if(e.origin===t&&"function"==typeof e.data.trim&&"{"===e.data.trim()[0]){var n=JSON.parse(e.data);n.is_from_chorus_auth&&Chorus.Auth.actions.callbacks.chorusAuth(n)}},!1),Chorus.Auth.events.bindOnce(),Chorus.Auth.helpers.placeholderPolyfill(),Chorus.Auth.helpers.checkForAutoLoad())})},events:{bindOnce:function(){Chorus.Auth.globals.bindOnceExecuted===!1&&(Util.UserAgentProfiler.isMobile()||Chorus.Auth.authTriggers.data.on("click",Chorus.Auth.modal.open),Chorus.Auth.globals.dispatcherDefined&&Chorus.EventDispatcher.subscribe("modal_closed_by_modaljs",Chorus.Auth.modal.forceClose),Chorus.Auth.globals.bindOnceExecuted=!0)},bind:function(){Chorus.Auth.authTriggers.goTo.on("click",Chorus.Auth.modal.goTo),Chorus.Auth.element.wrapper.on("click",Chorus.Auth.modal.close),Chorus.Auth.element.modal.find(Chorus.Auth.element.close).on("click",Chorus.Auth.modal.close),Chorus.Auth.authTriggers.password.on("submit",Chorus.Auth.actions.login.password);var e=Chorus.Auth.modal.goTo("login",!0);e.find('[name="username"]').on("change",Chorus.Auth.actions.validate.at_sign);var t=Chorus.Auth.modal.goTo("rec-migrate",!0);t.find("#rec-migrate-already").on("click",function(e){e.preventDefault(),Chorus.Auth.modal.goTo("rec-migrate-login")}),t.find("form").on("submit",Chorus.Auth.actions.form.startSubmission),t.find('[name="user[username]"]').on("focus blur",Chorus.Auth.actions.validate.username),t.find('[name="user[password]"]').on("blur",Chorus.Auth.actions.validate.password);var n=Chorus.Auth.modal.goTo("rec-migrate-login",!0);n.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var o=Chorus.Auth.modal.goTo("forgot",!0);o.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var i=Chorus.Auth.modal.goTo("forgot-username",!0);i.find("form").on("submit",Chorus.Auth.actions.form.startSubmission),Chorus.Auth.authTriggers.facebook.on("click",function(e){Chorus.Auth.actions.login.facebook(e)}),Chorus.Auth.authTriggers.twitter.on("click",function(e){Chorus.Auth.actions.login.twitter(e)}),Chorus.Auth.authTriggers.yahoo.on("click",function(e){Chorus.Auth.actions.login.yahoo(e)}),Chorus.Auth.authTriggers.openId.on("click",function(e){Chorus.Auth.actions.showOpenIdForm(e)}),Chorus.Auth.element.form.filter(".openid").on("submit",function(e){Chorus.Auth.actions.login.openId(e)});for(var r=["join","register-join"],a=0;a<r.length;a++){var s=Chorus.Auth.modal.goTo(r[a],!0);s.find('input[type="checkbox"]').on("change",Chorus.Auth.actions.validate.checkboxEnablesForm),s.find("form").on("submit",Chorus.Auth.actions.form.startSubmission)}Chorus.Auth.modal.goTo("umbel-permissions",!0).find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var l=Chorus.Auth.modal.goTo("third-party-register",!0);l.find('[name="user[username]"]').on("focus",Chorus.Auth.actions.validate.validationEnablesForm),l.find('[name="user[username]"]').on("focus blur",Chorus.Auth.actions.validate.username),l.find("form").on("submit",Chorus.Auth.actions.form.startSubmission),Chorus.Auth.modal.goTo("captcha",!0).find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var c=Chorus.Auth.modal.goTo("register",!0);c.find('[name="user[username]"]').on("blur",Chorus.Auth.actions.validate.username),c.find('[name="user[password]"]').on("blur",Chorus.Auth.actions.validate.password),c.find('[name="user[email]"]').on("blur",Chorus.Auth.actions.validate.email),c.find('[name="user[email]"]').on("blur",Chorus.Auth.actions.validate.suggestEmail),c.find("form").on("submit",Chorus.Auth.actions.form.startSubmission)}},actions:{validate:{email:function(e){var t=Chorus.Auth.actions.validate.getInputContext(e);t.errorId="email",_.isEmpty(t.value)?(t.status.removeClass("error success"),Chorus.Auth.actions.validate.errors.clear(t)):Chorus.Auth.actions.validate.testAgainstJSON("email_valid",{email:t.value},t)},suggestEmail:function(t){var n=Chorus.Auth.actions.validate.getInputContext(t);n.errorId="suggest-email",e(n.input).mailcheck({suggested:function(e,t){Chorus.Auth.actions.validate.errors.show(n,"Did you mean "+t.full+"?")},empty:function(e){Chorus.Auth.actions.validate.errors.clear(n)}})},at_sign:function(t){var n=Chorus.Auth.actions.validate.getInputContext(t);-1===n.value.indexOf("@")?e(".username-at-sign-warning").hide():e(".username-at-sign-warning").show()},username:function(e){var t=Chorus.Auth.actions.validate.getInputContext(e);t.errorId="username",_.isEmpty(t.value)||t.value==t.input.attr("placeholder")?t.status.removeClass("error success"):Chorus.Auth.actions.validate.testAgainstJSON("username_available",{username:t.value},t)},password:function(e){var t=Chorus.Auth.actions.validate.getInputContext(e);if(t.errorId="password",_.isEmpty(t.value))t.status.removeClass("error success");else{var n=t.value.length>=6&&t.value.match(/\d/)&&t.value.match(/\d/).length&&t.value.match(/[a-z]/i)&&t.value.match(/[a-z]/i).length?!0:!1;Chorus.Auth.actions.validate.addCheckOrX(n,t)}},checkboxEnablesForm:function(e){var t=Chorus.Auth.actions.validate.getInputContext(e);t.errorId="checkbox";var n=t.modalObj.find('[type="submit"]');t.input.is(":checked")?n.removeAttr("disabled"):n.attr("disabled",!0)},getInputContext:function(t){var n=e(t.target),o=n.parents(Chorus.Auth.element.body.selector),i={input:n,status:n.parent(),value:n.val(),modal:o.data("chorus-auth-modal"),modalObj:o,errorMsg:n.data("error-msg"),errorEl:n.parent().find("h6")};return i},testAgainstJSON:function(t,n,o){e.getJSON(Chorus.Auth.networkUrl+"/chorus_auth/"+t+".json?callback=?",n).success(function(e){Chorus.Auth.actions.validate.addCheckOrX(e,o)})},addCheckOrX:function(e,t){e.available||_.isBoolean(e)&&e?(t.status.addClass("success"),t.status.removeClass("error"),Chorus.Auth.actions.validate.errors.clear(t)):(t.status.addClass("error"),t.status.removeClass("success"),_.isUndefined(e.message)?Chorus.Auth.actions.validate.errors.show(t):Chorus.Auth.actions.validate.errors.show(t,e.message))},isFormValid:function(t){var n=e(t.target),o=n.find("fieldset").filter("[data-chorus-auth-validate]").length,i=n.find("fieldset").filter("[data-chorus-auth-validate].success").length;return o===i},errors:{show:function(t,n){var o=_.isUndefined(n)?t.errorMsg:n;t.status.find("#"+t.errorId).length||(e("<h6/>").appendTo(t.status).attr("id",t.errorId).text(o),t.status.hasClass("error")||(t.status.addClass("error"),t.status.removeClass("success")))},clear:function(e){e.status.find("#"+e.errorId).remove()}}},form:{startSubmission:function(t){var n=e(t.target).parents(Chorus.Auth.element.body.selector);switch(n.data("chorus-auth-modal")){case"forgot":Chorus.Auth.modal.spinner("Sending...");var o=e(t.target).find("[name='email']").val();e.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/request_password_reset.json",data:{email:o},dataType:"json",success:function(e){var t=Chorus.Auth.modal.goTo("forgot-result",!0);t.find(".auth-error").text(""),t.find(".success").text(e.message),"success"===e.message_type&&(t.find('[ data-chorus-auth-goto="forgot"]').hide(),t.find(".third-party").hide()),Chorus.Auth.modal.goTo("forgot-result")},error:function(e,t,n){var o=(JSON.parse(e.responseText),Chorus.Auth.modal.goTo("forgot-result",!0));o.find(".success").text(""),o.find(".auth-error").text(data.message),Chorus.Auth.modal.goTo("forgot-result")}},Chorus.Auth.defaultAjaxOptions));break;case"forgot-username":Chorus.Auth.modal.spinner("Sending...");var o=e(t.target).find("[name='email']").val();e.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/request_username_retrieval.json",data:{email:o},dataType:"json",success:function(e){var t=Chorus.Auth.modal.goTo("forgot-username-result",!0);t.find(".auth-error").text(""),t.find(".success").text(e.message),"success"===e.message_type&&(t.find('[ data-chorus-auth-goto="forgot-username"]').hide(),t.find(".third-party").hide()),Chorus.Auth.modal.goTo("forgot-username-result")},error:function(e,t,n){var o=(JSON.parse(e.responseText),Chorus.Auth.modal.goTo("forgot-username-result",!0));o.find(".success").text(""),o.find(".auth-error").text(data.message),Chorus.Auth.modal.goTo("forgot-username-result")}},Chorus.Auth.defaultAjaxOptions));break;case"join":Chorus.Auth.actions.form.submitJoin();break;case"register-join":Chorus.Auth.isCaptchaRequired?Chorus.Auth.modal.goTo("captcha"):Chorus.Auth.actions.form.completeSubmission();break;case"umbel-permissions":Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.modal.goTo("third-party-register");break;case"rec-migrate":Chorus.Auth.actions.validate.isFormValid(t)&&(Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.isCaptchaRequired=!1,Chorus.Auth.modal.goTo("register-join",!0).length?Chorus.Auth.modal.goTo("register-join"):Chorus.Auth.actions.form.completeSubmission());break;case"rec-migrate-login":t.preventDefault(),Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.actions.login.recLinkChorus(t);break;case"third-party-register":Chorus.Auth.actions.validate.isFormValid(t)&&(Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.isCaptchaRequired=!1,Chorus.Auth.modal.goTo("register-join",!0).length?Chorus.Auth.modal.goTo("register-join"):Chorus.Auth.actions.form.completeSubmission());break;case"captcha":
Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.actions.form.completeSubmission(Chorus.Auth.actions.captcha.error);break;case"register":if(Chorus.Auth.actions.validate.isFormValid(t)){Chorus.Auth.provider="password",Chorus.Auth.actions.form.serialize(t.target),Chorus.Auth.actions.captcha.init("chorus-auth-register-recaptcha");var i=e(t.target).find("[name='user[username]']").val();Chorus.Auth.modal.goTo("captcha",!0).find("span.username").text(i),Chorus.Auth.isCaptchaRequired=!0,Chorus.Auth.modal.goTo("register-join",!0).length?Chorus.Auth.modal.goTo("register-join"):Chorus.Auth.modal.goTo("captcha")}}t.preventDefault()},completeSubmission:function(t){return e.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/register.json",data:Chorus.Auth.globals.serializedForm,dataType:"json",success:function(e){Chorus.Auth.actions.login.completeLogin("Register")},error:function(e,n,o){var i=JSON.parse(e.responseText);t(i.message)}},Chorus.Auth.defaultAjaxOptions)),Chorus.Auth.modal.spinner("Registering"),!1},submitJoin:function(){var t=Chorus.Auth.networkUrl+"/chorus_auth/join_community.json";return Chorus.Context.community_id&&(t=t+"?community_id="+Chorus.Context.community_id),e.ajax(_.extend({type:"post",url:t,dataType:"json",success:function(e){window.location.reload()},error:function(e,t,n){var o=JSON.parse(e.responseText);console.log(o.message)}},Chorus.Auth.defaultAjaxOptions)),Chorus.Auth.modal.spinner("Registering"),!1},serialize:function(t){_.isEmpty(Chorus.Auth.globals.serializedForm)||(Chorus.Auth.globals.serializedForm+="&"),Chorus.Auth.globals.serializedForm+=e(t).serialize()}},captcha:{recaptchaInstances:[],init:function(){window.grecaptcha?Chorus.Auth.actions.captcha.resetAll():e.getScript("https://www.google.com/recaptcha/api.js?onload=handleRecaptchaLoad&render=explicit")},resetAll:function(){window.grecaptcha&&Chorus.Auth.actions.captcha.recaptchaInstances.length>0&&Chorus.Auth.actions.captcha.recaptchaInstances.forEach(function(e){grecaptcha.reset(e)})},addAll:function(){var e={sitekey:document.querySelector("[data-recaptcha-site-id]").getAttribute("data-recaptcha-site-id")};Chorus.Auth.actions.captcha.recaptchaInstances=[grecaptcha.render("chorus-auth-login-recaptcha",e),grecaptcha.render("chorus-auth-register-recaptcha",e)]},error:function(e){Chorus.Auth.actions.captcha.init(),Chorus.Auth.modal.goTo("captcha",!0).find(".auth-error").text(e),Chorus.Auth.modal.goTo("captcha")}},callbacks:{thirdParty:function(e,t,n){var o=Chorus.Auth.modal.goTo("third-party-register",!0);if(!_.isUndefined(t)){var i=o.find('[name="user[username]"]');i.val(t),i.focus()}_.isUndefined(n)||o.find(".m-auth-modal__avatar").attr("src",n)},chorusAuth:function(e){if(e.logged_in)Chorus.Auth.actions.login.completeLogin("Login");else if(_.isUndefined(e.error))Chorus.Auth.actions.callbacks.thirdParty(e.provider,e.username,e.profile_image_url),"facebook"===e.provider?Chorus.Auth.modal.goTo("umbel-permissions"):Chorus.Auth.modal.goTo("third-party-register");else{var t=Chorus.Auth.modal.goTo("register",!0);t.find(".auth-error").text(e.error),Chorus.Auth.modal.goTo("register")}}},login:{yahoo:function(e){Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_yahoo_auth"),Chorus.Auth.provider="yahoo",e.preventDefault()},openId:function(t){var n=e(t.target).find("[name='openid']").val();Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_openid_auth?openid_url="+n),Chorus.Auth.provider="open_id",t.preventDefault()},twitter:function(e){var t=Chorus.Auth.networkUrl+"/chorus_auth/initiate_twitter_auth";Chorus.Auth.actions.openAuthWindow(t),Chorus.Auth.provider="twitter",e.preventDefault()},facebook:function(e){Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_facebook_auth"),Chorus.Auth.provider="facebook",e.preventDefault()},gplus:function(t){Chorus.Auth.provider="google_plus",t.code&&t["g-oauth-window"]&&(Chorus.Auth.modal.spinner("Authenticating"),e.ajax(_.extend({type:"POST",url:Chorus.Auth.networkUrl+"/chorus_auth/finalize_google_plus_auth.json?",data:{code:t.code},success:function(e){Chorus.Auth.actions.callbacks.chorusAuth(e)},dataType:"json"},Chorus.Auth.defaultAjaxOptions)))},recLinkChorus:function(t){var n=e(t.target);return e.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/rec_link_chorus.json",data:Chorus.Auth.globals.serializedForm,dataType:"json",success:function(e){e.logged_in?Chorus.Auth.actions.login.completeLogin("Login"):("undefined"!=typeof e.message&&n.find(".auth-error").text(e.message),Chorus.Auth.modal.goTo("rec-migrate-login"))},error:function(e,t,n){JSON.parse(e.responseText)}},Chorus.Auth.defaultAjaxOptions)),Chorus.Auth.modal.spinner("Registering"),!1},password:function(t){var n=e(t.target),o=function(e){if(Chorus.Auth.provider="password",e.logged_in)Chorus.Auth.actions.login.completeLogin("Login");else{if("undefined"!=typeof e.next_action)return void Chorus.Auth.modal.goTo(e.next_action);e.captcha_required&&Chorus.Auth.actions.captcha.init("chorus-auth-login-recaptcha"),"undefined"!=typeof e.message&&n.find(".auth-error").text(e.message),Chorus.Auth.modal.goTo("login")}};e.ajax(_.extend({type:"POST",url:Chorus.Auth.networkUrl+"/chorus_auth/initiate_password_auth.json",data:n.serialize(),success:o,dataType:"json"},Chorus.Auth.defaultAjaxOptions)),Chorus.Auth.modal.spinner("Logging in..."),Chorus.DynamicSizedImages.applyTo(".m-auth-modal"),t.preventDefault()},completeLogin:function(e){setTimeout(function(){window.location.reload()},100)}},openAuthWindow:function(e){Chorus.Auth.modal.spinner("Authenticating");var t=window.open(e,"_blank","height=450,width=800,menubar=yes,status=yes,scrollbars=yes,resizable=yes,titlebar=yes,toolbar=no,menubar=yes,location=yes");t||alert("welp, window blocked")},resetLoginOptions:function(){Chorus.Auth.element.loginTable.each(function(){e(this).find("tr").not(":first").addClass("other")}),Chorus.Auth.element.form.filter(".openid").hide()},showOpenIdForm:function(t){var n=e(t.target),o=n.parents(Chorus.Auth.element.body.selector);o.find(Chorus.Auth.element.form).filter(".openid").toggle(),t.preventDefault()}},modal:{open:function(t){var n=_.isObject(t)?e(this).data("chorus-auth"):t;if(Chorus.Auth.helpers.noCorsSupport()&&Chorus.Auth.helpers.notOnNetworkDomain()){var o=Chorus.Auth.helpers.httpNetworkUrl(),i=window.location.href.split("?")[0];window.location.href=o+"/login?return_to="+i}else Chorus.Auth.element.modal.find('[data-chorus-auth-modal="'+n+'"]').show(),Chorus.Auth.globals.dispatcherDefined&&Chorus.EventDispatcher.publish("modal_open",{content:Chorus.Auth.element.modal});_.isObject(t)&&t.preventDefault(),Chorus.DynamicSizedImages.applyTo(".m-auth-modal"),Chorus.Auth.events.bind()},forceClose:function(){e("body").removeClass(Chorus.Auth.openModalClass),Chorus.Auth.element.wrapper.hide(),Chorus.Auth.element.modal.find("[data-chorus-auth-modal]").hide(),Chorus.Auth.actions.resetLoginOptions()},close:function(t){t.target===this&&(e("body").removeClass(Chorus.Auth.openModalClass),Chorus.Auth.element.wrapper.hide(),Chorus.Auth.element.modal.find("[data-chorus-auth-modal]").hide(),Chorus.Auth.actions.resetLoginOptions(),t.preventDefault())},goTo:function(t,n){var o=_.isObject(t)?e(this).data("chorus-auth-goto"):t,i=Chorus.Auth.element.body.filter('[data-chorus-auth-modal="'+o+'"]');return _.isUndefined(n)?(Chorus.Auth.element.body.filter(":visible").hide(),i.show(),void(_.isObject(t)&&t.preventDefault())):i},spinner:function(e){Chorus.Auth.element.loadingMsg.text(e),Chorus.Auth.modal.goTo("spinner")},moveIntoView:function(){var t=e(window).scrollTop();Chorus.Auth.element.modal.css("top",t)}},helpers:{placeholderPolyfill:function(){var t=document.createElement("input");"placeholder"in t||Chorus.Auth.element.modal.find("[placeholder]").focus(function(){var t=e(this);t.val()===t.attr("placeholder")&&(t.val(""),t.removeClass("placeholder"))}).blur(function(){var t=e(this);(""===t.val()||t.val()===t.attr("placeholder"))&&(t.addClass("placeholder"),t.val(t.attr("placeholder")))}).blur()},checkForAutoLoad:function(){if(1===Chorus.Auth.authTriggers.auto.length){var e=Chorus.Auth.authTriggers.auto.eq(0).data("chorus-auth-auto");Chorus.Auth.modal.open(e)}},httpNetworkUrl:function(){return null==Chorus.Auth.networkUrl?null:Chorus.Auth.networkUrl.replace(/^https:\/\//,"http://")},noCorsSupport:function(){return window.navigator.userAgent.match(/MSIE (6|7|8|9)/)},notOnNetworkDomain:function(){return 0!==window.location.href.indexOf(Chorus.Auth.helpers.httpNetworkUrl())}}}}(jQuery),jQuery(function(){Chorus.Auth.init()}),/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.8.0.sbn
 * - Hacked so that it lazy loads non-IMG tags
 * - Hacked so that the scroll event that ends up firing lazyload:appear is debounced
 * - Hacked so resize event is debounced
 * - Hacked so data attributes are not cached via jQuery (neccesary for optimization)
 *
 */
function(e,t){var n=e(t);e.fn.lazyload=function(o){function i(e,t){return"undefined"!=typeof _?_.debounce(e,t):e}function r(){var t=0;s.each(function(){var n=e(this);if(!l.skip_invisible||n.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else n.trigger("lazyload:appear")})}var a,s=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,scrollInterval:200,resizeInterval:250};if(o&&(void 0!==o.failurelimit&&(o.failure_limit=o.failurelimit,delete o.failurelimit),void 0!==o.effectspeed&&(o.effect_speed=o.effectspeed,delete o.effectspeed),e.extend(l,o)),a=void 0===l.container||l.container===t?n:e(l.container),0===l.event.indexOf("scroll")){var c=function(e){return r()};a.bind(l.event,i(c,l.scrollInterval))}this.each(function(){var n=this,o=e(n);n.loaded=!1,n.error_event_set=!1;var r=4e3,a=4,c=0,u=function(){if(!this.loaded){if(l.appear){var i=s.length;l.appear.call(n,i,l)}if("IMG"===this.tagName)e("<img />").bind("load",function(){o.hide().attr("src",o.attr("data-"+l.data_attribute))[l.effect](l.effect_speed),n.loaded=!0;var t=e.grep(s,function(e){return!e.loaded});if(s=e(t),l.load){var i=s.length;l.load.call(n,i,l)}}).bind("error",function(){n.error_event_set||t.setTimeout(e.proxy(d,this),r),n.error_event_set=!0}).attr("src",o.attr("data-"+l.data_attribute));else{o.css("background-image","url('"+o.attr("data-"+l.data_attribute)+"')")[l.effect](l.effect_speed),n.loaded=!0;var a=e.grep(s,function(e){return!e.loaded});if(s=e(a),l.load){var i=s.length;l.load.call(n,i,l)}}}},d=function(){if(c+=1,a>=c){e(this).bind("error",function(){t.setTimeout(e.proxy(d,this),r)});var n=this.src.split("?")[0];this.src=n+"?"+(new Date).getTime()}};if(o.one("lazyload:appear",u),0!==l.event.indexOf("scroll")){var h=function(e){n.loaded||o.trigger("lazyload:appear")};o.bind(l.event,i(h,l.scrollInterval))}});var u=function(e){r()};return n.bind("resize",i(u,l.resizeInterval)),r(),this},e.belowthefold=function(o,i){var r;return r=void 0===i.container||i.container===t?n.height()+n.scrollTop():e(i.container).offset().top+e(i.container).height(),r<=e(o).offset().top-i.threshold},e.rightoffold=function(o,i){var r;return r=void 0===i.container||i.container===t?n.width()+n.scrollLeft():e(i.container).offset().left+e(i.container).width(),r<=e(o).offset().left-i.threshold},e.abovethetop=function(o,i){var r;return r=void 0===i.container||i.container===t?n.scrollTop():e(i.container).offset().top,r>=e(o).offset().top+i.threshold+e(o).height()},e.leftofbegin=function(o,i){var r;return r=void 0===i.container||i.container===t?n.scrollLeft():e(i.container).offset().left,r>=e(o).offset().left+i.threshold+e(o).width()},e.inviewport=function(t,n){return!(e.rightofscreen(t,n)||e.leftofscreen(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return!e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(e){function t(t,n){var s={failure_limit:20,load:function(){var t=e(this),n=t.parent(".image-window");if(t.is("img")&&(n.length>0?(t.css({position:"absolute",top:Math.round((n.outerHeight()-t.outerHeight())/2),left:Math.round((n.outerWidth()-t.outerWidth())/2)}),"undefined"==typeof t.attr("height")&&t.css("height","auto")):"undefined"==typeof t.attr("height")&&t.css("height","auto")),t.addClass(r),t.removeClass(a),t.removeClass("m-chorus-asset__in-entry-body"),e.fn.playGIF){var o=Chorus.Context.gif_opts||{},i={on:"touchstart",off:"touchstart"};if(Chorus.Context&&Chorus.Context.main_link_color&&(o.circleBackgroundColor=Chorus.Context.main_link_color,o.circleTextColor="FFFFFF"),"undefined"==typeof PLAYGIF_DISABLE_FLAG){var s=e('.m-entry__body img[src*=".gif"], .m-entry__body img[data-original*=".gif"], .m-block__fanshot-media img[src*=".gif"]'),l=e('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');s.length+l.length===1?PLAYGIF_DISABLE_FLAG=!0:s&&s.length>0&&(PLAYGIF_DISABLE_FLAG=!1,Modernizr.touch?s.playGIF(i):s.playGIF(o))}Modernizr.touch?t.playGIF(i):t.playGIF(o)}},threshold:800};n&&e.extend(s,n),t=e("undefined"!=typeof t&&null!==t?t:"body");var l=t.find(i+":visible").not("."+a+", ."+r),c=[],u=[];l.each(function(){var t,n,i,r,l,d=e(this),h=d.attr("data-imgkey"),m=d.data("chorus-asset-id");if("undefined"!=typeof h){if(s.parentDimensionSlc){var f=d.closest(s.parentDimensionSlc);t=f.outerWidth(),n=f.outerHeight()}t||(t=d.outerWidth()),n||(n=d.outerHeight()),0==n&&(i=d.data("ratio"),n="undefined"!=typeof i&&i>0?Math.ceil(t/i):t),d.is("img")&&(i=d.data("ratio"),r=d.parent(".image-window"),"undefined"!=typeof i&&i>0&&(n=Math.ceil(t/i)),r.length>0&&(t=Math.ceil(r.outerWidth()),n=Math.ceil(r.outerHeight())),n>0&&d.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),Chorus.Context&&"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n)),/\.(png|jpg|jpeg)$/i.test(d.attr("data-original"))&&o.webp&&!Chorus.Modernizr.touch&&(l="webp");var p=h+":"+t+"x"+n+(l?":"+l:"");c.push(p),d.attr("data-dim",t+"x"+n),d.addClass(a)}else if("undefined"!=typeof m){t=d.outerWidth(),n=d.outerHeight(),d.is("img")&&(i=d.data("ratio"),r=d.parent(".image-window"),"undefined"!=typeof i&&i>0&&(n=Math.ceil(t/i)),r.length>0&&(t=Math.ceil(r.outerWidth()),n=Math.ceil(r.outerHeight())),n>0&&d.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n));var g=m+":"+t+":"+n;u.push(g),d.data("asset-key",g),d.addClass(a)}else d.lazyload(s)}),(0!==c.length||0!==u.length)&&(e.each([u,c],function(e,t){t.sort(function(e,t){return+e.split(":")[0]-+t.split(":")[0]})}),e.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",timeout:1e4,data:{imgkeys:c.join(","),asset_keys:u.join(",")},success:function(t){var n=t.urls,o={};_.forEach(n,function(e,t){var n=t.replace(/\:webp|\:jp2/,"");o[n]=e}),n=o,l.each(function(){var t,o=e(this);t=o.attr("data-imgkey")?o.attr("data-imgkey")+":"+o.attr("data-dim"):o.data("asset-key");var i=n[t];"undefined"!=typeof i&&(o.attr("data-original",i),o.lazyload(s))})}}))}e(document).ready(function(){Chorus.DynamicSizedImages.init(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("dynamic-images-available",{},!0)});var n={},o={webp:!1,jp2:!1},i=".vox-lazy-load",r="lazy-loaded",a="lazy-loading";return n.init=function(){function e(){if(Chorus.Modernizr.localstorage&&window.localStorage.getItem("supportsWebp"))o.webp="true"===window.localStorage.getItem("supportsWebp")?!0:!1,i();else{var e=new Image;e.onload=function(){o.webp=!!(e.height>0&&e.width>0),Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",o.webp),i()},e.onerror=function(){o.webp=!1,Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",o.webp),i()},e.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4IBoAAAAwAQCdASoBAAEAAIAOJaQAA3AA/v89WAAAAA=="}}function i(){Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading?Chorus.Context.defer_image_loading=!1:n.initUI(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(e){t(e.modules)})}e()},n.initUI=function(e,n){t(e,n)},n.applyTo=function(e,n){t(e,n)},n}(jQuery),function(){"use strict";/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */
function e(t,o){function i(e,t){return function(){return e.apply(t,arguments)}}var r;if(o=o||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=o.touchBoundary||10,this.layer=t,this.tapDelay=o.tapDelay||200,this.tapTimeout=o.tapTimeout||700,!e.notNeeded(t)){for(var a=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],s=this,l=0,c=a.length;c>l;l++)s[a[l]]=i(s[a[l]],s);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,o){var i=Node.prototype.removeEventListener;"click"===e?i.call(t,e,n.hijacked||n,o):i.call(t,e,n,o)},t.addEventListener=function(e,n,o){var i=Node.prototype.addEventListener;"click"===e?i.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),o):i.call(t,e,n,o)}),"function"==typeof t.onclick&&(r=t.onclick,t.addEventListener("click",function(e){r(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,o=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,i=o&&/OS 4_\d(_\d)?/.test(navigator.userAgent),r=o&&/OS [6-7]_\d/.test(navigator.userAgent),a=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(o&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,o;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),o=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;o&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;if(t=e.fastClickScrollParent,!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,r;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],o){if(r=window.getSelection(),r.rangeCount&&!r.isCollapsed)return!0;if(!i){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,a,s,l,c,u=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,a=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,r&&(c=e.changedTouches[0],u=document.elementFromPoint(c.pageX-window.pageXOffset,c.pageY-window.pageYOffset)||u,u.fastClickScrollParent=this.targetElement.fastClickScrollParent),s=u.tagName.toLowerCase(),"label"===s){if(t=this.findControl(u)){if(this.focus(u),n)return!1;u=t}}else if(this.needsFocus(u))return e.timeStamp-a>100||o&&window.top!==window&&"input"===s?(this.targetElement=null,!1):(this.focus(u),this.sendClick(u,e),o&&"select"===s||(this.targetElement=null,e.preventDefault()),!1);return o&&!i&&(l=u.fastClickScrollParent,l&&l.fastClickLastScrollTop!==l.scrollTop)?!0:(this.needsClick(u)||(e.preventDefault(),this.sendClick(u,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,o,i,r;if("undefined"==typeof window.ontouchstart)return!0;if(o=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(o>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(a&&(i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),i[1]>=10&&i[2]>=3&&(t=document.querySelector("meta[name=viewport]")))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction?!0:(r=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],r>=27&&(t=document.querySelector("meta[name=viewport]"),t&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===e.style.touchAction||"manipulation"===e.style.touchAction?!0:!1)},e.attach=function(t,n){return new e(t,n)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1);